import{r as Zr,R as D,a as m,j as e,u as xs,b as gs,c as bs,m as A,A as fe,g as ea}from"./vendor-DTrRP3K8.js";import{c as ta}from"./supabase-mJBJ84dL.js";import{R as sa,S as ra,M as ss,U as He,b as Qe,L as rs,c as Ce,A as aa,d as na,P as as,u as ia,e as zs,f as vt,g as Ut,h as oa,C as la,i as yt,B as ns,j as ot,X as _e,E as Fs,k as is,l as Lt,m as ca,n as $s,o as Gs,T as Bs,p as $t,F as Ot,q as da,r as Vs,s as ua,t as os,D as qs,I as Us,v as ls,V as it,w as zt,x as Hs,y as ma,z as pa,G as fa,H as Xe,J as ha,K as xa,N as ga,O as ba,Q as Ws,W as Ft,Y as Ys,Z as Js,$ as Ks,a0 as va,a1 as ya,a2 as Xs,a3 as ja,a4 as wa,a5 as Na,a6 as Ca,a7 as Sa,a8 as ka,a9 as _a,aa as Qs,ab as Ct,ac as Gt,ad as Ta,ae as Ra}from"./ui-D225BVvN.js";function Pa(t,a){for(var s=0;s<a.length;s++){const r=a[s];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var St={},vs;function Ea(){if(vs)return St;vs=1;var t=Zr();return St.createRoot=t.createRoot,St.hydrateRoot=t.hydrateRoot,St}var Ia=Ea();const cs="umgfxbipblzpgpejlnzg",ds="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtZ2Z4YmlwYmx6cGdwZWpsbnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODY5MDIsImV4cCI6MjA4MjE2MjkwMn0.fkNxfMwxqGR5EUALb5C3QxQvSMXsDyRyHf8tltWpm2Y",Ma=`https://${cs}.supabase.co`,Aa=ds,Z=ta(Ma,Aa,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}}),Da={en:{loginTitle:"Welcome Back",loginSubtitle:"Sign in to continue",emailPlaceholder:"Email address",passwordPlaceholder:"Password",loginButton:"Sign In",signupLink:"Create an account",chatsTitle:"Chats",searchPlaceholder:"Search conversations...",newChatButton:"New Chat",typeMessage:"Type a message...",online:"Online",offline:"Last seen",typing:"typing...",settings:"Settings",profile:"Profile",language:"Language",logout:"Log Out",notifications:"Notifications",sounds:"Sounds",privacy:"Privacy",help:"Help",theme:"Theme",account:"Account",blocked:"Blocked Users",general:"General",darkMode:"Dark Mode",lightMode:"Light Mode",systemMode:"System",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy",info:"Info",members:"Members",media:"Media",files:"Files",links:"Links",voice:"Voice",video:"Video",call:"Call",mute:"Mute",unmute:"Unmute",camera:"Camera",screenShare:"Screen Share",endCall:"End Call",accept:"Accept",reject:"Reject",calling:"Calling...",ringing:"Ringing...",connecting:"Connecting...",reconnecting:"Reconnecting...",ended:"Call Ended",missed:"Missed Call",incoming:"Incoming Call",outgoing:"Outgoing Call",today:"Today",yesterday:"Yesterday",justNow:"Just now",sent:"Sent",delivered:"Delivered",read:"Read",failed:"Failed",uploading:"Uploading...",downloading:"Downloading...",success:"Success",error:"Error",retry:"Retry",loading:"Loading...",noChats:"No chats yet",startChat:"Start a conversation",createGroup:"Create Group",groupName:"Group Name",addMembers:"Add Members",create:"Create",groupCreated:"Group created successfully",userJoined:"User joined",userLeft:"User left",admin:"Admin",kick:"Remote",promote:"Promote",demote:"Demote",leaveGroup:"Leave Group",deleteGroup:"Delete Group",areYouSure:"Are you sure?",cannotUndo:"This action cannot be undone.",yes:"Yes",no:"No",ok:"OK"},ar:{loginTitle:"ŸÖÿ±ÿ≠ÿ®ÿßŸã",loginSubtitle:"ÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©",emailPlaceholder:"ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",passwordPlaceholder:"ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±",loginButton:"ÿØÿÆŸàŸÑ",signupLink:"ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ",chatsTitle:"ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™",searchPlaceholder:"ÿ®ÿ≠ÿ´...",newChatButton:"ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©",typeMessage:"ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©...",online:"ŸÖÿ™ÿµŸÑ",offline:"ÿ¢ÿÆÿ± ÿ∏ŸáŸàÿ±",typing:"ŸäŸÉÿ™ÿ®...",settings:"ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™",profile:"ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä",language:"ÿßŸÑŸÑÿ∫ÿ©",logout:"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨",notifications:"ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™",sounds:"ÿßŸÑÿ£ÿµŸàÿßÿ™",privacy:"ÿßŸÑÿÆÿµŸàÿµŸäÿ©",help:"ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©",theme:"ÿßŸÑŸÖÿ∏Ÿáÿ±",account:"ÿßŸÑÿ≠ÿ≥ÿßÿ®",blocked:"ÿßŸÑŸÖÿ≠ÿ∏Ÿàÿ±ŸäŸÜ",general:"ÿπÿßŸÖ",darkMode:"ÿØÿßŸÉŸÜ",lightMode:"ŸÅÿßÿ™ÿ≠",systemMode:"ÿßŸÑŸÜÿ∏ÿßŸÖ",save:"ÿ≠ŸÅÿ∏",cancel:"ÿ•ŸÑÿ∫ÿßÿ°",edit:"ÿ™ÿπÿØŸäŸÑ",delete:"ÿ≠ÿ∞ŸÅ",reply:"ÿ±ÿØ",forward:"ÿ™ÿ≠ŸàŸäŸÑ",copy:"ŸÜÿ≥ÿÆ",info:"ŸÖÿπŸÑŸàŸÖÿßÿ™",members:"ÿßŸÑÿ£ÿπÿ∂ÿßÿ°",media:"ÿßŸÑŸàÿ≥ÿßÿ¶ÿ∑",files:"ÿßŸÑŸÖŸÑŸÅÿßÿ™",links:"ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑",voice:"ÿµŸàÿ™Ÿä",video:"ŸÅŸäÿØŸäŸà",call:"ÿßÿ™ÿµÿßŸÑ",mute:"ŸÉÿ™ŸÖ",unmute:"ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿµŸàÿ™",camera:"ŸÉÿßŸÖŸäÿ±ÿß",screenShare:"ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ¥ÿßÿ¥ÿ©",endCall:"ÿ•ŸÜŸáÿßÿ°",accept:"ÿ±ÿØ",reject:"ÿ±ŸÅÿ∂",calling:"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ...",ringing:"Ÿäÿ±ŸÜ...",connecting:"Ÿäÿ™ÿµŸÑ...",reconnecting:"ŸäÿπŸäÿØ ÿßŸÑÿßÿ™ÿµÿßŸÑ...",ended:"ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÖŸÉÿßŸÑŸÖÿ©",missed:"ŸÖŸÉÿßŸÑŸÖÿ© ŸÅÿßÿ¶ÿ™ÿ©",incoming:"ŸÖŸÉÿßŸÑŸÖÿ© Ÿàÿßÿ±ÿØÿ©",outgoing:"ŸÖŸÉÿßŸÑŸÖÿ© ÿµÿßÿØÿ±ÿ©",today:"ÿßŸÑŸäŸàŸÖ",yesterday:"ÿ£ŸÖÿ≥",justNow:"ÿßŸÑÿ¢ŸÜ",sent:"ÿ™ŸÖ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ",delivered:"ÿ™ŸÖ ÿßŸÑŸàÿµŸàŸÑ",read:"ÿ™ŸÖÿ™ ÿßŸÑŸÇÿ±ÿßÿ°ÿ©",failed:"ŸÅÿ¥ŸÑ",uploading:"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ±ŸÅÿπ...",downloading:"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...",success:"ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠",error:"ÿÆÿ∑ÿ£",retry:"ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©",loading:"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...",noChats:"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ≠ÿßÿØÿ´ÿßÿ™",startChat:"ÿßÿ®ÿØÿ£ ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©",createGroup:"ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ¨ŸÖŸàÿπÿ©",groupName:"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©",addMembers:"ÿ•ÿ∂ÿßŸÅÿ© ÿ£ÿπÿ∂ÿßÿ°",create:"ÿ•ŸÜÿ¥ÿßÿ°",groupCreated:"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©",userJoined:"ÿßŸÜÿ∂ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",userLeft:"ÿ∫ÿßÿØÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",admin:"ŸÖÿ¥ÿ±ŸÅ",kick:"ÿ∑ÿ±ÿØ",promote:"ÿ™ÿ±ŸÇŸäÿ©",demote:"ÿ™ÿÆŸÅŸäÿ∂",leaveGroup:"ŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©",deleteGroup:"ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©",areYouSure:"ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü",cannotUndo:"ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°.",yes:"ŸÜÿπŸÖ",no:"ŸÑÿß",ok:"ÿ≠ÿ≥ŸÜÿßŸã"}};function La(t){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",a.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}const Oa=t=>{switch(t){case"success":return $a;case"info":return Ba;case"warning":return Ga;case"error":return Va;default:return null}},za=Array(12).fill(0),Fa=({visible:t,className:a})=>D.createElement("div",{className:["sonner-loading-wrapper",a].filter(Boolean).join(" "),"data-visible":t},D.createElement("div",{className:"sonner-spinner"},za.map((s,r)=>D.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),$a=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ga=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Ba=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Va=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),qa=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},D.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),D.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ua=()=>{const[t,a]=D.useState(document.hidden);return D.useEffect(()=>{const s=()=>{a(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),t};let Ht=1;class Ha{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{const s=this.subscribers.indexOf(a);this.subscribers.splice(s,1)}),this.publish=a=>{this.subscribers.forEach(s=>s(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var s;const{message:r,...n}=a,i=typeof(a==null?void 0:a.id)=="number"||((s=a.id)==null?void 0:s.length)>0?a.id:Ht++,l=this.toasts.find(p=>p.id===i),d=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),l?this.toasts=this.toasts.map(p=>p.id===i?(this.publish({...p,...a,id:i,title:r}),{...p,...a,id:i,dismissible:d,title:r}):p):this.addToast({title:r,...n,dismissible:d,id:i}),i},this.dismiss=a=>(a?(this.dismissedToasts.add(a),requestAnimationFrame(()=>this.subscribers.forEach(s=>s({id:a,dismiss:!0})))):this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),a),this.message=(a,s)=>this.create({...s,message:a}),this.error=(a,s)=>this.create({...s,message:a,type:"error"}),this.success=(a,s)=>this.create({...s,type:"success",message:a}),this.info=(a,s)=>this.create({...s,type:"info",message:a}),this.warning=(a,s)=>this.create({...s,type:"warning",message:a}),this.loading=(a,s)=>this.create({...s,type:"loading",message:a}),this.promise=(a,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:a,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));const n=Promise.resolve(a instanceof Function?a():a);let i=r!==void 0,l;const d=n.then(async u=>{if(l=["resolve",u],D.isValidElement(u))i=!1,this.create({id:r,type:"default",message:u});else if(Ya(u)&&!u.ok){i=!1;const o=typeof s.error=="function"?await s.error(`HTTP error! status: ${u.status}`):s.error,f=typeof s.description=="function"?await s.description(`HTTP error! status: ${u.status}`):s.description,g=typeof o=="object"&&!D.isValidElement(o)?o:{message:o};this.create({id:r,type:"error",description:f,...g})}else if(u instanceof Error){i=!1;const o=typeof s.error=="function"?await s.error(u):s.error,f=typeof s.description=="function"?await s.description(u):s.description,g=typeof o=="object"&&!D.isValidElement(o)?o:{message:o};this.create({id:r,type:"error",description:f,...g})}else if(s.success!==void 0){i=!1;const o=typeof s.success=="function"?await s.success(u):s.success,f=typeof s.description=="function"?await s.description(u):s.description,g=typeof o=="object"&&!D.isValidElement(o)?o:{message:o};this.create({id:r,type:"success",description:f,...g})}}).catch(async u=>{if(l=["reject",u],s.error!==void 0){i=!1;const c=typeof s.error=="function"?await s.error(u):s.error,o=typeof s.description=="function"?await s.description(u):s.description,v=typeof c=="object"&&!D.isValidElement(c)?c:{message:c};this.create({id:r,type:"error",description:o,...v})}}).finally(()=>{i&&(this.dismiss(r),r=void 0),s.finally==null||s.finally.call(s)}),p=()=>new Promise((u,c)=>d.then(()=>l[0]==="reject"?c(l[1]):u(l[1])).catch(c));return typeof r!="string"&&typeof r!="number"?{unwrap:p}:Object.assign(r,{unwrap:p})},this.custom=(a,s)=>{const r=(s==null?void 0:s.id)||Ht++;return this.create({jsx:a(r),id:r,...s}),r},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const ve=new Ha,Wa=(t,a)=>{const s=(a==null?void 0:a.id)||Ht++;return ve.addToast({title:t,...a,id:s}),s},Ya=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",Ja=Wa,Ka=()=>ve.toasts,Xa=()=>ve.getActiveToasts(),X=Object.assign(Ja,{success:ve.success,info:ve.info,warning:ve.warning,error:ve.error,custom:ve.custom,message:ve.message,promise:ve.promise,dismiss:ve.dismiss,loading:ve.loading},{getHistory:Ka,getToasts:Xa});La("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function kt(t){return t.label!==void 0}const Qa=3,Za="24px",en="16px",ys=4e3,tn=356,sn=14,rn=45,an=200;function Ie(...t){return t.filter(Boolean).join(" ")}function nn(t){const[a,s]=t.split("-"),r=[];return a&&r.push(a),s&&r.push(s),r}const on=t=>{var a,s,r,n,i,l,d,p,u;const{invert:c,toast:o,unstyled:f,interacting:v,setHeights:g,visibleToasts:_,heights:C,index:P,toasts:I,expanded:w,removeToast:k,defaultRichColors:O,closeButton:q,style:b,cancelButtonStyle:h,actionButtonStyle:R,className:E="",descriptionClassName:x="",duration:N,position:y,gap:T,expandByDefault:W,classNames:S,icons:V,closeButtonAriaLabel:j="Close toast"}=t,[$,ee]=D.useState(null),[H,Q]=D.useState(null),[M,Y]=D.useState(!1),[U,L]=D.useState(!1),[J,ne]=D.useState(!1),[te,ce]=D.useState(!1),[Pe,je]=D.useState(!1),[dt,Me]=D.useState(0),[et,Ye]=D.useState(0),be=D.useRef(o.duration||N||ys),ge=D.useRef(null),ue=D.useRef(null),Fe=P===0,tt=P+1<=_,he=o.type,Ee=o.dismissible!==!1,ut=o.className||"",mt=o.descriptionClassName||"",$e=D.useMemo(()=>C.findIndex(K=>K.toastId===o.id)||0,[C,o.id]),pt=D.useMemo(()=>{var K;return(K=o.closeButton)!=null?K:q},[o.closeButton,q]),Ge=D.useMemo(()=>o.duration||N||ys,[o.duration,N]),F=D.useRef(0),ie=D.useRef(0),Ae=D.useRef(0),Se=D.useRef(null),[Be,ft]=y.split("-"),Ve=D.useMemo(()=>C.reduce((K,oe,me)=>me>=$e?K:K+oe.height,0),[C,$e]),st=Ua(),ht=o.invert||c,z=he==="loading";ie.current=D.useMemo(()=>$e*T+Ve,[$e,Ve]),D.useEffect(()=>{be.current=Ge},[Ge]),D.useEffect(()=>{Y(!0)},[]),D.useEffect(()=>{const K=ue.current;if(K){const oe=K.getBoundingClientRect().height;return Ye(oe),g(me=>[{toastId:o.id,height:oe,position:o.position},...me]),()=>g(me=>me.filter(Ne=>Ne.toastId!==o.id))}},[g,o.id]),D.useLayoutEffect(()=>{if(!M)return;const K=ue.current,oe=K.style.height;K.style.height="auto";const me=K.getBoundingClientRect().height;K.style.height=oe,Ye(me),g(Ne=>Ne.find(xe=>xe.toastId===o.id)?Ne.map(xe=>xe.toastId===o.id?{...xe,height:me}:xe):[{toastId:o.id,height:me,position:o.position},...Ne])},[M,o.title,o.description,g,o.id]);const re=D.useCallback(()=>{L(!0),Me(ie.current),g(K=>K.filter(oe=>oe.toastId!==o.id)),setTimeout(()=>{k(o)},an)},[o,k,g,ie]);D.useEffect(()=>{if(o.promise&&he==="loading"||o.duration===1/0||o.type==="loading")return;let K;return w||v||st?(()=>{if(Ae.current<F.current){const Ne=new Date().getTime()-F.current;be.current=be.current-Ne}Ae.current=new Date().getTime()})():(()=>{be.current!==1/0&&(F.current=new Date().getTime(),K=setTimeout(()=>{o.onAutoClose==null||o.onAutoClose.call(o,o),re()},be.current))})(),()=>clearTimeout(K)},[w,v,o,he,st,re]),D.useEffect(()=>{o.delete&&re()},[re,o.delete]);function de(){var K;if(V!=null&&V.loading){var oe;return D.createElement("div",{className:Ie(S==null?void 0:S.loader,o==null||(oe=o.classNames)==null?void 0:oe.loader,"sonner-loader"),"data-visible":he==="loading"},V.loading)}return D.createElement(Fa,{className:Ie(S==null?void 0:S.loader,o==null||(K=o.classNames)==null?void 0:K.loader),visible:he==="loading"})}const De=o.icon||(V==null?void 0:V[he])||Oa(he);var we,xt;return D.createElement("li",{tabIndex:0,ref:ue,className:Ie(E,ut,S==null?void 0:S.toast,o==null||(a=o.classNames)==null?void 0:a.toast,S==null?void 0:S.default,S==null?void 0:S[he],o==null||(s=o.classNames)==null?void 0:s[he]),"data-sonner-toast":"","data-rich-colors":(we=o.richColors)!=null?we:O,"data-styled":!(o.jsx||o.unstyled||f),"data-mounted":M,"data-promise":!!o.promise,"data-swiped":Pe,"data-removed":U,"data-visible":tt,"data-y-position":Be,"data-x-position":ft,"data-index":P,"data-front":Fe,"data-swiping":J,"data-dismissible":Ee,"data-type":he,"data-invert":ht,"data-swipe-out":te,"data-swipe-direction":H,"data-expanded":!!(w||W&&M),style:{"--index":P,"--toasts-before":P,"--z-index":I.length-P,"--offset":`${U?dt:ie.current}px`,"--initial-height":W?"auto":`${et}px`,...b,...o.style},onDragEnd:()=>{ne(!1),ee(null),Se.current=null},onPointerDown:K=>{z||!Ee||(ge.current=new Date,Me(ie.current),K.target.setPointerCapture(K.pointerId),K.target.tagName!=="BUTTON"&&(ne(!0),Se.current={x:K.clientX,y:K.clientY}))},onPointerUp:()=>{var K,oe,me;if(te||!Ee)return;Se.current=null;const Ne=Number(((K=ue.current)==null?void 0:K.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),wt=Number(((oe=ue.current)==null?void 0:oe.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),xe=new Date().getTime()-((me=ge.current)==null?void 0:me.getTime()),ke=$==="x"?Ne:wt,Nt=Math.abs(ke)/xe;if(Math.abs(ke)>=rn||Nt>.11){Me(ie.current),o.onDismiss==null||o.onDismiss.call(o,o),Q($==="x"?Ne>0?"right":"left":wt>0?"down":"up"),re(),ce(!0);return}else{var Te,Re;(Te=ue.current)==null||Te.style.setProperty("--swipe-amount-x","0px"),(Re=ue.current)==null||Re.style.setProperty("--swipe-amount-y","0px")}je(!1),ne(!1),ee(null)},onPointerMove:K=>{var oe,me,Ne;if(!Se.current||!Ee||((oe=window.getSelection())==null?void 0:oe.toString().length)>0)return;const xe=K.clientY-Se.current.y,ke=K.clientX-Se.current.x;var Nt;const Te=(Nt=t.swipeDirections)!=null?Nt:nn(y);!$&&(Math.abs(ke)>1||Math.abs(xe)>1)&&ee(Math.abs(ke)>Math.abs(xe)?"x":"y");let Re={x:0,y:0};const hs=Je=>1/(1.5+Math.abs(Je)/20);if($==="y"){if(Te.includes("top")||Te.includes("bottom"))if(Te.includes("top")&&xe<0||Te.includes("bottom")&&xe>0)Re.y=xe;else{const Je=xe*hs(xe);Re.y=Math.abs(Je)<Math.abs(xe)?Je:xe}}else if($==="x"&&(Te.includes("left")||Te.includes("right")))if(Te.includes("left")&&ke<0||Te.includes("right")&&ke>0)Re.x=ke;else{const Je=ke*hs(ke);Re.x=Math.abs(Je)<Math.abs(ke)?Je:ke}(Math.abs(Re.x)>0||Math.abs(Re.y)>0)&&je(!0),(me=ue.current)==null||me.style.setProperty("--swipe-amount-x",`${Re.x}px`),(Ne=ue.current)==null||Ne.style.setProperty("--swipe-amount-y",`${Re.y}px`)}},pt&&!o.jsx&&he!=="loading"?D.createElement("button",{"aria-label":j,"data-disabled":z,"data-close-button":!0,onClick:z||!Ee?()=>{}:()=>{re(),o.onDismiss==null||o.onDismiss.call(o,o)},className:Ie(S==null?void 0:S.closeButton,o==null||(r=o.classNames)==null?void 0:r.closeButton)},(xt=V==null?void 0:V.close)!=null?xt:qa):null,(he||o.icon||o.promise)&&o.icon!==null&&((V==null?void 0:V[he])!==null||o.icon)?D.createElement("div",{"data-icon":"",className:Ie(S==null?void 0:S.icon,o==null||(n=o.classNames)==null?void 0:n.icon)},o.promise||o.type==="loading"&&!o.icon?o.icon||de():null,o.type!=="loading"?De:null):null,D.createElement("div",{"data-content":"",className:Ie(S==null?void 0:S.content,o==null||(i=o.classNames)==null?void 0:i.content)},D.createElement("div",{"data-title":"",className:Ie(S==null?void 0:S.title,o==null||(l=o.classNames)==null?void 0:l.title)},o.jsx?o.jsx:typeof o.title=="function"?o.title():o.title),o.description?D.createElement("div",{"data-description":"",className:Ie(x,mt,S==null?void 0:S.description,o==null||(d=o.classNames)==null?void 0:d.description)},typeof o.description=="function"?o.description():o.description):null),D.isValidElement(o.cancel)?o.cancel:o.cancel&&kt(o.cancel)?D.createElement("button",{"data-button":!0,"data-cancel":!0,style:o.cancelButtonStyle||h,onClick:K=>{kt(o.cancel)&&Ee&&(o.cancel.onClick==null||o.cancel.onClick.call(o.cancel,K),re())},className:Ie(S==null?void 0:S.cancelButton,o==null||(p=o.classNames)==null?void 0:p.cancelButton)},o.cancel.label):null,D.isValidElement(o.action)?o.action:o.action&&kt(o.action)?D.createElement("button",{"data-button":!0,"data-action":!0,style:o.actionButtonStyle||R,onClick:K=>{kt(o.action)&&(o.action.onClick==null||o.action.onClick.call(o.action,K),!K.defaultPrevented&&re())},className:Ie(S==null?void 0:S.actionButton,o==null||(u=o.classNames)==null?void 0:u.actionButton)},o.action.label):null)};function js(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function ln(t,a){const s={};return[t,a].forEach((r,n)=>{const i=n===1,l=i?"--mobile-offset":"--offset",d=i?en:Za;function p(u){["top","right","bottom","left"].forEach(c=>{s[`${l}-${c}`]=typeof u=="number"?`${u}px`:u})}typeof r=="number"||typeof r=="string"?p(r):typeof r=="object"?["top","right","bottom","left"].forEach(u=>{r[u]===void 0?s[`${l}-${u}`]=d:s[`${l}-${u}`]=typeof r[u]=="number"?`${r[u]}px`:r[u]}):p(d)}),s}const ws=D.forwardRef(function(a,s){const{invert:r,position:n="bottom-right",hotkey:i=["altKey","KeyT"],expand:l,closeButton:d,className:p,offset:u,mobileOffset:c,theme:o="light",richColors:f,duration:v,style:g,visibleToasts:_=Qa,toastOptions:C,dir:P=js(),gap:I=sn,icons:w,containerAriaLabel:k="Notifications"}=a,[O,q]=D.useState([]),b=D.useMemo(()=>Array.from(new Set([n].concat(O.filter(H=>H.position).map(H=>H.position)))),[O,n]),[h,R]=D.useState([]),[E,x]=D.useState(!1),[N,y]=D.useState(!1),[T,W]=D.useState(o!=="system"?o:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),S=D.useRef(null),V=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),j=D.useRef(null),$=D.useRef(!1),ee=D.useCallback(H=>{q(Q=>{var M;return(M=Q.find(Y=>Y.id===H.id))!=null&&M.delete||ve.dismiss(H.id),Q.filter(({id:Y})=>Y!==H.id)})},[]);return D.useEffect(()=>ve.subscribe(H=>{if(H.dismiss){requestAnimationFrame(()=>{q(Q=>Q.map(M=>M.id===H.id?{...M,delete:!0}:M))});return}setTimeout(()=>{sa.flushSync(()=>{q(Q=>{const M=Q.findIndex(Y=>Y.id===H.id);return M!==-1?[...Q.slice(0,M),{...Q[M],...H},...Q.slice(M+1)]:[H,...Q]})})})}),[O]),D.useEffect(()=>{if(o!=="system"){W(o);return}if(o==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?W("dark"):W("light")),typeof window>"u")return;const H=window.matchMedia("(prefers-color-scheme: dark)");try{H.addEventListener("change",({matches:Q})=>{W(Q?"dark":"light")})}catch{H.addListener(({matches:M})=>{try{W(M?"dark":"light")}catch(Y){console.error(Y)}})}},[o]),D.useEffect(()=>{O.length<=1&&x(!1)},[O]),D.useEffect(()=>{const H=Q=>{var M;if(i.every(L=>Q[L]||Q.code===L)){var U;x(!0),(U=S.current)==null||U.focus()}Q.code==="Escape"&&(document.activeElement===S.current||(M=S.current)!=null&&M.contains(document.activeElement))&&x(!1)};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[i]),D.useEffect(()=>{if(S.current)return()=>{j.current&&(j.current.focus({preventScroll:!0}),j.current=null,$.current=!1)}},[S.current]),D.createElement("section",{ref:s,"aria-label":`${k} ${V}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},b.map((H,Q)=>{var M;const[Y,U]=H.split("-");return O.length?D.createElement("ol",{key:H,dir:P==="auto"?js():P,tabIndex:-1,ref:S,className:p,"data-sonner-toaster":!0,"data-sonner-theme":T,"data-y-position":Y,"data-lifted":E&&O.length>1&&!l,"data-x-position":U,style:{"--front-toast-height":`${((M=h[0])==null?void 0:M.height)||0}px`,"--width":`${tn}px`,"--gap":`${I}px`,...g,...ln(u,c)},onBlur:L=>{$.current&&!L.currentTarget.contains(L.relatedTarget)&&($.current=!1,j.current&&(j.current.focus({preventScroll:!0}),j.current=null))},onFocus:L=>{L.target instanceof HTMLElement&&L.target.dataset.dismissible==="false"||$.current||($.current=!0,j.current=L.relatedTarget)},onMouseEnter:()=>x(!0),onMouseMove:()=>x(!0),onMouseLeave:()=>{N||x(!1)},onDragEnd:()=>x(!1),onPointerDown:L=>{L.target instanceof HTMLElement&&L.target.dataset.dismissible==="false"||y(!0)},onPointerUp:()=>y(!1)},O.filter(L=>!L.position&&Q===0||L.position===H).map((L,J)=>{var ne,te;return D.createElement(on,{key:L.id,icons:w,index:J,toast:L,defaultRichColors:f,duration:(ne=C==null?void 0:C.duration)!=null?ne:v,className:C==null?void 0:C.className,descriptionClassName:C==null?void 0:C.descriptionClassName,invert:r,visibleToasts:_,closeButton:(te=C==null?void 0:C.closeButton)!=null?te:d,interacting:N,position:H,style:C==null?void 0:C.style,unstyled:C==null?void 0:C.unstyled,classNames:C==null?void 0:C.classNames,cancelButtonStyle:C==null?void 0:C.cancelButtonStyle,actionButtonStyle:C==null?void 0:C.actionButtonStyle,closeButtonAriaLabel:C==null?void 0:C.closeButtonAriaLabel,removeToast:ee,toasts:O.filter(ce=>ce.position==L.position),heights:h.filter(ce=>ce.position==L.position),setHeights:R,expandByDefault:l,gap:I,expanded:E,swipeDirections:a.swipeDirections})})):null}))}),at=t=>{const a="/Chat-App/",s=a.startsWith("/")?a:`/${a}`,r=s.endsWith("/")?s:`${s}/`,n=t.startsWith("/")?t.substring(1):t;return`${r}${n}`},Ue=[{id:"whistle",name:"Whistle Chime",url:at("sounds/whistle.mp3")},{id:"bell",name:"Success Bell",url:at("sounds/bell.mp3")},{id:"note",name:"Electronic Note",url:at("sounds/note.mp3")},{id:"digital",name:"Digital Alert",url:at("sounds/digital.mp3")}];function cn(){const[t,a]=m.useState(null),[s,r]=m.useState(!0),[n,i]=m.useState("login"),l=m.useRef(null),d=m.useRef(!1),p=m.useRef(!1);m.useEffect(()=>{s||(p.current=!0)},[s]);const u=async o=>{var f;if(d.current)return null;if(l.current===o&&t)return r(!1),t;d.current=!0,console.log("üì• Fetching profile for:",o);try{const{data:v,error:g}=await Z.from("profiles").select("*").eq("id",o).single();if(g)return console.error("‚ùå Profile fetch error:",g),(g.code==="PGRST116"||(f=g.message)!=null&&f.includes("406"))&&(console.warn("Profile missing for user. Logging out to clear stale session."),await Z.auth.signOut(),a(null),l.current=null),null;console.log("‚úÖ Profile fetched successfully");const _={id:v.id,username:v.username,name:v.display_name||v.username,avatar_url:v.avatar_url};return l.current=o,(!t||t.id!==_.id||t.username!==_.username||t.name!==_.name||t.avatar_url!==_.avatar_url)&&(console.log("üë§ Updating currentUser state (reference change)"),a(_)),v.display_name||i("signup"),_}finally{d.current=!1,r(!1)}},c=async()=>{await Z.auth.signOut(),a(null),localStorage.removeItem("chat_app_view"),localStorage.removeItem("chat_app_selected_chat")};return m.useEffect(()=>{console.log("üîå useAuth effect started");let o=!0;const f=setTimeout(()=>{o&&!p.current&&(console.warn("‚ö†Ô∏è Auth check timed out, forcing load completion"),r(!1))},12e3);console.log("üîç Checking initial session..."),Z.auth.getSession().then(({data:{session:g}})=>{console.log("üìÑ Session result:",g?"Found":"Not Found"),o&&(g?u(g.user.id):r(!1))}).catch(g=>{console.error("‚ùå Session check failed:",g),o&&r(!1)});const{data:{subscription:v}}=Z.auth.onAuthStateChange((g,_)=>{console.log("üîÑ Auth state changed:",g),o&&(_?u(_.user.id):(a(null),i("login"),r(!1)))});return()=>{o=!1,clearTimeout(f),v.unsubscribe()}},[]),{currentUser:t,setCurrentUser:a,isLoading:s,setIsLoading:r,loginStep:n,setLoginStep:i,fetchProfile:u,logout:c}}function dn(t){const[a,s]=m.useState([]),[r,n]=m.useState(!1),[i,l]=m.useState(null),[d,p]=m.useState([]),u=m.useRef(null),c=m.useRef(0);m.useEffect(()=>{u.current=i},[i]);const o=m.useCallback(async b=>{if(b){console.log("üì® loadChats started for:",b),n(!0);try{const{data:h,error:R}=await Z.from("conversation_participants").select(`
          conversation_id,
          conversations (
              id,
              last_message_text,
              last_message_at
          )
        `).eq("user_id",b);if(R)throw R;const E=h.map(S=>S.conversation_id);let x=[],N={};if(E.length>0){const{data:S,error:V}=await Z.from("conversation_participants").select(`
            conversation_id,
            user_id,
            profiles (id, display_name, avatar_url)
          `).in("conversation_id",E).neq("user_id",b);if(V)throw V;x=S||[];const{data:j}=await Z.from("messages").select("conversation_id").eq("is_read",!1).neq("sender_id",b).in("conversation_id",E);j==null||j.forEach($=>{N[$.conversation_id]=(N[$.conversation_id]||0)+1})}const y=h.map(S=>{var $,ee;const V=x.find(H=>H.conversation_id===S.conversation_id),j=V!=null&&V.profiles&&!Array.isArray(V.profiles)?V.profiles.display_name:"Unknown User";return{id:S.conversation_id,partnerId:(V==null?void 0:V.user_id)||"unknown",partnerName:j,partnerAvatar:V!=null&&V.profiles&&!Array.isArray(V.profiles)?V.profiles.avatar_url:void 0,lastMessage:(($=S.conversations)==null?void 0:$.last_message_text)||"",lastMessageTime:((ee=S.conversations)==null?void 0:ee.last_message_at)||"",unreadCount:N[S.conversation_id]||0,isGroup:!1}});let T=[];try{const{data:S,error:V}=await Z.from("group_members").select(`
              group_id,
              groups (id, name, updated_at)
            `).eq("user_id",b);if(!V&&S&&S.length>0){const j=S.map(Q=>Q.group_id),{data:$}=await Z.from("group_messages").select("group_id").eq("is_read",!1).neq("sender_id",b).in("group_id",j),ee={};$==null||$.forEach(Q=>{ee[Q.group_id]=(ee[Q.group_id]||0)+1});const{data:H}=await Z.from("group_messages").select("group_id, text, created_at").in("group_id",j).order("created_at",{ascending:!1});T=S.map(Q=>{const M=Q.groups,Y=H==null?void 0:H.find(U=>U.group_id===M.id);return{id:M.id,partnerId:M.id,partnerName:M.name,partnerAvatar:void 0,lastMessage:(Y==null?void 0:Y.text)||"No messages yet",lastMessageTime:(Y==null?void 0:Y.created_at)||M.updated_at,unreadCount:ee[M.id]||0,isGroup:!0}})}}catch(S){console.warn("Group fetch error:",S)}const W=[...y,...T].sort((S,V)=>{const j=new Date(S.lastMessageTime).getTime();return new Date(V.lastMessageTime).getTime()-j});s(W),c.current=W.reduce((S,V)=>S+V.unreadCount,0)}catch(h){console.error("Error loading chats:",h),h.code==="42P17"&&X.error("Database Error: Recursive policy detected. Please run the SQL fix.")}finally{n(!1)}}},[]),f=async(b,h,R=!1)=>{R?await Z.from("group_messages").update({is_read:!0}).eq("group_id",b).neq("sender_id",h).eq("is_read",!1):await Z.from("messages").update({is_read:!0}).eq("conversation_id",b).neq("sender_id",h).eq("is_read",!1)},v=m.useCallback(async(b,h=!1)=>{var N,y;if(b!==((N=u.current)==null?void 0:N.id)||!b)return;let R,E;if(h){const T=await Z.from("group_messages").select("*").eq("group_id",b).order("created_at",{ascending:!1}).limit(50);R=T.data?T.data.reverse():[],E=T.error}else{const T=await Z.from("messages").select("*").eq("conversation_id",b).order("created_at",{ascending:!1}).limit(50);R=T.data?T.data.reverse():[],E=T.error}if(E){console.error("Error loading messages:",E);return}if(b!==((y=u.current)==null?void 0:y.id))return;const x=(R||[]).map(T=>({id:T.id,senderId:T.sender_id,text:T.text,fileUrl:T.file_url,fileType:T.file_type,fileName:T.file_name,timestamp:T.created_at,isRead:T.is_read||!1,replyToId:T.reply_to_id,reactions:T.reactions||{},poll:T.poll}));p(T=>{const W=T.filter(j=>j.isOptimistic),S=new Set(x.map(j=>j.id)),V=W.filter(j=>!S.has(j.id));return[...x,...V]}),t&&t.id&&f(b,t.id,h)},[t==null?void 0:t.id]);m.useEffect(()=>{t!=null&&t.id?(console.log("üöÄ useChats auto-loading for:",t.id),o(t.id).then(()=>{const b=localStorage.getItem("chat_app_selected_chat");if(b&&!u.current)try{const h=JSON.parse(b);console.log("üïØÔ∏è Restoring saved chat:",h.id),l(h),v(h.id,h.isGroup)}catch(h){console.error("Failed to parse saved chat",h)}})):(console.log("Emptying chats as no user is present"),s([]))},[t==null?void 0:t.id,o,v]);const g=m.useCallback(b=>{l(b),s(h=>h.map(R=>R.id===b.id?{...R,unreadCount:0}:R)),v(b.id,b.isGroup),localStorage.setItem("chat_app_selected_chat",JSON.stringify(b)),t!=null&&t.id&&f(b.id,t.id,b.isGroup)},[v,t]),_=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){const h=Math.random()*16|0;return(b==="x"?h:h&3|8).toString(16)}),C=m.useCallback(async(b,h)=>{p(R=>R.filter(E=>E.id!==b));try{const R=h?"group_messages":"messages";await Z.from(R).delete().eq("id",b)}catch(R){console.error("Error deleting message:",R)}},[]),P=m.useCallback(async(b,h,R,E,x,N,y)=>{var S,V,j;if(!t)return;const T=_(),W={id:T,senderId:t.id,text:h,fileUrl:R,fileType:E,fileName:x,timestamp:new Date().toISOString(),isRead:!1,isOptimistic:!0,replyToId:N};((S=u.current)==null?void 0:S.id)===b.id&&p($=>[...$,W]);try{let $,ee;if(b.isGroup){const H=await Z.from("group_messages").insert({id:T,group_id:b.id,sender_id:t.id,text:h,file_url:R,file_type:E,file_name:x,reply_to_id:N}).select().single();$=H.data,ee=H.error}else{const H=await Z.from("messages").insert({id:T,conversation_id:b.id,sender_id:t.id,text:h,file_url:R,file_type:E,file_name:x,reply_to_id:N}).select().single();$=H.data,ee=H.error}if(ee)throw ee;$&&(((V=u.current)==null?void 0:V.id)===b.id&&p(H=>H.map(Q=>Q.id===T?{...Q,isOptimistic:!1}:Q)),y&&y>0&&setTimeout(()=>C(T,b.isGroup),y*1e3),b.isGroup||await Z.from("conversations").update({last_message_text:h,last_message_at:new Date().toISOString()}).eq("id",b.id))}catch($){console.error("Error sending message:",$),((j=u.current)==null?void 0:j.id)===b.id&&p(ee=>ee.filter(H=>H.id!==T)),X.error("Failed to send message")}},[t,C]),I=m.useCallback(async(b,h,R,E,x,N)=>{u.current&&await P(u.current,b,h,R,E,x,N)},[P]),w=async(b,h)=>{if(t){s(R=>R.map(E=>E.id===b?{...E,isPinned:h}:E));try{h?await Z.from("pinned_conversations").insert({user_id:t.id,conversation_id:b}):await Z.from("pinned_conversations").delete().eq("user_id",t.id).eq("conversation_id",b)}catch(R){console.error("Error pinning chat:",R)}}},k=m.useCallback(async(b,h)=>{if(!t||!u.current)return;const R=u.current,E={question:b,options:h,votes:{}},x=R.isGroup?"group_messages":"messages",N=R.isGroup?"group_id":"conversation_id",y={id:Math.random().toString(36).substring(7),senderId:t.id,text:`Poll: ${b}`,timestamp:new Date().toISOString(),isRead:!1,poll:E};p(T=>[...T,y]);try{const{error:T}=await Z.from(x).insert({[N]:R.id,sender_id:t.id,text:`Poll: ${b}`,poll:E});if(T)throw T}catch(T){console.error("Poll error:",T)}},[t]),O=m.useCallback((b,h,R)=>{console.log("üì© useChats: Incoming message received:",b.id,"for chatId:",R),p(E=>{if(E.find(y=>y.id===b.id))return console.log("‚ôªÔ∏è useChats: Message already exists, skipping."),E;const x=u.current,N=R||(h?b.group_id:b.conversation_id);return console.log("üßê useChats: Matching...",{msgChatId:N,currentChatId:x==null?void 0:x.id}),t&&b.senderId!==t.id&&x&&N===x.id&&(console.log("üëÅÔ∏è useChats: Auto-marking as read"),f(x.id,t.id,h)),x&&N===x.id?(console.log("‚ú® useChats: Appending message to state"),[...E,b]):(console.log("‚è≠Ô∏è useChats: Message not for current chat, ignoring append."),E)})},[t,f]),q=m.useCallback(b=>{p(h=>h.map(R=>R.id===b.id?b:R))},[]);return{chats:a,setChats:s,isLoading:r,selectedChat:i,setSelectedChat:l,messages:d,setMessages:p,loadChats:o,loadMessages:v,handleSelectChat:g,selectedChatRef:u,markMessagesAsRead:f,handleSendMessage:I,handleDeleteMessage:C,handlePinChat:w,handleSendPoll:k,handleIncomingMessage:O,handleIncomingUpdate:q,sendMessageToChat:P}}function un({currentUser:t,soundEnabled:a}){const[s,r]=m.useState(null),n=m.useRef(null),i=m.useRef(null),l=m.useRef(null);m.useEffect(()=>{l.current=s},[s]),m.useEffect(()=>(n.current=new Audio(at("sounds/ringtone.mp3")),n.current.loop=!0,n.current.load(),()=>{var o;(o=n.current)==null||o.pause()}),[]);const d=m.useCallback((o,f,v)=>{(i.current||Z.channel("chat-realtime")).send({type:"broadcast",event:f,payload:{...v,recipientId:o}})},[]),p=async(o,f,v)=>{if(!t)return;const _={id:Math.random().toString(36).substring(7),callerId:t.id,callerName:t.name||t.username,recipientId:o,type:v,status:"ringing"};r(_)},u=async()=>{var o;s&&(r(f=>f?{...f,status:"connecting"}:null),(o=n.current)==null||o.pause())},c=m.useCallback(()=>{var f;const o=l.current;o&&(d(o.callerId,"call-ended",{id:o.id}),r(null),(f=n.current)==null||f.pause(),n.current&&(n.current.currentTime=0))},[d]);return m.useEffect(()=>{if(!(t!=null&&t.id))return;const o=Z.channel("chat-realtime");return i.current=o,o.on("broadcast",{event:"call-offer"},({payload:f})=>{if(f.recipientId===t.id){if(l.current){d(f.callerId,"call-ended",{id:f.id,reason:"busy"});return}a&&n.current&&n.current.play().catch(console.error),r({id:f.id,callerId:f.callerId,callerName:f.callerName,recipientId:f.recipientId,type:f.type,status:"ringing",offer:f.offer,iceCandidates:[]})}}).on("broadcast",{event:"call-answer"},({payload:f})=>{var v;f.recipientId===t.id&&(r(g=>g&&g.id===f.id?{...g,status:"connected",answer:f.answer}:g),(v=n.current)==null||v.pause())}).on("broadcast",{event:"ice-candidate"},({payload:f})=>{f.recipientId===t.id&&r(v=>v&&v.id===f.id?{...v,iceCandidates:[...v.iceCandidates||[],f.candidate]}:v)}).on("broadcast",{event:"call-ended"},({payload:f})=>{var v;r(g=>g&&g.id===f.id?(X.info("Call ended"),null):g),(v=n.current)==null||v.pause(),n.current&&(n.current.currentTime=0)}).subscribe(),()=>{var f;o.unsubscribe(),(f=n.current)==null||f.pause()}},[t==null?void 0:t.id,a,d]),{activeCall:s,setActiveCall:r,handleStartCall:p,handleAcceptCall:u,handleRejectCall:c,sendSignalingMessage:d}}function mn({currentUser:t,selectedChatRef:a,onNewMessage:s,onUpdateMessage:r,onReloadChats:n,soundEnabled:i,onIncomingCall:l,onCallAnswer:d,onIceCandidate:p,onCallEnded:u}){const[c,o]=m.useState(new Set),[f,v]=m.useState({}),g=m.useRef(null),_=m.useRef(null),C=m.useRef(null),P=m.useRef(s),I=m.useRef(r),w=m.useRef(n);m.useEffect(()=>{P.current=s,I.current=r,w.current=n},[s,r,n]);const[k,O]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||Ue[0].id);m.useEffect(()=>{localStorage.setItem("chat_app_sound_id",k);const x=Ue.find(N=>N.id===k)||Ue[0];g.current=new Audio(x.url),g.current.load(),_.current=new Audio(at("sounds/ringtone.mp3")),_.current.loop=!0,_.current.load()},[k]);const q=()=>{g.current&&i&&(g.current.currentTime=0,g.current.play().catch(x=>console.log("Sound play failed:",x)))};m.useEffect(()=>{if(!t)return;const x=`chat-realtime-${t.id}`;console.log(`üîå Subscribing to channel: ${x}`);const N=Z.channel(x);return C.current=N,N.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},y=>{console.log("üì• New 1-1 Message received",y.new.id),b(y.new,!1)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},y=>{console.log("üì• New Group Message received",y.new.id),b(y.new,!0)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},y=>{h(y.new,!1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages"},y=>{h(y.new,!0)}).on("postgres_changes",{event:"*",schema:"public",table:"conversations"},y=>{console.log("üîÑ Conversation updated, reloading chats..."),w.current()}).on("postgres_changes",{event:"*",schema:"public",table:"group_members"},()=>w.current()).on("presence",{event:"sync"},()=>{const y=N.presenceState(),T=new Set;Object.values(y).forEach(W=>{W.forEach(S=>T.add(S.user_id))}),o(T)}).on("broadcast",{event:"typing"},({payload:y})=>{v(T=>T[y.user_id]===y.isTyping?T:{...T,[y.user_id]:y.isTyping})}).on("broadcast",{event:"call-offer"},({payload:y})=>{y.recipientId===t.id&&l&&(i&&_.current&&_.current.play().catch(console.error),l(y))}).on("broadcast",{event:"call-answer"},({payload:y})=>{var T;y.recipientId===t.id&&d&&(d(y),(T=_.current)==null||T.pause())}).on("broadcast",{event:"ice-candidate"},({payload:y})=>{y.recipientId===t.id&&p&&p(y)}).on("broadcast",{event:"call-ended"},({payload:y})=>{var T;u&&u(y),(T=_.current)==null||T.pause(),_.current&&(_.current.currentTime=0)}).subscribe(async y=>{console.log(`üì° Subscription status for ${x}:`,y),y==="SUBSCRIBED"&&await N.track({user_id:t.id,online_at:new Date().toISOString()}),y==="CHANNEL_ERROR"&&(console.error("üö∑ Realtime subscription error. Retrying in 5s..."),setTimeout(()=>w.current(),5e3))}),()=>{var y;console.log(`üîå Unsubscribing from ${x}`),N.unsubscribe(),(y=_.current)==null||y.pause()}},[t==null?void 0:t.id,i]);const b=(x,N)=>{const y=a.current;console.log("üì© Raw Realtime Message:",x),console.log("üí¨ Current Chat in Ref:",y==null?void 0:y.id,"isGroup:",y==null?void 0:y.isGroup);const T={id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read||!1,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},W=x.group_id||x.conversation_id,S=!!y&&y.id===W;console.log(`üîç Comparison Result: ${S?"‚úÖ MATCH":"‚ùå NO MATCH"} (MsgChat: ${W} vs Current: ${y==null?void 0:y.id})`),S?(console.log("‚úÖ Message matches current chat, updating UI..."),P.current(T,N,W)):(console.log("‚ÑπÔ∏è Message is for another chat:",W),X.info(`New message in another chat: ${W.substring(0,8)}`)),x.sender_id!==(t==null?void 0:t.id)&&q(),w.current()},h=(x,N)=>{const y=a.current;(N?(y==null?void 0:y.isGroup)&&y.id===x.group_id:!(y!=null&&y.isGroup)&&(y==null?void 0:y.id)===x.conversation_id)&&I.current({id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},N)};return{onlineUsers:c,typingUsers:f,sendTypingIndicator:(x,N)=>{var y;(y=C.current)==null||y.send({type:"broadcast",event:"typing",payload:{user_id:t==null?void 0:t.id,partner_id:N,isTyping:x}})},sendSignalingMessage:(x,N,y)=>{C.current&&C.current.send({type:"broadcast",event:N,payload:{...y,recipientId:x}})},notificationSounds:Ue,currentSoundId:k,setCurrentSoundId:O,ringtoneSoundRef:_}}function Zs(t){var a,s,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(s=Zs(t[a]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s);return r}function us(){for(var t,a,s=0,r="",n=arguments.length;s<n;s++)(t=arguments[s])&&(a=Zs(t))&&(r&&(r+=" "),r+=a);return r}const Ns=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Cs=us,pn=(t,a)=>s=>{var r;if((a==null?void 0:a.variants)==null)return Cs(t,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:n,defaultVariants:i}=a,l=Object.keys(n).map(u=>{const c=s==null?void 0:s[u],o=i==null?void 0:i[u];if(c===null)return null;const f=Ns(c)||Ns(o);return n[u][f]}),d=s&&Object.entries(s).reduce((u,c)=>{let[o,f]=c;return f===void 0||(u[o]=f),u},{}),p=a==null||(r=a.compoundVariants)===null||r===void 0?void 0:r.reduce((u,c)=>{let{class:o,className:f,...v}=c;return Object.entries(v).every(g=>{let[_,C]=g;return Array.isArray(C)?C.includes({...i,...d}[_]):{...i,...d}[_]===C})?[...u,o,f]:u},[]);return Cs(t,l,p,s==null?void 0:s.class,s==null?void 0:s.className)},ms="-",fn=t=>{const a=xn(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:l=>{const d=l.split(ms);return d[0]===""&&d.length!==1&&d.shift(),er(d,a)||hn(l)},getConflictingClassGroupIds:(l,d)=>{const p=s[l]||[];return d&&r[l]?[...p,...r[l]]:p}}},er=(t,a)=>{var l;if(t.length===0)return a.classGroupId;const s=t[0],r=a.nextPart.get(s),n=r?er(t.slice(1),r):void 0;if(n)return n;if(a.validators.length===0)return;const i=t.join(ms);return(l=a.validators.find(({validator:d})=>d(i)))==null?void 0:l.classGroupId},Ss=/^\[(.+)\]$/,hn=t=>{if(Ss.test(t)){const a=Ss.exec(t)[1],s=a==null?void 0:a.substring(0,a.indexOf(":"));if(s)return"arbitrary.."+s}},xn=t=>{const{theme:a,classGroups:s}=t,r={nextPart:new Map,validators:[]};for(const n in s)Wt(s[n],r,n,a);return r},Wt=(t,a,s,r)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?a:ks(a,n);i.classGroupId=s;return}if(typeof n=="function"){if(gn(n)){Wt(n(r),a,s,r);return}a.validators.push({validator:n,classGroupId:s});return}Object.entries(n).forEach(([i,l])=>{Wt(l,ks(a,i),s,r)})})},ks=(t,a)=>{let s=t;return a.split(ms).forEach(r=>{s.nextPart.has(r)||s.nextPart.set(r,{nextPart:new Map,validators:[]}),s=s.nextPart.get(r)}),s},gn=t=>t.isThemeGetter,bn=t=>{if(t<1)return{get:()=>{},set:()=>{}};let a=0,s=new Map,r=new Map;const n=(i,l)=>{s.set(i,l),a++,a>t&&(a=0,r=s,s=new Map)};return{get(i){let l=s.get(i);if(l!==void 0)return l;if((l=r.get(i))!==void 0)return n(i,l),l},set(i,l){s.has(i)?s.set(i,l):n(i,l)}}},Yt="!",Jt=":",vn=Jt.length,yn=t=>{const{prefix:a,experimentalParseClassName:s}=t;let r=n=>{const i=[];let l=0,d=0,p=0,u;for(let g=0;g<n.length;g++){let _=n[g];if(l===0&&d===0){if(_===Jt){i.push(n.slice(p,g)),p=g+vn;continue}if(_==="/"){u=g;continue}}_==="["?l++:_==="]"?l--:_==="("?d++:_===")"&&d--}const c=i.length===0?n:n.substring(p),o=jn(c),f=o!==c,v=u&&u>p?u-p:void 0;return{modifiers:i,hasImportantModifier:f,baseClassName:o,maybePostfixModifierPosition:v}};if(a){const n=a+Jt,i=r;r=l=>l.startsWith(n)?i(l.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:l,maybePostfixModifierPosition:void 0}}if(s){const n=r;r=i=>s({className:i,parseClassName:n})}return r},jn=t=>t.endsWith(Yt)?t.substring(0,t.length-1):t.startsWith(Yt)?t.substring(1):t,wn=t=>{const a=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const n=[];let i=[];return r.forEach(l=>{l[0]==="["||a[l]?(n.push(...i.sort(),l),i=[]):i.push(l)}),n.push(...i.sort()),n}},Nn=t=>({cache:bn(t.cacheSize),parseClassName:yn(t),sortModifiers:wn(t),...fn(t)}),Cn=/\s+/,Sn=(t,a)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n,sortModifiers:i}=a,l=[],d=t.trim().split(Cn);let p="";for(let u=d.length-1;u>=0;u-=1){const c=d[u],{isExternal:o,modifiers:f,hasImportantModifier:v,baseClassName:g,maybePostfixModifierPosition:_}=s(c);if(o){p=c+(p.length>0?" "+p:p);continue}let C=!!_,P=r(C?g.substring(0,_):g);if(!P){if(!C){p=c+(p.length>0?" "+p:p);continue}if(P=r(g),!P){p=c+(p.length>0?" "+p:p);continue}C=!1}const I=i(f).join(":"),w=v?I+Yt:I,k=w+P;if(l.includes(k))continue;l.push(k);const O=n(P,C);for(let q=0;q<O.length;++q){const b=O[q];l.push(w+b)}p=c+(p.length>0?" "+p:p)}return p};function kn(){let t=0,a,s,r="";for(;t<arguments.length;)(a=arguments[t++])&&(s=tr(a))&&(r&&(r+=" "),r+=s);return r}const tr=t=>{if(typeof t=="string")return t;let a,s="";for(let r=0;r<t.length;r++)t[r]&&(a=tr(t[r]))&&(s&&(s+=" "),s+=a);return s};function _n(t,...a){let s,r,n,i=l;function l(p){const u=a.reduce((c,o)=>o(c),t());return s=Nn(u),r=s.cache.get,n=s.cache.set,i=d,d(p)}function d(p){const u=r(p);if(u)return u;const c=Sn(p,s);return n(p,c),c}return function(){return i(kn.apply(null,arguments))}}const pe=t=>{const a=s=>s[t]||[];return a.isThemeGetter=!0,a},sr=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,rr=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Tn=/^\d+\/\d+$/,Rn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pn=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,En=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,In=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Mn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rt=t=>Tn.test(t),ae=t=>!!t&&!Number.isNaN(Number(t)),qe=t=>!!t&&Number.isInteger(Number(t)),Bt=t=>t.endsWith("%")&&ae(t.slice(0,-1)),Le=t=>Rn.test(t),An=()=>!0,Dn=t=>Pn.test(t)&&!En.test(t),ar=()=>!1,Ln=t=>In.test(t),On=t=>Mn.test(t),zn=t=>!G(t)&&!B(t),Fn=t=>lt(t,or,ar),G=t=>sr.test(t),Ke=t=>lt(t,lr,Dn),Vt=t=>lt(t,qn,ae),_s=t=>lt(t,nr,ar),$n=t=>lt(t,ir,On),_t=t=>lt(t,cr,Ln),B=t=>rr.test(t),gt=t=>ct(t,lr),Gn=t=>ct(t,Un),Ts=t=>ct(t,nr),Bn=t=>ct(t,or),Vn=t=>ct(t,ir),Tt=t=>ct(t,cr,!0),lt=(t,a,s)=>{const r=sr.exec(t);return r?r[1]?a(r[1]):s(r[2]):!1},ct=(t,a,s=!1)=>{const r=rr.exec(t);return r?r[1]?a(r[1]):s:!1},nr=t=>t==="position"||t==="percentage",ir=t=>t==="image"||t==="url",or=t=>t==="length"||t==="size"||t==="bg-size",lr=t=>t==="length",qn=t=>t==="number",Un=t=>t==="family-name",cr=t=>t==="shadow",Hn=()=>{const t=pe("color"),a=pe("font"),s=pe("text"),r=pe("font-weight"),n=pe("tracking"),i=pe("leading"),l=pe("breakpoint"),d=pe("container"),p=pe("spacing"),u=pe("radius"),c=pe("shadow"),o=pe("inset-shadow"),f=pe("text-shadow"),v=pe("drop-shadow"),g=pe("blur"),_=pe("perspective"),C=pe("aspect"),P=pe("ease"),I=pe("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],k=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],O=()=>[...k(),B,G],q=()=>["auto","hidden","clip","visible","scroll"],b=()=>["auto","contain","none"],h=()=>[B,G,p],R=()=>[rt,"full","auto",...h()],E=()=>[qe,"none","subgrid",B,G],x=()=>["auto",{span:["full",qe,B,G]},qe,B,G],N=()=>[qe,"auto",B,G],y=()=>["auto","min","max","fr",B,G],T=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],W=()=>["start","end","center","stretch","center-safe","end-safe"],S=()=>["auto",...h()],V=()=>[rt,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...h()],j=()=>[t,B,G],$=()=>[...k(),Ts,_s,{position:[B,G]}],ee=()=>["no-repeat",{repeat:["","x","y","space","round"]}],H=()=>["auto","cover","contain",Bn,Fn,{size:[B,G]}],Q=()=>[Bt,gt,Ke],M=()=>["","none","full",u,B,G],Y=()=>["",ae,gt,Ke],U=()=>["solid","dashed","dotted","double"],L=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>[ae,Bt,Ts,_s],ne=()=>["","none",g,B,G],te=()=>["none",ae,B,G],ce=()=>["none",ae,B,G],Pe=()=>[ae,B,G],je=()=>[rt,"full",...h()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Le],breakpoint:[Le],color:[An],container:[Le],"drop-shadow":[Le],ease:["in","out","in-out"],font:[zn],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Le],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Le],shadow:[Le],spacing:["px",ae],text:[Le],"text-shadow":[Le],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",rt,G,B,C]}],container:["container"],columns:[{columns:[ae,G,B,d]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:O()}],overflow:[{overflow:q()}],"overflow-x":[{"overflow-x":q()}],"overflow-y":[{"overflow-y":q()}],overscroll:[{overscroll:b()}],"overscroll-x":[{"overscroll-x":b()}],"overscroll-y":[{"overscroll-y":b()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:R()}],"inset-x":[{"inset-x":R()}],"inset-y":[{"inset-y":R()}],start:[{start:R()}],end:[{end:R()}],top:[{top:R()}],right:[{right:R()}],bottom:[{bottom:R()}],left:[{left:R()}],visibility:["visible","invisible","collapse"],z:[{z:[qe,"auto",B,G]}],basis:[{basis:[rt,"full","auto",d,...h()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ae,rt,"auto","initial","none",G]}],grow:[{grow:["",ae,B,G]}],shrink:[{shrink:["",ae,B,G]}],order:[{order:[qe,"first","last","none",B,G]}],"grid-cols":[{"grid-cols":E()}],"col-start-end":[{col:x()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":E()}],"row-start-end":[{row:x()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":y()}],"auto-rows":[{"auto-rows":y()}],gap:[{gap:h()}],"gap-x":[{"gap-x":h()}],"gap-y":[{"gap-y":h()}],"justify-content":[{justify:[...T(),"normal"]}],"justify-items":[{"justify-items":[...W(),"normal"]}],"justify-self":[{"justify-self":["auto",...W()]}],"align-content":[{content:["normal",...T()]}],"align-items":[{items:[...W(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...W(),{baseline:["","last"]}]}],"place-content":[{"place-content":T()}],"place-items":[{"place-items":[...W(),"baseline"]}],"place-self":[{"place-self":["auto",...W()]}],p:[{p:h()}],px:[{px:h()}],py:[{py:h()}],ps:[{ps:h()}],pe:[{pe:h()}],pt:[{pt:h()}],pr:[{pr:h()}],pb:[{pb:h()}],pl:[{pl:h()}],m:[{m:S()}],mx:[{mx:S()}],my:[{my:S()}],ms:[{ms:S()}],me:[{me:S()}],mt:[{mt:S()}],mr:[{mr:S()}],mb:[{mb:S()}],ml:[{ml:S()}],"space-x":[{"space-x":h()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":h()}],"space-y-reverse":["space-y-reverse"],size:[{size:V()}],w:[{w:[d,"screen",...V()]}],"min-w":[{"min-w":[d,"screen","none",...V()]}],"max-w":[{"max-w":[d,"screen","none","prose",{screen:[l]},...V()]}],h:[{h:["screen",...V()]}],"min-h":[{"min-h":["screen","none",...V()]}],"max-h":[{"max-h":["screen",...V()]}],"font-size":[{text:["base",s,gt,Ke]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,B,Vt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Bt,G]}],"font-family":[{font:[Gn,G,a]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,B,G]}],"line-clamp":[{"line-clamp":[ae,"none",B,Vt]}],leading:[{leading:[i,...h()]}],"list-image":[{"list-image":["none",B,G]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",B,G]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:j()}],"text-color":[{text:j()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[ae,"from-font","auto",B,Ke]}],"text-decoration-color":[{decoration:j()}],"underline-offset":[{"underline-offset":[ae,"auto",B,G]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:h()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",B,G]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",B,G]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:$()}],"bg-repeat":[{bg:ee()}],"bg-size":[{bg:H()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},qe,B,G],radial:["",B,G],conic:[qe,B,G]},Vn,$n]}],"bg-color":[{bg:j()}],"gradient-from-pos":[{from:Q()}],"gradient-via-pos":[{via:Q()}],"gradient-to-pos":[{to:Q()}],"gradient-from":[{from:j()}],"gradient-via":[{via:j()}],"gradient-to":[{to:j()}],rounded:[{rounded:M()}],"rounded-s":[{"rounded-s":M()}],"rounded-e":[{"rounded-e":M()}],"rounded-t":[{"rounded-t":M()}],"rounded-r":[{"rounded-r":M()}],"rounded-b":[{"rounded-b":M()}],"rounded-l":[{"rounded-l":M()}],"rounded-ss":[{"rounded-ss":M()}],"rounded-se":[{"rounded-se":M()}],"rounded-ee":[{"rounded-ee":M()}],"rounded-es":[{"rounded-es":M()}],"rounded-tl":[{"rounded-tl":M()}],"rounded-tr":[{"rounded-tr":M()}],"rounded-br":[{"rounded-br":M()}],"rounded-bl":[{"rounded-bl":M()}],"border-w":[{border:Y()}],"border-w-x":[{"border-x":Y()}],"border-w-y":[{"border-y":Y()}],"border-w-s":[{"border-s":Y()}],"border-w-e":[{"border-e":Y()}],"border-w-t":[{"border-t":Y()}],"border-w-r":[{"border-r":Y()}],"border-w-b":[{"border-b":Y()}],"border-w-l":[{"border-l":Y()}],"divide-x":[{"divide-x":Y()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Y()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:j()}],"border-color-x":[{"border-x":j()}],"border-color-y":[{"border-y":j()}],"border-color-s":[{"border-s":j()}],"border-color-e":[{"border-e":j()}],"border-color-t":[{"border-t":j()}],"border-color-r":[{"border-r":j()}],"border-color-b":[{"border-b":j()}],"border-color-l":[{"border-l":j()}],"divide-color":[{divide:j()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ae,B,G]}],"outline-w":[{outline:["",ae,gt,Ke]}],"outline-color":[{outline:j()}],shadow:[{shadow:["","none",c,Tt,_t]}],"shadow-color":[{shadow:j()}],"inset-shadow":[{"inset-shadow":["none",o,Tt,_t]}],"inset-shadow-color":[{"inset-shadow":j()}],"ring-w":[{ring:Y()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:j()}],"ring-offset-w":[{"ring-offset":[ae,Ke]}],"ring-offset-color":[{"ring-offset":j()}],"inset-ring-w":[{"inset-ring":Y()}],"inset-ring-color":[{"inset-ring":j()}],"text-shadow":[{"text-shadow":["none",f,Tt,_t]}],"text-shadow-color":[{"text-shadow":j()}],opacity:[{opacity:[ae,B,G]}],"mix-blend":[{"mix-blend":[...L(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":L()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ae]}],"mask-image-linear-from-pos":[{"mask-linear-from":J()}],"mask-image-linear-to-pos":[{"mask-linear-to":J()}],"mask-image-linear-from-color":[{"mask-linear-from":j()}],"mask-image-linear-to-color":[{"mask-linear-to":j()}],"mask-image-t-from-pos":[{"mask-t-from":J()}],"mask-image-t-to-pos":[{"mask-t-to":J()}],"mask-image-t-from-color":[{"mask-t-from":j()}],"mask-image-t-to-color":[{"mask-t-to":j()}],"mask-image-r-from-pos":[{"mask-r-from":J()}],"mask-image-r-to-pos":[{"mask-r-to":J()}],"mask-image-r-from-color":[{"mask-r-from":j()}],"mask-image-r-to-color":[{"mask-r-to":j()}],"mask-image-b-from-pos":[{"mask-b-from":J()}],"mask-image-b-to-pos":[{"mask-b-to":J()}],"mask-image-b-from-color":[{"mask-b-from":j()}],"mask-image-b-to-color":[{"mask-b-to":j()}],"mask-image-l-from-pos":[{"mask-l-from":J()}],"mask-image-l-to-pos":[{"mask-l-to":J()}],"mask-image-l-from-color":[{"mask-l-from":j()}],"mask-image-l-to-color":[{"mask-l-to":j()}],"mask-image-x-from-pos":[{"mask-x-from":J()}],"mask-image-x-to-pos":[{"mask-x-to":J()}],"mask-image-x-from-color":[{"mask-x-from":j()}],"mask-image-x-to-color":[{"mask-x-to":j()}],"mask-image-y-from-pos":[{"mask-y-from":J()}],"mask-image-y-to-pos":[{"mask-y-to":J()}],"mask-image-y-from-color":[{"mask-y-from":j()}],"mask-image-y-to-color":[{"mask-y-to":j()}],"mask-image-radial":[{"mask-radial":[B,G]}],"mask-image-radial-from-pos":[{"mask-radial-from":J()}],"mask-image-radial-to-pos":[{"mask-radial-to":J()}],"mask-image-radial-from-color":[{"mask-radial-from":j()}],"mask-image-radial-to-color":[{"mask-radial-to":j()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":k()}],"mask-image-conic-pos":[{"mask-conic":[ae]}],"mask-image-conic-from-pos":[{"mask-conic-from":J()}],"mask-image-conic-to-pos":[{"mask-conic-to":J()}],"mask-image-conic-from-color":[{"mask-conic-from":j()}],"mask-image-conic-to-color":[{"mask-conic-to":j()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:$()}],"mask-repeat":[{mask:ee()}],"mask-size":[{mask:H()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",B,G]}],filter:[{filter:["","none",B,G]}],blur:[{blur:ne()}],brightness:[{brightness:[ae,B,G]}],contrast:[{contrast:[ae,B,G]}],"drop-shadow":[{"drop-shadow":["","none",v,Tt,_t]}],"drop-shadow-color":[{"drop-shadow":j()}],grayscale:[{grayscale:["",ae,B,G]}],"hue-rotate":[{"hue-rotate":[ae,B,G]}],invert:[{invert:["",ae,B,G]}],saturate:[{saturate:[ae,B,G]}],sepia:[{sepia:["",ae,B,G]}],"backdrop-filter":[{"backdrop-filter":["","none",B,G]}],"backdrop-blur":[{"backdrop-blur":ne()}],"backdrop-brightness":[{"backdrop-brightness":[ae,B,G]}],"backdrop-contrast":[{"backdrop-contrast":[ae,B,G]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ae,B,G]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ae,B,G]}],"backdrop-invert":[{"backdrop-invert":["",ae,B,G]}],"backdrop-opacity":[{"backdrop-opacity":[ae,B,G]}],"backdrop-saturate":[{"backdrop-saturate":[ae,B,G]}],"backdrop-sepia":[{"backdrop-sepia":["",ae,B,G]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":h()}],"border-spacing-x":[{"border-spacing-x":h()}],"border-spacing-y":[{"border-spacing-y":h()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",B,G]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ae,"initial",B,G]}],ease:[{ease:["linear","initial",P,B,G]}],delay:[{delay:[ae,B,G]}],animate:[{animate:["none",I,B,G]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[_,B,G]}],"perspective-origin":[{"perspective-origin":O()}],rotate:[{rotate:te()}],"rotate-x":[{"rotate-x":te()}],"rotate-y":[{"rotate-y":te()}],"rotate-z":[{"rotate-z":te()}],scale:[{scale:ce()}],"scale-x":[{"scale-x":ce()}],"scale-y":[{"scale-y":ce()}],"scale-z":[{"scale-z":ce()}],"scale-3d":["scale-3d"],skew:[{skew:Pe()}],"skew-x":[{"skew-x":Pe()}],"skew-y":[{"skew-y":Pe()}],transform:[{transform:[B,G,"","none","gpu","cpu"]}],"transform-origin":[{origin:O()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:je()}],"translate-x":[{"translate-x":je()}],"translate-y":[{"translate-y":je()}],"translate-z":[{"translate-z":je()}],"translate-none":["translate-none"],accent:[{accent:j()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:j()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",B,G]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":h()}],"scroll-mx":[{"scroll-mx":h()}],"scroll-my":[{"scroll-my":h()}],"scroll-ms":[{"scroll-ms":h()}],"scroll-me":[{"scroll-me":h()}],"scroll-mt":[{"scroll-mt":h()}],"scroll-mr":[{"scroll-mr":h()}],"scroll-mb":[{"scroll-mb":h()}],"scroll-ml":[{"scroll-ml":h()}],"scroll-p":[{"scroll-p":h()}],"scroll-px":[{"scroll-px":h()}],"scroll-py":[{"scroll-py":h()}],"scroll-ps":[{"scroll-ps":h()}],"scroll-pe":[{"scroll-pe":h()}],"scroll-pt":[{"scroll-pt":h()}],"scroll-pr":[{"scroll-pr":h()}],"scroll-pb":[{"scroll-pb":h()}],"scroll-pl":[{"scroll-pl":h()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",B,G]}],fill:[{fill:["none",...j()]}],"stroke-w":[{stroke:[ae,gt,Ke,Vt]}],stroke:[{stroke:["none",...j()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},dr=_n(Hn);function jt(...t){return dr(us(t))}const Wn=pn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function le({className:t,variant:a,size:s,asChild:r=!1,...n}){const i=r?ra:"button";return e.jsx(i,{"data-slot":"button",className:jt(Wn({variant:a,size:s,className:t})),...n})}const ye=m.forwardRef(({className:t,type:a,...s},r)=>e.jsx("input",{ref:r,type:a,"data-slot":"input",className:jt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s}));ye.displayName="Input";function Yn({onLoginSuccess:t,initialStep:a="login",onNavigateToRegister:s,language:r,t:n}){const[i,l]=m.useState(""),[d,p]=m.useState(""),[u,c]=m.useState(""),[o,f]=m.useState(a==="signup"),[v,g]=m.useState(!1),[_,C]=m.useState(null),P=xs(0),I=xs(0),w=gs(P,{stiffness:500,damping:50}),k=gs(I,{stiffness:500,damping:50});function O({currentTarget:E,clientX:x,clientY:N}){const{left:y,top:T,width:W,height:S}=E.getBoundingClientRect();P.set((x-y)/W-.5),I.set((N-T)/S-.5)}const q=bs(k,[-.5,.5],[10,-10]),b=bs(w,[-.5,.5],[-10,10]);m.useEffect(()=>{const E=localStorage.getItem("chat_app_username"),x=localStorage.getItem("chat_app_pin");E&&x&&(l(E),p(x))},[]);const h=E=>`${E.trim().toLowerCase().replace(/\s+/g,"_")}@app.local`,R=async E=>{if(E.preventDefault(),!(!i.trim()||!d.trim())&&!(o&&!u.trim())){g(!0),C(null);try{const x=h(i);if(await new Promise(N=>setTimeout(N,800)),o){const{error:N}=await Z.auth.signUp({email:x,password:d,options:{data:{username:i.trim().toLowerCase(),display_name:u.trim(),pin:d}}});if(N)throw N}else{let{error:N}=await Z.auth.signInWithPassword({email:x,password:d});if(N){const y=`${i.trim().toLowerCase().replace(/\s+/g,"_")}@chatapp.local`,{error:T}=await Z.auth.signInWithPassword({email:y,password:d});if(T)throw new Error(r==="ar"?"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ÿ±ŸÖÿ≤ PIN ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠":"Invalid username or PIN");N=null}localStorage.setItem("chat_app_username",i.trim()),localStorage.setItem("chat_app_pin",d)}t()}catch(x){C(x.message)}finally{g(!1)}}};return e.jsxs("div",{className:"h-screen w-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center relative group",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(A.div,{animate:{x:[0,30,0],y:[0,-50,0],scale:[1,1.1,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"},className:"absolute -top-[10%] -left-[5%] w-[60vw] h-[60vw] bg-indigo-600/15 rounded-full blur-[120px] mix-blend-screen"}),e.jsx(A.div,{animate:{x:[0,-30,0],y:[0,50,0],scale:[1,1.2,1]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute top-[30%] -right-[5%] w-[50vw] h-[50vw] bg-violet-600/15 rounded-full blur-[100px] mix-blend-screen"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 pointer-events-none mix-blend-multiply"})]}),e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:Array.from({length:20}).map((E,x)=>e.jsx(A.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1,0],x:["0%",`${Math.random()*100}%`],y:["0%",`${Math.random()*100}%`]},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"linear"},className:"absolute w-1 h-1 bg-indigo-400 rounded-full blur-[1px]",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},x))}),e.jsxs(A.div,{onMouseMove:O,style:{rotateX:q,rotateY:b,transformStyle:"preserve-3d"},initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},transition:{duration:.8,ease:[.16,1,.3,1]},className:"w-full max-w-md relative perspective-1000 z-10 mx-4",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-[2.5rem] blur-2xl opacity-50 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"}),e.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900/40 border border-white/10 shadow-[0_0_50px_-12px_rgba(0,0,0,0.5)] rounded-[2rem] p-8 overflow-hidden transform-gpu ring-1 ring-white/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-indigo-500/5 via-transparent to-violet-500/5 pointer-events-none"}),e.jsx("div",{className:"absolute -top-[150%] -left-[50%] w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none animate-[shimmer_10s_infinite_linear]"}),e.jsxs("div",{className:"flex flex-col items-center mb-10 relative z-10",children:[e.jsxs(A.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,type:"spring"},className:"relative group/logo",children:[e.jsxs("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/40 mb-5 transform rotate-3 hover:rotate-0 transition-all duration-500",children:[e.jsx(ss,{className:"w-10 h-10 text-white fill-white/10"}),e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-2xl opacity-0 group-hover/logo:opacity-100 transition-opacity"})]}),e.jsx(A.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:3},className:"absolute -top-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900 shadow-[0_0_15px_rgba(52,211,153,0.8)]"})]}),e.jsx(A.h1,{initial:{opacity:0,filter:"blur(10px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{delay:.5},className:`text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400 font-outfit ${r==="ar"?"font-arabic":""}`,children:o?r==="ar"?"ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸäŸÜÿß":"Join the Flow":r==="ar"?"ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ":"Welcome"}),e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:`text-slate-400 text-sm mt-3 font-medium text-center max-w-[250px] ${r==="ar"?"font-arabic":""}`,children:o?r==="ar"?"ŸÇŸÖ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ŸáŸàŸäÿ™ŸÉ ÿßŸÑÿ¢ŸÜ":"Establish your decentralized identity":r==="ar"?"ŸàÿµŸàŸÑ ÿ¢ŸÖŸÜ ŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™ŸÉ ÿßŸÑÿÆÿßÿµÿ©":"Secure access to your private conversations"})]}),e.jsxs("form",{onSubmit:R,className:"space-y-5 relative z-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors animate-pulse-slow`,children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx(ye,{type:"text",value:i,onChange:E=>l(E.target.value),placeholder:r==="ar"?"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ":"Username",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${r==="ar"?"font-arabic text-right":""}`,disabled:v})]}),e.jsx(fe,{mode:"popLayout",children:o&&e.jsxs(A.div,{initial:{opacity:0,height:0,y:-20},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-20},className:"group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(Qe,{className:"w-5 h-5"})}),e.jsx(ye,{type:"text",value:u,onChange:E=>c(E.target.value),placeholder:r==="ar"?"ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿπÿßÿ±":"Display Name",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${r==="ar"?"font-arabic text-right":""}`,disabled:v})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsx(ye,{type:"password",inputMode:"numeric",className:"pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 tracking-[0.5em] font-mono text-xl",maxLength:6,placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",value:d,onChange:E=>p(E.target.value),disabled:v})]})]}),e.jsx(fe,{children:_&&e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 flex items-center gap-3 backdrop-blur-md",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)] ${r==="ar"?"ml-3":""}`}),e.jsx("span",{className:`text-red-400 text-sm font-medium leading-tight ${r==="ar"?"font-arabic":""}`,children:_})]})}),e.jsx(A.div,{initial:!1,animate:v?{scale:.98}:{scale:1},children:e.jsxs(le,{type:"submit",disabled:v,className:"w-full h-14 bg-gradient-to-r from-indigo-600 via-indigo-500 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold text-lg rounded-2xl shadow-2xl shadow-indigo-600/30 border-0 relative overflow-hidden group/btn",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 -translate-x-full group-hover/btn:translate-x-0 transition-transform duration-500"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:v?e.jsx(Ce,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[o?r==="ar"?"ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ŸÖÿ¨ÿßŸÜŸä":"Sign Up Free":r==="ar"?"ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ":"Authenticate",e.jsx(aa,{className:`w-5 h-5 group-hover/btn:translate-x-2 transition-transform duration-300 ${r==="ar"?"rotate-180 group-hover/btn:-translate-x-2":""}`})]})})]})}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{type:"button",onClick:()=>{f(!o),C(null)},className:"text-slate-400 hover:text-white text-sm transition-all duration-300 group/link",children:o?e.jsxs("span",{className:r==="ar"?"font-arabic":"",children:[r==="ar"?"ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ® ÿ®ÿßŸÑŸÅÿπŸÑÿü ":"Existing user? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:r==="ar"?"ÿ≥ÿ¨ŸÑ ÿØÿÆŸàŸÑŸÉ":"Log in"})]}):e.jsxs("span",{className:r==="ar"?"font-arabic":"",children:[r==="ar"?"ŸáŸàŸäÿ© ÿ¨ÿØŸäÿØÿ©ÿü ":"New identity? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:r==="ar"?"ÿ≥ÿ¨ŸÑ ÿßŸÑÿ¢ŸÜ":"Sign up"})]})})})]})]}),e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-8 flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-slate-700",children:[e.jsx("div",{className:"h-px w-8 bg-current"}),e.jsx("p",{className:`text-[10px] uppercase tracking-[0.3em] font-black ${r==="ar"?"font-arabic":""}`,children:r==="ar"?"ŸÇŸÜÿßÿ© ŸÖÿ¥ŸÅÿ±ÿ©":"Encrypted Channel"}),e.jsx("div",{className:"h-px w-8 bg-current"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3].map(E=>e.jsx("div",{className:"w-1 h-1 bg-slate-800 rounded-full"},E))})]})]})]})}var ps="Avatar",[Jn]=na(ps),[Kn,ur]=Jn(ps),mr=m.forwardRef((t,a)=>{const{__scopeAvatar:s,...r}=t,[n,i]=m.useState("idle");return e.jsx(Kn,{scope:s,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(as.span,{...r,ref:a})})});mr.displayName=ps;var pr="AvatarImage",fr=m.forwardRef((t,a)=>{const{__scopeAvatar:s,src:r,onLoadingStatusChange:n=()=>{},...i}=t,l=ur(pr,s),d=Xn(r,i.referrerPolicy),p=ia(u=>{n(u),l.onImageLoadingStatusChange(u)});return zs(()=>{d!=="idle"&&p(d)},[d,p]),d==="loaded"?e.jsx(as.img,{...i,ref:a,src:r}):null});fr.displayName=pr;var hr="AvatarFallback",xr=m.forwardRef((t,a)=>{const{__scopeAvatar:s,delayMs:r,...n}=t,i=ur(hr,s),[l,d]=m.useState(r===void 0);return m.useEffect(()=>{if(r!==void 0){const p=window.setTimeout(()=>d(!0),r);return()=>window.clearTimeout(p)}},[r]),l&&i.imageLoadingStatus!=="loaded"?e.jsx(as.span,{...n,ref:a}):null});xr.displayName=hr;function Xn(t,a){const[s,r]=m.useState("idle");return zs(()=>{if(!t){r("error");return}let n=!0;const i=new window.Image,l=d=>()=>{n&&r(d)};return r("loading"),i.onload=l("loaded"),i.onerror=l("error"),i.src=t,a&&(i.referrerPolicy=a),()=>{n=!1}},[t,a]),s}var Qn=mr,Zn=fr,ei=xr;function Oe({className:t,...a}){return e.jsx(Qn,{"data-slot":"avatar",className:jt("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...a})}function We({className:t,...a}){return e.jsx(Zn,{"data-slot":"avatar-image",className:jt("aspect-square size-full",t),...a})}function ze({className:t,...a}){return e.jsx(ei,{"data-slot":"avatar-fallback",className:jt("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}function se(...t){return dr(us(t))}function Rs({user:t,hasStatus:a,isAllSeen:s,statusCount:r,onClick:n,size:i="md"}){const l={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20"}[i];return e.jsxs("div",{className:se("relative flex-shrink-0 cursor-pointer transition-transform active:scale-95",l),onClick:n,children:[a&&e.jsx("svg",{className:"absolute inset-0 w-full h-full -rotate-90 pointer-events-none",children:e.jsx("circle",{cx:"50%",cy:"50%",r:"48%",fill:"none",stroke:s?"rgba(255,255,255,0.2)":"var(--brand-color)",strokeWidth:"2",strokeDasharray:r>1?"10 2":"0",className:"transition-all duration-500"})}),e.jsx("div",{className:se("p-[3px] w-full h-full rounded-full"),children:e.jsxs(Oe,{className:"w-full h-full border border-slate-900 shadow-inner",children:[e.jsx(We,{src:t.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-slate-300",children:t.name?t.name.charAt(0).toUpperCase():"?"})]})}),!s&&a&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-950 rounded-full ring-1 ring-white/20"})]})}function ti({chats:t,currentUser:a,onlineUsers:s,onSelectChat:r,onNewChat:n,onCreateGroup:i,onLogout:l,onAcceptRequest:d,onRejectRequest:p,pendingRequests:u,typingUsers:c,onSettings:o,onPinChat:f,statuses:v=[],onViewStatus:g,onAddStatus:_,language:C,t:P,isLoading:I}){const[w,k]=m.useState(""),O=m.useMemo(()=>t.filter(b=>b.partnerName.toLowerCase().includes(w.toLowerCase())||b.lastMessage.toLowerCase().includes(w.toLowerCase())).sort((b,h)=>b.isPinned&&!h.isPinned?-1:!b.isPinned&&h.isPinned?1:new Date(h.lastMessageTime).getTime()-new Date(b.lastMessageTime).getTime()),[t,w]),q=b=>{if(!b)return"";const h=new Date(b),E=new Date().getTime()-h.getTime(),x=Math.floor(E/(1e3*60*60*24));return x===0?h.toLocaleTimeString(C==="ar"?"ar-EG":"en-US",{hour:"2-digit",minute:"2-digit"}):x===1?C==="ar"?"ÿ£ŸÖÿ≥":"Yesterday":x<7?h.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{weekday:"short"}):h.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950/95 backdrop-blur-md border-r border-white/5 w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-brand/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"p-4 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(A.h1,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 flex items-center gap-2 ${C==="ar"?"font-arabic":""}`,children:[P("chats")," ",e.jsx("span",{className:"text-xs bg-brand/20 text-brand px-2 py-0.5 rounded-full border border-brand/30",children:t.length})]}),e.jsx("div",{className:"flex items-center gap-2",children:[{icon:vt,onClick:i,title:P("createGroup")},{icon:Ut,onClick:n,title:P("newChat")},{icon:oa,onClick:o,title:P("settings")}].map((b,h)=>e.jsx(A.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:h*.1},whileHover:{scale:1.1,backgroundColor:"rgba(255, 255, 255, 0.1)"},whileTap:{scale:.9},onClick:b.onClick,title:b.title,className:se("p-2 rounded-full transition-colors text-slate-400 hover:text-white"),children:e.jsx(b.icon,{className:"w-5 h-5"})},h))})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-4 mb-6 p-3 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/30 transition-colors group",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Oe,{className:"w-12 h-12 border-2 border-brand/20 group-hover:border-brand transition-colors",children:[e.jsx(We,{src:a.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name)}&background=6366f1&color=fff`}),e.jsx(ze,{className:"bg-brand text-white",children:a.name.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-bold truncate text-base",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-brand text-xs font-medium truncate bg-brand/10 px-2 py-0.5 rounded-md",children:["@",a.username]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`@${a.username}`),X.success(C==="ar"?"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ!":"Username copied!")},className:"text-slate-500 hover:text-white transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(la,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex gap-4 overflow-x-auto py-2 no-scrollbar mb-4 relative z-10",children:[e.jsxs(A.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] group",onClick:_,children:[e.jsx(Rs,{user:{id:a.id,name:a.name,avatar_url:a.avatar_url},hasStatus:!1,isAllSeen:!1,statusCount:0,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:C==="ar"?"ÿ≠ÿßŸÑÿ™ŸêŸä":"My Status"})]}),Object.entries(v.reduce((b,h)=>{const R=h.user_id;return b[R]||(b[R]=[]),b[R].push(h),b},{})).map(([b,h])=>{var R,E,x;return e.jsxs(A.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] cursor-pointer",onClick:()=>{const N=h.map(y=>{var T,W;return{id:y.id,user_id:y.user_id,user_name:((T=y.profiles)==null?void 0:T.display_name)||"User",user_avatar:(W=y.profiles)==null?void 0:W.avatar_url,content_type:y.content_type,content_url:y.content_url,text:y.text,created_at:y.created_at}});g==null||g(N,0)},children:[e.jsx(Rs,{user:{id:b,name:((R=h[0].profiles)==null?void 0:R.display_name)||"User",avatar_url:(E=h[0].profiles)==null?void 0:E.avatar_url},hasStatus:!0,isAllSeen:!1,statusCount:h.length,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-medium truncate w-14 text-center",children:((x=h[0].profiles)==null?void 0:x.display_name)||"User"})]},b)})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(yt,{className:"w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"})}),e.jsx(ye,{type:"text",placeholder:P("search"),value:w,onChange:b=>k(b.target.value),className:"pl-10 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-500 h-10 transition-all font-light"})]})]}),e.jsx(fe,{children:u.length>0&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/20 to-violet-900/20 border border-indigo-500/20 rounded-xl p-3 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(ns,{className:"w-3 h-3 animate-bounce"}),e.jsx("span",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"ÿ∑ŸÑÿ®ÿßÿ™ ÿ¨ÿØŸäÿØÿ©":"New Requests"})]}),e.jsx("div",{className:"space-y-2",children:u.map(b=>{var h;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-slate-900/50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate",children:e.jsxs("span",{className:"text-indigo-400",children:["@",(h=b.profiles)==null?void 0:h.username]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(b.id,b.sender_id),className:"p-1.5 bg-brand/20 text-brand hover:bg-brand hover:text-white rounded-md transition-colors",children:e.jsx(ot,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>p(b.id),className:"p-1.5 bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white rounded-md transition-colors",children:e.jsx(_e,{className:"w-3 h-3"})})]})]},b.id)})})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2 space-y-1",children:I?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx(Ce,{className:"w-8 h-8 animate-spin text-brand mb-2"}),e.jsx("p",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™...":"Loading chats..."})]}):O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-4",children:e.jsx(ss,{className:"w-8 h-8 opacity-20"})}),e.jsx("p",{className:`font-medium text-slate-400 ${C==="ar"?"font-arabic":""}`,children:P("no_chats")}),e.jsx("p",{className:"text-xs mt-1 text-slate-600",children:C==="ar"?"ÿßÿ®ÿØÿ£ ÿßŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ ŸÑŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ£ÿµÿØŸÇÿßÿ° ÿ¨ÿØÿØ.":"Start exploring to find new friends."})]}):O.map((b,h)=>{var R,E;return e.jsxs(A.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:h*.05},onClick:()=>r(b.partnerId,b.partnerName),className:"group relative flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer transition-all border border-transparent hover:border-white/5 active:scale-[0.98]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(Oe,{className:"w-12 h-12 border border-white/10 group-hover:border-brand/50 transition-colors",children:[e.jsx(We,{src:b.partnerAvatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(b.partnerName)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-slate-300",children:b.partnerName.charAt(0).toUpperCase()})]}),!b.isGroup&&s.has(b.partnerId)&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-brand border-2 border-slate-950 rounded-full ring-2 ring-slate-950 animate-pulse"}),b.isGroup&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-slate-800 p-1 rounded-full border border-slate-700",children:e.jsx(vt,{className:"w-3 h-3 text-brand"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h3",{className:se("font-semibold truncate transition-colors text-base",b.unreadCount>0?"text-white":"text-slate-300 group-hover:text-white"),children:b.partnerName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),f(b.id,!b.isPinned)},className:se("p-1 rounded-md transition-all",b.isPinned?"text-indigo-400 opacity-100":"text-slate-600 opacity-0 group-hover:opacity-100 hover:text-white hover:bg-white/10"),children:e.jsx(Qe,{className:se("w-3.5 h-3.5",b.isPinned&&"fill-indigo-400")})}),e.jsx("span",{className:se("text-[10px] flex-shrink-0 font-medium",b.unreadCount>0?"text-indigo-400":"text-slate-500"),children:q(b.lastMessageTime)})]})]}),e.jsxs("div",{className:"flex justify-between items-center h-5",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-2",children:c[b.partnerId]?e.jsxs("p",{className:"text-brand text-xs font-bold flex items-center gap-1",children:[C==="ar"?"ŸäŸÉÿ™ÿ® ÿßŸÑÿ¢ŸÜ":"typing",e.jsxs("span",{className:"flex gap-0.5 pt-1",children:[e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-1 h-1 bg-brand rounded-full"})]})]}):e.jsx("p",{className:se("text-sm truncate",b.unreadCount>0?"text-slate-100 font-medium":"text-slate-500 group-hover:text-slate-400"),children:(R=b.lastMessage)!=null&&R.includes("Voice Message")||(E=b.lastMessage)!=null&&E.includes("ÿ±ÿ≥ÿßŸÑÿ© ÿµŸàÿ™Ÿäÿ©")?"üé§":b.lastMessage||e.jsx("span",{className:"italic text-slate-600",children:C==="ar"?"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ":"No messages yet"})})}),b.unreadCount>0&&e.jsx(A.div,{initial:{scale:0},animate:{scale:1},className:"bg-brand text-white text-[10px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg shadow-brand/40",children:b.unreadCount})]})]})]},b.id)})})]})}const si=m.memo(ti),gr=m.createContext(void 0),ri=({children:t})=>{const[a,s]=m.useState(null),r=m.useRef(new Map),n=m.useRef(null);typeof window<"u"&&!n.current&&(n.current=new Audio("/sounds/digital.mp3"));const i=m.useCallback(c=>{s(c)},[]),l=m.useCallback(c=>{s(o=>o===c?null:o)},[]),d=m.useCallback((c,o)=>{r.current.set(c,o)},[]),p=m.useCallback(c=>{r.current.delete(c)},[]),u=m.useCallback(c=>{s(null);const o=r.current.get(c);o&&(n.current&&(n.current.volume=1,n.current.play().catch(()=>{})),setTimeout(()=>{o()},500))},[]);return e.jsx(gr.Provider,{value:{activeMessageId:a,playMessage:i,pauseMessage:l,registerMessage:d,unregisterMessage:p,notifyEnded:u},children:t})},br=()=>{const t=m.useContext(gr);if(!t)throw new Error("useVoicePlayback must be used within a VoicePlaybackProvider");return t},vr=m.createContext(void 0),Pt={indigo:{name:"Royal Indigo",class:"indigo",hex:"#6366f1"},emerald:{name:"Forest Emerald",class:"emerald",hex:"#10b981"},rose:{name:"Velvet Rose",class:"rose",hex:"#f43f5e"},amber:{name:"Golden Amber",class:"amber",hex:"#f59e0b"},cyan:{name:"Ocean Cyan",class:"cyan",hex:"#06b6d4"},violet:{name:"Electric Violet",class:"violet",hex:"#8b5cf6"}};function ai({children:t}){const[a,s]=m.useState(()=>localStorage.getItem("chat_theme_color")||"indigo"),[r,n]=m.useState(()=>localStorage.getItem("chat_wallpaper")||"doodles"),[i,l]=m.useState(()=>Number(localStorage.getItem("chat_bg_opacity"))||.05);return m.useEffect(()=>{localStorage.setItem("chat_theme_color",a);const d=Pt[a];document.documentElement.style.setProperty("--brand-color",d.hex)},[a]),m.useEffect(()=>{localStorage.setItem("chat_wallpaper",r)},[r]),m.useEffect(()=>{localStorage.setItem("chat_bg_opacity",String(i)),document.documentElement.style.setProperty("--bg-opacity",String(i))},[i]),e.jsx(vr.Provider,{value:{accentColor:a,setAccentColor:s,wallpaper:r,setWallpaper:n,bgOpacity:i,setBgOpacity:l},children:t})}function yr(){const t=m.useContext(vr);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const ni=m.memo(({question:t,options:a,votes:s,currentUserId:r,onVote:n,isSent:i})=>{const l=Object.keys(s).length,d=s[r],p=u=>{const c=Object.values(s).filter(f=>f===u).length,o=l===0?0:c/l*100;return{count:c,percent:o}};return e.jsxs("div",{className:"flex flex-col gap-4 min-w-[240px] max-w-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl",children:e.jsx(vt,{className:"w-5 h-5 text-brand"})}),e.jsx("h3",{className:"text-lg font-bold text-white leading-tight",dir:"auto",children:t})]}),e.jsx("div",{className:"space-y-2",children:a.map((u,c)=>{const{count:o,percent:f}=p(c),v=d===c,g=/[\u0600-\u06FF]/.test(u);return e.jsxs("button",{onClick:()=>n(c),className:"w-full text-left group relative outline-none",dir:g?"rtl":"ltr",children:[e.jsxs("div",{className:se("relative z-10 flex items-center justify-between p-3 rounded-xl border transition-all duration-300",v?"bg-brand/30 border-brand/50 shadow-lg shadow-brand/10":"bg-white/5 border-white/5 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:se("w-5 h-5 rounded-full border flex items-center justify-center transition-colors",v?"bg-white border-white":"border-white/20 group-hover:border-white/40"),children:v&&e.jsx(ot,{className:"w-3 h-3 text-brand stroke-[4px]"})}),e.jsx("span",{className:se("font-medium truncate",v?"text-white":"text-slate-200"),dir:"auto",children:u})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-400",children:o})})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl overflow-hidden pointer-events-none",children:e.jsx(A.div,{initial:{width:0},animate:{width:`${f}%`},transition:{type:"spring",stiffness:100,damping:20},className:se("h-full opacity-10 transition-colors",v?"bg-white":"bg-brand")})})]},c)})}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:[l," ",l===1?"Vote":"Votes"]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:d!==void 0?"Voted":"Not voted"})]})]})});function ii({url:t,language:a}){const[s,r]=m.useState(null),[n,i]=m.useState(!0),[l,d]=m.useState(!1);return m.useEffect(()=>{let p=!0;return t&&(async()=>{i(!0),d(!1);try{const c=new URL(t).hostname;await new Promise(o=>setTimeout(o,1e3)),t.includes("google")||t.includes("youtube")?r({title:c==="www.youtube.com"?"YouTube Video":"Google Search",description:"Enjoy the videos and music you love, upload original content, and share it all with friends, family, and the world on YouTube.",siteName:c,image:c==="www.youtube.com"?"https://www.youtube.com/img/desktop/yt_1200.png":void 0}):r({title:c,siteName:c})}catch(c){console.error("Link preview failed:",c),d(!0)}finally{p&&i(!1)}})(),()=>{p=!1}},[t]),l||!s?null:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"block mt-2 mb-1 max-w-sm rounded-xl overflow-hidden bg-slate-800/50 border border-white/10 hover:bg-slate-800 transition-colors group",dir:a==="ar"?"rtl":"ltr",children:n?e.jsx("div",{className:"h-24 flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 animate-spin text-slate-500"})}):e.jsxs(e.Fragment,{children:[s.image&&e.jsx("div",{className:"w-full h-32 overflow-hidden relative bg-slate-900 border-b border-white/5",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-200 line-clamp-1 mb-1",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:[e.jsx(Fs,{className:"w-3 h-3"}),e.jsx("span",{children:s.siteName})]})]})]})})}const oi=m.memo(({message:t,currentUserId:a,partnerName:s,isGroup:r,isSequential:n,isMenuOpen:i,onToggleMenu:l,onReact:d,onReply:p,onDelete:u,onEdit:c,onVote:o,setViewingFile:f,repliedMessage:v,language:g,t:_,formatMessageTime:C,renderFilePreview:P,onJoinGroup:I,isAnyOverlayOpen:w})=>{var R,E,x;const k=t.senderId===a,O=g==="ar",q=k&&!O||!k&&O,b=(R=t.text)==null?void 0:R.match(/(https?:\/\/[^\s]+)/),h=b?b[0]:null;return e.jsx("div",{id:`msg-${t.id}`,className:se("flex w-full mb-4",k?"justify-end":"justify-start",i&&"z-[130] relative"),children:e.jsxs("div",{className:se("relative max-w-[80%] group",k?"items-end":"items-start"),children:[r&&!k&&!n&&e.jsx("p",{className:"text-[10px] font-bold mb-1 text-brand ml-1",children:"~User"}),!w&&e.jsx("div",{className:se("absolute top-0 z-10 transition-all duration-200",q?"left-0 -translate-x-full pr-1":"right-0 translate-x-full pl-1","opacity-100"),children:e.jsx("button",{onClick:N=>{N.stopPropagation(),l(t.id)},className:se("p-1 rounded-full transition-all bg-slate-900/50 backdrop-blur-sm shadow-sm border border-white/5",i?"text-brand bg-slate-800":"text-slate-400 hover:text-white"),children:e.jsx(is,{className:"w-3.5 h-3.5"})})}),e.jsxs("div",{className:se("rounded-2xl px-4 py-2 shadow-sm relative transition-all duration-200 select-none",k?"bg-gradient-to-br from-brand to-violet-600 text-white rounded-br-none":"bg-slate-800/80 backdrop-blur-sm text-slate-100 border border-white/5 rounded-bl-none",i&&"ring-2 ring-brand ring-offset-2 ring-offset-slate-900"),children:[t.replyToId&&v&&e.jsxs("div",{onClick:N=>{N.stopPropagation();const y=document.getElementById(`msg-${v.id}`);y&&(y.scrollIntoView({behavior:"smooth",block:"center"}),y.classList.add("ring-2","ring-yellow-400","ring-offset-2"),setTimeout(()=>{y.classList.remove("ring-2","ring-yellow-400","ring-offset-2")},2e3))},className:se("mb-2 p-2 rounded-lg border-l-4 cursor-pointer hover:bg-white/5 transition-colors",k?"bg-white/10 border-white/30":"bg-slate-700/50 border-brand"),children:[e.jsx("p",{className:"text-[10px] font-semibold mb-0.5 opacity-80",children:v.senderId===a?g==="ar"?"ÿ£ŸÜÿ™":"You":s}),e.jsx("p",{className:"text-xs opacity-70 line-clamp-2",children:v.text||((E=v.fileType)!=null&&E.startsWith("image/")?g==="ar"?"üì∑ ÿµŸàÿ±ÿ©":"üì∑ Photo":g==="ar"?"üìé ŸÖŸÑŸÅ":"üìé File")})]}),P(t,k),t.poll?e.jsx(ni,{question:t.poll.question,options:t.poll.options,votes:t.poll.votes,onVote:N=>o(t.id,N),currentUserId:a,isSent:k}):!(((x=t.fileType)!=null&&x.startsWith("audio/")||t.fileType==="audio")&&(t.text==="üé§"||t.text==="üé§ Voice Message"||t.text==="Voice Message"))&&e.jsx("p",{className:"text-[15px] leading-relaxed break-words whitespace-pre-wrap",children:t.text.split(/(\bhttps?:\/\/[^\s]+)/g).map((N,y)=>{if(N.match(/^https?:\/\//)){try{const T=new URL(N);if(T.searchParams.has("join"))return e.jsxs("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 font-bold underline decoration-brand decoration-2 text-brand/80 hover:text-white transition-colors bg-brand/10 px-1 rounded mx-0.5",onClick:W=>{if(W.preventDefault(),I){const S=T.searchParams.get("join");S&&I(S)}},children:[e.jsx(Lt,{className:"w-3 h-3"}),"Join Group"]},y)}catch{}return e.jsx("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-400 hover:text-blue-300 break-all",children:N},y)}return N})}),!t.poll&&!t.fileType&&h&&e.jsx(ii,{url:h,language:g}),e.jsxs("div",{className:se("flex items-center gap-1.5 mt-1 opacity-60 text-[10px]",k?"justify-end":"justify-start"),children:[e.jsx("span",{children:C(t.timestamp)}),k&&(t.isRead?e.jsx(ca,{className:"w-3 h-3 text-sky-400"}):e.jsx(ot,{className:"w-3 h-3"}))]}),t.reactions&&Object.keys(t.reactions).length>0&&e.jsx("div",{className:se("absolute -bottom-3 flex flex-wrap gap-1 z-10",k?"right-2":"left-2"),children:Object.entries(t.reactions).map(([N,y])=>e.jsxs(A.button,{initial:{scale:0},animate:{scale:1},onClick:T=>{T.stopPropagation(),d(t.id,N)},className:se("bg-slate-900/90 backdrop-blur-md border border-white/10 rounded-full px-1.5 py-0.5 text-[10px] flex items-center gap-1 shadow-lg",y.includes(a)&&"border-brand/50 bg-brand/10"),children:[e.jsx("span",{children:N}),y.length>1&&e.jsx("span",{className:"opacity-70 font-bold",children:y.length})]},N))})]}),e.jsx(fe,{children:i&&e.jsx("div",{className:se("absolute top-8 z-30",q?"right-0":"left-0"),children:e.jsxs(A.div,{initial:{opacity:0,scale:.9,x:q?20:-20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.9,x:q?10:-10},className:"bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl py-1.5 min-w-[120px] overflow-hidden",children:[e.jsx("div",{className:"flex px-1.5 pb-1.5 mb-1.5 border-b border-white/5 overflow-x-auto scrollbar-hide gap-1",children:["üëç","‚ù§Ô∏è","üòÇ","üòÆ","üò¢","üî•"].map(N=>e.jsx("button",{onClick:()=>{d(t.id,N),l()},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-lg",children:N},N))}),e.jsxs("button",{onClick:()=>{p(t),l()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx($s,{className:"w-3.5 h-3.5"})," ",_("reply")]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{c(t.id,t.text),l()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Gs,{className:"w-3.5 h-3.5"})," ",_("edit")]}),e.jsxs("button",{onClick:()=>{u(t.id),l()},className:"w-full text-left px-4 py-2 text-xs text-red-400 hover:bg-red-500/10 flex items-center gap-2",children:[e.jsx(Bs,{className:"w-3.5 h-3.5"})," ",_("delete")]})]})]})})})]})})}),Rt=[{id:"1",title:"Funny Cat",url:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif",preview:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"},{id:"2",title:"Excited",url:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif",preview:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif"},{id:"3",title:"Sad",url:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif",preview:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif"},{id:"4",title:"Thumbs Up",url:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif",preview:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif"},{id:"5",title:"Dancing",url:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif",preview:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif"},{id:"6",title:"Mind Blown",url:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif",preview:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif"},{id:"7",title:"Applause",url:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif",preview:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif"},{id:"8",title:"Laughing",url:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif",preview:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif"}];function li({onSelect:t,onClose:a,language:s}){const[r,n]=m.useState(""),[i,l]=m.useState(Rt),[d,p]=m.useState(!1);return m.useEffect(()=>{if(!r){l(Rt);return}const u=setTimeout(()=>{p(!0);const c=Rt.filter(f=>f.title.toLowerCase().includes(r.toLowerCase())),o=c.length>0?c:Rt.slice(0,4);l(o),p(!1)},500);return()=>clearTimeout(u)},[r]),e.jsxs("div",{className:"w-full h-full flex flex-col bg-slate-900 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",value:r,onChange:u=>n(u.target.value),placeholder:s==="ar"?"ÿ®ÿ≠ÿ´ ÿπŸÜ GIF...":"Search GIF...",className:"w-full bg-slate-800 text-white rounded-lg pl-9 pr-4 py-2 text-sm border-none focus:ring-1 focus:ring-brand placeholder:text-slate-500",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:d?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 animate-spin text-brand"})}):e.jsxs(e.Fragment,{children:[!r&&e.jsxs("div",{className:"text-xs font-bold text-slate-500 mb-2 px-1 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(Qe,{className:"w-3 h-3 text-yellow-500"})," Trending"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(u=>e.jsxs("button",{onClick:()=>t(u),className:"relative aspect-video rounded-lg overflow-hidden border border-white/5 hover:border-brand/50 transition-all group",children:[e.jsx("img",{src:u.preview,alt:u.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]},u.id))})]})}),e.jsx("div",{className:"p-2 border-t border-white/5 flex justify-center",children:e.jsx("span",{className:"text-[10px] text-slate-600 font-bold tracking-widest",children:"POWERED BY GIPHY"})})]})}function ci({repliedMessage:t,onCancel:a}){const s=()=>{var r,n,i;return(r=t.fileType)!=null&&r.startsWith("audio/")?"üé§":(n=t.fileType)!=null&&n.startsWith("image/")?"üì∑ Photo":(i=t.fileType)!=null&&i.startsWith("video/")?"üé• Video":t.fileType?"üìé File":t.text};return e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"bg-slate-800/60 backdrop-blur-md border border-white/10 border-l-4 border-l-indigo-500 px-3 py-2 mb-2 rounded-r-lg shadow-lg relative",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($s,{className:"w-3 h-3 text-indigo-400"}),e.jsx("span",{className:"text-indigo-400 text-xs font-bold",children:t.senderName})]}),e.jsx("p",{className:"text-slate-300 text-sm truncate opacity-90",children:s()})]}),e.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(_e,{className:"w-4 h-4"})})]})})}function di({onSend:t,onCancel:a}){const[s,r]=m.useState(0),[n,i]=m.useState(new Array(25).fill(0)),l=m.useRef(null),d=m.useRef([]),p=m.useRef(0),u=m.useRef(!1),c=m.useRef(null),o=m.useRef(null),f=m.useRef(null),v=m.useCallback(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){X.error("Microphone access is blocked! üö´"),a();return}const P=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),I=new(window.AudioContext||window.webkitAudioContext);I.state==="suspended"&&await I.resume();const w=I.createMediaStreamSource(P),k=I.createGain();k.gain.value=3;const O=I.createAnalyser();O.fftSize=64;const q=I.createMediaStreamDestination();w.connect(k),k.connect(q),k.connect(O),c.current=I,o.current=O;const b=O.frequencyBinCount,h=new Uint8Array(b);p.current=Date.now(),u.current=!0,r(0);const R=()=>{if(!u.current)return;if(o.current){o.current.getByteFrequencyData(h);const T=[],W=Math.floor(b/25);for(let S=0;S<25;S++)T.push(Math.max(4,h[S*W]||0));i(T)}const y=(Date.now()-p.current)/1e3;r(y),f.current=requestAnimationFrame(R)};let E={audioBitsPerSecond:128e3};const x=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/aac"];for(const y of x)if(MediaRecorder.isTypeSupported(y)){E.mimeType=y;break}const N=new MediaRecorder(q.stream,E);l.current=N,d.current=[],N.ondataavailable=y=>{y.data.size>0&&d.current.push(y.data)},N.onstop=()=>{P.getTracks().forEach(y=>y.stop()),c.current&&c.current.close()},N.start(100),R()}catch(P){console.error("Microphone error:",P),X.error("Unable to access microphone: "+P.message),a()}},[a]),g=m.useCallback(()=>{if(l.current&&u.current){const P=(Date.now()-p.current)/1e3;l.current.onstop=()=>{const I=new Blob(d.current,{type:l.current.mimeType});t(I,P)},l.current.stop(),u.current=!1}},[t]),_=m.useCallback(()=>{l.current&&u.current&&(l.current.onstop=()=>{d.current=[]},l.current.stop(),u.current=!1),a()},[a]);m.useEffect(()=>(v(),()=>{u.current&&l.current&&l.current.stop(),f.current&&cancelAnimationFrame(f.current),c.current&&c.current.close()}),[]);const C=P=>{const I=Math.floor(P/60),w=Math.floor(P%60);return`${I}:${w.toString().padStart(2,"0")}`};return e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mx-auto w-full max-w-[220px] flex items-center justify-between gap-2 px-3 h-12 bg-slate-800/40 rounded-full border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{onClick:_,variant:"ghost",size:"icon",className:"text-slate-400 hover:text-red-400 rounded-full h-9 w-9 transition-colors flex-shrink-0",children:e.jsx(Bs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A.div,{animate:{opacity:[1,.5,1]},transition:{repeat:1/0,duration:1.5},className:"w-2.5 h-2.5 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-white font-mono text-xs font-medium min-w-[35px]",children:C(s)})]})]}),e.jsx("div",{className:"flex-1 px-1",children:e.jsx("div",{className:"h-4 flex items-center gap-[1px] overflow-hidden justify-center max-w-[80px] mx-auto opacity-30",children:n.map((P,I)=>e.jsx(A.div,{animate:{height:`${Math.min(100,Math.max(20,P/255*100))}%`},transition:{type:"spring",stiffness:300,damping:20},className:"w-1 bg-red-500/80 rounded-full"},I))})}),e.jsx("div",{className:"flex items-center",children:e.jsx(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:g,className:"w-9 h-9 bg-brand rounded-full flex items-center justify-center text-white shadow-lg shadow-brand/20 hover:bg-brand/80 transition-colors flex-shrink-0",children:e.jsx($t,{className:"w-4 h-4 fill-current ml-0.5"})})})]})}const ui=m.memo(({onSendMessage:t,currentUserId:a,replyTo:s,setReplyTo:r,onTyping:n,t:i,language:l,onSendVoiceMessage:d,editingMessage:p,setEditingMessage:u,onEditMessage:c,scrollToBottom:o,isGroup:f,setShowPollCreator:v})=>{const[g,_]=m.useState(!1),[C,P]=m.useState(""),[I,w]=m.useState(null),[k,O]=m.useState(!1),[q,b]=m.useState(!1),[h,R]=m.useState(null),[E,x]=m.useState(!1),[N,y]=m.useState(!1),[T,W]=m.useState(null),S=m.useRef(null),V=m.useRef(null),j=m.useRef(!1),$=m.useRef(null);m.useEffect(()=>{p&&(P(p.text),S.current&&(S.current.value=p.text,S.current.focus()))},[p]);const ee=m.useCallback(M=>{const Y=M.target.value,U=Y.trim().length>0;_(J=>J!==U?U:J);const L=M.target;L.style.height="auto",L.style.height=`${Math.min(L.scrollHeight,120)}px`,Y.length>0?(j.current||(j.current=!0,n(!0)),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{j.current=!1,n(!1)},3e3)):j.current&&(j.current=!1,n(!1),$.current&&clearTimeout($.current))},[n]),H=async M=>{var U;M==null||M.preventDefault();const Y=((U=S.current)==null?void 0:U.value)||"";if(I){O(!0);try{const L=new FormData;L.append("file",I),L.append("userId",a);const ne=await(await fetch(`https://${cs}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${ds}`},body:L})).json();if(ne.error)throw new Error(ne.error);t(Y.trim(),ne.fileUrl,ne.fileType,ne.fileName,s==null?void 0:s.id,h),S.current&&(S.current.value="",S.current.style.height="auto"),_(!1),w(null),r(null),setTimeout(()=>o(),100)}catch(L){X.error("Upload failed: "+L.message)}finally{O(!1)}}else Y.trim()&&(p&&c?(c(p.id,Y.trim()),u(null)):t(Y.trim(),void 0,void 0,void 0,s==null?void 0:s.id,h),S.current&&(S.current.value="",S.current.style.height="auto"),_(!1),r(null),R(null),setTimeout(()=>o(),100))},Q=M=>{t(M.title||"GIF",M.url,"image/gif","animation.gif",s==null?void 0:s.id,h),y(!1),r(null),setTimeout(()=>o(),100)};return m.useLayoutEffect(()=>{if(!S.current)return;const M=S.current;M.style.height="auto",M.style.height=`${Math.min(M.scrollHeight,120)}px`,p&&_(!0)},[p]),e.jsxs("div",{className:"p-4 bg-slate-900/80 backdrop-blur-md border-t border-white/5 relative z-50",children:[e.jsxs(fe,{children:[s&&e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3",children:e.jsx(ci,{repliedMessage:s,onCancel:()=>r(null)})}),p&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 p-3 bg-indigo-500/10 border-l-4 border-indigo-500 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i("editing_message")})]}),e.jsx("button",{onClick:()=>{u(null),P(""),S.current&&(S.current.value="")},className:"text-slate-400 hover:text-white",children:e.jsx(_e,{className:"w-4 h-4"})})]}),I&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-2 flex items-center gap-3 bg-slate-800/80 rounded-xl p-3 border border-brand/30",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-lg",children:e.jsx(Ot,{className:"w-5 h-5 text-brand"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:I.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(I.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>w(null),className:"p-1 hover:bg-white/10 rounded-full",children:e.jsx(_e,{className:"w-4 h-4 text-slate-400"})})]})]}),e.jsx(fe,{children:N&&e.jsxs(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:320},exit:{opacity:0,height:0},className:"absolute bottom-full left-0 right-0 z-50 bg-slate-900 border-t border-white/10 shadow-2xl overflow-hidden rounded-t-2xl mx-2 mb-2",children:[e.jsx("div",{className:"flex justify-end p-2 absolute top-0 right-0 z-10",children:e.jsx("button",{onClick:()=>y(!1),className:"bg-black/50 hover:bg-black/70 rounded-full p-1 text-white transition-colors",children:e.jsx(_e,{className:"w-4 h-4"})})}),e.jsx(li,{onSelect:Q,onClose:()=>y(!1),language:l})]})}),e.jsxs("div",{className:"flex items-end gap-3 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex-1 bg-slate-800/50 backdrop-blur-sm rounded-2xl flex items-end p-1 border border-white/10 shadow-lg focus-within:border-brand/50 focus-within:ring-1 focus-within:ring-brand/20 transition-all",children:q?e.jsx(di,{onSend:(M,Y)=>{d(M,Y),b(!1)},onCancel:()=>b(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center self-center px-1",children:[e.jsx("input",{type:"file",ref:V,onChange:M=>{var Y;return w(((Y=M.target.files)==null?void 0:Y[0])||null)},className:"hidden"}),e.jsx("button",{onClick:()=>{var M;return(M=V.current)==null?void 0:M.click()},className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(da,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>y(!N),className:se("p-2.5 rounded-xl transition-all",N?"text-brand bg-brand/10":"text-slate-400 hover:text-brand hover:bg-brand/10"),children:e.jsx(Qe,{className:"w-5 h-5"})}),f&&e.jsx("button",{onClick:()=>v(!0),className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>x(!E),className:se("p-2.5 rounded-xl transition-all flex items-center justify-center relative",h?"text-orange-400 bg-orange-500/20":"text-slate-400 hover:text-white"),children:[e.jsx(ua,{className:se("w-5 h-5",h&&"animate-pulse")}),h&&e.jsxs("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:[h,"s"]})]}),e.jsx(fe,{children:E&&e.jsx(A.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-0 mb-4 bg-slate-900 border border-white/20 rounded-2xl p-2 shadow-2xl z-[200] min-w-[160px] backdrop-blur-2xl",children:e.jsx("div",{className:"flex flex-col gap-1",children:[{label:l==="ar"?"ÿ•ŸäŸÇÿßŸÅ":"Off",value:null},{label:l==="ar"?"5 ÿ´ŸàÿßŸÜŸç":"5 Seconds",value:5},{label:l==="ar"?"10 ÿ´ŸàÿßŸÜŸç":"10 Seconds",value:10},{label:l==="ar"?"30 ÿ´ÿßŸÜŸäÿ©":"30 Seconds",value:30},{label:l==="ar"?"ÿØŸÇŸäŸÇÿ© Ÿàÿßÿ≠ÿØÿ©":"1 Minute",value:60},{label:l==="ar"?"ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©":"1 Hour",value:3600}].map(M=>e.jsxs("button",{onClick:()=>{R(M.value),x(!1)},className:se("w-full text-left px-4 py-2.5 rounded-xl text-sm transition-all flex items-center justify-between",h===M.value?"bg-brand/20 text-brand font-bold":"text-slate-300 hover:bg-white/5"),children:[M.label,h===M.value&&e.jsx(ot,{className:"w-4 h-4"})]},M.label))})})})]})]}),e.jsx("textarea",{ref:S,rows:1,placeholder:i("type_message"),defaultValue:C,onChange:ee,inputMode:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"sentences",onKeyDown:M=>{if(M.key==="Enter"&&!M.shiftKey){if(M.preventDefault(),k)return;H(M)}},className:"flex-1 bg-transparent border-none text-white placeholder:text-slate-500 px-4 py-3 resize-none focus:outline-none max-h-[120px] scrollbar-hide text-[15px] leading-relaxed"})]})}),g||I?e.jsx(A.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:H,className:"h-[50px] w-[50px] bg-gradient-to-tr from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/25",children:k?e.jsx(Ce,{className:"w-5 h-5 animate-spin"}):e.jsx($t,{className:"w-5 h-5 fill-current"})}):e.jsx(A.button,{onClick:()=>b(!0),whileHover:{scale:1.1},whileTap:{scale:.9},className:"h-[50px] w-[50px] bg-slate-800 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-slate-700 transition-colors",children:e.jsx(os,{className:"w-5 h-5"})})]})]})});function mi({url:t,type:a,name:s,onClose:r}){const n=a.startsWith("image/"),i=a.startsWith("video/"),l=a.includes("pdf");return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-200",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-[200px] sm:max-w-md",children:s}),e.jsx("p",{className:"text-gray-400 text-xs",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:t,download:s,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(qs,{className:"w-6 h-6"})}),e.jsx("button",{onClick:r,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(_e,{className:"w-7 h-7"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 sm:p-10",children:n?e.jsx("img",{src:t,alt:s,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl animate-in zoom-in-95 duration-300"}):i?e.jsx("video",{src:t,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg shadow-2xl"}):l?e.jsx("iframe",{src:t,className:"w-full h-full max-w-5xl bg-white rounded-lg shadow-2xl",title:s}):e.jsxs("div",{className:"bg-[#202c33] p-8 rounded-2xl flex flex-col items-center gap-6 max-w-sm text-center shadow-2xl border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-brand/20 rounded-full flex items-center justify-center",children:e.jsx(Fs,{className:"w-10 h-10 text-brand"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"No Preview Available"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["This file type (",a,") cannot be previewed directly. You can download it to view."]})]}),e.jsx("a",{href:t,download:s,className:"w-full",children:e.jsx(le,{className:"w-full bg-brand hover:bg-brand/80 text-white py-6 text-lg",children:"Download File"})})]})})]})}function pi({partnerId:t,partnerName:a,partnerAvatar:s,isGroup:r,onClose:n,messages:i,onOpenGallery:l,onAudioCall:d,onVideoCall:p,onShowProfile:u,language:c,t:o}){const[f,v]=m.useState(null),[g,_]=m.useState(!0),C=i.filter(P=>{var I,w;return P.fileUrl&&(((I=P.fileType)==null?void 0:I.startsWith("image/"))||((w=P.fileType)==null?void 0:w.startsWith("video/")))});return m.useEffect(()=>{async function P(){if(r){const{data:I,error:w}=await Z.from("groups").select("*").eq("id",t).single();I&&v(I),_(!1)}else{const{data:I,error:w}=await Z.from("profiles").select("*").eq("id",t).single();I&&v(I),_(!1)}}P()},[t,r]),e.jsxs(A.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"absolute top-0 right-0 h-full w-full md:w-[380px] bg-slate-950 border-l border-white/10 z-[1001] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/5 bg-slate-950",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("h2",{className:`text-lg font-semibold text-white ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ¨Ÿáÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ":"Contact Info"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative mb-4 group cursor-pointer",children:[e.jsxs(Oe,{className:"w-32 h-32 border-4 border-slate-800 shadow-2xl group-hover:border-indigo-500/50 transition-colors duration-300",children:[e.jsx(We,{src:s||(f==null?void 0:f.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-3xl font-bold text-indigo-400",children:a.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Us,{className:"w-8 h-8 text-white/80"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-white text-center mb-1",children:a}),e.jsx("p",{className:"text-indigo-400 text-sm font-medium",children:f!=null&&f.username?`@${f.username}`:r?c==="ar"?"ÿØÿ±ÿØÿ¥ÿ© ÿ¨ŸÖÿßÿπŸäÿ©":"Group Chat":c==="ar"?"~ŸÖÿ≥ÿ™ÿÆÿØŸÖ":"~User"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-8",children:[e.jsxs("button",{onClick:d,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(ls,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ÿµŸàÿ™":"Audio"})]}),e.jsxs("button",{onClick:p,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/10 flex items-center justify-center group-hover:bg-violet-500/20 text-violet-400 transition-colors",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ŸÅŸäÿØŸäŸà":"Video"})]}),e.jsxs("button",{onClick:u,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center group-hover:bg-emerald-500/20 text-emerald-400 transition-colors",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ÿßŸÑŸÖŸÑŸÅ":"Profile"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5",children:[e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-widest font-black mb-4 ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©":"Personal Info"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400 shrink-0",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-100 text-[15px] leading-relaxed break-words",children:(f==null?void 0:f.about)||(c==="ar"?"ŸÑÿß ŸäŸàÿ¨ÿØ ŸÜÿ®ÿ∞ÿ© ÿ¥ÿÆÿµŸäÿ©":"No bio provided")}),e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-wider mt-1 font-bold ${c==="ar"?"font-arabic":""}`,children:o("about")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-400",children:e.jsx(He,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(f==null?void 0:f.gender)==="male"?o("male"):(f==null?void 0:f.gender)==="female"?o("female"):c==="ar"?"ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ":"Not specified"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:o("gender")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400",children:e.jsx(zt,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(f==null?void 0:f.birth_year)||"----"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:o("birth_year")})]})]})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(Hs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm truncate",children:(f==null?void 0:f.email)||(r?c==="ar"?"ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ŸÖÿßÿπŸäÿ©":"Group Conversation":c==="ar"?"ŸÖÿÆŸÅŸä":"Hidden")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä":"Email"})]})]}),(f==null?void 0:f.created_at)&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(zt,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(f.created_at).toLocaleDateString(c==="ar"?"ar-EG":"en-US")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"ÿßŸÜÿ∂ŸÖ ŸÅŸä":"Joined"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:l,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest font-bold",children:c==="ar"?"ÿßŸÑŸàÿ≥ÿßÿ¶ÿ∑ ŸàÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ŸàÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™":"Media, Links & Docs"}),e.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1 group-hover:text-indigo-400 transition-colors",children:[C.length," ",e.jsx("span",{className:"opacity-50",children:"‚Ä∫"})]})]}),C.length>0?e.jsx("div",{className:"grid grid-cols-4 gap-2",children:C.slice(0,4).map((P,I)=>{var w;return e.jsxs("div",{className:"aspect-square rounded-lg bg-slate-800 border border-white/5 overflow-hidden relative group/img",children:[(w=P.fileType)!=null&&w.startsWith("image")?e.jsx("img",{src:P.fileUrl,alt:"Media",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-800",children:e.jsx(it,{className:"w-5 h-5 text-slate-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover/img:bg-transparent transition-colors"})]},P.id||I)})}):e.jsx("p",{className:"text-slate-600 text-xs italic py-2",children:c==="ar"?"ŸÑÿß ÿ™Ÿàÿ¨ÿØ Ÿàÿ≥ÿßÿ¶ÿ∑ ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ®ÿπÿØ.":"No shared media yet."})]}),r&&(f==null?void 0:f.group_id)&&e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:()=>{const P=`${window.location.origin}?join=${f.group_id}`;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(P).then(()=>X.success(c==="ar"?"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿØÿπŸàÿ©!":"Invite link copied!",{description:c==="ar"?"ÿ¥ÿßÿ±ŸÉ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÑÿØÿπŸàÿ© ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ.":"Share this link to invite others."})).catch(()=>X.error(c==="ar"?"ŸÅÿ¥ŸÑ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑":"Failed to copy link"));else try{const I=document.createElement("textarea");I.value=P,document.body.appendChild(I),I.select(),document.execCommand("copy"),document.body.removeChild(I),X.success(c==="ar"?"ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿØÿπŸàÿ©!":"Invite link copied!",{description:c==="ar"?"ÿ¥ÿßÿ±ŸÉ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÑÿØÿπŸàÿ© ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ.":"Share this link to invite others."})}catch{X.error(c==="ar"?"ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑÿ≠ÿßŸÅÿ∏ÿ©":"Clipboard access denied",{description:c==="ar"?"Ÿäÿ±ÿ¨Ÿâ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸäÿØŸàŸäÿßŸã.":"Please manually copy the link."})}},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(Lt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white transition-colors",children:c==="ar"?"ÿØÿπŸàÿ© ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿπÿ®ÿ± ÿ±ÿßÿ®ÿ∑":"Invite to Group via Link"}),e.jsx("p",{className:"text-slate-500 text-xs",children:c==="ar"?"ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿØÿπŸàÿ©":"Tap to copy invite link"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(ns,{className:"w-5 h-5 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"ŸÉÿ™ŸÖ ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™":"Mute Notifications"})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(ma,{className:"w-5 h-5 text-slate-400 group-hover:text-yellow-400 transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖŸÖŸäÿ≤ÿ© ÿ®ŸÜÿ¨ŸÖÿ©":"Starred Messages"})})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(pa,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?`ÿ≠ÿ∏ÿ± ${a}`:`Block ${a}`})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(fa,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?"ÿ•ÿ®ŸÑÿßÿ∫ ÿπŸÜ ÿ¨Ÿáÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ":"Report Contact"})})]})]})]})]})]})}function fi({messages:t,onClose:a}){const[s,r]=m.useState("media"),[n,i]=m.useState(null),{media:l,docs:d,links:p}=m.useMemo(()=>{const c=[],o=[],f=[];return t.forEach(v=>{var C,P,I;v.fileUrl&&((C=v.fileType)!=null&&C.startsWith("image/")||(P=v.fileType)!=null&&P.startsWith("video/"))?c.push(v):v.fileUrl&&o.push(v);const g=/(https?:\/\/[^\s]+)/g,_=(I=v.text)==null?void 0:I.match(g);_&&_.forEach(w=>{f.push({...v,linkUrl:w})})}),{media:c.reverse(),docs:o.reverse(),links:f.reverse()}},[t]),u=[{id:"media",label:"Media"},{id:"docs",label:"Docs"},{id:"links",label:"Links"}];return e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute inset-0 z-[150] bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-900 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Xe,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Media, Links & Docs"})]}),e.jsx("div",{className:"flex border-b border-white/5 bg-slate-900/50",children:u.map(c=>e.jsxs("button",{onClick:()=>r(c.id),className:se("flex-1 py-3 text-sm font-medium relative transition-colors",s===c.id?"text-indigo-400":"text-slate-400 hover:text-slate-300"),children:[c.label,s===c.id&&e.jsx(A.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500"})]},c.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-950 p-4 custom-scrollbar",children:[s==="media"&&e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-2",children:l.length>0?l.map(c=>{var o;return e.jsx("div",{className:"aspect-square relative group overflow-hidden rounded-lg bg-slate-900 border border-white/5",children:(o=c.fileType)!=null&&o.startsWith("image/")?e.jsx("img",{src:c.fileUrl,alt:c.fileName,className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform duration-300",onClick:()=>i(c.fileUrl)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-slate-800",children:e.jsx(it,{className:"w-8 h-8 text-slate-400"})})},c.id)}):e.jsxs("div",{className:"col-span-full py-20 text-center text-slate-500",children:[e.jsx(Us,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No media shared"})]})}),s==="docs"&&e.jsx("div",{className:"space-y-2",children:d.length>0?d.map(c=>{var o;return e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400",children:e.jsx(Ot,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:c.fileName}),e.jsxs("p",{className:"text-xs text-slate-500 uppercase",children:[((o=c.fileType)==null?void 0:o.split("/")[1])||"FILE"," ‚Ä¢ ",new Date(c.timestamp).toLocaleDateString()]})]}),e.jsx("a",{href:c.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-500 hover:text-white rounded-full hover:bg-white/10 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(qs,{className:"w-4 h-4"})})]},c.id)}):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(Ot,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No documents found"})]})}),s==="links"&&e.jsx("div",{className:"space-y-2",children:p.length>0?p.map((c,o)=>e.jsxs("div",{className:"flex gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400 flex-shrink-0",children:e.jsx(Lt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("a",{href:c.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:underline text-sm font-medium truncate block",children:c.linkUrl}),c.text!==c.linkUrl&&e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5",children:c.text}),e.jsx("p",{className:"text-[10px] text-slate-600 mt-1",children:new Date(c.timestamp).toLocaleDateString()})]})]},o)):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(Lt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No links shared"})]})})]}),e.jsx(fe,{children:n&&e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200] bg-black/95 backdrop-blur-md flex items-center justify-center p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition-colors",onClick:()=>i(null),children:e.jsx(_e,{className:"w-6 h-6"})}),e.jsx(A.img,{initial:{scale:.9},animate:{scale:1},src:n||"",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:c=>c.stopPropagation()})]})})]})}function hi({onClose:t,onSend:a}){const[s,r]=m.useState(""),[n,i]=m.useState(["",""]),l=()=>{n.length<10&&i([...n,""])},d=(c,o)=>{const f=[...n];f[c]=o,i(f)},p=c=>{n.length>2&&i(n.filter((o,f)=>f!==c))},u=()=>{const c=n.filter(o=>o.trim()!=="");s.trim()&&c.length>=2&&(a(s,c),t())};return e.jsx(A.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-3xl w-full max-w-md shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-gradient-to-r from-brand/10 to-violet-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl text-brand",children:e.jsx(Vs,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white leading-none",children:"Create Poll"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ask your friends anything"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full transition-all",children:e.jsx(_e,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(ha,{className:"w-4 h-4 text-brand"}),"Question"]}),e.jsx(ye,{value:s,onChange:c=>r(c.target.value),placeholder:"What's on your mind?",dir:"auto",className:"bg-slate-950 border-white/5 focus:border-brand/50 h-12 text-white placeholder:text-slate-600 rounded-xl px-4"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Options"}),n.map((c,o)=>e.jsx(A.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-2 group",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ye,{value:c,onChange:f=>d(o,f.target.value),placeholder:`Option ${o+1}`,dir:"auto",className:"bg-slate-950/50 border-white/5 focus:border-brand/50 h-11 text-white placeholder:text-slate-700 rounded-xl px-4"}),o>=2&&e.jsx("button",{onClick:()=>p(o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(_e,{className:"w-4 h-4"})})]})},o)),n.length<10&&e.jsxs("button",{onClick:l,className:"w-full py-3 border-2 border-dashed border-slate-800 rounded-xl text-slate-500 hover:text-brand hover:border-brand/30 transition-all flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(xa,{className:"w-4 h-4"}),"Add Option"]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-950/50 flex gap-3",children:[e.jsx(le,{variant:"ghost",onClick:t,className:"flex-1 text-slate-400 hover:text-white hover:bg-white/5 h-12 rounded-xl font-bold",children:"Cancel"}),e.jsxs(le,{onClick:u,disabled:!s.trim()||n.filter(c=>c.trim()).length<2,className:"flex-1 bg-gradient-to-r from-brand to-violet-600 hover:from-brand/80 hover:to-violet-500 text-white shadow-lg shadow-brand/20 h-12 rounded-xl font-bold gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),"Create Poll"]})]})]})})}function xi({audioUrl:t,duration:a,messageId:s,onPlayNext:r}){const{activeMessageId:n,playMessage:i,pauseMessage:l,registerMessage:d,unregisterMessage:p,notifyEnded:u}=br(),[c,o]=m.useState(!1),[f,v]=m.useState(()=>s?localStorage.getItem(`vp_played_${s}`)==="true":!0),[g,_]=m.useState(a||0),[C,P]=m.useState(0),[I,w]=m.useState(1),[k,O]=m.useState(!1),[q,b]=m.useState(!1),h=m.useRef(null);m.useRef(null);const R=m.useRef(a||0),E=35,x=m.useMemo(()=>Array.from({length:E},()=>Math.floor(Math.random()*60)+20),[]);m.useEffect(()=>{a&&a>0&&(_(a),R.current=a)},[a]),m.useEffect(()=>{const j=h.current;if(!j)return;const $=()=>P(j.currentTime),ee=()=>{j.duration&&!isNaN(j.duration)&&j.duration!==1/0&&(_(j.duration),R.current=j.duration)};return j.addEventListener("timeupdate",$),j.addEventListener("loadedmetadata",ee),j.addEventListener("durationchange",ee),j.addEventListener("play",()=>o(!0)),j.addEventListener("pause",()=>o(!1)),j.muted=q,()=>{j.removeEventListener("timeupdate",$),j.removeEventListener("loadedmetadata",ee),j.removeEventListener("durationchange",ee)}},[t,q]),m.useEffect(()=>{s&&(n===s?h.current&&h.current.paused&&(h.current.play().catch(()=>{}),f||(v(!0),localStorage.setItem(`vp_played_${s}`,"true"))):h.current&&!h.current.paused&&h.current.pause())},[n,s,f]),m.useEffect(()=>{if(s&&r)return d(s,r),()=>p(s)},[s,r,d,p]);const N=m.useCallback(()=>{o(!1),P(0),h.current&&(h.current.currentTime=0),s&&u(s)},[s,u]);m.useEffect(()=>{const j=h.current;if(j)return j.addEventListener("ended",N),()=>j.removeEventListener("ended",N)},[N]);const y=async j=>{j==null||j.stopPropagation(),!(!h.current||!s)&&(f||(v(!0),localStorage.setItem(`vp_played_${s}`,"true")),c?l(s):i(s))},T=j=>{if(j.stopPropagation(),!h.current||!R.current)return;const $=j.currentTarget.getBoundingClientRect(),ee=j.clientX-$.left,Q=Math.min(Math.max(0,ee/$.width),1)*R.current;h.current.currentTime=Q,P(Q)},W=j=>{if(j.stopPropagation(),!h.current)return;const $=[1,1.5,2],ee=$[($.indexOf(I)+1)%$.length];w(ee),h.current.playbackRate=ee},S=j=>{const $=Math.floor(j/60),ee=Math.floor(j%60);return`${$}:${ee.toString().padStart(2,"0")}`},V=R.current>0?C/R.current*100:0;return e.jsxs("div",{className:"flex items-center gap-3 w-full py-1 group/player select-none",onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[e.jsxs(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:y,className:se("w-10 h-10 rounded-full flex items-center justify-center transition-all bg-white/10 hover:bg-white/20 text-white border border-white/10 shadow-lg relative",c&&"bg-brand hover:bg-brand/80 border-brand",!f&&"ring-2 ring-sky-400 ring-offset-2 ring-offset-slate-900"),children:[c?e.jsx(ga,{className:"w-5 h-5 fill-current"}):e.jsx(ba,{className:"w-5 h-5 fill-current ml-0.5"}),!f&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-sky-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsxs("div",{className:"h-10 flex items-center gap-[3px] cursor-pointer group/wave relative",onClick:T,children:[x.map((j,$)=>{const ee=$/E*100,H=V>ee;return e.jsx(A.div,{initial:!1,animate:{height:`${j}%`,backgroundColor:H?f?"#818cf8":"#38bdf8":f?"rgba(255,255,255,0.15)":"rgba(56,189,248,0.2)"},transition:{type:"spring",stiffness:300,damping:20},className:se("flex-1 rounded-full min-h-[4px] transition-shadow duration-300",H&&(f?"shadow-[0_0_8px_rgba(129,140,248,0.5)]":"shadow-[0_0_10px_rgba(56,189,248,0.6)]"))},$)}),e.jsx("div",{className:"absolute inset-0 z-10 opacity-0 group-hover/wave:opacity-100 bg-gradient-to-r from-transparent via-white/5 to-transparent pointer-events-none transition-opacity duration-300"})]}),e.jsxs("div",{className:"flex justify-between items-center px-0.5 opacity-60 group-hover/player:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"text-[10px] font-mono font-medium text-white/70 flex gap-1",children:[e.jsx("span",{className:"text-white font-bold",children:S(C)}),e.jsxs("span",{children:["/ ",S(g)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>{const j=!q;b(j),h.current&&(h.current.muted=j)},className:"p-1 rounded-md bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/5 transition-all",title:q?"ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™":"ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™",children:q?e.jsx(Ws,{className:"w-3 h-3"}):e.jsx(Ft,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:W,className:se("text-[10px] font-bold px-1.5 py-0.5 rounded-md transition-all border",I===1?"bg-white/5 text-white/40 border-white/5":"bg-brand text-white border-brand"),children:[I,"x"]})]})]})]}),e.jsx("audio",{ref:h,src:t,hidden:!0})]})}function gi({currentUserId:t,partnerId:a,partnerName:s,partnerAvatar:r,messages:n,isPartnerOnline:i,isPartnerTyping:l,onBack:d,onSendMessage:p,onSendVoiceMessage:u,onDeleteMessage:c,onTyping:o,onRefresh:f,onReact:v,onSendPoll:g,onVote:_,onStartCall:C,onEditMessage:P,smartReplies:I=[],isGroup:w,onJoinGroup:k,onShowProfile:O,onClearChat:q,language:b,t:h}){const{playMessage:R}=br(),[E,x]=m.useState(null),[N,y]=m.useState(null),[T,W]=m.useState(!1),S=m.useRef(null),[V,j]=m.useState(null),[$,ee]=m.useState(null),[H,Q]=m.useState(!1),[M,Y]=m.useState(!1),[U,L]=m.useState(""),[J,ne]=m.useState(!1),[te,ce]=m.useState(!1),[Pe,je]=m.useState(!1),dt=J||te||Pe||!!N,Me=m.useRef(null);m.useRef(!1);const et=m.useRef(null),Ye=m.useRef(n.length),{wallpaper:be,bgOpacity:ge}=yr();m.useEffect(()=>{j(null),ee(null),x(null),L("")},[a]);const ue=(F="auto")=>{S.current&&S.current.scrollIntoView({behavior:F})};m.useLayoutEffect(()=>{n.length>0&&(n[n.length-1].senderId===t||!T)&&ue("smooth"),Ye.current=n.length},[n,t,T,a]),m.useLayoutEffect(()=>{ue("auto"),et.current=a},[a]);const Fe=()=>{if(!Me.current)return;const{scrollTop:F,scrollHeight:ie,clientHeight:Ae}=Me.current,Be=ie-F-Ae<200;W(!Be)},tt=m.useCallback(F=>new Date(F).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),[]),he=m.useCallback(F=>{if(!F){j(null);return}j(ie=>ie===F?null:F)},[]),Ee=m.useCallback(F=>{x({id:F.id,senderName:F.senderId===t?b==="ar"?"ÿ£ŸÜÿ™":"You":s,text:F.text,fileType:F.fileType}),j(null)},[t,b,s]),ut=m.useCallback((F,ie)=>{ee({id:F,text:ie}),j(null)},[]),mt=m.useCallback(()=>{ue("smooth")},[]),$e=m.useCallback((F,ie)=>{var Ae,Se,Be;if(!F.fileUrl||!F.fileType)return null;if(F.fileType.startsWith("image/"))return e.jsx(A.div,{whileHover:{scale:1.02},className:"mb-2 overflow-hidden rounded-lg",children:e.jsx("img",{src:F.fileUrl,alt:F.fileName||"Image",className:"max-w-full max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>y({url:F.fileUrl,type:F.fileType,name:F.fileName||"Image"})})});if(F.fileType.startsWith("video/"))return e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-black/20",children:e.jsx("video",{src:F.fileUrl,controls:!0,className:"max-w-full max-h-64"})});if((Ae=F.fileType)!=null&&Ae.startsWith("audio/")||F.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(F.fileName||"")){const ft=n.findIndex(z=>z.id===F.id),Ve=n[ft+1],ht=Ve&&(z=>{var re;return((re=z.fileType)==null?void 0:re.startsWith("audio/"))||z.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(z.fileName||"")})(Ve);return e.jsx(xi,{audioUrl:F.fileUrl||"",messageId:F.id,onPlayNext:ht?()=>R(Ve.id):void 0,duration:((Se=F.fileName)!=null&&Se.includes("duration=")?parseFloat(F.fileName.split("duration=")[1]):void 0)||((Be=F.fileUrl)!=null&&Be.includes("duration=")?parseFloat(F.fileUrl.split("duration=")[1]):void 0)})}return e.jsxs("div",{className:se("flex items-center gap-3 mb-2 p-3 rounded-xl cursor-pointer hover:opacity-80 transition-all border",ie?"bg-brand/20 border-brand/30":"bg-slate-800/60 border-white/10"),onClick:()=>y({url:F.fileUrl,type:F.fileType,name:F.fileName||"File"}),children:[e.jsx("div",{className:se("p-2 rounded-lg",ie?"bg-brand/20":"bg-slate-700/50"),children:e.jsx(Ot,{className:se("w-5 h-5",ie?"text-brand":"text-slate-400")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:F.fileName}),e.jsx("p",{className:"text-xs opacity-70 uppercase",children:F.fileType.split("/")[1]||"FILE"})]})]})},[n,R]),pt=m.useMemo(()=>{const F=new Map;return n.forEach(ie=>F.set(ie.id,ie)),F},[n]),Ge=m.useMemo(()=>U.trim()?n.filter(F=>F.text.toLowerCase().includes(U.toLowerCase())):n,[n,U]);return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 overflow-hidden relative",children:[e.jsx(fe,{children:V&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-20 bg-black/5",onClick:()=>j(null)})}),e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden",children:[e.jsx(A.div,{animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-brand/10 rounded-full blur-[120px]"}),e.jsx(A.div,{animate:{scale:[1,1.3,1],x:[0,-40,0],y:[0,-20,0]},transition:{duration:25,repeat:1/0,ease:"linear",delay:2},className:"absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-violet-600/10 rounded-full blur-[100px]"}),e.jsx("div",{className:se("absolute inset-0 transition-opacity duration-700",be==="doodles"&&"premium-doodle opacity-30 mix-blend-overlay",be==="stars"&&"wallpaper-stars opacity-40 mix-blend-screen",be==="geometric"&&"wallpaper-geometric opacity-20 mix-blend-overlay",be==="solid"&&"wallpaper-solid"),style:{opacity:be==="solid"?1:ge}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-slate-950/50"})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md px-4 py-3 flex items-center gap-3 sticky top-0 z-50 border-b border-white/5",children:[e.jsx("button",{onClick:d,className:"text-slate-400 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full",children:e.jsx(Xe,{className:"w-6 h-6"})}),e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ne(!0),children:[e.jsxs(Oe,{className:"w-10 h-10 border-2 border-slate-800 group-hover:border-brand transition-colors",children:[e.jsx(We,{src:r||`https://ui-avatars.com/api/?name=${encodeURIComponent(s)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-brand font-bold",children:(s||"?").charAt(0).toUpperCase()})]}),i&&!w&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-emerald-500 border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>ne(!0),children:[e.jsxs("h2",{className:"text-white font-bold truncate text-lg flex items-center gap-2",children:[s," ",w&&e.jsx("span",{className:"bg-slate-800 text-slate-400 text-[10px] px-1.5 py-0.5 rounded border border-white/5",children:"GROUP"})]}),!w&&e.jsx("div",{className:"text-xs flex items-center gap-1 h-4",children:e.jsx(fe,{mode:"wait",children:l?e.jsxs(A.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"flex items-center gap-1.5 text-indigo-400 font-medium",children:[e.jsx("span",{className:"text-[10px]",children:"typing"}),e.jsx("span",{className:"flex gap-0.5",children:[0,1,2].map(F=>e.jsx(A.span,{animate:{y:[0,-2,0]},transition:{repeat:1/0,duration:.5,delay:F*.1},className:"w-1 h-1 bg-indigo-400 rounded-full"},F))})]}):i?e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"text-emerald-500 font-medium",children:"Online"}):e.jsx(A.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-500",children:"Offline"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>Y(!M),className:se("p-2 rounded-full transition-colors",M?"text-indigo-400 bg-indigo-500/10":"text-slate-400 hover:text-white hover:bg-white/5"),children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:f,className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Ys,{className:"w-5 h-5"})}),!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>C("audio"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(ls,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C("video"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(it,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Q(!H),className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(is,{className:"w-5 h-5"})}),e.jsx(fe,{children:H&&e.jsxs(A.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute top-full right-0 mt-2 w-48 bg-slate-900 border border-white/10 rounded-xl shadow-2xl py-1 z-[100] overflow-hidden",children:[e.jsx("button",{onClick:()=>{ne(!0),Q(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Contact Info"}),e.jsx("button",{onClick:()=>{q&&q(),Q(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Clear Chat"}),e.jsx("div",{className:"h-px bg-white/5 my-1"}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:"Close Chat"})]})})]})]})]}),e.jsx(fe,{children:M&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-slate-900/50 backdrop-blur-md border-b border-white/5 px-4 py-2 relative z-40 overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search in conversation...",value:U,onChange:F=>L(F.target.value),className:"w-full bg-slate-950/50 border border-white/5 rounded-xl pl-10 pr-10 py-2 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all font-light"}),U&&e.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white",children:e.jsx(_e,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{ref:Me,onScroll:Fe,className:"flex-1 overflow-y-auto overflow-x-hidden p-4 px-6 space-y-4 custom-scrollbar relative message-container-glass",children:[Ge.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-indigo-500/20 to-violet-500/20 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(Qe,{className:"w-10 h-10 text-indigo-400"})}),e.jsxs("p",{className:"text-center font-medium",children:[U?"No matches found":"No messages yet.",e.jsx("br",{}),e.jsx("span",{className:"text-sm opacity-60",children:U?"Try searching for something else":"Start the conversation!"})]})]}):Ge.map((F,ie)=>e.jsx(oi,{message:F,currentUserId:t,partnerName:s,isGroup:w,isSequential:ie>0&&Ge[ie-1].senderId===F.senderId,isMenuOpen:V===F.id,onToggleMenu:he,onReact:v,onReply:Ee,onDelete:c,onEdit:ut,onVote:_,setViewingFile:y,repliedMessage:F.replyToId&&pt.get(F.replyToId)||null,language:b,t:h,formatMessageTime:tt,renderFilePreview:$e,onJoinGroup:k,isAnyOverlayOpen:dt},F.id)),e.jsx("div",{ref:S})]}),T&&e.jsx(A.button,{initial:{scale:0},animate:{scale:1},onClick:()=>ue("smooth"),className:"absolute bottom-24 right-6 bg-indigo-600 text-white p-3 rounded-full shadow-lg z-40 hover:bg-indigo-500 transition-colors",children:e.jsx(Xe,{className:"w-6 h-6 rotate-[-90deg]"})}),e.jsx(fe,{children:I.length>0&&!U&&e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar relative z-30",children:I.map((F,ie)=>e.jsx("button",{onClick:()=>p(F),dir:/[\u0600-\u06FF]/.test(F)?"rtl":"ltr",className:se("whitespace-nowrap bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-300 border border-indigo-500/20 px-4 py-1.5 rounded-full text-xs font-medium transition-all backdrop-blur-md",/[\u0600-\u06FF]/.test(F)?"font-arabic":""),children:F},ie))})}),e.jsx(ui,{onSendMessage:p,currentUserId:t,replyTo:E,setReplyTo:x,onTyping:o,t:h,language:b,onSendVoiceMessage:u,editingMessage:$,setEditingMessage:ee,onEditMessage:P,scrollToBottom:mt,isGroup:w,setShowPollCreator:je}),N&&e.jsx(mi,{url:N.url,type:N.type,name:N.name,onClose:()=>y(null)}),e.jsx(fe,{children:J&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#020617] backdrop-blur-md z-[1000]",onClick:()=>ne(!1)}),e.jsx(pi,{partnerId:a,partnerName:s,partnerAvatar:r,isGroup:w,onClose:()=>ne(!1),messages:n,onOpenGallery:()=>{ce(!0),ne(!1)},onAudioCall:()=>C("audio"),onVideoCall:()=>C("video"),onShowProfile:()=>{O(a),ne(!1)},language:b,t:h})]})}),e.jsx(fe,{children:te&&e.jsx(fi,{messages:n,onClose:()=>ce(!1)})}),e.jsx(fe,{children:Pe&&e.jsx(hi,{onClose:()=>je(!1),onSend:g})})]})}const bi=m.memo(gi);function vi({callerName:t,type:a,onAccept:s,onReject:r,language:n}){return e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:e.jsxs(A.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-8 shadow-2xl border border-white/10 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full flex items-center justify-center text-4xl text-white font-bold shadow-xl",children:t.charAt(0).toUpperCase()}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-indigo-400 text-sm",children:n==="ar"?a==="video"?"ŸÖŸÉÿßŸÑŸÖÿ© ŸÅŸäÿØŸäŸà Ÿàÿßÿ±ÿØÿ©...":"ŸÖŸÉÿßŸÑŸÖÿ© ÿµŸàÿ™Ÿäÿ© Ÿàÿßÿ±ÿØÿ©...":`Incoming ${a} call...`})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:r,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 active:scale-95 transition-all flex items-center justify-center shadow-lg",children:e.jsx(Js,{className:"w-7 h-7 text-white"})}),e.jsx("button",{onClick:s,className:"w-16 h-16 rounded-full bg-green-600 hover:bg-green-700 active:scale-95 transition-all flex items-center justify-center shadow-lg animate-pulse",children:e.jsx(ls,{className:"w-7 h-7 text-white"})})]})]})})}function yi({onFinish:t,language:a}){return m.useEffect(()=>{const s=setTimeout(()=>{t()},3e3);return()=>clearTimeout(s)},[t]),e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen w-full bg-slate-950 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[20%] left-[10%] w-[60vw] h-[60vw] bg-indigo-600/10 rounded-full blur-[120px] animate-blob"}),e.jsx("div",{className:"absolute bottom-[20%] right-[10%] w-[50vw] h-[50vw] bg-violet-600/10 rounded-full blur-[100px] animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-20"})]}),e.jsxs(A.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"relative z-10 flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx(A.div,{animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 bg-indigo-500 rounded-full blur-2xl"}),e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-[2.5rem] flex items-center justify-center shadow-2xl relative z-10 border border-white/20 transform rotate-3",children:e.jsx(ss,{className:"w-16 h-16 text-white fill-white/10",strokeWidth:1.5})}),e.jsx(A.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"absolute -bottom-2 -right-2 w-12 h-12 bg-slate-900 border border-emerald-500/50 rounded-2xl flex items-center justify-center shadow-xl z-20",children:e.jsx(Ks,{className:"w-6 h-6 text-emerald-400"})})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex flex-col items-center justify-center w-full max-w-md px-4",children:[e.jsx("h1",{className:"text-white text-4xl sm:text-5xl md:text-6xl font-black mb-4 tracking-tighter text-center w-full leading-tight",children:"Chat App"}),e.jsx("p",{className:"text-indigo-400 font-medium text-sm md:text-base mb-10 text-center w-full",children:a==="ar"?"ÿßÿÆÿ™ÿ®ÿ± ŸÖÿ≥ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™":"Experience the Future"})]}),e.jsx("div",{className:"w-48 h-1 overflow-hidden bg-slate-900 border border-white/5 rounded-full relative",children:e.jsx(A.div,{initial:{left:"-100%"},animate:{left:"100%"},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 bottom-0 w-1/2 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"})})]}),e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"absolute bottom-10 text-slate-600 text-[10px] uppercase font-bold tracking-[0.4em]",children:"Secure Quantum Encryption v2.4"})]})}function ji({items:t,initialIndex:a=0,onClose:s,onNext:r,onPrevious:n,onReply:i,language:l}){const[d,p]=m.useState(""),[u,c]=m.useState(!1),[o,f]=m.useState(a),[v,g]=m.useState(0),_=m.useRef(null),C=t[o],P=m.useCallback(()=>{o<t.length-1?(f(w=>w+1),g(0)):s()},[o,t.length,s]),I=m.useCallback(()=>{o>0?(f(w=>w-1),g(0)):n&&n()},[o,n]);return m.useEffect(()=>{if(!C)return;g(0);const w=5e3,k=50,O=k/w*100;return _.current=setInterval(()=>{u||g(q=>q>=100?(clearInterval(_.current),P(),100):q+O)},k),()=>{_.current&&clearInterval(_.current)}},[o,C,P]),C?e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-black flex flex-col md:rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full p-4 z-50 bg-gradient-to-b from-black/60 to-transparent",children:[e.jsx("div",{className:"flex gap-1 mb-4",children:t.map((w,k)=>e.jsx("div",{className:"flex-1 h-1 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-50",style:{width:k<o?"100%":k===o?`${v}%`:"0%"}})},k))}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Oe,{className:"w-10 h-10 border border-white/20",children:[e.jsx(We,{src:C.user_avatar}),e.jsx(ze,{children:C.user_name?C.user_name.charAt(0):"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:C.user_name}),e.jsx("p",{className:"text-[10px] opacity-60",children:new Date(C.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(is,{className:"w-5 h-5"})}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(_e,{className:"w-6 h-6"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[C.content_type==="text"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center p-10 bg-gradient-to-br from-indigo-600 to-violet-700",children:e.jsx("p",{className:"text-3xl font-bold text-white text-center leading-relaxed",children:C.text})}),C.content_type==="image"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("img",{src:C.content_url,alt:"Status",className:"max-w-full max-h-full object-contain"}),C.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:C.text})]}),C.content_type==="video"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("video",{src:C.content_url,autoPlay:!0,onEnded:P,className:"max-w-full max-h-full"}),C.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:C.text})]}),e.jsxs("div",{className:"absolute inset-0 flex",children:[e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:I}),e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:P})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 z-[1010] bg-gradient-to-t from-black/90 to-transparent",children:e.jsxs("form",{onSubmit:w=>{w.preventDefault(),d.trim()&&i&&(i(d,C.id),p(""))},className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"text",value:d,onChange:w=>p(w.target.value),onFocus:()=>c(!0),onBlur:()=>c(!1),placeholder:l==="ar"?"ÿ±ÿØ ÿπŸÑŸâ ÿßŸÑÿ≥ÿ™Ÿàÿ±Ÿä...":"Reply to story...",className:"flex-1 bg-white/10 border border-white/20 rounded-full px-4 py-3 text-white placeholder:text-white/60 focus:outline-none focus:bg-white/20 backdrop-blur-md transition-all text-sm"}),d.trim()&&e.jsx("button",{type:"submit",className:"p-3 bg-brand rounded-full text-white shadow-lg hover:brightness-110 transition-all",children:e.jsx($t,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -left-16 items-center",children:e.jsx("button",{onClick:I,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(va,{className:"w-8 h-8"})})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -right-16 items-center",children:e.jsx("button",{onClick:P,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(ya,{className:"w-8 h-8"})})})]}):null}function wi({children:t,language:a,onUnlock:s,isAuthenticated:r}){const[n,i]=m.useState(!0),[l,d]=m.useState(""),[p,u]=m.useState(!1),[c,o]=m.useState(!1),[f,v]=m.useState(null);m.useEffect(()=>{const w=()=>{const k=localStorage.getItem("chat_app_lock_enabled")!=="false",O=localStorage.getItem("chat_app_pin"),q=localStorage.getItem("chat_app_biometric")==="true";v(O),!k||!O&&!q?(i(!1),s()):i(!0)};return w(),window.addEventListener("storage",w),()=>window.removeEventListener("storage",w)},[r]);const g=async()=>{try{if(!window.PublicKeyCredential)return;const w=new Uint8Array(32);window.crypto.getRandomValues(w),await navigator.credentials.get({publicKey:{challenge:w,rpId:window.location.hostname,userVerification:"required",timeout:6e4}})&&_()}catch(w){console.error("Biometric auth failed",w)}},_=()=>{i(!1),s()},C=w=>{if(l.length<6){const k=l+w;d(k),u(!1),k.length===6&&P(k)}},P=w=>{f&&(w===f?_():(u(!0),d(""),X.error(a==="ar"?"ÿ±ŸÖÿ≤ ÿÆÿßÿ∑ÿ¶":"Incorrect PIN")))},I=()=>{d(w=>w.slice(0,-1)),u(!1)};return n?r?!f&&r?e.jsx(e.Fragment,{children:t}):e.jsx("div",{className:"fixed inset-0 z-[9999] bg-[#111b21] flex flex-col items-center justify-center text-white pb-10",children:e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"w-full max-w-sm px-8 flex flex-col items-center",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-500/20 rounded-full flex items-center justify-center mb-4 ring-1 ring-indigo-500/50 shadow-[0_0_30px_rgba(99,102,241,0.3)]",children:e.jsx(rs,{className:"w-10 h-10 text-indigo-400"})}),e.jsx("h1",{className:"text-2xl font-bold font-outfit",children:a==="ar"?"Chat App ŸÖŸÇŸÅŸÑ":"Chat App Locked"}),e.jsx("p",{className:"text-slate-400 text-sm",children:a==="ar"?"ÿ£ÿØÿÆŸÑ ÿ±ŸÖÿ≤ ÿßŸÑŸÖÿ±Ÿàÿ± ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©":"Enter your passcode to continue"})]}),e.jsx("div",{className:"flex gap-4 mb-12",children:[1,2,3,4,5,6].map(w=>e.jsx("div",{className:"relative",children:e.jsx(A.div,{className:se("w-4 h-4 rounded-full border-2 transition-colors duration-200",l.length>=w?"bg-indigo-500 border-indigo-500":p?"border-red-500 bg-red-500/20":"border-slate-600 bg-slate-800"),animate:p?{x:[-5,5,-5,5,0]}:{}})},w))}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 w-full max-w-[280px]",children:[[1,2,3,4,5,6,7,8,9].map(w=>e.jsx("button",{onClick:()=>C(w),className:"w-16 h-16 rounded-full bg-slate-800/50 hover:bg-slate-700/80 flex items-center justify-center text-2xl font-medium transition-all active:scale-95 border border-slate-700 backdrop-blur-sm",children:w},w)),e.jsx("button",{onClick:()=>g(),className:"w-16 h-16 flex items-center justify-center rounded-full text-indigo-400 hover:bg-indigo-500/10 transition-colors",children:e.jsx(Xs,{className:"w-8 h-8"})}),e.jsx("button",{onClick:()=>C(0),className:"w-16 h-16 rounded-full bg-slate-800/50 hover:bg-slate-700/80 flex items-center justify-center text-2xl font-medium transition-all active:scale-95 border border-slate-700 backdrop-blur-sm",children:"0"}),e.jsx("button",{onClick:I,className:"w-16 h-16 flex items-center justify-center rounded-full text-slate-400 hover:text-white hover:bg-white/5 transition-colors",children:e.jsx(ja,{className:"w-8 h-8"})})]}),e.jsx("p",{className:"mt-8 text-xs text-slate-500 cursor-pointer hover:text-indigo-400 transition-colors",children:a==="ar"?"ŸÜÿ≥Ÿäÿ™ ÿßŸÑÿ±ŸÖÿ≤ÿü":"Forgot Passcode?"})]})}):e.jsx(e.Fragment,{children:t}):e.jsx(e.Fragment,{children:t})}let jr=!0,wr=!0;function bt(t,a,s){const r=t.match(a);return r&&r.length>=s&&parseFloat(r[s],10)}function Ze(t,a,s){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(l,d){if(l!==a)return n.apply(this,arguments);const p=u=>{const c=s(u);c&&(d.handleEvent?d.handleEvent(c):d(c))};return this._eventMap=this._eventMap||{},this._eventMap[a]||(this._eventMap[a]=new Map),this._eventMap[a].set(d,p),n.apply(this,[l,p])};const i=r.removeEventListener;r.removeEventListener=function(l,d){if(l!==a||!this._eventMap||!this._eventMap[a])return i.apply(this,arguments);if(!this._eventMap[a].has(d))return i.apply(this,arguments);const p=this._eventMap[a].get(d);return this._eventMap[a].delete(d),this._eventMap[a].size===0&&delete this._eventMap[a],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[l,p])},Object.defineProperty(r,"on"+a,{get(){return this["_on"+a]},set(l){this["_on"+a]&&(this.removeEventListener(a,this["_on"+a]),delete this["_on"+a]),l&&this.addEventListener(a,this["_on"+a]=l)},enumerable:!0,configurable:!0})}function Ni(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(jr=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ci(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wr=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Nr(){if(typeof window=="object"){if(jr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function fs(t,a){wr&&console.warn(t+" is deprecated, please use "+a+" instead.")}function Si(t){const a={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return a.browser="Not a browser.",a;const{navigator:s}=t;if(s.userAgentData&&s.userAgentData.brands){const r=s.userAgentData.brands.find(n=>n.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(s.mozGetUserMedia)a.browser="firefox",a.version=parseInt(bt(s.userAgent,/Firefox\/(\d+)\./,1));else if(s.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)a.browser="chrome",a.version=parseInt(bt(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))a.browser="safari",a.version=parseInt(bt(s.userAgent,/AppleWebKit\/(\d+)\./,1)),a.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,a._safariVersion=bt(s.userAgent,/Version\/(\d+(\.?\d+))/,1);else return a.browser="Not a supported browser.",a;return a}function Ps(t){return Object.prototype.toString.call(t)==="[object Object]"}function Cr(t){return Ps(t)?Object.keys(t).reduce(function(a,s){const r=Ps(t[s]),n=r?Cr(t[s]):t[s],i=r&&!Object.keys(n).length;return n===void 0||i?a:Object.assign(a,{[s]:n})},{}):t}function Kt(t,a,s){!a||s.has(a.id)||(s.set(a.id,a),Object.keys(a).forEach(r=>{r.endsWith("Id")?Kt(t,t.get(a[r]),s):r.endsWith("Ids")&&a[r].forEach(n=>{Kt(t,t.get(n),s)})}))}function Es(t,a,s){const r=s?"outbound-rtp":"inbound-rtp",n=new Map;if(a===null)return n;const i=[];return t.forEach(l=>{l.type==="track"&&l.trackIdentifier===a.id&&i.push(l)}),i.forEach(l=>{t.forEach(d=>{d.type===r&&d.trackId===l.id&&Kt(t,d,n)})}),n}const Is=Nr;function Sr(t,a){const s=t&&t.navigator;if(!s.mediaDevices)return;const r=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const c=typeof d[u]=="object"?d[u]:{ideal:d[u]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const o=function(f,v){return f?f+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(c.ideal!==void 0){p.optional=p.optional||[];let f={};typeof c.ideal=="number"?(f[o("min",u)]=c.ideal,p.optional.push(f),f={},f[o("max",u)]=c.ideal,p.optional.push(f)):(f[o("",u)]=c.ideal,p.optional.push(f))}c.exact!==void 0&&typeof c.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[o("",u)]=c.exact):["min","max"].forEach(f=>{c[f]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[o(f,u)]=c[f])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},n=function(d,p){if(a.version>=61)return p(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const u=function(c,o,f){o in c&&!(f in c)&&(c[f]=c[o],delete c[o])};d=JSON.parse(JSON.stringify(d)),u(d.audio,"autoGainControl","googAutoGainControl"),u(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=r(d.audio)}if(d&&typeof d.video=="object"){let u=d.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const c=a.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete d.video.facingMode;let o;if(u.exact==="environment"||u.ideal==="environment"?o=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(o=["front"]),o)return s.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let v=f.find(g=>o.some(_=>g.label.toLowerCase().includes(_)));return!v&&f.length&&o.includes("back")&&(v=f[f.length-1]),v&&(d.video.deviceId=u.exact?{exact:v.deviceId}:{ideal:v.deviceId}),d.video=r(d.video),Is("chrome: "+JSON.stringify(d)),p(d)})}d.video=r(d.video)}return Is("chrome: "+JSON.stringify(d)),p(d)},i=function(d){return a.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},l=function(d,p,u){n(d,c=>{s.webkitGetUserMedia(c,p,o=>{u&&u(i(o))})})};if(s.getUserMedia=l.bind(s),s.mediaDevices.getUserMedia){const d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(p){return n(p,u=>d(u).then(c=>{if(u.audio&&!c.getAudioTracks().length||u.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(o=>{o.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(i(c))))}}}function kr(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function _r(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.track.id):i={track:n.track};const l=new Event("track");l.track=n.track,l.receiver=i,l.transceiver={receiver:i},l.streams=[r.stream],this.dispatchEvent(l)}),r.stream.getTracks().forEach(n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.id):i={track:n};const l=new Event("track");l.track=n,l.receiver=i,l.transceiver={receiver:i},l.streams=[r.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),a.apply(this,arguments)}}else Ze(t,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a))}function Tr(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const a=function(n,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=n.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:n}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,p){let u=n.apply(this,arguments);return u||(u=a(this,d),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){i.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(l=>{this._senders.push(a(this,l))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(l=>{const d=this._senders.find(p=>p.track===l);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const a=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=a.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Rr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=s.apply(this,[]);return i.forEach(l=>l._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(l=>Es(l,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=s.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ze(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>Es(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let n,i,l;return this.getSenders().forEach(d=>{d.track===r&&(n?l=!0:n=d)}),this.getReceivers().forEach(d=>(d.track===r&&(i?l=!0:i=d),d.track===r)),l||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}function Pr(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,d){if(!d)return a.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=a.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(u=>{if(this.getSenders().find(o=>o.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();s.apply(this,arguments);const p=this.getSenders().filter(u=>d.indexOf(u)===-1);this._shimmedLocalStreams[l.id]=[l].concat(p)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],r.apply(this,arguments)};const n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(l);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),n.apply(this,arguments)}}function Er(t,a){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&a.version>=65)return Pr(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=s.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(o=>this._reverseStreams[o.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(o=>{if(this.getSenders().find(v=>v.track===o))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const o=new t.MediaStream(c.getTracks());this._streams[c.id]=o,this._reverseStreams[o.id]=c,c=o}r.apply(this,[c])};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,o){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(_=>_===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_=>_.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[o.id];if(g)g.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _=new t.MediaStream([c]);this._streams[o.id]=_,this._reverseStreams[_.id]=o,this.addStream(_)}return this.getSenders().find(_=>_.track===c)};function i(u,c){let o=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const v=u._reverseStreams[f],g=u._streams[v.id];o=o.replace(new RegExp(g.id,"g"),v.id)}),new RTCSessionDescription({type:c.type,sdp:o})}function l(u,c){let o=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(f=>{const v=u._reverseStreams[f],g=u._streams[v.id];o=o.replace(new RegExp(v.id,"g"),g.id)}),new RTCSessionDescription({type:c.type,sdp:o})}["createOffer","createAnswer"].forEach(function(u){const c=t.RTCPeerConnection.prototype[u],o={[u](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[g=>{const _=i(this,g);f[0].apply(null,[_])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):c.apply(this,arguments).then(g=>i(this,g))}};t.RTCPeerConnection.prototype[u]=o[u]});const d=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=l(this,arguments[0]),d.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=p.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(_=>c.track===_)&&(f=this._streams[v])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Xt(t,a){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=t.RTCPeerConnection.prototype[s],n={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=n[s]})}function Ir(t,a){Ze(t,"negotiationneeded",s=>{const r=s.target;if(!((a.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return s})}const Ms=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Ir,shimAddTrackRemoveTrack:Er,shimAddTrackRemoveTrackWithNative:Pr,shimGetSendersWithDtmf:Tr,shimGetUserMedia:Sr,shimMediaStream:kr,shimOnTrack:_r,shimPeerConnection:Xt,shimSenderReceiverGetStats:Rr},Symbol.toStringTag,{value:"Module"}));function Mr(t,a){const s=t&&t.navigator,r=t&&t.MediaStreamTrack;if(s.getUserMedia=function(n,i,l){fs("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(n).then(i,l)},!(a.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const n=function(l,d,p){d in l&&!(p in l)&&(l[p]=l[d],delete l[d])},i=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),n(l.audio,"autoGainControl","mozAutoGainControl"),n(l.audio,"noiseSuppression","mozNoiseSuppression")),i(l)},r&&r.prototype.getSettings){const l=r.prototype.getSettings;r.prototype.getSettings=function(){const d=l.apply(this,arguments);return n(d,"mozAutoGainControl","autoGainControl"),n(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const l=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),n(d,"autoGainControl","mozAutoGainControl"),n(d,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[d])}}}}function ki(t,a){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:a}:r.video.mediaSource=a,t.navigator.mediaDevices.getUserMedia(r)})}function Ar(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Qt(t,a){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],l={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=l[n]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,l,d]=arguments;return r.apply(this,[i||null]).then(p=>{if(a.version<53&&!l)try{p.forEach(u=>{u.type=s[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;p.forEach((c,o)=>{p.set(o,Object.assign({},c,{type:s[c.type]||c.type}))})}return p}).then(l,d)}}function Dr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const a=t.RTCPeerConnection.prototype.getSenders;a&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=a.apply(this,[]);return n.forEach(i=>i._pc=this),n});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=s.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Lr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const a=t.RTCPeerConnection.prototype.getReceivers;a&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=a.apply(this,[]);return r.forEach(n=>n._pc=this),r}),Ze(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Or(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){fs("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&s.getTracks().includes(r.track)&&this.removeTrack(r)})})}function zr(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Fr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.addTransceiver;a&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=a.apply(this,arguments);if(n){const{sender:l}=i,d=l.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=r,l.sendEncodings=r,this.setParametersPromises.push(l.setParameters(d).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return i})}function $r(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const a=t.RTCRtpSender.prototype.getParameters;a&&(t.RTCRtpSender.prototype.getParameters=function(){const r=a.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Gr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}function Br(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}const As=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Fr,shimCreateAnswer:Br,shimCreateOffer:Gr,shimGetDisplayMedia:ki,shimGetParameters:$r,shimGetUserMedia:Mr,shimOnTrack:Ar,shimPeerConnection:Qt,shimRTCDataChannel:zr,shimReceiverGetStats:Lr,shimRemoveStream:Or,shimSenderGetStats:Dr},Symbol.toStringTag,{value:"Module"}));function Vr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>a.call(this,n,r)),r.getVideoTracks().forEach(n=>a.call(this,n,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...n){return n&&n.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),a.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(s);if(r===-1)return;this._localStreams.splice(r,1);const n=s.getTracks();this.getSenders().forEach(i=>{n.includes(i.track)&&this.removeTrack(i)})})}}function qr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const i=new Event("addstream");i.stream=n,this.dispatchEvent(i)})})}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const l=new Event("addstream");l.stream=i,r.dispatchEvent(l)})}),a.apply(r,arguments)}}}function Ur(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,s=a.createOffer,r=a.createAnswer,n=a.setLocalDescription,i=a.setRemoteDescription,l=a.addIceCandidate;a.createOffer=function(u,c){const o=arguments.length>=2?arguments[2]:arguments[0],f=s.apply(this,[o]);return c?(f.then(u,c),Promise.resolve()):f},a.createAnswer=function(u,c){const o=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[o]);return c?(f.then(u,c),Promise.resolve()):f};let d=function(p,u,c){const o=n.apply(this,[p]);return c?(o.then(u,c),Promise.resolve()):o};a.setLocalDescription=d,d=function(p,u,c){const o=i.apply(this,[p]);return c?(o.then(u,c),Promise.resolve()):o},a.setRemoteDescription=d,d=function(p,u,c){const o=l.apply(this,[p]);return c?(o.then(u,c),Promise.resolve()):o},a.addIceCandidate=d}function Hr(t){const a=t&&t.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){const s=a.mediaDevices,r=s.getUserMedia.bind(s);a.mediaDevices.getUserMedia=n=>r(Wr(n))}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=(function(r,n,i){a.mediaDevices.getUserMedia(r).then(n,i)}).bind(a))}function Wr(t){return t&&t.video!==void 0?Object.assign({},t,{video:Cr(t.video)}):t}function Yr(t){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection;t.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const i=[];for(let l=0;l<r.iceServers.length;l++){let d=r.iceServers[l];d.urls===void 0&&d.url?(fs("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,i.push(d)):i.push(r.iceServers[l])}r.iceServers=i}return new a(r,n)},t.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in a&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return a.generateCertificate}})}function Jr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Kr(t){const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return a.apply(this,arguments)}}function Xr(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Ds=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Xr,shimCallbacksAPI:Ur,shimConstraints:Wr,shimCreateOfferLegacy:Kr,shimGetUserMedia:Hr,shimLocalStreamsAPI:Vr,shimRTCIceServerUrls:Yr,shimRemoteStreamsAPI:qr,shimTrackEventTransceiver:Jr},Symbol.toStringTag,{value:"Module"}));var qt={exports:{}},Ls;function _i(){return Ls||(Ls=1,(function(t){const a={};a.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},a.localCName=a.generateIdentifier(),a.splitLines=function(s){return s.trim().split(`
`).map(r=>r.trim())},a.splitSections=function(s){return s.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},a.getDescription=function(s){const r=a.splitSections(s);return r&&r[0]},a.getMediaSections=function(s){const r=a.splitSections(s);return r.shift(),r},a.matchPrefix=function(s,r){return a.splitLines(s).filter(n=>n.indexOf(r)===0)},a.parseCandidate=function(s){let r;s.indexOf("a=candidate:")===0?r=s.substring(12).split(" "):r=s.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":n.relatedAddress=r[i+1];break;case"rport":n.relatedPort=parseInt(r[i+1],10);break;case"tcptype":n.tcpType=r[i+1];break;case"ufrag":n.ufrag=r[i+1],n.usernameFragment=r[i+1];break;default:n[r[i]]===void 0&&(n[r[i]]=r[i+1]);break}return n},a.writeCandidate=function(s){const r=[];r.push(s.foundation);const n=s.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(s.protocol.toUpperCase()),r.push(s.priority),r.push(s.address||s.ip),r.push(s.port);const i=s.type;return r.push("typ"),r.push(i),i!=="host"&&s.relatedAddress&&s.relatedPort&&(r.push("raddr"),r.push(s.relatedAddress),r.push("rport"),r.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(r.push("ufrag"),r.push(s.usernameFragment||s.ufrag)),"candidate:"+r.join(" ")},a.parseIceOptions=function(s){return s.substring(14).split(" ")},a.parseRtpMap=function(s){let r=s.substring(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},a.writeRtpMap=function(s){let r=s.payloadType;s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType);const n=s.channels||s.numChannels||1;return"a=rtpmap:"+r+" "+s.name+"/"+s.clockRate+(n!==1?"/"+n:"")+`\r
`},a.parseExtmap=function(s){const r=s.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},a.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},a.parseFmtp=function(s){const r={};let n;const i=s.substring(s.indexOf(" ")+1).split(";");for(let l=0;l<i.length;l++)n=i[l].trim().split("="),r[n[0].trim()]=n[1];return r},a.writeFmtp=function(s){let r="",n=s.payloadType;if(s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const i=[];Object.keys(s.parameters).forEach(l=>{s.parameters[l]!==void 0?i.push(l+"="+s.parameters[l]):i.push(l)}),r+="a=fmtp:"+n+" "+i.join(";")+`\r
`}return r},a.parseRtcpFb=function(s){const r=s.substring(s.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},a.writeRtcpFb=function(s){let r="",n=s.payloadType;return s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+n+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},a.parseSsrcMedia=function(s){const r=s.indexOf(" "),n={ssrc:parseInt(s.substring(7,r),10)},i=s.indexOf(":",r);return i>-1?(n.attribute=s.substring(r+1,i),n.value=s.substring(i+1)):n.attribute=s.substring(r+1),n},a.parseSsrcGroup=function(s){const r=s.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},a.getMid=function(s){const r=a.matchPrefix(s,"a=mid:")[0];if(r)return r.substring(6)},a.parseFingerprint=function(s){const r=s.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},a.getDtlsParameters=function(s,r){return{role:"auto",fingerprints:a.matchPrefix(s+r,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(s,r){let n="a=setup:"+r+`\r
`;return s.fingerprints.forEach(i=>{n+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),n},a.parseCryptoLine=function(s){const r=s.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},a.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?a.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const r=s.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},a.getCryptoParameters=function(s,r){return a.matchPrefix(s+r,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(s,r){const n=a.matchPrefix(s+r,"a=ice-ufrag:")[0],i=a.matchPrefix(s+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},a.writeIceParameters=function(s){let r="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(r+=`a=ice-lite\r
`),r},a.parseRtpParameters=function(s){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=a.splitLines(s)[0].split(" ");r.profile=i[2];for(let d=3;d<i.length;d++){const p=i[d],u=a.matchPrefix(s,"a=rtpmap:"+p+" ")[0];if(u){const c=a.parseRtpMap(u),o=a.matchPrefix(s,"a=fmtp:"+p+" ");switch(c.parameters=o.length?a.parseFmtp(o[0]):{},c.rtcpFeedback=a.matchPrefix(s,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),r.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(c.name.toUpperCase());break}}}a.matchPrefix(s,"a=extmap:").forEach(d=>{r.headerExtensions.push(a.parseExtmap(d))});const l=a.matchPrefix(s,"a=rtcp-fb:* ").map(a.parseRtcpFb);return r.codecs.forEach(d=>{l.forEach(p=>{d.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),r},a.writeRtpDescription=function(s,r){let n="";n+="m="+s+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(l=>{n+=a.writeRtpMap(l),n+=a.writeFmtp(l),n+=a.writeRtcpFb(l)});let i=0;return r.codecs.forEach(l=>{l.maxptime>i&&(i=l.maxptime)}),i>0&&(n+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(l=>{n+=a.writeExtmap(l)}),n},a.parseRtpEncodingParameters=function(s){const r=[],n=a.parseRtpParameters(s),i=n.fecMechanisms.indexOf("RED")!==-1,l=n.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(s,"a=ssrc:").map(f=>a.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),p=d.length>0&&d[0].ssrc;let u;const c=a.matchPrefix(s,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(g=>parseInt(g,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(u=c[0][1]),n.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let v={ssrc:p,codecPayloadType:parseInt(f.parameters.apt,10)};p&&u&&(v.rtx={ssrc:u}),r.push(v),i&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:p,mechanism:l?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&p&&r.push({ssrc:p});let o=a.matchPrefix(s,"b=");return o.length&&(o[0].indexOf("b=TIAS:")===0?o=parseInt(o[0].substring(7),10):o[0].indexOf("b=AS:")===0?o=parseInt(o[0].substring(5),10)*1e3*.95-2e3*8:o=void 0,r.forEach(f=>{f.maxBitrate=o})),r},a.parseRtcpParameters=function(s){const r={},n=a.matchPrefix(s,"a=ssrc:").map(d=>a.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const i=a.matchPrefix(s,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const l=a.matchPrefix(s,"a=rtcp-mux");return r.mux=l.length>0,r},a.writeRtcpParameters=function(s){let r="";return s.reducedSize&&(r+=`a=rtcp-rsize\r
`),s.mux&&(r+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(r+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),r},a.parseMsid=function(s){let r;const n=a.matchPrefix(s,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=a.matchPrefix(s,"a=ssrc:").map(l=>a.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},a.parseSctpDescription=function(s){const r=a.parseMLine(s),n=a.matchPrefix(s,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const l=a.matchPrefix(s,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const d=a.matchPrefix(s,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},a.writeSctpDescription=function(s,r){let n=[];return s.protocol!=="DTLS/SCTP"?n=["m="+s.kind+" 9 "+s.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+s.kind+" 9 "+s.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(s,r,n){let i;const l=r!==void 0?r:2;return s?i=s:i=a.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+i+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(s,r){const n=a.splitLines(s);for(let i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substring(2)}return r?a.getDirection(r):"sendrecv"},a.getKind=function(s){return a.splitLines(s)[0].split(" ")[0].substring(2)},a.isRejected=function(s){return s.split(" ",2)[1]==="0"},a.parseMLine=function(s){const n=a.splitLines(s)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},a.parseOLine=function(s){const n=a.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},a.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const r=a.splitLines(s);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},t.exports=a})(qt)),qt.exports}var Qr=_i();const nt=ea(Qr),Ti=Pa({__proto__:null,default:nt},[Qr]);function Et(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const a=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const n=new a(r),i=nt.parseCandidate(r.candidate);for(const l in i)l in n||Object.defineProperty(n,l,{value:i[l]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new a(r)},t.RTCIceCandidate.prototype=a.prototype,Ze(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Zt(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ze(t,"icecandidate",a=>{if(a.candidate){const s=nt.parseCandidate(a.candidate.candidate);s.type==="relay"&&(a.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return a})}function It(t,a){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const s=function(d){if(!d||!d.sdp)return!1;const p=nt.splitSections(d.sdp);return p.shift(),p.some(u=>{const c=nt.parseMLine(u);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},r=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const u=parseInt(p[1],10);return u!==u?-1:u},n=function(d){let p=65536;return a.browser==="firefox"&&(a.version<57?d===-1?p=16384:p=2147483637:a.version<60?p=a.version===57?65535:65536:p=2147483637),p},i=function(d,p){let u=65536;a.browser==="firefox"&&a.version===57&&(u=65535);const c=nt.matchPrefix(d.sdp,"a=max-message-size:");return c.length>0?u=parseInt(c[0].substring(19),10):a.browser==="firefox"&&p!==-1&&(u=2147483637),u},l=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,a.browser==="chrome"&&a.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const p=r(arguments[0]),u=n(p),c=i(arguments[0],p);let o;u===0&&c===0?o=Number.POSITIVE_INFINITY:u===0||c===0?o=Math.max(u,c):o=Math.min(u,c);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return o}}),this._sctp=f}return l.apply(this,arguments)}}function Mt(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function a(r,n){const i=r.send;r.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(r.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=s.apply(this,arguments);return a(n,this),n},Ze(t,"datachannel",r=>(a(r.channel,r.target),r))}function es(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const a=t.RTCPeerConnection.prototype;Object.defineProperty(a,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const r=a[s];a[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const i=n.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const l=new Event("connectionstatechange",n);i.dispatchEvent(l)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function ts(t,a){if(!t.RTCPeerConnection||a.browser==="chrome"&&a.version>=71||a.browser==="safari"&&a._safariVersion>=13.1)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(l=>l.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return s.apply(this,arguments)}}function At(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.addIceCandidate;!s||s.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(a.browser==="chrome"&&a.version<78||a.browser==="firefox"&&a.version<68||a.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Dt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.setLocalDescription;!s||s.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return s.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?s.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(l=>s.apply(this,[l]))})}const Ri=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ts,shimAddIceCandidateNullOrEmpty:At,shimConnectionState:es,shimMaxMessageSize:It,shimParameterlessSetLocalDescription:Dt,shimRTCIceCandidate:Et,shimRTCIceCandidateRelayProtocol:Zt,shimSendThrowTypeError:Mt},Symbol.toStringTag,{value:"Module"}));function Pi({window:t}={},a={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=Nr,r=Si(t),n={browserDetails:r,commonShim:Ri,extractVersion:bt,disableLog:Ni,disableWarnings:Ci,sdp:Ti};switch(r.browser){case"chrome":if(!Ms||!Xt||!a.shimChrome)return s("Chrome shim is not included in this adapter release."),n;if(r.version===null)return s("Chrome shim can not determine version, not shimming."),n;s("adapter.js shimming chrome."),n.browserShim=Ms,At(t,r),Dt(t),Sr(t,r),kr(t),Xt(t,r),_r(t),Er(t,r),Tr(t),Rr(t),Ir(t,r),Et(t),Zt(t),es(t),It(t,r),Mt(t),ts(t,r);break;case"firefox":if(!As||!Qt||!a.shimFirefox)return s("Firefox shim is not included in this adapter release."),n;s("adapter.js shimming firefox."),n.browserShim=As,At(t,r),Dt(t),Mr(t,r),Qt(t,r),Ar(t),Or(t),Dr(t),Lr(t),zr(t),Fr(t),$r(t),Gr(t),Br(t),Et(t),es(t),It(t,r),Mt(t);break;case"safari":if(!Ds||!a.shimSafari)return s("Safari shim is not included in this adapter release."),n;s("adapter.js shimming safari."),n.browserShim=Ds,At(t,r),Dt(t),Yr(t),Kr(t),Ur(t),Vr(t),qr(t),Jr(t),Hr(t),Xr(t),Et(t),Zt(t),It(t,r),Mt(t),ts(t,r);break;default:s("Unsupported browser!");break}return n}Pi({window:typeof window>"u"?void 0:window});function Ei({callId:t,callerId:a,callerName:s,recipientId:r,isIncoming:n,type:i,onEndCall:l,currentUserId:d,sendSignaling:p,incomingOffer:u,remoteAnswer:c,remoteIceCandidates:o}){const[f,v]=m.useState("ringing"),[g,_]=m.useState(0),[C,P]=m.useState(!1),[I,w]=m.useState(i==="audio"),[k,O]=m.useState(!0),[q,b]=m.useState("user"),[h,R]=m.useState(null),[E,x]=m.useState(null),N=m.useRef(null),y=m.useRef(null),T=m.useRef(null),W=m.useRef(null),S={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceCandidatePoolSize:10},V=(U,L,J)=>{const ne=U.split(`
`);let te=-1;for(let ce=0;ce<ne.length;ce++)if(ne[ce].indexOf("m="+L)===0){te=ce;break}if(te===-1)return U;for(te++;te<ne.length&&ne[te].indexOf("m=")!==0;){if(ne[te].indexOf("b=AS:")===0)return ne[te]="b=AS:"+J,ne.join(`
`);te++}return ne.splice(te,0,"b=AS:"+J),ne.join(`
`)},j=m.useCallback(()=>{h==null||h.getTracks().forEach(U=>U.stop()),N.current&&(N.current.onicecandidate=null,N.current.ontrack=null,N.current.close(),N.current=null),R(null),x(null)},[h]),$=m.useCallback(()=>{j(),l()},[j,l]);m.useEffect(()=>{let U;return f==="connected"&&(U=setInterval(()=>{_(L=>L+1)},1e3)),()=>clearInterval(U)},[f]);const ee=U=>{const L=Math.floor(U/60),J=U%60;return`${L}:${J.toString().padStart(2,"0")}`};m.useEffect(()=>{(async()=>{try{h==null||h.getTracks().forEach(J=>J.stop());const L=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:i==="video"?{facingMode:q,width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:60}}:!1});if(R(L),N.current){const J=L.getVideoTracks()[0],ne=N.current.getSenders().find(te=>{var ce;return((ce=te.track)==null?void 0:ce.kind)==="video"});ne&&J&&ne.replaceTrack(J)}}catch(L){console.error("getUserMedia failed:",L),X.error("ŸÉÿßŸÖŸäÿ±ÿß ÿ£Ÿà ŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ HTTPS Ÿàÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ£ÿ∞ŸàŸÜÿßÿ™."),$()}})()},[i,q]),m.useEffect(()=>{y.current&&h&&(y.current.srcObject=h)},[h]),m.useEffect(()=>h?((async()=>{try{if(!N.current){const L=new RTCPeerConnection(S);N.current=L,L.ontrack=J=>{console.log("Remote track received"),x(J.streams[0]),v("connected")},L.onicecandidate=J=>{J.candidate&&p(n?a:r,"ice-candidate",{id:t,candidate:J.candidate})},L.oniceconnectionstatechange=()=>{(L.iceConnectionState==="disconnected"||L.iceConnectionState==="failed")&&console.log("ICE failed/disconnected")},h.getTracks().forEach(J=>L.addTrack(J,h))}if(n&&u&&N.current.signalingState==="stable"){await N.current.setRemoteDescription(new RTCSessionDescription(u));let L=await N.current.createAnswer();L.sdp=V(L.sdp,"audio",64),i==="video"&&(L.sdp=V(L.sdp,"video",1e3)),await N.current.setLocalDescription(L),p(a,"call-answer",{id:t,answer:L})}else if(!n&&N.current.signalingState==="stable"){let L=await N.current.createOffer();L.sdp=V(L.sdp,"audio",64),i==="video"&&(L.sdp=V(L.sdp,"video",1e3)),await N.current.setLocalDescription(L),p(r,"call-offer",{id:t,callerId:d,callerName:s,type:i,offer:L})}}catch(L){console.error("PC init failed:",L),$()}})(),()=>{}):void 0,[h,t,n,u,i,d,s,p,$,a,r]),m.useEffect(()=>{c&&N.current&&N.current.signalingState==="have-local-offer"&&N.current.setRemoteDescription(new RTCSessionDescription(c)).catch(U=>console.error("Error setting answer:",U))},[c]),m.useEffect(()=>{o&&N.current&&N.current.remoteDescription&&o.forEach(U=>{var L;(L=N.current)==null||L.addIceCandidate(new RTCIceCandidate(U)).catch(J=>console.error("Error adding candidate:",J))})},[o]),m.useEffect(()=>{T.current&&E&&i==="video"?(T.current.srcObject=E,T.current.play().catch(U=>console.warn("Auto-play blocked:",U))):W.current&&E&&i==="audio"&&(W.current.srcObject=E,W.current.play().catch(U=>console.warn("Auto-play blocked:",U)))},[E,i]);const H=()=>{if(h){const U=h.getAudioTracks()[0];U&&(U.enabled=C,P(!C))}},Q=()=>{if(h&&i==="video"){const U=h.getVideoTracks()[0];U&&(U.enabled=I,w(!I))}},M=()=>{O(!k),T.current&&(T.current.muted=!k),W.current&&(W.current.muted=!k)},Y=()=>{b(U=>U==="user"?"environment":"user")};return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-[#111b21] flex flex-col items-center justify-center p-4",children:[i==="video"?e.jsx("video",{ref:T,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-6 mb-20",children:[e.jsx(Oe,{className:"w-32 h-32 border-4 border-brand/30 shadow-2xl scale-in-center",children:e.jsx(ze,{className:"bg-[#202c33] text-brand text-4xl font-bold",children:s.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-white text-3xl font-bold mb-2",children:s}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"text-brand font-medium animate-pulse uppercase tracking-widest text-xs",children:f==="ringing"?n?"ŸÖŸÉÿßŸÑŸÖÿ© Ÿàÿßÿ±ÿØÿ©...":"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ...":"ŸÖÿ™ÿµŸÑ"}),f==="connected"&&e.jsx("p",{className:"text-white/60 font-mono text-lg",children:ee(g)})]})]}),e.jsx("audio",{ref:W,autoPlay:!0})]}),i==="video"&&f==="connected"&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-20 bg-black/40 px-4 py-1 rounded-full backdrop-blur-md border border-white/10",children:e.jsx("p",{className:"text-white font-mono",children:ee(g)})}),i==="video"&&h&&e.jsx("div",{className:"absolute top-6 right-6 w-32 md:w-48 aspect-[3/4] rounded-xl overflow-hidden shadow-2xl border-2 border-white/20 z-10",children:e.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover -scale-x-100"})}),e.jsxs("div",{className:"absolute bottom-12 flex items-center gap-6 bg-[#202c33]/90 backdrop-blur-xl p-6 rounded-full border border-white/10 shadow-2xl z-20",children:[e.jsx(le,{onClick:H,className:`w-14 h-14 rounded-full transition-all ${C?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:C?e.jsx(wa,{}):e.jsx(os,{})}),i==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{onClick:Q,className:`w-14 h-14 rounded-full transition-all ${I?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:I?e.jsx(Na,{}):e.jsx(it,{})}),e.jsx(le,{onClick:Y,className:"w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 transition-all",children:e.jsx(Ys,{className:"w-6 h-6"})})]}),e.jsx(le,{onClick:M,className:`w-14 h-14 rounded-full ${k?"bg-gray-700":"bg-red-500"}`,children:k?e.jsx(Ft,{}):e.jsx(Ws,{})}),e.jsx(le,{onClick:$,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center",children:e.jsx(Js,{className:"w-8 h-8"})})]})]})}function Ii({language:t,t:a}){const{accentColor:s,setAccentColor:r,wallpaper:n,setWallpaper:i,bgOpacity:l,setBgOpacity:d}=yr();return e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-brand text-sm font-bold uppercase tracking-wider",children:t==="ar"?"ÿßŸÑŸÖÿ∏Ÿáÿ±":"Appearance"}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl border border-gray-800 divide-y divide-gray-800",children:[e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500/10 text-indigo-400",children:e.jsx(ka,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t==="ar"?"ŸÑŸàŸÜ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ":"App Theme"}),e.jsx("p",{className:"text-xs text-gray-500",children:Pt[s].name})]})]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-hide",children:Object.keys(Pt).map(p=>e.jsx("button",{onClick:()=>r(p),className:`w-10 h-10 rounded-full flex items-center justify-center transition-all ring-2 ring-offset-2 ring-offset-[#202c33] ${s===p?"ring-white scale-110":"ring-transparent opacity-70 hover:opacity-100"}`,style:{backgroundColor:Pt[p].hex},children:s===p&&e.jsx(ot,{className:"w-5 h-5 text-white drop-shadow-md"})},p))})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10 text-amber-500",children:e.jsx(_a,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t==="ar"?"ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ©":"Chat Wallpaper"}),e.jsx("p",{className:"text-xs text-gray-500",children:t==="ar"?"ÿ™ÿÆÿµŸäÿµ ÿßŸÑÿÆŸÑŸÅŸäÿ©":"Customize background"})]})]}),e.jsxs("select",{value:n,onChange:p=>i(p.target.value),className:"bg-gray-800 text-white text-xs rounded-lg px-3 py-2 outline-none border border-gray-700",children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"doodles",children:"Doodles"}),e.jsx("option",{value:"stars",children:"Stars Pattern"}),e.jsx("option",{value:"geometric",children:"Geometric"}),e.jsx("option",{value:"solid",children:"Solid Color"})]})]}),n!=="solid"&&e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-cyan-500/10 text-cyan-500",children:e.jsx(Qe,{className:"w-5 h-5"})}),e.jsx("p",{className:"font-medium",children:t==="ar"?"ÿ¥ŸÅÿßŸÅŸäÿ© ÿßŸÑŸÜŸÖÿ∑":"Pattern Opacity"})]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[Math.round(l*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:l,onChange:p=>d(parseFloat(p.target.value)),className:"w-full h-1.5 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-brand"})]})]})]})}function Mi({user:t,onBack:a,onGoToProfile:s,onLogout:r,notificationsEnabled:n,onEnableNotifications:i,micEnabled:l,onEnableMic:d,soundEnabled:p,onToggleSound:u,currentSoundId:c,notificationSounds:o,onSelectSound:f,onTestSound:v,language:g,onLanguageChange:_,t:C}){const[P,I]=m.useState(0);return e.jsxs("div",{className:"flex flex-col h-full bg-[#111b21] text-white",children:[e.jsxs("div",{className:"p-4 bg-[#202c33] flex items-center gap-4 border-b border-gray-800",children:[e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:e.jsx(Xe,{className:`w-6 h-6 ${g==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-lg font-bold ${g==="ar"?"font-arabic":""}`,children:C("settings")})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-brand text-sm font-bold uppercase tracking-wider",children:g==="ar"?"ÿßŸÑÿ≠ÿ≥ÿßÿ®":"Account"}),e.jsxs("div",{onClick:s,className:"flex items-center gap-4 bg-[#202c33] p-4 rounded-xl border border-gray-800 hover:bg-[#2a3942] transition-colors cursor-pointer group",children:[e.jsxs(Oe,{className:"w-16 h-16 border-2 border-brand/20 group-hover:border-brand/50 transition-colors",children:[e.jsx(We,{src:t.avatar_url}),e.jsx(ze,{className:"text-xl",children:t.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",children:t.name}),e.jsxs("p",{className:"text-gray-500 text-sm truncate",children:["@",t.username]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center text-indigo-400 group-hover:bg-indigo-500/20 group-hover:scale-110 transition-all",children:e.jsx(He,{className:"w-5 h-5"})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-brand text-sm font-bold uppercase tracking-wider",children:"Permissions & Notifications"}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl border border-gray-800 divide-y divide-gray-800",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p - 2 rounded - lg ${n?"bg-brand/10 text-brand":"bg-gray-800 text-gray-400"} `,children:e.jsx(ns,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Desktop Notifications"}),e.jsx("p",{className:"text-xs text-gray-500",children:n?"Currently enabled":"Currently disabled"})]})]}),e.jsx(le,{onClick:()=>{if(console.log("Enable notifications clicked"),window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){X.error("Notifications require HTTPS or localhost.");return}i()},disabled:n,variant:n?"ghost":"outline",className:n?"text-gray-500 cursor-default":"border-brand text-brand hover:bg-brand/10",children:n?"Enabled":"Enable"})]}),e.jsxs("div",{className:"p-4 bg-[#2a3942]/30 rounded-lg border border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500/10 text-indigo-400",children:e.jsx(it,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:g==="ar"?"ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß":"Camera Test"}),e.jsx("p",{className:"text-xs text-gray-500",children:g==="ar"?"ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß":"Test your camera"})]})]}),e.jsx(le,{onClick:async()=>{try{const w=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}}),k=document.getElementById("camera-preview"),O=document.getElementById("camera-placeholder");k&&(k.srcObject=w,k.play(),O&&(O.style.display="none"),X.success(g==="ar"?"‚úÖ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ÿ™ÿπŸÖŸÑ!":"‚úÖ Camera working!"),setTimeout(()=>{w.getTracks().forEach(q=>q.stop()),k&&(k.srcObject=null),O&&(O.style.display="block"),k.style.display="none"},5e3))}catch(w){console.log("Camera test failed:",w),w.name==="NotAllowedError"?X.error(g==="ar"?"‚ùå ÿßŸÑÿ•ÿ∞ŸÜ ŸÖÿ±ŸÅŸàÿ∂":"‚ùå Permission denied"):X.error(g==="ar"?"‚ùå ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ÿ©":"‚ùå Camera not available")}},size:"sm",variant:"outline",className:"h-7 text-[10px] border-indigo-500 text-indigo-400 hover:bg-indigo-500/10",children:g==="ar"?"ÿßÿÆÿ™ÿ®ÿßÿ±":"Test"})]}),e.jsxs("div",{className:"mt-3 rounded-lg overflow-hidden bg-slate-900/50 aspect-video flex items-center justify-center",children:[e.jsx("video",{id:"camera-preview",autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover -scale-x-100",style:{display:"none"},onPlay:w=>w.target.style.display="block"}),e.jsx("p",{className:"text-xs text-gray-500",id:"camera-placeholder",children:g==="ar"?"ÿßÿ∂ÿ∫ÿ∑ ÿßÿÆÿ™ÿ®ÿßÿ± ŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß":"Click Test to see camera"})]})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p - 2 rounded - lg ${l?"bg-brand/10 text-brand":"bg-gray-800 text-gray-400"} `,children:e.jsx(os,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Microphone Access"}),e.jsx("p",{className:"text-xs text-gray-500",children:l?"Access granted":"Required for voice messages"})]})]}),e.jsx(le,{onClick:()=>{if(console.log("Enable mic clicked"),window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){X.error("Microphone access requires HTTPS or localhost.");return}d()},disabled:l,variant:l?"ghost":"outline",className:l?"text-gray-500 cursor-default":"border-brand text-brand hover:bg-brand/10",children:l?"Enabled":"Enable"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-brand/10 text-brand",children:e.jsx(Ft,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Notification Sound"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Play sound on new message"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{onClick:()=>u(!p),className:`w - 10 h - 5 rounded - full relative cursor - pointer shadow - inner transition - colors ${p?"bg-brand":"bg-gray-600"} `,children:e.jsx("div",{className:`absolute top - 0.5 w - 4 h - 4 bg - white rounded - full shadow transition - all ${p?"right-0.5":"left-0.5"} `})}),e.jsx(le,{onClick:v,size:"sm",variant:"outline",className:"h-7 text-[10px] border-brand text-brand hover:bg-brand/10",children:"Test"})]})]}),p&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-800",children:[e.jsx("p",{className:"text-xs text-gray-400 font-medium",children:"Select Sound:"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:o.map(w=>e.jsxs("div",{className:`flex items - center justify - between p - 2 rounded - lg cursor - pointer transition - all ${c===w.id?"bg-brand/10 border border-brand/30":"bg-[#2a3942]/50 border border-transparent hover:bg-[#2a3942]"} `,onClick:()=>f(w.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w - 3 h - 3 rounded - full ${c===w.id?"bg-brand":"bg-gray-600"} `}),e.jsx("span",{className:"text-sm",children:w.name})]}),e.jsx("button",{onClick:k=>{k.stopPropagation(),new Audio(w.url).play().catch(q=>X.error("Preview failed"))},className:"p-1.5 hover:bg-brand/20 rounded-md text-brand transition-colors",title:"Preview Sound",children:e.jsx(Ft,{className:"w-4 h-4"})})]},w.id))})]})]})]}),e.jsx("p",{className:"text-[10px] text-gray-600 px-2",children:g==="ar"?'ŸÜÿµŸäÿ≠ÿ©: ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸä iPhoneÿå Ÿäÿ¨ÿ® "ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©" ŸÑÿ™ŸÑŸÇŸä ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™.':'Tip: On iPhone, you must "Add to Home Screen" to receive notifications.'})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-brand text-sm font-bold uppercase tracking-wider",children:g==="ar"?"ÿßŸÑÿÆÿµŸàÿµŸäÿ© ŸàÿßŸÑÿ£ŸÖÿßŸÜ":"Privacy & Security"}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl border border-gray-800 divide-y divide-gray-800",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-brand/10 text-brand":"bg-gray-800 text-gray-400"}`,children:e.jsx(Ks,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-white text-sm font-bold",children:g==="ar"?"ÿ™ŸÅÿπŸäŸÑ ŸÇŸÅŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ":"Enable App Lock"}),e.jsx("p",{className:"text-gray-400 text-[10px]",children:g==="ar"?"ÿ™ŸÅÿπŸäŸÑ ÿ£Ÿà ÿ™ÿπÿ∑ŸäŸÑ ŸÖŸäÿ≤ÿ© ÿßŸÑŸÇŸÅŸÑ ÿ™ŸÖÿßŸÖÿßŸã":"Enable or disable the lock feature entirely"})]})]}),e.jsx("div",{onClick:()=>{const w=localStorage.getItem("chat_app_lock_enabled")==="true";localStorage.setItem("chat_app_lock_enabled",(!w).toString()),window.dispatchEvent(new Event("storage")),I(k=>k+1)},className:`w-10 h-5 rounded-full relative cursor-pointer shadow-inner transition-colors ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-brand":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-all ${localStorage.getItem("chat_app_lock_enabled")==="true"?"right-0.5":"left-0.5"}`})})]}),e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-rose-500/10 text-rose-500",children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:g==="ar"?"ŸÇŸÅŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ":"App Lock"}),e.jsx("p",{className:"text-xs text-gray-500",children:g==="ar"?"ÿ≠ŸÖÿßŸäÿ© ÿ®ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±":"Protect with passcode"})]})]}),e.jsx(le,{onClick:()=>{if(localStorage.getItem("chat_app_pin"))localStorage.removeItem("chat_app_pin"),localStorage.removeItem("chat_app_biometric"),X.success(g==="ar"?"ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÇŸÅŸÑ":"App lock disabled");else{const k=prompt(g==="ar"?"ÿ£ÿØÿÆŸÑ ÿ±ŸÖÿ≤ ÿ¨ÿØŸäÿØ (6 ÿ£ÿ±ŸÇÿßŸÖ):":"Enter new 6-digit PIN:");k&&k.length===6&&!isNaN(Number(k))?(localStorage.setItem("chat_app_pin",k),X.success(g==="ar"?"ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÇŸÅŸÑ":"App lock enabled")):k&&X.error(g==="ar"?"ÿßŸÑÿ±ŸÖÿ≤ Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ 6 ÿ£ÿ±ŸÇÿßŸÖ":"PIN must be 6 digits")}},variant:"outline",className:`text-xs ${localStorage.getItem("chat_app_pin")?"text-red-400 border-red-400/30":"text-brand border-brand/30"}`,children:localStorage.getItem("chat_app_pin")?g==="ar"?"ÿ™ÿπÿ∑ŸäŸÑ":"Disable":g==="ar"?"ÿ™ŸÅÿπŸäŸÑ":"Enable"})]}),localStorage.getItem("chat_app_pin")&&e.jsxs("div",{className:"p-4 flex items-center justify-between border-t border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500/10 text-indigo-500",children:e.jsx(Xs,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:g==="ar"?"ÿ®ÿµŸÖÿ© ÿßŸÑŸàÿ¨Ÿá/ÿßŸÑÿ•ÿµÿ®ÿπ":"Face ID / Touch ID"}),e.jsx("p",{className:"text-xs text-gray-500",children:g==="ar"?"ŸÅÿ™ÿ≠ ÿßŸÑŸÇŸÅŸÑ ÿ®ÿßŸÑŸÖŸÇÿßŸäŸäÿ≥ ÿßŸÑÿ≠ŸäŸàŸäÿ©":"Unlock with biometrics"})]})]}),e.jsx(le,{onClick:async()=>{if(localStorage.getItem("chat_app_biometric")==="true"){localStorage.setItem("chat_app_biometric","false"),X.success(g==="ar"?"ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿ®ÿµŸÖÿ©":"Biometrics disabled");return}try{if(!window.PublicKeyCredential)throw new Error("WebAuthn not supported");const k=new Uint8Array(32);window.crypto.getRandomValues(k),await navigator.credentials.create({publicKey:{challenge:k,rp:{name:"Chat App",id:window.location.hostname},user:{id:new Uint8Array(16),name:t.username||"user",displayName:t.name||"User"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"},timeout:6e4,attestation:"none"}})&&(localStorage.setItem("chat_app_biometric","true"),X.success(g==="ar"?"ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ®ÿµŸÖÿ© ÿ®ŸÜÿ¨ÿßÿ≠":"Biometrics enabled successfully"))}catch(k){console.error("Biometric setup failed:",k),k.name==="NotAllowedError"?X.error(g==="ar"?"ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿßŸÑÿ•ÿ∞ŸÜ":"Permission denied"):X.error(g==="ar"?"ŸÅÿ¥ŸÑ ÿ•ÿπÿØÿßÿØ ÿßŸÑÿ®ÿµŸÖÿ©. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿØÿπŸÖ ÿ¨Ÿáÿßÿ≤ŸÉ.":"Biometric setup failed. Ensure device support.")}},variant:"outline",className:`text-xs ${localStorage.getItem("chat_app_biometric")==="true"?"text-red-400 border-red-400/30":"text-brand border-brand/30"}`,children:localStorage.getItem("chat_app_biometric")==="true"?g==="ar"?"ÿ™ÿπÿ∑ŸäŸÑ":"Disable":g==="ar"?"ÿ™ŸÅÿπŸäŸÑ":"Enable"})]})]})]}),e.jsx(Ii,{language:g,t:C}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-brand text-sm font-bold uppercase tracking-wider",children:C("language")}),e.jsxs("div",{className:"bg-[#202c33] rounded-xl border border-gray-800 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-indigo-500/10 text-indigo-400",children:e.jsx(Ca,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:C("language")}),e.jsx("p",{className:"text-xs text-gray-500",children:g==="ar"?"ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©: ÿßŸÑÿπÿ±ÿ®Ÿäÿ©":"Current: English"})]})]}),e.jsxs("div",{className:"flex bg-[#111b21] rounded-lg p-1 border border-gray-800",children:[e.jsx("button",{onClick:()=>_("ar"),className:`px-4 py-1.5 rounded-md text-sm font-bold transition-all ${g==="ar"?"bg-brand text-white":"text-gray-500 hover:text-white"}`,children:"ÿßŸÑÿπÿ±ÿ®Ÿäÿ©"}),e.jsx("button",{onClick:()=>_("en"),className:`px-4 py-1.5 rounded-md text-sm font-bold transition-all ${g==="en"?"bg-brand text-white":"text-gray-500 hover:text-white"}`,children:"English"})]})]})]}),e.jsx("section",{className:"space-y-4 pt-4",children:e.jsxs(le,{onClick:()=>{console.log("Logout clicked"),r()},variant:"ghost",className:"w-full text-red-500 hover:text-red-400 hover:bg-red-500/10 justify-start gap-3 p-4 h-auto",children:[e.jsx(Sa,{className:"w-5 h-5"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-bold",children:"Logout"}),e.jsx("p",{className:"text-[10px] opacity-70",children:"Sign out of your account on this device"})]})]})})]})]})}function Os({user:t,onBack:a,onUpdate:s,isPublicView:r,language:n,t:i,onStartChat:l}){var y;const[d,p]=m.useState((t==null?void 0:t.name)||""),[u,c]=m.useState((t==null?void 0:t.birth_year)||""),[o,f]=m.useState((t==null?void 0:t.gender)||""),[v,g]=m.useState((t==null?void 0:t.about)||(r?n==="ar"?"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ®ÿ∞ÿ©":"No bio provided":n==="ar"?"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ÿ£ŸÜÿß ÿ£ÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©.":"Hey there! I am using Chat App.")),[_,C]=m.useState(!1),[P,I]=m.useState(!1),[w,k]=m.useState(!1),[O,q]=m.useState(!1),[b,h]=m.useState(!1),R=m.useRef(null),E=m.useRef(null),x=m.useRef(null);if(m.useEffect(()=>{t&&(p(t.name||""),c(t.birth_year||""),f(t.gender||""),g(t.about||(r?n==="ar"?"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ®ÿ∞ÿ©":"No bio provided":n==="ar"?"ŸÖÿ±ÿ≠ÿ®ÿßŸã! ÿ£ŸÜÿß ÿ£ÿ≥ÿ™ÿÆÿØŸÖ ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©.":"Hey there! I am using Chat App.")))},[t,r,n]),m.useEffect(()=>{P&&R.current&&R.current.focus()},[P]),m.useEffect(()=>{w&&E.current&&E.current.focus()},[w]),m.useEffect(()=>{O&&x.current&&x.current.focus()},[O]),!t)return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 items-center justify-center p-8 text-center space-y-4",children:[e.jsx(Ce,{className:"w-12 h-12 text-brand animate-spin"}),e.jsx("p",{className:"text-slate-400 font-medium",children:n==="ar"?"ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä...":"Loading profile..."}),e.jsx("button",{onClick:a,className:"text-brand hover:underline",children:n==="ar"?"ÿ±ÿ¨Ÿàÿπ":"Go Back"})]});const N=async()=>{if(!d.trim())return X.error(n==="ar"?"ÿßŸÑÿßÿ≥ŸÖ ŸÑÿß ŸäŸÖŸÉŸÜ ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÅÿßÿ±ÿ∫ÿßŸã":"Name cannot be empty");C(!0);try{const{error:T}=await Z.from("profiles").update({name:d.trim(),about:v.trim(),birth_year:u?parseInt(u.toString()):null,gender:o||null}).eq("id",t.id);if(T)throw T;X.success(i("profileUpdatedSuccessfully")),s&&s({...t,name:d.trim(),about:v.trim(),birth_year:u?parseInt(u.toString()):null,gender:o||null}),I(!1),k(!1),q(!1),h(!1)}catch(T){console.error("Error updating profile:",T),X.error(n==="ar"?"ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä":"Failed to update profile")}finally{C(!1)}};return e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col h-full bg-slate-950 w-full relative overflow-hidden z-[500]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-brand/10 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-violet-500/5 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950 border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Xe,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${n==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-white text-xl font-bold ${n==="ar"?"font-arabic":""}`,children:i(r?"partnerProfile":"profile")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[e.jsxs("div",{className:`relative group ${r?"":"cursor-pointer"}`,children:[e.jsxs(Oe,{className:"w-40 h-40 border-4 border-slate-900 shadow-2xl group-hover:border-brand/50 transition-colors duration-500",children:[e.jsx(We,{src:t==null?void 0:t.avatar_url,className:"object-cover"}),e.jsx(ze,{className:"bg-slate-800 text-4xl font-bold text-brand",children:(y=t==null?void 0:t.name)==null?void 0:y.charAt(0).toUpperCase()})]}),!r&&e.jsxs("div",{className:"absolute inset-0 bg-black/40 rounded-full flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-sm",children:[e.jsx(Qs,{className:"w-8 h-8 text-white mb-2"}),e.jsx("span",{className:"text-xs text-white font-medium",children:n==="ar"?"ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿµŸàÿ±ÿ©":"Change Photo"})]})]}),r&&l&&e.jsxs(le,{onClick:l,className:"bg-brand hover:bg-brand/80 text-white rounded-full px-8 shadow-lg shadow-brand/20 mt-6",children:[e.jsx(Ut,{className:"w-4 h-4 mr-2"}),n==="ar"?"ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ©":"Send Message"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand text-xs font-bold uppercase tracking-wider",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("name")})]}),!P&&!r&&e.jsx("button",{onClick:()=>I(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(Ct,{className:"w-4 h-4"})})]}),P?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ye,{ref:R,value:d,onChange:T=>p(T.target.value),className:"bg-slate-950/50 border-white/10 text-lg font-medium text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ":"Enter your name"}),e.jsx(le,{size:"icon",onClick:N,disabled:_,className:"bg-brand hover:bg-brand/80",children:_?e.jsx(Ce,{className:"w-4 h-4 animate-spin"}):e.jsx(Gt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-white text-lg font-medium pl-1",children:d})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Ut,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("about")})]}),!w&&!r&&e.jsx("button",{onClick:()=>k(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(Ct,{className:"w-4 h-4"})})]}),w?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ye,{ref:E,value:v,onChange:T=>g(T.target.value),className:"bg-slate-950/50 border-white/10 text-base text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"ÿ£ÿ∂ŸÅ ŸÜÿ®ÿ∞ÿ©":"Add a bio"}),e.jsx(le,{size:"icon",onClick:N,disabled:_,className:"bg-brand hover:bg-brand/80",children:_?e.jsx(Ce,{className:"w-4 h-4 animate-spin"}):e.jsx(Gt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-slate-300 text-base pl-1",children:v})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(zt,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("birth_year")})]}),!O&&!r&&e.jsx("button",{onClick:()=>q(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(Ct,{className:"w-3 h-3"})})]}),O?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{ref:x,type:"number",value:u,onChange:T=>c(T.target.value),className:"bg-slate-950/50 border-white/10 text-sm text-white h-8",placeholder:"YYYY"}),e.jsx(le,{size:"icon",onClick:N,className:"h-8 w-8 bg-brand hover:bg-brand/80",children:e.jsx(Gt,{className:"w-3 h-3"})})]}):e.jsx("p",{className:"text-white text-base pl-1",children:u||(n==="ar"?"ŸÑŸÖ Ÿäÿ≠ÿØÿØ":"Not specified")})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("gender")})]}),!b&&!r&&e.jsx("button",{onClick:()=>h(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(Ct,{className:"w-3 h-3"})})]}),b?e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:o,onChange:T=>{f(T.target.value),setTimeout(()=>N(),100)},className:"bg-slate-950 text-white text-sm border-white/10 rounded-md p-1 flex-1 outline-none ring-1 ring-white/10",children:[e.jsx("option",{value:"",children:n==="ar"?"ÿßÿÆÿ™ÿßÿ±":"Select"}),e.jsx("option",{value:"male",children:i("male")}),e.jsx("option",{value:"female",children:i("female")})]})}):e.jsx("p",{className:"text-white text-base pl-1",children:o==="male"?i("male"):o==="female"?i("female"):n==="ar"?"ŸÑŸÖ Ÿäÿ≠ÿØÿØ":"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä":"Email"})]}),e.jsx("p",{className:"text-slate-300 font-mono text-sm truncate",children:t.email||"Hidden"})]}),e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(zt,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"ÿßŸÜÿ∂ŸÖ ŸÅŸä":"Joined"})]}),e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(t.created_at||Date.now()).toLocaleDateString()})]})]})]})]})})]})}function Ai({onBack:t,currentUserId:a,language:s,t:r}){const[n,i]=m.useState(""),[l,d]=m.useState("user"),[p,u]=m.useState(null),[c,o]=m.useState(!1),[f,v]=m.useState(!1),[g,_]=m.useState(!1),C=async()=>{if(!n.trim())return;const w=n.trim().toLowerCase().replace(l==="user"?"@":"#","");o(!0),v(!1),u(null),await new Promise(k=>setTimeout(k,600));try{if(l==="user"){const{data:k}=await Z.from("profiles").select("id, display_name, username").eq("username",w).maybeSingle();if(k){if(k.id===a){v(!0);return}const{data:O}=await Z.from("conversation_participants").select("conversation_id").eq("user_id",k.id),q=(O==null?void 0:O.map(R=>R.conversation_id))||[];let b=!1;if(q.length>0){const{data:R}=await Z.from("conversation_participants").select("conversation_id").eq("user_id",a).in("conversation_id",q).maybeSingle();b=!!R}const{data:h}=await Z.from("chat_requests").select("status, sender_id").or(`and(sender_id.eq.${a},receiver_id.eq.${k.id}),and(sender_id.eq.${k.id},receiver_id.eq.${a})`).maybeSingle();u({id:k.id,identifier:k.username,name:k.display_name||k.username,hasChat:b,requestStatus:h==null?void 0:h.status,requestSenderId:h==null?void 0:h.sender_id})}else v(!0)}else{const{data:k}=await Z.from("groups").select("id, name, group_id, description").eq("group_id",w).maybeSingle();if(k){const{data:O}=await Z.from("group_members").select("id").eq("group_id",k.id).eq("user_id",a).maybeSingle();u({id:k.id,identifier:k.group_id,name:k.name,description:k.description,isMember:!!O})}else v(!0)}}catch(k){console.error("Search error:",k),v(!0)}finally{o(!1)}},P=async()=>{if(!(!p||g)){_(!0);try{const{error:w}=await Z.from("chat_requests").upsert({sender_id:a,receiver_id:p.id,status:"pending"},{onConflict:"sender_id,receiver_id"});if(w)throw w;X.success(s==="ar"?"ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠!":"Request sent successfully!"),u(k=>k?{...k,requestStatus:"pending",requestSenderId:a}:null)}catch(w){X.error(w.message||(s==="ar"?"ŸÅÿ¥ŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®":"Failed to send request"))}finally{_(!1)}}},I=async()=>{if(!(!p||g)){_(!0);try{const{error:w}=await Z.from("group_members").insert({group_id:p.id,user_id:a,role:"member"});if(w)throw w;X.success(s==="ar"?"ÿ™ŸÖ ÿßŸÑÿßŸÜÿ∂ŸÖÿßŸÖ ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿ®ŸÜÿ¨ÿßÿ≠!":"Joined group successfully!"),u(k=>k?{...k,isMember:!0}:null)}catch(w){console.error("Join group error:",w),X.error(s==="ar"?"ŸÅÿ¥ŸÑ ÿßŸÑÿßŸÜÿ∂ŸÖÿßŸÖ ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Failed to join group")}finally{_(!1)}}};return e.jsxs("div",{className:"flex flex-col h-[100dvh] bg-slate-950 text-white overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-indigo-900/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3 relative z-10 border-b border-white/5 bg-slate-900/50 backdrop-blur-sm",children:[e.jsx(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t,className:"text-slate-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/5",children:e.jsx(Xe,{className:`w-6 h-6 ${s==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 ${s==="ar"?"font-arabic":""}`,children:r("newChat")})]}),e.jsxs("div",{className:"flex border-b border-white/5 relative z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{d("user"),u(null),v(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${l==="user"?"text-brand":"text-slate-500 hover:text-slate-300"} ${s==="ar"?"font-arabic":""}`,children:[s==="ar"?"ÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ≥ÿ™ÿÆÿØŸÖ":"Find User",l==="user"&&e.jsx(A.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]}),e.jsxs("button",{type:"button",onClick:()=>{d("group"),u(null),v(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${l==="group"?"text-brand":"text-slate-500 hover:text-slate-300"} ${s==="ar"?"font-arabic":""}`,children:[s==="ar"?"ÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ¨ŸÖŸàÿπÿ©":"Find Group",l==="group"&&e.jsx(A.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]})]}),e.jsx("div",{className:"flex-1 px-4 py-8 overflow-y-auto relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 mb-6 text-center text-sm",children:l==="user"?s==="ar"?"ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖŸÜ ÿÆŸÑÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿÆÿßÿµ ÿ®ŸáŸÖ (ŸÖÿ´ŸÑÿßŸã elgin@)":"Search for users by their username (e.g. @elgin)":s==="ar"?"ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ŸÖŸÜ ÿÆŸÑÿßŸÑ ŸÖÿπÿ±ŸëŸÅ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© (ŸÖÿ´ŸÑÿßŸã #developers)":"Search for groups by their Group ID (e.g. #developers)"}),e.jsxs("form",{onSubmit:w=>{w.preventDefault(),C()},className:"flex gap-2 mb-8 relative z-50",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand font-bold pointer-events-none text-lg",children:l==="user"?"@":"#"}),e.jsx(ye,{type:"text",inputMode:"search",autoComplete:"off",autoCorrect:"off",spellCheck:"false",placeholder:l==="user"?s==="ar"?"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ":"username":s==="ar"?"ŸÖÿπÿ±ŸëŸÅ-ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"group-id",value:n,onChange:w=>{i(w.target.value),v(!1),u(null)},className:"pl-8 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-600 h-12 text-lg font-medium transition-all"})]}),e.jsx(A.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:c||!n.trim(),className:"bg-brand hover:bg-brand/80 disabled:opacity-50 text-white h-12 w-12 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-brand/20",children:e.jsx(yt,{className:"w-6 h-6 pointer-events-none"})})]}),c&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 py-8 gap-2",children:[e.jsx(Ce,{className:"w-8 h-8 animate-spin text-brand"}),e.jsx("span",{className:"text-xs animate-pulse",children:s==="ar"?"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ¥ÿ®ŸÉÿ©...":"Searching the network..."})]}),f&&e.jsxs(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900/50 border border-white/5 rounded-2xl p-6 text-center",children:[e.jsxs("p",{className:"text-slate-300 font-medium text-lg",children:[l==="user"?s==="ar"?"ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ":"User":s==="ar"?"ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Group"," ",s==="ar"?"ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ":"not found"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:s==="ar"?"ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿπÿ±ŸëŸÅ Ÿàÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.":"Check the ID and try again."})]}),e.jsx(fe,{children:p&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand via-purple-500 to-brand"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-xl font-bold",children:p.name}),e.jsxs("p",{className:"text-brand text-sm font-medium bg-brand/10 px-2 py-0.5 rounded-md w-fit mt-1",children:[l==="user"?"@":"#",p.identifier]}),p.description&&e.jsx("p",{className:"text-slate-400 text-sm mt-2 leading-relaxed",children:p.description})]}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20 rotate-3",children:l==="user"?e.jsx(He,{className:"w-7 h-7"}):e.jsx(vt,{className:"w-7 h-7"})})]}),l==="user"?p.hasChat?e.jsx("div",{className:"bg-brand/10 text-brand border border-brand/20 rounded-xl py-3 text-center text-sm font-medium",children:s==="ar"?"ŸÑÿØŸäŸÉ ÿØÿ±ÿØÿ¥ÿ© ÿ®ÿßŸÑŸÅÿπŸÑ ŸÖÿπ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ":"You already have a chat with this user"}):p.requestStatus==="pending"?e.jsx("div",{className:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded-xl py-3 text-center text-sm font-medium",children:p.requestSenderId===a?s==="ar"?"ÿßŸÑÿ∑ŸÑÿ® ŸÇŸäÿØ ÿßŸÑÿßŸÜÿ™ÿ∏ÿßÿ±...":"Request Pending...":s==="ar"?"ÿ£ÿ±ÿ≥ŸÑ ÿ•ŸÑŸäŸÉ ÿ∑ŸÑÿ®ÿßŸã!":"Sent you a request!"}):e.jsx(le,{onClick:P,disabled:g,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:g?e.jsx(Ce,{className:"w-5 h-5 animate-spin"}):s==="ar"?"ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿØÿ±ÿØÿ¥ÿ©":"Send Chat Request"}):p.isMember?e.jsx("div",{className:"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-xl py-3 text-center text-sm font-medium",children:s==="ar"?"ÿ£ŸÜÿ™ ÿπÿ∂Ÿà ÿ®ÿßŸÑŸÅÿπŸÑ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"You are already a member"}):e.jsx(le,{onClick:I,disabled:g,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:g?e.jsx(Ce,{className:"w-5 h-5 animate-spin"}):s==="ar"?"ÿßŸÜÿ∂ŸÖÿßŸÖ ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Join Group"})]})})]})})]})}function Di({onBack:t,currentUserId:a,language:s,t:r}){const[n,i]=m.useState(""),[l,d]=m.useState(""),[p,u]=m.useState(""),[c,o]=m.useState(!1),[f,v]=m.useState(null),g=async()=>{if(!n.trim()||!l.trim()){X.error(s==="ar"?"Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©":"Please fill in required fields",{description:s==="ar"?"ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ŸàÿßŸÑŸÖÿπÿ±ŸëŸÅ ÿßŸÑŸÅÿ±ŸäÿØ ŸÖÿ∑ŸÑŸàÿ®ÿßŸÜ.":"Group Name and Unique ID are required."});return}o(!0);try{const{data:_,error:C}=await Z.from("groups").insert({name:n.trim(),group_id:l.trim().toLowerCase(),description:p.trim(),created_by:a}).select().single();if(C)throw C;const{error:P}=await Z.from("group_members").insert({group_id:_.id,user_id:a,role:"admin"});if(P)throw P;X.success(s==="ar"?"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿ®ŸÜÿ¨ÿßÿ≠!":"Group Created Successfully!",{description:s==="ar"?`ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ${n.trim()}`:`Welcome to ${n.trim()}`}),t()}catch(_){console.error("Error creating group:",_),_.code==="23505"?X.error(s==="ar"?"ŸÖÿπÿ±ŸëŸÅ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ŸÖÿ£ÿÆŸàÿ∞ ÿ®ÿßŸÑŸÅÿπŸÑ":"Group ID already taken",{description:s==="ar"?"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿπÿ±ŸëŸÅ ŸÅÿ±ŸäÿØ ÿ¢ÿÆÿ±.":"Please choose a different unique ID."}):X.error(s==="ar"?"ŸÅÿ¥ŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Failed to create group",{description:_.message||(s==="ar"?"Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÑÿßÿ≠ŸÇÿßŸã.":"Please try again later.")})}finally{o(!1)}};return e.jsxs(A.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"flex flex-col h-full bg-slate-950 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-32 -left-32 w-64 h-64 bg-violet-500/10 rounded-full blur-3xl animate-pulse"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950/80 backdrop-blur-md border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Xe,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${s==="ar"?"rotate-180":""}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:`text-white text-xl font-bold flex items-center gap-2 ${s==="ar"?"font-arabic":""}`,children:[r("createGroup"),e.jsx(Qe,{className:"w-4 h-4 text-indigo-400"})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:s==="ar"?"ÿßÿ¨ŸÖÿπ ÿßŸÑŸÜÿßÿ≥ ŸÖÿπÿßŸã":"Bring people together"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(A.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-32 h-32 bg-gradient-to-tr from-slate-800 to-slate-700 rounded-full flex items-center justify-center cursor-pointer relative group border-4 border-slate-950 shadow-2xl",children:[e.jsx(Qs,{className:"w-10 h-10 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-medium",children:s==="ar"?"ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©":"Change Icon"})}),e.jsx("div",{className:"absolute -inset-1 rounded-full border border-indigo-500/30 opacity-0 group-hover:opacity-100 transition-opacity scale-110"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:s==="ar"?"ÿßÿ∂ÿ∫ÿ∑ ŸÑÿ™ÿπŸäŸäŸÜ ÿ£ŸäŸÇŸàŸÜÿ© ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Tap to set group icon"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:se("text-sm font-medium transition-colors ml-1",f==="name"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:[r("name")," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",f==="name"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(vt,{className:se("w-5 h-5 transition-colors",f==="name"?"text-indigo-400":"text-slate-500")}),e.jsx(ye,{type:"text",placeholder:s==="ar"?"ŸÖÿ´ŸÑÿßŸã: ÿ±ÿ≠ŸÑÿ© ÿπÿ∑ŸÑÿ© ŸÜŸáÿßŸäÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ":"e.g. Weekend Trip Squad",value:n,onChange:_=>i(_.target.value),onFocus:()=>v("name"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:se("text-sm font-medium transition-colors ml-1",f==="id"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:[s==="ar"?"ÿßŸÑŸÖÿπÿ±ŸëŸÅ ÿßŸÑŸÅÿ±ŸäÿØ":"Unique ID"," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",f==="id"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ta,{className:se("w-5 h-5 transition-colors",f==="id"?"text-indigo-400":"text-slate-500")}),e.jsx(ye,{type:"text",placeholder:s==="ar"?"ŸÖÿπÿ±ŸëŸÅ-ŸÖÿ¨ŸÖŸàÿπÿ©-ŸÅÿ±ŸäÿØ":"unique-group-handle",value:l,onChange:_=>d(_.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-")),onFocus:()=>v("id"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 ml-1",children:[s==="ar"?"ŸäŸÖŸÉŸÜ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿßŸÑÿßŸÜÿ∂ŸÖÿßŸÖ ÿπÿ®ÿ±":"Users can join via"," ",e.jsxs("span",{className:"font-mono text-indigo-400 bg-indigo-500/10 px-1 rounded",children:["#",l||(s==="ar"?"ÿßŸÑŸÖÿπÿ±ŸëŸÅ":"handle")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:se("text-sm font-medium transition-colors ml-1",f==="desc"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:r("about")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",f==="desc"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ra,{className:se("w-5 h-5 transition-colors",f==="desc"?"text-indigo-400":"text-slate-500")}),e.jsx(ye,{type:"text",placeholder:s==="ar"?"ÿπŸÜ ŸÖÿßÿ∞ÿß ÿ™ÿØŸàÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©ÿü":"What's this group about?",value:p,onChange:_=>u(_.target.value),onFocus:()=>v("desc"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]})]}),e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(le,{onClick:g,disabled:c||!n.trim()||!l.trim(),className:"w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white h-14 text-lg font-semibold rounded-xl shadow-lg shadow-indigo-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-5 h-5 mr-2 animate-spin"}),s==="ar"?"ÿ¨ÿßÿ±Ÿä ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©...":"Creating Group..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-5 h-5 mr-2"}),s==="ar"?"ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©":"Create Group"]})})})]})})]})}function Li(){const[t,a]=m.useState(()=>localStorage.getItem("chat_app_language")||"en"),[s,r]=m.useState(()=>localStorage.getItem("chat_app_theme")==="dark"),[n,i]=m.useState(()=>localStorage.getItem("chat_app_view")||"chatList");m.useEffect(()=>{localStorage.setItem("chat_app_view",n)},[n]);const[l,d]=m.useState(!1),[p,u]=m.useState(()=>localStorage.getItem("chat_app_sound_enabled")!=="false"),[c,o]=m.useState(!1),[f,v]=m.useState(!1),[g,_]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||Ue[0].id),[C,P]=m.useState([]),[I,w]=m.useState([]),[k,O]=m.useState(null),[q,b]=m.useState(null),h=m.useRef(null),R=m.useRef(null),E=m.useRef(null);console.log("üîó Initializing hooks...");const{currentUser:x,isLoading:N,logout:y}=cn();console.log("üë§ Auth State:",{currentUser:x==null?void 0:x.id,authLoading:N});const{chats:T,isLoading:W,selectedChat:S,messages:V,loadChats:j,loadMessages:$,handleSelectChat:ee,handleSendMessage:H,handleDeleteMessage:Q,handlePinChat:M,handleSendPoll:Y,handleIncomingMessage:U,handleIncomingUpdate:L,sendMessageToChat:J}=dn(x),ne=m.useCallback(z=>{R.current=z,ee(z)},[ee]);m.useEffect(()=>{R.current=S},[S]);const{activeCall:te,handleStartCall:ce,handleAcceptCall:Pe,handleRejectCall:je,sendSignalingMessage:dt}=un({currentUser:x,soundEnabled:p}),Me=m.useMemo(()=>x?{id:x.id,name:x.name||x.username,username:x.username}:null,[x]),{onlineUsers:et,typingUsers:Ye,sendTypingIndicator:be}=mn({currentUser:Me,selectedChatRef:R,onNewMessage:U,onUpdateMessage:L,onReloadChats:m.useCallback(()=>{x&&j(x.id)},[x,j]),soundEnabled:p}),ge=m.useCallback(z=>Da[t][z]||z,[t]);m.useEffect(()=>{const z=setTimeout(()=>d(!1),2500);return()=>clearTimeout(z)},[]),m.useEffect(()=>{s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("chat_app_theme",s?"dark":"light")},[s]),m.useEffect(()=>{"Notification"in window&&v(Notification.permission==="granted"),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"microphone"}).then(z=>{o(z.state==="granted"),z.onchange=()=>o(z.state==="granted")}).catch(()=>{})},[]),m.useEffect(()=>{const z=()=>{document.removeEventListener("click",z)};return document.addEventListener("click",z),()=>document.removeEventListener("click",z)},[]),m.useEffect(()=>{const z=Ue.find(re=>re.id===g)||Ue[0];h.current=new Audio(z.url),localStorage.setItem("chat_app_sound_id",g)},[g]),m.useEffect(()=>{localStorage.setItem("chat_app_sound_enabled",String(p))},[p]);const ue=m.useCallback(async()=>{if(!x)return;const{data:z}=await Z.from("chat_requests").select("*, profiles:sender_id(username, display_name, avatar_url)").eq("receiver_id",x.id).eq("status","pending");z&&P(re=>JSON.stringify(re)!==JSON.stringify(z)?z:re)},[x==null?void 0:x.id]),Fe=m.useCallback(async()=>{if(!x)return;const{data:z}=await Z.from("statuses").select("*, profiles:user_id(id, display_name, avatar_url)").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});z&&w(re=>JSON.stringify(re)!==JSON.stringify(z)?z:re)},[x==null?void 0:x.id]);m.useEffect(()=>{if(x){console.log("üîÑ Running global data fetch for user:",x.id),ue(),Fe();const z=Z.channel(`app-global-${x.id}`).on("postgres_changes",{event:"*",schema:"public",table:"chat_requests",filter:`receiver_id=eq.${x.id}`},ue).on("postgres_changes",{event:"*",schema:"public",table:"statuses"},Fe).subscribe(re=>console.log("üì° Global channel status:",re));return()=>{console.log("üîå Cleaning up global channel"),Z.removeChannel(z)}}},[x==null?void 0:x.id,ue,Fe]);const tt=m.useCallback((z,re)=>{be(z,re)},[be]),he=m.useCallback(()=>{},[]),Ee=m.useCallback(()=>{},[]),ut=m.useCallback(()=>{},[]),mt=m.useCallback(()=>{i("chatList")},[]),$e=m.useCallback(z=>{S&&Q(z,S.isGroup)},[S,Q]),pt=m.useCallback(()=>{S&&$(S.id,S.isGroup)},[S,$]),Ge=m.useCallback(z=>{S&&tt(z,S.partnerId)},[S,tt]),F=m.useCallback(()=>{X.info(t==="ar"?"ŸÇÿ±Ÿäÿ®ÿßŸã: ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©":"Coming Soon: Clear Chat")},[t]),ie=async(z,re)=>{if(!x)return;let de=null;const De=I.find(K=>K.id===re);if(De&&(de=De.user_id),!de&&k&&k.items){const K=k.items.find(oe=>oe.id===re);K&&(de=K.user_id)}if(!de){X.error("Could not find status owner");return}const we=T.find(K=>K.partnerId===de),xt=`Replied to story: ${z}`;we?(await J(we,xt),X.success(t==="ar"?"ÿ™ŸÖ ÿßŸÑÿ±ÿØ ÿ®ŸÜÿ¨ÿßÿ≠":"Reply sent"),O(null)):X.error("You must have a chat with this user to reply")},Ae=async z=>{var De;const re=(De=z.target.files)==null?void 0:De[0];if(!re||!x)return;if(!re.type.startsWith("image/")&&!re.type.startsWith("video/")){X.error(t==="ar"?"Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ© ÿ£Ÿà ŸÅŸäÿØŸäŸà":"Please select an image or video");return}const de=X.loading(t==="ar"?"ÿ¨ÿßÿ±Ÿä ÿ±ŸÅÿπ ÿßŸÑÿ≥ÿ™Ÿàÿ±Ÿä...":"Uploading story...");try{const we=new FormData;we.append("file",re),we.append("userId",x.id);const K=await(await fetch(`https://${cs}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${ds}`},body:we})).json();if(K.error)throw new Error(K.error);const oe=new Date;oe.setDate(oe.getDate()+1);const{error:me}=await Z.from("statuses").insert({user_id:x.id,content_url:K.fileUrl,content_type:K.fileType,text:"",expires_at:oe.toISOString()});if(me)throw me;X.success(t==="ar"?"ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ≥ÿ™Ÿàÿ±Ÿä ÿ®ŸÜÿ¨ÿßÿ≠":"Story added successfully",{id:de}),Fe()}catch(we){console.error("Story upload error:",we),X.error(t==="ar"?"ŸÅÿ¥ŸÑ ÿßŸÑÿ±ŸÅÿπ: "+we.message:"Upload failed: "+we.message,{id:de})}finally{E.current&&(E.current.value="")}},Se=z=>{S&&ce(S.partnerId,S.partnerName,z)},Be=async(z,re)=>{if(x)try{await Z.from("chat_requests").update({status:"accepted"}).eq("id",z);const{data:de}=await Z.from("conversations").insert({}).select().single();de&&(await Z.from("conversation_participants").insert([{conversation_id:de.id,user_id:x.id},{conversation_id:de.id,user_id:re}]),X.success("Request accepted"),ue(),j(x.id))}catch{X.error("Failed to accept")}},ft=async z=>{await Z.from("chat_requests").update({status:"rejected"}).eq("id",z),X.success("Request rejected"),ue()},Ve=async(z,re)=>{if(i(z),typeof re=="string"){b(null);const{data:de}=await Z.from("profiles").select("*").eq("id",re).single();de&&b(de)}else b(re||null)},st=async()=>{if(!("Notification"in window))return;const z=await Notification.requestPermission();v(z==="granted"),z==="granted"&&X.success(ge("notifications")+" "+ge("success"))},ht=async()=>{try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(re=>re.stop()),o(!0),X.success("Microphone enabled")}catch{X.error("Microphone access denied")}};return N||l?e.jsx("div",{className:"w-full h-screen bg-[#111b21] flex flex-col items-center justify-center",children:e.jsx(yi,{onFinish:()=>d(!1),language:t})}):x?e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"h-screen bg-[#111b21] flex items-center justify-center",children:e.jsx(Ce,{className:"w-8 h-8 animate-spin text-green-500"})}),children:e.jsx(wi,{language:t,isAuthenticated:!!x,onUnlock:()=>{},children:e.jsx(ri,{children:e.jsxs("div",{className:"flex h-screen bg-[#111b21] relative overflow-hidden font-outfit text-white",children:[e.jsx(ws,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx("input",{type:"file",ref:E,className:"hidden",accept:"image/*,video/*",onChange:Ae}),te&&te.status==="ringing"&&te.callerId!==x.id&&e.jsx(vi,{callerName:te.callerName,type:te.type,onAccept:Pe,onReject:je,language:t}),te&&(te.status==="connected"||te.status==="connecting"||te.status==="ringing"&&te.callerId===x.id)&&e.jsx(Ei,{callId:te.id,isIncoming:te.callerId!==x.id,callerName:te.callerId===x.id?te.recipientId:te.callerName,type:te.type,onEndCall:je,currentUserId:x.id,callerId:te.callerId,recipientId:te.recipientId,sendSignaling:dt,incomingOffer:te.offer,remoteAnswer:te.answer,remoteIceCandidates:te.iceCandidates||[]}),e.jsx(fe,{children:k&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[1000] bg-black",children:e.jsx(ji,{items:k.items,initialIndex:k.index,onClose:()=>O(null),onReply:ie,language:t})})}),e.jsxs("div",{className:`flex w-full h-full ${n==="chatList"?"":"md:flex"}`,children:[e.jsx("div",{className:`${n==="chatList"?"flex":"hidden md:flex"} w-full md:w-[400px] flex-col h-full border-r border-white/5`,children:e.jsx(si,{chats:T,currentUser:x,onlineUsers:et,onSelectChat:(z,re)=>{const de=T.find(De=>De.partnerId===z);de&&(ne(de),i("chatWindow"))},onNewChat:()=>i("newChat"),onCreateGroup:()=>i("createGroup"),onLogout:y,onSettings:()=>i("settings"),onAcceptRequest:Be,onRejectRequest:ft,pendingRequests:C,typingUsers:Ye,onPinChat:M,statuses:I,onViewStatus:(z,re)=>O({items:z,index:re}),onAddStatus:()=>{var z;return(z=E.current)==null?void 0:z.click()},language:t,t:ge,onEnableNotifications:st,notificationsEnabled:f,isLoading:W})}),e.jsxs("div",{className:`${n!=="chatList"?"flex":"hidden md:flex"} flex-1 flex-col h-full bg-[#0b141a]`,children:[n==="chatList"&&e.jsx("div",{className:"hidden md:flex items-center justify-center h-full text-gray-500",children:e.jsx("p",{children:"Select a chat to start messaging"})}),n==="chatWindow"&&S&&e.jsx(bi,{currentUserId:x.id,partnerId:S.partnerId,partnerName:S.partnerName,partnerAvatar:S.partnerAvatar,messages:V,isPartnerOnline:et.has(S.partnerId),isPartnerTyping:Ye[S.partnerId],onBack:mt,onSendMessage:H,onSendVoiceMessage:he,onDeleteMessage:$e,onTyping:Ge,onRefresh:pt,onReact:Ee,onSendPoll:Y,onVote:ut,onStartCall:Se,isGroup:S.isGroup,onShowProfile:z=>Ve("partnerProfile",z),onClearChat:F,language:t,t:ge}),n==="settings"&&e.jsx(Mi,{user:x,onBack:()=>i("chatList"),onGoToProfile:()=>i("profile"),onLogout:y,notificationsEnabled:f,onEnableNotifications:st,micEnabled:c,onEnableMic:ht,soundEnabled:p,onToggleSound:u,currentSoundId:g,notificationSounds:Ue,onSelectSound:_,onTestSound:()=>{var z;return(z=h.current)==null?void 0:z.play()},language:t,onLanguageChange:a,t:ge}),n==="newChat"&&e.jsx(Ai,{onBack:()=>i("chatList"),currentUserId:x.id,language:t,t:ge}),n==="createGroup"&&e.jsx(Di,{onBack:()=>{j(x.id),i("chatList")},currentUserId:x.id,language:t,t:ge}),n==="profile"&&e.jsx(Os,{user:x,onBack:()=>i("settings"),onUpdate:()=>{},language:t,t:ge}),n==="partnerProfile"&&e.jsx(Os,{user:q,isPublicView:!0,onBack:()=>i("chatWindow"),onStartChat:()=>{i("chatWindow")},language:t,t:ge})]})]})]})})})}):e.jsxs(e.Fragment,{children:[e.jsx(ws,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx(Yn,{onLoginSuccess:()=>{},language:t,t:ge})]})}console.log("üöÄ main.tsx execution started");typeof navigator<"u"&&"serviceWorker"in navigator&&(console.log("üßπ Attempting to unregister Service Workers..."),navigator.serviceWorker.getRegistrations().then(t=>{console.log(`üì° Found ${t.length} registrations`),t.forEach(a=>{a.unregister().then(s=>console.log("‚úÖ SW Unregistered:",s))})}).catch(t=>console.warn("‚ùå SW unregister failed:",t)));console.log("üèóÔ∏è Creating root and rendering App...");Ia.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(ai,{children:e.jsx(Li,{})})}));console.log("üèÅ main.tsx end of file reached");
