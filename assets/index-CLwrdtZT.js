import{a as na,R as G,r as u,j as e,u as jr,b as wr,c as Nr,m as z,A as je,g as ia}from"./vendor-C2tG_28P.js";import{c as oa}from"./supabase-2A4keVzc.js";import{R as la,S as ca,M as dr,U as He,b as tt,L as Vr,c as _e,A as da,d as ua,P as ur,u as ma,e as Ur,f as bt,g as Qt,h as pa,C as fa,i as vt,B as Ot,j as Fe,X as Ee,E as Hr,k as mr,l as zt,m as ha,n as Wr,o as Yr,T as pr,p as Ut,F as Ft,q as xa,r as Jr,s as ga,t as $t,D as Xr,I as Kr,v as fr,V as We,w as Gt,x as Qr,y as ba,z as va,G as ya,H as Ye,J as ja,K as wa,N as Na,O as Ca,Q as Zr,W as Bt,Y as es,Z as ts,$ as rs,a0 as Sa,a1 as ss,a2 as ka,a3 as _a,a4 as Cr,a5 as Ta,a6 as Ra,a7 as Pa,a8 as as,a9 as kt,aa as Yt,ab as Ea,ac as Ia}from"./ui-wo5GeGEf.js";function Ma(t,a){for(var r=0;r<a.length;r++){const s=a[r];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var _t={},Sr;function Aa(){if(Sr)return _t;Sr=1;var t=na();return _t.createRoot=t.createRoot,_t.hydrateRoot=t.hydrateRoot,_t}var Da=Aa();const qt="umgfxbipblzpgpejlnzg",Vt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtZ2Z4YmlwYmx6cGdwZWpsbnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODY5MDIsImV4cCI6MjA4MjE2MjkwMn0.fkNxfMwxqGR5EUALb5C3QxQvSMXsDyRyHf8tltWpm2Y",La=`https://${qt}.supabase.co`,Oa=Vt,ee=oa(La,Oa,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}}),za={en:{loginTitle:"Welcome Back",loginSubtitle:"Sign in to continue",emailPlaceholder:"Email address",passwordPlaceholder:"Password",loginButton:"Sign In",signupLink:"Create an account",chatsTitle:"Chats",searchPlaceholder:"Search conversations...",newChatButton:"New Chat",typeMessage:"Type a message...",online:"Online",offline:"Last seen",typing:"typing...",settings:"Settings",profile:"Profile",language:"Language",logout:"Log Out",notifications:"Notifications",sounds:"Sounds",privacy:"Privacy",help:"Help",theme:"Theme",account:"Account",blocked:"Blocked Users",general:"General",darkMode:"Dark Mode",lightMode:"Light Mode",systemMode:"System",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy",info:"Info",members:"Members",media:"Media",files:"Files",links:"Links",voice:"Voice",video:"Video",call:"Call",mute:"Mute",unmute:"Unmute",camera:"Camera",screenShare:"Screen Share",endCall:"End Call",accept:"Accept",reject:"Reject",calling:"Calling...",ringing:"Ringing...",connecting:"Connecting...",reconnecting:"Reconnecting...",ended:"Call Ended",missed:"Missed Call",incoming:"Incoming Call",outgoing:"Outgoing Call",today:"Today",yesterday:"Yesterday",justNow:"Just now",sent:"Sent",delivered:"Delivered",read:"Read",failed:"Failed",uploading:"Uploading...",downloading:"Downloading...",success:"Success",error:"Error",retry:"Retry",loading:"Loading...",noChats:"No chats yet",startChat:"Start a conversation",createGroup:"Create Group",groupName:"Group Name",addMembers:"Add Members",create:"Create",groupCreated:"Group created successfully",userJoined:"User joined",userLeft:"User left",admin:"Admin",kick:"Remote",promote:"Promote",demote:"Demote",leaveGroup:"Leave Group",deleteGroup:"Delete Group",areYouSure:"Are you sure?",cannotUndo:"This action cannot be undone.",yes:"Yes",no:"No",ok:"OK"},ar:{loginTitle:"Ù…Ø±Ø­Ø¨Ø§Ù‹",loginSubtitle:"Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©",emailPlaceholder:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",passwordPlaceholder:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",loginButton:"Ø¯Ø®ÙˆÙ„",signupLink:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",chatsTitle:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª",searchPlaceholder:"Ø¨Ø­Ø«...",newChatButton:"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",typeMessage:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...",online:"Ù…ØªØµÙ„",offline:"Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±",typing:"ÙŠÙƒØªØ¨...",settings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",profile:"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",language:"Ø§Ù„Ù„ØºØ©",logout:"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",notifications:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",sounds:"Ø§Ù„Ø£ØµÙˆØ§Øª",privacy:"Ø§Ù„Ø®ØµÙˆØµÙŠØ©",help:"Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",theme:"Ø§Ù„Ù…Ø¸Ù‡Ø±",account:"Ø§Ù„Ø­Ø³Ø§Ø¨",blocked:"Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†",general:"Ø¹Ø§Ù…",darkMode:"Ø¯Ø§ÙƒÙ†",lightMode:"ÙØ§ØªØ­",systemMode:"Ø§Ù„Ù†Ø¸Ø§Ù…",save:"Ø­ÙØ¸",cancel:"Ø¥Ù„ØºØ§Ø¡",edit:"ØªØ¹Ø¯ÙŠÙ„",delete:"Ø­Ø°Ù",reply:"Ø±Ø¯",forward:"ØªØ­ÙˆÙŠÙ„",copy:"Ù†Ø³Ø®",info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",members:"Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡",media:"Ø§Ù„ÙˆØ³Ø§Ø¦Ø·",files:"Ø§Ù„Ù…Ù„ÙØ§Øª",links:"Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",voice:"ØµÙˆØªÙŠ",video:"ÙÙŠØ¯ÙŠÙˆ",call:"Ø§ØªØµØ§Ù„",mute:"ÙƒØªÙ…",unmute:"ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª",camera:"ÙƒØ§Ù…ÙŠØ±Ø§",screenShare:"Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©",endCall:"Ø¥Ù†Ù‡Ø§Ø¡",accept:"Ø±Ø¯",reject:"Ø±ÙØ¶",calling:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...",ringing:"ÙŠØ±Ù†...",connecting:"ÙŠØªØµÙ„...",reconnecting:"ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„...",ended:"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",missed:"Ù…ÙƒØ§Ù„Ù…Ø© ÙØ§Ø¦ØªØ©",incoming:"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©",outgoing:"Ù…ÙƒØ§Ù„Ù…Ø© ØµØ§Ø¯Ø±Ø©",today:"Ø§Ù„ÙŠÙˆÙ…",yesterday:"Ø£Ù…Ø³",justNow:"Ø§Ù„Ø¢Ù†",sent:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",delivered:"ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„",read:"ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",failed:"ÙØ´Ù„",uploading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...",downloading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",success:"ØªÙ… Ø¨Ù†Ø¬Ø§Ø­",error:"Ø®Ø·Ø£",retry:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",loading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",noChats:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª",startChat:"Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",createGroup:"Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©",groupName:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",addMembers:"Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡",create:"Ø¥Ù†Ø´Ø§Ø¡",groupCreated:"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",userJoined:"Ø§Ù†Ø¶Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",userLeft:"ØºØ§Ø¯Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",admin:"Ù…Ø´Ø±Ù",kick:"Ø·Ø±Ø¯",promote:"ØªØ±Ù‚ÙŠØ©",demote:"ØªØ®ÙÙŠØ¶",leaveGroup:"Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",deleteGroup:"Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",areYouSure:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ",cannotUndo:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.",yes:"Ù†Ø¹Ù…",no:"Ù„Ø§",ok:"Ø­Ø³Ù†Ø§Ù‹"}};function Fa(t){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",a.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const $a=t=>{switch(t){case"success":return qa;case"info":return Ua;case"warning":return Va;case"error":return Ha;default:return null}},Ga=Array(12).fill(0),Ba=({visible:t,className:a})=>G.createElement("div",{className:["sonner-loading-wrapper",a].filter(Boolean).join(" "),"data-visible":t},G.createElement("div",{className:"sonner-spinner"},Ga.map((r,s)=>G.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),qa=G.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},G.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Va=G.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},G.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Ua=G.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},G.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Ha=G.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},G.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Wa=G.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},G.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),G.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ya=()=>{const[t,a]=G.useState(document.hidden);return G.useEffect(()=>{const r=()=>{a(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t};let Zt=1;class Ja{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{const r=this.subscribers.indexOf(a);this.subscribers.splice(r,1)}),this.publish=a=>{this.subscribers.forEach(r=>r(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var r;const{message:s,...n}=a,i=typeof(a==null?void 0:a.id)=="number"||((r=a.id)==null?void 0:r.length)>0?a.id:Zt++,o=this.toasts.find(p=>p.id===i),d=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(p=>p.id===i?(this.publish({...p,...a,id:i,title:s}),{...p,...a,id:i,dismissible:d,title:s}):p):this.addToast({title:s,...n,dismissible:d,id:i}),i},this.dismiss=a=>(a?(this.dismissedToasts.add(a),requestAnimationFrame(()=>this.subscribers.forEach(r=>r({id:a,dismiss:!0})))):this.toasts.forEach(r=>{this.subscribers.forEach(s=>s({id:r.id,dismiss:!0}))}),a),this.message=(a,r)=>this.create({...r,message:a}),this.error=(a,r)=>this.create({...r,message:a,type:"error"}),this.success=(a,r)=>this.create({...r,type:"success",message:a}),this.info=(a,r)=>this.create({...r,type:"info",message:a}),this.warning=(a,r)=>this.create({...r,type:"warning",message:a}),this.loading=(a,r)=>this.create({...r,type:"loading",message:a}),this.promise=(a,r)=>{if(!r)return;let s;r.loading!==void 0&&(s=this.create({...r,promise:a,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));const n=Promise.resolve(a instanceof Function?a():a);let i=s!==void 0,o;const d=n.then(async m=>{if(o=["resolve",m],G.isValidElement(m))i=!1,this.create({id:s,type:"default",message:m});else if(Ka(m)&&!m.ok){i=!1;const l=typeof r.error=="function"?await r.error(`HTTP error! status: ${m.status}`):r.error,h=typeof r.description=="function"?await r.description(`HTTP error! status: ${m.status}`):r.description,x=typeof l=="object"&&!G.isValidElement(l)?l:{message:l};this.create({id:s,type:"error",description:h,...x})}else if(m instanceof Error){i=!1;const l=typeof r.error=="function"?await r.error(m):r.error,h=typeof r.description=="function"?await r.description(m):r.description,x=typeof l=="object"&&!G.isValidElement(l)?l:{message:l};this.create({id:s,type:"error",description:h,...x})}else if(r.success!==void 0){i=!1;const l=typeof r.success=="function"?await r.success(m):r.success,h=typeof r.description=="function"?await r.description(m):r.description,x=typeof l=="object"&&!G.isValidElement(l)?l:{message:l};this.create({id:s,type:"success",description:h,...x})}}).catch(async m=>{if(o=["reject",m],r.error!==void 0){i=!1;const c=typeof r.error=="function"?await r.error(m):r.error,l=typeof r.description=="function"?await r.description(m):r.description,v=typeof c=="object"&&!G.isValidElement(c)?c:{message:c};this.create({id:s,type:"error",description:l,...v})}}).finally(()=>{i&&(this.dismiss(s),s=void 0),r.finally==null||r.finally.call(r)}),p=()=>new Promise((m,c)=>d.then(()=>o[0]==="reject"?c(o[1]):m(o[1])).catch(c));return typeof s!="string"&&typeof s!="number"?{unwrap:p}:Object.assign(s,{unwrap:p})},this.custom=(a,r)=>{const s=(r==null?void 0:r.id)||Zt++;return this.create({jsx:a(s),id:s,...r}),s},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const ke=new Ja,Xa=(t,a)=>{const r=(a==null?void 0:a.id)||Zt++;return ke.addToast({title:t,...a,id:r}),r},Ka=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",Qa=Xa,Za=()=>ke.toasts,en=()=>ke.getActiveToasts(),Q=Object.assign(Qa,{success:ke.success,info:ke.info,warning:ke.warning,error:ke.error,custom:ke.custom,message:ke.message,promise:ke.promise,dismiss:ke.dismiss,loading:ke.loading},{getHistory:Za,getToasts:en});Fa("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function Tt(t){return t.label!==void 0}const tn=3,rn="24px",sn="16px",kr=4e3,an=356,nn=14,on=45,ln=200;function Le(...t){return t.filter(Boolean).join(" ")}function cn(t){const[a,r]=t.split("-"),s=[];return a&&s.push(a),r&&s.push(r),s}const dn=t=>{var a,r,s,n,i,o,d,p,m;const{invert:c,toast:l,unstyled:h,interacting:v,setHeights:x,visibleToasts:P,heights:E,index:w,toasts:R,expanded:k,removeToast:M,defaultRichColors:$,closeButton:q,style:C,cancelButtonStyle:f,actionButtonStyle:S,className:_="",descriptionClassName:j="",duration:N,position:y,gap:F,expandByDefault:D,classNames:T,icons:B,closeButtonAriaLabel:g="Close toast"}=t,[Y,K]=G.useState(null),[A,I]=G.useState(null),[b,W]=G.useState(!1),[V,O]=G.useState(!1),[Z,ae]=G.useState(!1),[le,ue]=G.useState(!1),[Ie,Ce]=G.useState(!1),[dt,Re]=G.useState(0),[Xe,Ke]=G.useState(0),Se=G.useRef(l.duration||N||kr),st=G.useRef(null),be=G.useRef(null),de=w===0,ut=w+1<=P,we=l.type,Ae=l.dismissible!==!1,jt=l.className||"",wt=l.descriptionClassName||"",Qe=G.useMemo(()=>E.findIndex(re=>re.toastId===l.id)||0,[E,l.id]),Nt=G.useMemo(()=>{var re;return(re=l.closeButton)!=null?re:q},[l.closeButton,q]),ve=G.useMemo(()=>l.duration||N||kr,[l.duration,N]),U=G.useRef(0),ce=G.useRef(0),Oe=G.useRef(0),Me=G.useRef(null),[Be,mt]=y.split("-"),qe=G.useMemo(()=>E.reduce((re,he,ye)=>ye>=Qe?re:re+he.height,0),[E,Qe]),pt=Ya(),ft=l.invert||c,De=we==="loading";ce.current=G.useMemo(()=>Qe*F+qe,[Qe,qe]),G.useEffect(()=>{Se.current=ve},[ve]),G.useEffect(()=>{W(!0)},[]),G.useEffect(()=>{const re=be.current;if(re){const he=re.getBoundingClientRect().height;return Ke(he),x(ye=>[{toastId:l.id,height:he,position:l.position},...ye]),()=>x(ye=>ye.filter(Ne=>Ne.toastId!==l.id))}},[x,l.id]),G.useLayoutEffect(()=>{if(!b)return;const re=be.current,he=re.style.height;re.style.height="auto";const ye=re.getBoundingClientRect().height;re.style.height=he,Ke(ye),x(Ne=>Ne.find(H=>H.toastId===l.id)?Ne.map(H=>H.toastId===l.id?{...H,height:ye}:H):[{toastId:l.id,height:ye,position:l.position},...Ne])},[b,l.title,l.description,x,l.id]);const Pe=G.useCallback(()=>{O(!0),Re(ce.current),x(re=>re.filter(he=>he.toastId!==l.id)),setTimeout(()=>{M(l)},ln)},[l,M,x,ce]);G.useEffect(()=>{if(l.promise&&we==="loading"||l.duration===1/0||l.type==="loading")return;let re;return k||v||pt?(()=>{if(Oe.current<U.current){const Ne=new Date().getTime()-U.current;Se.current=Se.current-Ne}Oe.current=new Date().getTime()})():(()=>{Se.current!==1/0&&(U.current=new Date().getTime(),re=setTimeout(()=>{l.onAutoClose==null||l.onAutoClose.call(l,l),Pe()},Se.current))})(),()=>clearTimeout(re)},[k,v,l,we,pt,Pe]),G.useEffect(()=>{l.delete&&Pe()},[Pe,l.delete]);function Ht(){var re;if(B!=null&&B.loading){var he;return G.createElement("div",{className:Le(T==null?void 0:T.loader,l==null||(he=l.classNames)==null?void 0:he.loader,"sonner-loader"),"data-visible":we==="loading"},B.loading)}return G.createElement(Ba,{className:Le(T==null?void 0:T.loader,l==null||(re=l.classNames)==null?void 0:re.loader),visible:we==="loading"})}const Wt=l.icon||(B==null?void 0:B[we])||$a(we);var Ct,St;return G.createElement("li",{tabIndex:0,ref:be,className:Le(_,jt,T==null?void 0:T.toast,l==null||(a=l.classNames)==null?void 0:a.toast,T==null?void 0:T.default,T==null?void 0:T[we],l==null||(r=l.classNames)==null?void 0:r[we]),"data-sonner-toast":"","data-rich-colors":(Ct=l.richColors)!=null?Ct:$,"data-styled":!(l.jsx||l.unstyled||h),"data-mounted":b,"data-promise":!!l.promise,"data-swiped":Ie,"data-removed":V,"data-visible":ut,"data-y-position":Be,"data-x-position":mt,"data-index":w,"data-front":de,"data-swiping":Z,"data-dismissible":Ae,"data-type":we,"data-invert":ft,"data-swipe-out":le,"data-swipe-direction":A,"data-expanded":!!(k||D&&b),style:{"--index":w,"--toasts-before":w,"--z-index":R.length-w,"--offset":`${V?dt:ce.current}px`,"--initial-height":D?"auto":`${Xe}px`,...C,...l.style},onDragEnd:()=>{ae(!1),K(null),Me.current=null},onPointerDown:re=>{De||!Ae||(st.current=new Date,Re(ce.current),re.target.setPointerCapture(re.pointerId),re.target.tagName!=="BUTTON"&&(ae(!0),Me.current={x:re.clientX,y:re.clientY}))},onPointerUp:()=>{var re,he,ye;if(le||!Ae)return;Me.current=null;const Ne=Number(((re=be.current)==null?void 0:re.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),L=Number(((he=be.current)==null?void 0:he.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),H=new Date().getTime()-((ye=st.current)==null?void 0:ye.getTime()),ne=Y==="x"?Ne:L,me=Math.abs(ne)/H;if(Math.abs(ne)>=on||me>.11){Re(ce.current),l.onDismiss==null||l.onDismiss.call(l,l),I(Y==="x"?Ne>0?"right":"left":L>0?"down":"up"),Pe(),ue(!0);return}else{var ie,oe;(ie=be.current)==null||ie.style.setProperty("--swipe-amount-x","0px"),(oe=be.current)==null||oe.style.setProperty("--swipe-amount-y","0px")}Ce(!1),ae(!1),K(null)},onPointerMove:re=>{var he,ye,Ne;if(!Me.current||!Ae||((he=window.getSelection())==null?void 0:he.toString().length)>0)return;const H=re.clientY-Me.current.y,ne=re.clientX-Me.current.x;var me;const ie=(me=t.swipeDirections)!=null?me:cn(y);!Y&&(Math.abs(ne)>1||Math.abs(H)>1)&&K(Math.abs(ne)>Math.abs(H)?"x":"y");let oe={x:0,y:0};const fe=xe=>1/(1.5+Math.abs(xe)/20);if(Y==="y"){if(ie.includes("top")||ie.includes("bottom"))if(ie.includes("top")&&H<0||ie.includes("bottom")&&H>0)oe.y=H;else{const xe=H*fe(H);oe.y=Math.abs(xe)<Math.abs(H)?xe:H}}else if(Y==="x"&&(ie.includes("left")||ie.includes("right")))if(ie.includes("left")&&ne<0||ie.includes("right")&&ne>0)oe.x=ne;else{const xe=ne*fe(ne);oe.x=Math.abs(xe)<Math.abs(ne)?xe:ne}(Math.abs(oe.x)>0||Math.abs(oe.y)>0)&&Ce(!0),(ye=be.current)==null||ye.style.setProperty("--swipe-amount-x",`${oe.x}px`),(Ne=be.current)==null||Ne.style.setProperty("--swipe-amount-y",`${oe.y}px`)}},Nt&&!l.jsx&&we!=="loading"?G.createElement("button",{"aria-label":g,"data-disabled":De,"data-close-button":!0,onClick:De||!Ae?()=>{}:()=>{Pe(),l.onDismiss==null||l.onDismiss.call(l,l)},className:Le(T==null?void 0:T.closeButton,l==null||(s=l.classNames)==null?void 0:s.closeButton)},(St=B==null?void 0:B.close)!=null?St:Wa):null,(we||l.icon||l.promise)&&l.icon!==null&&((B==null?void 0:B[we])!==null||l.icon)?G.createElement("div",{"data-icon":"",className:Le(T==null?void 0:T.icon,l==null||(n=l.classNames)==null?void 0:n.icon)},l.promise||l.type==="loading"&&!l.icon?l.icon||Ht():null,l.type!=="loading"?Wt:null):null,G.createElement("div",{"data-content":"",className:Le(T==null?void 0:T.content,l==null||(i=l.classNames)==null?void 0:i.content)},G.createElement("div",{"data-title":"",className:Le(T==null?void 0:T.title,l==null||(o=l.classNames)==null?void 0:o.title)},l.jsx?l.jsx:typeof l.title=="function"?l.title():l.title),l.description?G.createElement("div",{"data-description":"",className:Le(j,wt,T==null?void 0:T.description,l==null||(d=l.classNames)==null?void 0:d.description)},typeof l.description=="function"?l.description():l.description):null),G.isValidElement(l.cancel)?l.cancel:l.cancel&&Tt(l.cancel)?G.createElement("button",{"data-button":!0,"data-cancel":!0,style:l.cancelButtonStyle||f,onClick:re=>{Tt(l.cancel)&&Ae&&(l.cancel.onClick==null||l.cancel.onClick.call(l.cancel,re),Pe())},className:Le(T==null?void 0:T.cancelButton,l==null||(p=l.classNames)==null?void 0:p.cancelButton)},l.cancel.label):null,G.isValidElement(l.action)?l.action:l.action&&Tt(l.action)?G.createElement("button",{"data-button":!0,"data-action":!0,style:l.actionButtonStyle||S,onClick:re=>{Tt(l.action)&&(l.action.onClick==null||l.action.onClick.call(l.action,re),!re.defaultPrevented&&Pe())},className:Le(T==null?void 0:T.actionButton,l==null||(m=l.classNames)==null?void 0:m.actionButton)},l.action.label):null)};function _r(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function un(t,a){const r={};return[t,a].forEach((s,n)=>{const i=n===1,o=i?"--mobile-offset":"--offset",d=i?sn:rn;function p(m){["top","right","bottom","left"].forEach(c=>{r[`${o}-${c}`]=typeof m=="number"?`${m}px`:m})}typeof s=="number"||typeof s=="string"?p(s):typeof s=="object"?["top","right","bottom","left"].forEach(m=>{s[m]===void 0?r[`${o}-${m}`]=d:r[`${o}-${m}`]=typeof s[m]=="number"?`${s[m]}px`:s[m]}):p(d)}),r}const Tr=G.forwardRef(function(a,r){const{invert:s,position:n="bottom-right",hotkey:i=["altKey","KeyT"],expand:o,closeButton:d,className:p,offset:m,mobileOffset:c,theme:l="light",richColors:h,duration:v,style:x,visibleToasts:P=tn,toastOptions:E,dir:w=_r(),gap:R=nn,icons:k,containerAriaLabel:M="Notifications"}=a,[$,q]=G.useState([]),C=G.useMemo(()=>Array.from(new Set([n].concat($.filter(A=>A.position).map(A=>A.position)))),[$,n]),[f,S]=G.useState([]),[_,j]=G.useState(!1),[N,y]=G.useState(!1),[F,D]=G.useState(l!=="system"?l:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),T=G.useRef(null),B=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=G.useRef(null),Y=G.useRef(!1),K=G.useCallback(A=>{q(I=>{var b;return(b=I.find(W=>W.id===A.id))!=null&&b.delete||ke.dismiss(A.id),I.filter(({id:W})=>W!==A.id)})},[]);return G.useEffect(()=>ke.subscribe(A=>{if(A.dismiss){requestAnimationFrame(()=>{q(I=>I.map(b=>b.id===A.id?{...b,delete:!0}:b))});return}setTimeout(()=>{la.flushSync(()=>{q(I=>{const b=I.findIndex(W=>W.id===A.id);return b!==-1?[...I.slice(0,b),{...I[b],...A},...I.slice(b+1)]:[A,...I]})})})}),[$]),G.useEffect(()=>{if(l!=="system"){D(l);return}if(l==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?D("dark"):D("light")),typeof window>"u")return;const A=window.matchMedia("(prefers-color-scheme: dark)");try{A.addEventListener("change",({matches:I})=>{D(I?"dark":"light")})}catch{A.addListener(({matches:b})=>{try{D(b?"dark":"light")}catch(W){console.error(W)}})}},[l]),G.useEffect(()=>{$.length<=1&&j(!1)},[$]),G.useEffect(()=>{const A=I=>{var b;if(i.every(O=>I[O]||I.code===O)){var V;j(!0),(V=T.current)==null||V.focus()}I.code==="Escape"&&(document.activeElement===T.current||(b=T.current)!=null&&b.contains(document.activeElement))&&j(!1)};return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[i]),G.useEffect(()=>{if(T.current)return()=>{g.current&&(g.current.focus({preventScroll:!0}),g.current=null,Y.current=!1)}},[T.current]),G.createElement("section",{ref:r,"aria-label":`${M} ${B}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},C.map((A,I)=>{var b;const[W,V]=A.split("-");return $.length?G.createElement("ol",{key:A,dir:w==="auto"?_r():w,tabIndex:-1,ref:T,className:p,"data-sonner-toaster":!0,"data-sonner-theme":F,"data-y-position":W,"data-lifted":_&&$.length>1&&!o,"data-x-position":V,style:{"--front-toast-height":`${((b=f[0])==null?void 0:b.height)||0}px`,"--width":`${an}px`,"--gap":`${R}px`,...x,...un(m,c)},onBlur:O=>{Y.current&&!O.currentTarget.contains(O.relatedTarget)&&(Y.current=!1,g.current&&(g.current.focus({preventScroll:!0}),g.current=null))},onFocus:O=>{O.target instanceof HTMLElement&&O.target.dataset.dismissible==="false"||Y.current||(Y.current=!0,g.current=O.relatedTarget)},onMouseEnter:()=>j(!0),onMouseMove:()=>j(!0),onMouseLeave:()=>{N||j(!1)},onDragEnd:()=>j(!1),onPointerDown:O=>{O.target instanceof HTMLElement&&O.target.dataset.dismissible==="false"||y(!0)},onPointerUp:()=>y(!1)},$.filter(O=>!O.position&&I===0||O.position===A).map((O,Z)=>{var ae,le;return G.createElement(dn,{key:O.id,icons:k,index:Z,toast:O,defaultRichColors:h,duration:(ae=E==null?void 0:E.duration)!=null?ae:v,className:E==null?void 0:E.className,descriptionClassName:E==null?void 0:E.descriptionClassName,invert:s,visibleToasts:P,closeButton:(le=E==null?void 0:E.closeButton)!=null?le:d,interacting:N,position:A,style:E==null?void 0:E.style,unstyled:E==null?void 0:E.unstyled,classNames:E==null?void 0:E.classNames,cancelButtonStyle:E==null?void 0:E.cancelButtonStyle,actionButtonStyle:E==null?void 0:E.actionButtonStyle,closeButtonAriaLabel:E==null?void 0:E.closeButtonAriaLabel,removeToast:K,toasts:$.filter(ue=>ue.position==O.position),heights:f.filter(ue=>ue.position==O.position),setHeights:S,expandByDefault:o,gap:R,expanded:_,swipeDirections:a.swipeDirections})})):null}))}),et=t=>{const a="/Chat-App/",r=a.startsWith("/")?a:`/${a}`,s=r.endsWith("/")?r:`${r}/`,n=t.startsWith("/")?t.substring(1):t;return`${s}${n}`},Ue=[{id:"whistle",name:"Whistle Chime",url:et("sounds/whistle.mp3")},{id:"bell",name:"Success Bell",url:et("sounds/bell.mp3")},{id:"note",name:"Electronic Note",url:et("sounds/note.mp3")},{id:"digital",name:"Digital Alert",url:et("sounds/digital.mp3")}];class mn{async getCameraPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"camera"})).state}catch{return"unknown"}}async requestCameraPermission(){try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(r=>r.stop()),!0}catch(a){return console.error("Camera permission denied",a),!1}}async getMicPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"microphone"})).state}catch{return"unknown"}}async requestMicPermission(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(r=>r.stop()),!0}catch(a){return console.error("Mic permission denied",a),!1}}async getNotificationPermission(){return"Notification"in window?Notification.permission:"denied"}async requestNotificationPermission(a){return"Notification"in window?await Notification.requestPermission()==="granted":(a&&Q.error("Notifications not supported"),!1)}isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}isPWA(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}vibrate(a=200){"vibrate"in navigator&&navigator.vibrate(a)}}const it=new mn;function pn(){const[t,a]=u.useState(null),[r,s]=u.useState(!0),[n,i]=u.useState("login"),o=u.useRef(null),d=u.useRef(!1),p=u.useRef(!1);u.useEffect(()=>{r||(p.current=!0)},[r]);const m=async l=>{var h;if(d.current)return null;if(o.current===l&&t)return s(!1),t;d.current=!0,console.log("ðŸ“¥ Fetching profile for:",l);try{const{data:v,error:x}=await ee.from("profiles").select("*").eq("id",l).single();if(x)return console.error("âŒ Profile fetch error:",x),(x.code==="PGRST116"||(h=x.message)!=null&&h.includes("406"))&&(console.warn("Profile missing for user. Logging out to clear stale session."),await ee.auth.signOut(),a(null),o.current=null),null;console.log("âœ… Profile fetched successfully");const P={id:v.id,username:v.username,name:v.display_name||v.username,avatar_url:v.avatar_url};return o.current=l,(!t||t.id!==P.id||t.username!==P.username||t.name!==P.name||t.avatar_url!==P.avatar_url)&&(console.log("ðŸ‘¤ Updating currentUser state (reference change)"),a(P)),v.display_name||i("signup"),P}finally{d.current=!1,s(!1)}},c=async()=>{await ee.auth.signOut(),a(null),localStorage.removeItem("chat_app_view"),localStorage.removeItem("chat_app_selected_chat")};return u.useEffect(()=>{console.log("ðŸ”Œ useAuth effect started");let l=!0;const h=setTimeout(()=>{l&&!p.current&&(console.warn("âš ï¸ Auth check timed out, forcing load completion"),s(!1))},12e3);console.log("ðŸ” Checking initial session..."),ee.auth.getSession().then(({data:{session:x}})=>{console.log("ðŸ“„ Session result:",x?"Found":"Not Found"),l&&(x?m(x.user.id):s(!1))}).catch(x=>{console.error("âŒ Session check failed:",x),l&&s(!1)});const{data:{subscription:v}}=ee.auth.onAuthStateChange((x,P)=>{console.log("ðŸ”„ Auth state changed:",x),l&&(P?m(P.user.id):(a(null),i("login"),s(!1)))});return()=>{l=!1,clearTimeout(h),v.unsubscribe()}},[]),{currentUser:t,setCurrentUser:a,isLoading:r,setIsLoading:s,loginStep:n,setLoginStep:i,fetchProfile:m,logout:c}}function fn(t){const[a,r]=u.useState([]),[s,n]=u.useState(!1),[i,o]=u.useState(null),[d,p]=u.useState([]),m=u.useRef(null),c=u.useRef(0);u.useEffect(()=>{m.current=i},[i]);const l=u.useCallback(async f=>{if(f){console.log("ðŸ“¨ loadChats started for:",f),n(!0);try{const{data:S,error:_}=await ee.from("conversation_participants").select(`
          conversation_id,
          conversations (
              id,
              last_message_text,
              last_message_at
          )
        `).eq("user_id",f);if(_)throw _;const j=S.map(B=>B.conversation_id);let N=[],y={};if(j.length>0){const{data:B,error:g}=await ee.from("conversation_participants").select(`
            conversation_id,
            user_id,
            profiles (id, display_name, avatar_url)
          `).in("conversation_id",j).neq("user_id",f);if(g)throw g;N=B||[];const{data:Y}=await ee.from("messages").select("conversation_id").eq("is_read",!1).neq("sender_id",f).in("conversation_id",j);Y==null||Y.forEach(K=>{y[K.conversation_id]=(y[K.conversation_id]||0)+1})}const F=S.map(B=>{var K,A;const g=N.find(I=>I.conversation_id===B.conversation_id),Y=g!=null&&g.profiles&&!Array.isArray(g.profiles)?g.profiles.display_name:"Unknown User";return{id:B.conversation_id,partnerId:(g==null?void 0:g.user_id)||"unknown",partnerName:Y,partnerAvatar:g!=null&&g.profiles&&!Array.isArray(g.profiles)?g.profiles.avatar_url:void 0,lastMessage:((K=B.conversations)==null?void 0:K.last_message_text)||"",lastMessageTime:((A=B.conversations)==null?void 0:A.last_message_at)||"",unreadCount:y[B.conversation_id]||0,isGroup:!1}});let D=[];try{const{data:B,error:g}=await ee.from("group_members").select(`
              group_id,
              groups (id, name, updated_at)
            `).eq("user_id",f);if(!g&&B&&B.length>0){const Y=B.map(b=>b.group_id),{data:K}=await ee.from("group_messages").select("group_id").eq("is_read",!1).neq("sender_id",f).in("group_id",Y),A={};K==null||K.forEach(b=>{A[b.group_id]=(A[b.group_id]||0)+1});const{data:I}=await ee.from("group_messages").select("group_id, text, created_at").in("group_id",Y).order("created_at",{ascending:!1});D=B.map(b=>{const W=b.groups,V=I==null?void 0:I.find(O=>O.group_id===W.id);return{id:W.id,partnerId:W.id,partnerName:W.name,partnerAvatar:void 0,lastMessage:(V==null?void 0:V.text)||"No messages yet",lastMessageTime:(V==null?void 0:V.created_at)||W.updated_at,unreadCount:A[W.id]||0,isGroup:!0}})}}catch(B){console.warn("Group fetch error:",B)}const T=[...F,...D].sort((B,g)=>{const Y=new Date(B.lastMessageTime).getTime();return new Date(g.lastMessageTime).getTime()-Y});r(T),c.current=T.reduce((B,g)=>B+g.unreadCount,0)}catch(S){console.error("Error loading chats:",S),S.code==="42P17"&&Q.error("Database Error: Recursive policy detected. Please run the SQL fix.")}finally{n(!1)}}},[]),h=async(f,S,_=!1)=>{_?await ee.from("group_messages").update({is_read:!0}).eq("group_id",f).neq("sender_id",S).eq("is_read",!1):await ee.from("messages").update({is_read:!0}).eq("conversation_id",f).neq("sender_id",S).eq("is_read",!1)},v=u.useCallback(async(f,S=!1)=>{var y,F;if(f!==((y=m.current)==null?void 0:y.id)||!f)return;let _,j;if(S){const D=await ee.from("group_messages").select("*").eq("group_id",f).order("created_at",{ascending:!1}).limit(50);_=D.data?D.data.reverse():[],j=D.error}else{const D=await ee.from("messages").select("*").eq("conversation_id",f).order("created_at",{ascending:!1}).limit(50);_=D.data?D.data.reverse():[],j=D.error}if(j){console.error("Error loading messages:",j);return}if(f!==((F=m.current)==null?void 0:F.id))return;const N=(_||[]).map(D=>({id:D.id,senderId:D.sender_id,text:D.text,fileUrl:D.file_url,fileType:D.file_type,fileName:D.file_name,timestamp:D.created_at,isRead:D.is_read||!1,replyToId:D.reply_to_id,reactions:D.reactions||{},poll:D.poll}));p(D=>{const T=D.filter(Y=>Y.isOptimistic),B=new Set(N.map(Y=>Y.id)),g=T.filter(Y=>!B.has(Y.id));return[...N,...g]}),t&&t.id&&h(f,t.id,S)},[t==null?void 0:t.id]);u.useEffect(()=>{t!=null&&t.id?(console.log("ðŸš€ useChats auto-loading for:",t.id),l(t.id).then(()=>{const f=localStorage.getItem("chat_app_selected_chat");if(f&&!m.current)try{const S=JSON.parse(f);console.log("ðŸ•¯ï¸ Restoring saved chat:",S.id),o(S),v(S.id,S.isGroup)}catch(S){console.error("Failed to parse saved chat",S)}})):(console.log("Emptying chats as no user is present"),r([]))},[t==null?void 0:t.id,l,v]);const x=u.useCallback(f=>{o(f),r(S=>S.map(_=>_.id===f.id?{..._,unreadCount:0}:_)),v(f.id,f.isGroup),localStorage.setItem("chat_app_selected_chat",JSON.stringify(f)),t!=null&&t.id&&h(f.id,t.id,f.isGroup)},[v,t]),P=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){const S=Math.random()*16|0;return(f==="x"?S:S&3|8).toString(16)}),E=u.useCallback(async(f,S)=>{p(_=>_.filter(j=>j.id!==f));try{const _=S?"group_messages":"messages";await ee.from(_).delete().eq("id",f)}catch(_){console.error("Error deleting message:",_)}},[]),w=u.useCallback(async(f,S,_,j,N,y,F)=>{var B,g,Y;if(!t)return;const D=P(),T={id:D,senderId:t.id,text:S,fileUrl:_,fileType:j,fileName:N,timestamp:new Date().toISOString(),isRead:!1,isOptimistic:!0,replyToId:y};((B=m.current)==null?void 0:B.id)===f.id&&p(K=>[...K,T]);try{let K,A;if(f.isGroup){const I=await ee.from("group_messages").insert({id:D,group_id:f.id,sender_id:t.id,text:S,file_url:_,file_type:j,file_name:N,reply_to_id:y}).select().single();K=I.data,A=I.error}else{const I=await ee.from("messages").insert({id:D,conversation_id:f.id,sender_id:t.id,text:S,file_url:_,file_type:j,file_name:N,reply_to_id:y}).select().single();K=I.data,A=I.error}if(A)throw A;K&&(((g=m.current)==null?void 0:g.id)===f.id&&p(I=>I.map(b=>b.id===D?{...b,isOptimistic:!1}:b)),F&&F>0&&setTimeout(()=>E(D,f.isGroup),F*1e3),f.isGroup||await ee.from("conversations").update({last_message_text:S,last_message_at:new Date().toISOString()}).eq("id",f.id))}catch(K){console.error("Error sending message:",K),((Y=m.current)==null?void 0:Y.id)===f.id&&p(A=>A.filter(I=>I.id!==D)),Q.error("Failed to send message")}},[t,E]),R=u.useCallback(async(f,S,_,j,N,y)=>{m.current&&await w(m.current,f,S,_,j,N,y)},[w]),k=async(f,S)=>{if(t){r(_=>_.map(j=>j.id===f?{...j,isPinned:S}:j));try{S?await ee.from("pinned_conversations").insert({user_id:t.id,conversation_id:f}):await ee.from("pinned_conversations").delete().eq("user_id",t.id).eq("conversation_id",f)}catch(_){console.error("Error pinning chat:",_)}}},M=u.useCallback(async(f,S)=>{if(!t||!m.current)return;const _=m.current,j={question:f,options:S,votes:{}},N=_.isGroup?"group_messages":"messages",y=_.isGroup?"group_id":"conversation_id",F={id:Math.random().toString(36).substring(7),senderId:t.id,text:`Poll: ${f}`,timestamp:new Date().toISOString(),isRead:!1,poll:j};p(D=>[...D,F]);try{const{error:D}=await ee.from(N).insert({[y]:_.id,sender_id:t.id,text:`Poll: ${f}`,poll:j});if(D)throw D}catch(D){console.error("Poll error:",D)}},[t]),$=u.useCallback((f,S,_)=>{console.log("ðŸ“© useChats: Incoming message received:",f.id,"for chatId:",_),p(j=>{if(j.find(F=>F.id===f.id))return console.log("â™»ï¸ useChats: Message already exists, skipping."),j;const N=m.current,y=_||(S?f.group_id:f.conversation_id);return console.log("ðŸ§ useChats: Matching...",{msgChatId:y,currentChatId:N==null?void 0:N.id}),t&&f.senderId!==t.id&&N&&y===N.id&&(console.log("ðŸ‘ï¸ useChats: Auto-marking as read"),h(N.id,t.id,S)),N&&y===N.id?(console.log("âœ¨ useChats: Appending message to state"),[...j,f]):(console.log("â­ï¸ useChats: Message not for current chat, ignoring append."),j)})},[t,h]),q=u.useCallback(f=>{p(S=>S.map(_=>_.id===f.id?{..._,...f}:_))},[]),C=u.useCallback((f,S,_,j)=>{r(N=>{var T;const y=N.findIndex(B=>B.id===f);if(y===-1)return N;const F=[...N],D={...F[y]};return D.lastMessage=S,D.lastMessageTime=_,((T=m.current)==null?void 0:T.id)!==f&&(D.unreadCount+=1,c.current+=1),F.splice(y,1),[D,...F]})},[]);return{chats:a,setChats:r,isLoading:s,selectedChat:i,setSelectedChat:o,messages:d,setMessages:p,loadChats:l,loadMessages:v,handleSelectChat:x,selectedChatRef:m,markMessagesAsRead:h,handleSendMessage:R,handleDeleteMessage:E,handlePinChat:k,handleSendPoll:M,handleIncomingMessage:$,handleIncomingUpdate:q,handleLocalChatUpdate:C,sendMessageToChat:w}}function hn({currentUser:t,soundEnabled:a,onlineUsers:r}){const[s,n]=u.useState(null),i=u.useRef(null),o=u.useRef(null),d=u.useRef(null),p=u.useRef(null);u.useEffect(()=>{p.current=s,s&&(s.status==="connected"||s.status==="ended")&&d.current&&(clearTimeout(d.current),d.current=null)},[s]),u.useEffect(()=>(i.current=new Audio(et("sounds/ringtone.mp3")),i.current.loop=!0,i.current.load(),()=>{var w;(w=i.current)==null||w.pause()}),[]);const m=u.useCallback((w,R,k)=>{(o.current||ee.channel("chat-realtime-global")).send({type:"broadcast",event:R,payload:{...k,recipientId:w}})},[]),c=async(w,R,k)=>{if(!t)return;const M=r.has(w),$=Math.random().toString(36).substring(7),q={id:$,callerId:t.id,callerName:t.name||t.username,recipientId:w,type:k,status:"connecting"};if(!M){Q.error(R+" is currently unavailable"),new Audio(et("sounds/unavailable.mp3")).play().catch(()=>{});return}n(q),setTimeout(()=>{n(C=>C&&C.id===$&&C.status==="connecting"?{...C,status:"ringing"}:C)},1500),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{n(C=>C&&C.id===$&&(C.status==="ringing"||C.status==="connecting")?(Q.info("No answer"),h(),null):C)},6e4)},l=async()=>{var w;s&&(n(R=>R?{...R,status:"connecting"}:null),(w=i.current)==null||w.pause())},h=u.useCallback(()=>{var R;const w=p.current;w&&(m(w.callerId,"call-ended",{id:w.id}),n(null),(R=i.current)==null||R.pause(),i.current&&(i.current.currentTime=0))},[m]),v=u.useCallback(w=>{if(w.recipientId===t.id){if(p.current){m(w.callerId,"call-ended",{id:w.id,reason:"busy"});return}a&&i.current&&i.current.play().catch(console.error),n({id:w.id,callerId:w.callerId,callerName:w.callerName,recipientId:w.recipientId,type:w.type,status:"ringing",offer:w.offer,iceCandidates:[]})}},[t==null?void 0:t.id,a,m]),x=u.useCallback(w=>{var R;w.recipientId===t.id&&(n(k=>k&&k.id===w.id?{...k,status:"connected",answer:w.answer}:k),(R=i.current)==null||R.pause())},[t==null?void 0:t.id]),P=u.useCallback(w=>{w.recipientId===t.id&&n(R=>R&&R.id===w.id?{...R,iceCandidates:[...R.iceCandidates||[],w.candidate]}:R)},[t==null?void 0:t.id]),E=u.useCallback(w=>{var R;n(k=>k&&k.id===w.id?(Q.info("Call ended"),null):k),(R=i.current)==null||R.pause(),i.current&&(i.current.currentTime=0)},[]);return{activeCall:s,setActiveCall:n,handleStartCall:c,handleAcceptCall:l,handleRejectCall:h,sendSignalingMessage:m,handleIncomingCall:v,handleCallAnswer:x,handleIceCandidate:P,handleCallEnded:E}}function xn({currentUser:t,selectedChatRef:a,onNewMessage:r,onUpdateMessage:s,onReloadChats:n,soundEnabled:i,onIncomingCall:o,onCallAnswer:d,onIceCandidate:p,onCallEnded:m,onReloadStatuses:c,onReloadRequests:l,onLocalChatUpdate:h}){const[v,x]=u.useState(new Set),[P,E]=u.useState({}),w=u.useRef(null),R=u.useRef(null),k=u.useRef(null),M=u.useRef(r),$=u.useRef(s),q=u.useRef(n),C=u.useRef(o),f=u.useRef(d),S=u.useRef(p),_=u.useRef(m),j=u.useRef(c),N=u.useRef(l),y=u.useRef(h);u.useEffect(()=>{M.current=r,$.current=s,q.current=n,C.current=o,f.current=d,S.current=p,_.current=m,j.current=c,N.current=l,y.current=h},[r,s,n,o,d,p,m,c,l,h]);const[F,D]=u.useState(()=>localStorage.getItem("chat_app_sound_id")||Ue[0].id);u.useEffect(()=>{localStorage.setItem("chat_app_sound_id",F);const A=Ue.find(I=>I.id===F)||Ue[0];w.current=new Audio(A.url),w.current.load(),R.current=new Audio(et("sounds/ringtone.mp3")),R.current.loop=!0,R.current.load()},[F]);const T=()=>{w.current&&i&&(w.current.currentTime=0,w.current.play().catch(A=>console.log("Sound play failed:",A)))};u.useEffect(()=>{if(!t)return;const A="chat-realtime-global";console.log(`ðŸ”Œ Subscribing to GLOBAL channel: ${A}`);const I=ee.channel(A);return k.current=I,I.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},b=>{console.log("ðŸ“¥ [DEBUG] Realtime INSERT (messages):",b.new),B(b.new,!1)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},b=>{console.log("ðŸ“¥ [DEBUG] Realtime INSERT (group_messages):",b.new),B(b.new,!0)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},b=>{g(b.new,!1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages"},b=>{g(b.new,!0)}).on("postgres_changes",{event:"*",schema:"public",table:"conversations"},b=>{console.log("ðŸ”„ Conversation updated, reloading chats..."),q.current()}).on("postgres_changes",{event:"*",schema:"public",table:"group_members"},()=>q.current()).on("postgres_changes",{event:"*",schema:"public",table:"statuses"},b=>{console.log("ðŸ“¸ [DEBUG] Realtime STATUS change:",b.eventType),j.current&&j.current()}).on("postgres_changes",{event:"*",schema:"public",table:"chat_requests"},b=>{console.log("ðŸ“© [DEBUG] Realtime REQUEST change:",b.eventType),N.current&&N.current(),q.current()}).on("presence",{event:"sync"},()=>{const b=I.presenceState(),W=new Set;Object.values(b).forEach(V=>{V.forEach(O=>W.add(O.user_id))}),x(W),console.log("ðŸ‘¥ Online Users updated:",Array.from(W))}).on("broadcast",{event:"typing"},({payload:b})=>{b.partner_id===t.id&&E(W=>({...W,[b.user_id]:b.isTyping}))}).on("broadcast",{event:"call-offer"},({payload:b})=>{b.recipientId===t.id&&C.current&&(i&&R.current&&R.current.play().catch(console.error),C.current(b))}).on("broadcast",{event:"call-answer"},({payload:b})=>{var W;b.recipientId===t.id&&f.current&&(f.current(b),(W=R.current)==null||W.pause())}).on("broadcast",{event:"ice-candidate"},({payload:b})=>{b.recipientId===t.id&&S.current&&S.current(b)}).on("broadcast",{event:"call-ended"},({payload:b})=>{var W;(b.recipientId===t.id||b.callerId===t.id)&&(_.current&&_.current(b),(W=R.current)==null||W.pause(),R.current&&(R.current.currentTime=0))}).subscribe(async b=>{console.log(`ðŸ“¡ Subscription status for ${A}:`,b),b==="SUBSCRIBED"&&await I.track({user_id:t.id,online_at:new Date().toISOString()}),b==="CHANNEL_ERROR"&&(console.error("ðŸš· Realtime subscription error. Retrying in 5s..."),setTimeout(()=>q.current(),5e3))}),()=>{var b;console.log(`ðŸ”Œ Unsubscribing from ${A}`),I.unsubscribe(),(b=R.current)==null||b.pause()}},[t==null?void 0:t.id,i]);const B=(A,I)=>{const b=a.current;console.log("ðŸ“© Raw Realtime Message:",A),console.log("ðŸ’¬ Current Chat in Ref:",b==null?void 0:b.id,"isGroup:",b==null?void 0:b.isGroup);const W={id:A.id,senderId:A.sender_id,text:A.text,fileUrl:A.file_url,fileType:A.file_type,fileName:A.file_name,timestamp:A.created_at,isRead:A.is_read||!1,replyToId:A.reply_to_id,reactions:A.reactions||{},poll:A.poll},V=A.group_id||A.conversation_id,O=!!b&&b.id===V;console.log(`ðŸ” Comparison Result: ${O?"âœ… MATCH":"âŒ NO MATCH"} (MsgChat: ${V} vs Current: ${b==null?void 0:b.id})`),O?(console.log("âœ… [MATCH] Updating UI for current chat:",V),M.current(W,I,V)):console.log("âŒ [MISMATCH] Message for chat:",V,"Current:",b==null?void 0:b.id),A.sender_id!==(t==null?void 0:t.id)&&T(),q.current()},g=(A,I)=>{console.log("ðŸ”„ [DEBUG] Realtime UPDATE received:",A),$.current({id:A.id,senderId:A.sender_id,text:A.text,fileUrl:A.file_url,fileType:A.file_type,fileName:A.file_name,timestamp:A.created_at,isRead:A.is_read,replyToId:A.reply_to_id,reactions:A.reactions||{},poll:A.poll},I),q.current()};return{onlineUsers:v,typingUsers:P,sendTypingIndicator:(A,I)=>{var b;(b=k.current)==null||b.send({type:"broadcast",event:"typing",payload:{user_id:t==null?void 0:t.id,partner_id:I,isTyping:A}})},sendSignalingMessage:(A,I,b)=>{k.current&&k.current.send({type:"broadcast",event:I,payload:{...b,recipientId:A}})},notificationSounds:Ue,currentSoundId:F,setCurrentSoundId:D,ringtoneSoundRef:R}}function ns(t){var a,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(r=ns(t[a]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function hr(){for(var t,a,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(a=ns(t))&&(s&&(s+=" "),s+=a);return s}const Rr=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Pr=hr,gn=(t,a)=>r=>{var s;if((a==null?void 0:a.variants)==null)return Pr(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:n,defaultVariants:i}=a,o=Object.keys(n).map(m=>{const c=r==null?void 0:r[m],l=i==null?void 0:i[m];if(c===null)return null;const h=Rr(c)||Rr(l);return n[m][h]}),d=r&&Object.entries(r).reduce((m,c)=>{let[l,h]=c;return h===void 0||(m[l]=h),m},{}),p=a==null||(s=a.compoundVariants)===null||s===void 0?void 0:s.reduce((m,c)=>{let{class:l,className:h,...v}=c;return Object.entries(v).every(x=>{let[P,E]=x;return Array.isArray(E)?E.includes({...i,...d}[P]):{...i,...d}[P]===E})?[...m,l,h]:m},[]);return Pr(t,o,p,r==null?void 0:r.class,r==null?void 0:r.className)},xr="-",bn=t=>{const a=yn(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:o=>{const d=o.split(xr);return d[0]===""&&d.length!==1&&d.shift(),is(d,a)||vn(o)},getConflictingClassGroupIds:(o,d)=>{const p=r[o]||[];return d&&s[o]?[...p,...s[o]]:p}}},is=(t,a)=>{var o;if(t.length===0)return a.classGroupId;const r=t[0],s=a.nextPart.get(r),n=s?is(t.slice(1),s):void 0;if(n)return n;if(a.validators.length===0)return;const i=t.join(xr);return(o=a.validators.find(({validator:d})=>d(i)))==null?void 0:o.classGroupId},Er=/^\[(.+)\]$/,vn=t=>{if(Er.test(t)){const a=Er.exec(t)[1],r=a==null?void 0:a.substring(0,a.indexOf(":"));if(r)return"arbitrary.."+r}},yn=t=>{const{theme:a,classGroups:r}=t,s={nextPart:new Map,validators:[]};for(const n in r)er(r[n],s,n,a);return s},er=(t,a,r,s)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?a:Ir(a,n);i.classGroupId=r;return}if(typeof n=="function"){if(jn(n)){er(n(s),a,r,s);return}a.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{er(o,Ir(a,i),r,s)})})},Ir=(t,a)=>{let r=t;return a.split(xr).forEach(s=>{r.nextPart.has(s)||r.nextPart.set(s,{nextPart:new Map,validators:[]}),r=r.nextPart.get(s)}),r},jn=t=>t.isThemeGetter,wn=t=>{if(t<1)return{get:()=>{},set:()=>{}};let a=0,r=new Map,s=new Map;const n=(i,o)=>{r.set(i,o),a++,a>t&&(a=0,s=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=s.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},tr="!",rr=":",Nn=rr.length,Cn=t=>{const{prefix:a,experimentalParseClassName:r}=t;let s=n=>{const i=[];let o=0,d=0,p=0,m;for(let x=0;x<n.length;x++){let P=n[x];if(o===0&&d===0){if(P===rr){i.push(n.slice(p,x)),p=x+Nn;continue}if(P==="/"){m=x;continue}}P==="["?o++:P==="]"?o--:P==="("?d++:P===")"&&d--}const c=i.length===0?n:n.substring(p),l=Sn(c),h=l!==c,v=m&&m>p?m-p:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:l,maybePostfixModifierPosition:v}};if(a){const n=a+rr,i=s;s=o=>o.startsWith(n)?i(o.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(r){const n=s;s=i=>r({className:i,parseClassName:n})}return s},Sn=t=>t.endsWith(tr)?t.substring(0,t.length-1):t.startsWith(tr)?t.substring(1):t,kn=t=>{const a=Object.fromEntries(t.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const n=[];let i=[];return s.forEach(o=>{o[0]==="["||a[o]?(n.push(...i.sort(),o),i=[]):i.push(o)}),n.push(...i.sort()),n}},_n=t=>({cache:wn(t.cacheSize),parseClassName:Cn(t),sortModifiers:kn(t),...bn(t)}),Tn=/\s+/,Rn=(t,a)=>{const{parseClassName:r,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:i}=a,o=[],d=t.trim().split(Tn);let p="";for(let m=d.length-1;m>=0;m-=1){const c=d[m],{isExternal:l,modifiers:h,hasImportantModifier:v,baseClassName:x,maybePostfixModifierPosition:P}=r(c);if(l){p=c+(p.length>0?" "+p:p);continue}let E=!!P,w=s(E?x.substring(0,P):x);if(!w){if(!E){p=c+(p.length>0?" "+p:p);continue}if(w=s(x),!w){p=c+(p.length>0?" "+p:p);continue}E=!1}const R=i(h).join(":"),k=v?R+tr:R,M=k+w;if(o.includes(M))continue;o.push(M);const $=n(w,E);for(let q=0;q<$.length;++q){const C=$[q];o.push(k+C)}p=c+(p.length>0?" "+p:p)}return p};function Pn(){let t=0,a,r,s="";for(;t<arguments.length;)(a=arguments[t++])&&(r=os(a))&&(s&&(s+=" "),s+=r);return s}const os=t=>{if(typeof t=="string")return t;let a,r="";for(let s=0;s<t.length;s++)t[s]&&(a=os(t[s]))&&(r&&(r+=" "),r+=a);return r};function En(t,...a){let r,s,n,i=o;function o(p){const m=a.reduce((c,l)=>l(c),t());return r=_n(m),s=r.cache.get,n=r.cache.set,i=d,d(p)}function d(p){const m=s(p);if(m)return m;const c=Rn(p,r);return n(p,c),c}return function(){return i(Pn.apply(null,arguments))}}const ge=t=>{const a=r=>r[t]||[];return a.isThemeGetter=!0,a},ls=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,cs=/^\((?:(\w[\w-]*):)?(.+)\)$/i,In=/^\d+\/\d+$/,Mn=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,An=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Dn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ln=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,On=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,at=t=>In.test(t),se=t=>!!t&&!Number.isNaN(Number(t)),Ve=t=>!!t&&Number.isInteger(Number(t)),Jt=t=>t.endsWith("%")&&se(t.slice(0,-1)),ze=t=>Mn.test(t),zn=()=>!0,Fn=t=>An.test(t)&&!Dn.test(t),ds=()=>!1,$n=t=>Ln.test(t),Gn=t=>On.test(t),Bn=t=>!J(t)&&!X(t),qn=t=>lt(t,ps,ds),J=t=>ls.test(t),Ze=t=>lt(t,fs,Fn),Xt=t=>lt(t,Yn,se),Mr=t=>lt(t,us,ds),Vn=t=>lt(t,ms,Gn),Rt=t=>lt(t,hs,$n),X=t=>cs.test(t),ht=t=>ct(t,fs),Un=t=>ct(t,Jn),Ar=t=>ct(t,us),Hn=t=>ct(t,ps),Wn=t=>ct(t,ms),Pt=t=>ct(t,hs,!0),lt=(t,a,r)=>{const s=ls.exec(t);return s?s[1]?a(s[1]):r(s[2]):!1},ct=(t,a,r=!1)=>{const s=cs.exec(t);return s?s[1]?a(s[1]):r:!1},us=t=>t==="position"||t==="percentage",ms=t=>t==="image"||t==="url",ps=t=>t==="length"||t==="size"||t==="bg-size",fs=t=>t==="length",Yn=t=>t==="number",Jn=t=>t==="family-name",hs=t=>t==="shadow",Xn=()=>{const t=ge("color"),a=ge("font"),r=ge("text"),s=ge("font-weight"),n=ge("tracking"),i=ge("leading"),o=ge("breakpoint"),d=ge("container"),p=ge("spacing"),m=ge("radius"),c=ge("shadow"),l=ge("inset-shadow"),h=ge("text-shadow"),v=ge("drop-shadow"),x=ge("blur"),P=ge("perspective"),E=ge("aspect"),w=ge("ease"),R=ge("animate"),k=()=>["auto","avoid","all","avoid-page","page","left","right","column"],M=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],$=()=>[...M(),X,J],q=()=>["auto","hidden","clip","visible","scroll"],C=()=>["auto","contain","none"],f=()=>[X,J,p],S=()=>[at,"full","auto",...f()],_=()=>[Ve,"none","subgrid",X,J],j=()=>["auto",{span:["full",Ve,X,J]},Ve,X,J],N=()=>[Ve,"auto",X,J],y=()=>["auto","min","max","fr",X,J],F=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],D=()=>["start","end","center","stretch","center-safe","end-safe"],T=()=>["auto",...f()],B=()=>[at,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...f()],g=()=>[t,X,J],Y=()=>[...M(),Ar,Mr,{position:[X,J]}],K=()=>["no-repeat",{repeat:["","x","y","space","round"]}],A=()=>["auto","cover","contain",Hn,qn,{size:[X,J]}],I=()=>[Jt,ht,Ze],b=()=>["","none","full",m,X,J],W=()=>["",se,ht,Ze],V=()=>["solid","dashed","dotted","double"],O=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Z=()=>[se,Jt,Ar,Mr],ae=()=>["","none",x,X,J],le=()=>["none",se,X,J],ue=()=>["none",se,X,J],Ie=()=>[se,X,J],Ce=()=>[at,"full",...f()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[ze],breakpoint:[ze],color:[zn],container:[ze],"drop-shadow":[ze],ease:["in","out","in-out"],font:[Bn],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[ze],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[ze],shadow:[ze],spacing:["px",se],text:[ze],"text-shadow":[ze],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",at,J,X,E]}],container:["container"],columns:[{columns:[se,J,X,d]}],"break-after":[{"break-after":k()}],"break-before":[{"break-before":k()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:$()}],overflow:[{overflow:q()}],"overflow-x":[{"overflow-x":q()}],"overflow-y":[{"overflow-y":q()}],overscroll:[{overscroll:C()}],"overscroll-x":[{"overscroll-x":C()}],"overscroll-y":[{"overscroll-y":C()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:S()}],"inset-x":[{"inset-x":S()}],"inset-y":[{"inset-y":S()}],start:[{start:S()}],end:[{end:S()}],top:[{top:S()}],right:[{right:S()}],bottom:[{bottom:S()}],left:[{left:S()}],visibility:["visible","invisible","collapse"],z:[{z:[Ve,"auto",X,J]}],basis:[{basis:[at,"full","auto",d,...f()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[se,at,"auto","initial","none",J]}],grow:[{grow:["",se,X,J]}],shrink:[{shrink:["",se,X,J]}],order:[{order:[Ve,"first","last","none",X,J]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:j()}],"col-start":[{"col-start":N()}],"col-end":[{"col-end":N()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:j()}],"row-start":[{"row-start":N()}],"row-end":[{"row-end":N()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":y()}],"auto-rows":[{"auto-rows":y()}],gap:[{gap:f()}],"gap-x":[{"gap-x":f()}],"gap-y":[{"gap-y":f()}],"justify-content":[{justify:[...F(),"normal"]}],"justify-items":[{"justify-items":[...D(),"normal"]}],"justify-self":[{"justify-self":["auto",...D()]}],"align-content":[{content:["normal",...F()]}],"align-items":[{items:[...D(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...D(),{baseline:["","last"]}]}],"place-content":[{"place-content":F()}],"place-items":[{"place-items":[...D(),"baseline"]}],"place-self":[{"place-self":["auto",...D()]}],p:[{p:f()}],px:[{px:f()}],py:[{py:f()}],ps:[{ps:f()}],pe:[{pe:f()}],pt:[{pt:f()}],pr:[{pr:f()}],pb:[{pb:f()}],pl:[{pl:f()}],m:[{m:T()}],mx:[{mx:T()}],my:[{my:T()}],ms:[{ms:T()}],me:[{me:T()}],mt:[{mt:T()}],mr:[{mr:T()}],mb:[{mb:T()}],ml:[{ml:T()}],"space-x":[{"space-x":f()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":f()}],"space-y-reverse":["space-y-reverse"],size:[{size:B()}],w:[{w:[d,"screen",...B()]}],"min-w":[{"min-w":[d,"screen","none",...B()]}],"max-w":[{"max-w":[d,"screen","none","prose",{screen:[o]},...B()]}],h:[{h:["screen",...B()]}],"min-h":[{"min-h":["screen","none",...B()]}],"max-h":[{"max-h":["screen",...B()]}],"font-size":[{text:["base",r,ht,Ze]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,X,Xt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Jt,J]}],"font-family":[{font:[Un,J,a]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,X,J]}],"line-clamp":[{"line-clamp":[se,"none",X,Xt]}],leading:[{leading:[i,...f()]}],"list-image":[{"list-image":["none",X,J]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",X,J]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:g()}],"text-color":[{text:g()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:[se,"from-font","auto",X,Ze]}],"text-decoration-color":[{decoration:g()}],"underline-offset":[{"underline-offset":[se,"auto",X,J]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:f()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",X,J]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",X,J]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Y()}],"bg-repeat":[{bg:K()}],"bg-size":[{bg:A()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ve,X,J],radial:["",X,J],conic:[Ve,X,J]},Wn,Vn]}],"bg-color":[{bg:g()}],"gradient-from-pos":[{from:I()}],"gradient-via-pos":[{via:I()}],"gradient-to-pos":[{to:I()}],"gradient-from":[{from:g()}],"gradient-via":[{via:g()}],"gradient-to":[{to:g()}],rounded:[{rounded:b()}],"rounded-s":[{"rounded-s":b()}],"rounded-e":[{"rounded-e":b()}],"rounded-t":[{"rounded-t":b()}],"rounded-r":[{"rounded-r":b()}],"rounded-b":[{"rounded-b":b()}],"rounded-l":[{"rounded-l":b()}],"rounded-ss":[{"rounded-ss":b()}],"rounded-se":[{"rounded-se":b()}],"rounded-ee":[{"rounded-ee":b()}],"rounded-es":[{"rounded-es":b()}],"rounded-tl":[{"rounded-tl":b()}],"rounded-tr":[{"rounded-tr":b()}],"rounded-br":[{"rounded-br":b()}],"rounded-bl":[{"rounded-bl":b()}],"border-w":[{border:W()}],"border-w-x":[{"border-x":W()}],"border-w-y":[{"border-y":W()}],"border-w-s":[{"border-s":W()}],"border-w-e":[{"border-e":W()}],"border-w-t":[{"border-t":W()}],"border-w-r":[{"border-r":W()}],"border-w-b":[{"border-b":W()}],"border-w-l":[{"border-l":W()}],"divide-x":[{"divide-x":W()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":W()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...V(),"hidden","none"]}],"divide-style":[{divide:[...V(),"hidden","none"]}],"border-color":[{border:g()}],"border-color-x":[{"border-x":g()}],"border-color-y":[{"border-y":g()}],"border-color-s":[{"border-s":g()}],"border-color-e":[{"border-e":g()}],"border-color-t":[{"border-t":g()}],"border-color-r":[{"border-r":g()}],"border-color-b":[{"border-b":g()}],"border-color-l":[{"border-l":g()}],"divide-color":[{divide:g()}],"outline-style":[{outline:[...V(),"none","hidden"]}],"outline-offset":[{"outline-offset":[se,X,J]}],"outline-w":[{outline:["",se,ht,Ze]}],"outline-color":[{outline:g()}],shadow:[{shadow:["","none",c,Pt,Rt]}],"shadow-color":[{shadow:g()}],"inset-shadow":[{"inset-shadow":["none",l,Pt,Rt]}],"inset-shadow-color":[{"inset-shadow":g()}],"ring-w":[{ring:W()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:g()}],"ring-offset-w":[{"ring-offset":[se,Ze]}],"ring-offset-color":[{"ring-offset":g()}],"inset-ring-w":[{"inset-ring":W()}],"inset-ring-color":[{"inset-ring":g()}],"text-shadow":[{"text-shadow":["none",h,Pt,Rt]}],"text-shadow-color":[{"text-shadow":g()}],opacity:[{opacity:[se,X,J]}],"mix-blend":[{"mix-blend":[...O(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":O()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[se]}],"mask-image-linear-from-pos":[{"mask-linear-from":Z()}],"mask-image-linear-to-pos":[{"mask-linear-to":Z()}],"mask-image-linear-from-color":[{"mask-linear-from":g()}],"mask-image-linear-to-color":[{"mask-linear-to":g()}],"mask-image-t-from-pos":[{"mask-t-from":Z()}],"mask-image-t-to-pos":[{"mask-t-to":Z()}],"mask-image-t-from-color":[{"mask-t-from":g()}],"mask-image-t-to-color":[{"mask-t-to":g()}],"mask-image-r-from-pos":[{"mask-r-from":Z()}],"mask-image-r-to-pos":[{"mask-r-to":Z()}],"mask-image-r-from-color":[{"mask-r-from":g()}],"mask-image-r-to-color":[{"mask-r-to":g()}],"mask-image-b-from-pos":[{"mask-b-from":Z()}],"mask-image-b-to-pos":[{"mask-b-to":Z()}],"mask-image-b-from-color":[{"mask-b-from":g()}],"mask-image-b-to-color":[{"mask-b-to":g()}],"mask-image-l-from-pos":[{"mask-l-from":Z()}],"mask-image-l-to-pos":[{"mask-l-to":Z()}],"mask-image-l-from-color":[{"mask-l-from":g()}],"mask-image-l-to-color":[{"mask-l-to":g()}],"mask-image-x-from-pos":[{"mask-x-from":Z()}],"mask-image-x-to-pos":[{"mask-x-to":Z()}],"mask-image-x-from-color":[{"mask-x-from":g()}],"mask-image-x-to-color":[{"mask-x-to":g()}],"mask-image-y-from-pos":[{"mask-y-from":Z()}],"mask-image-y-to-pos":[{"mask-y-to":Z()}],"mask-image-y-from-color":[{"mask-y-from":g()}],"mask-image-y-to-color":[{"mask-y-to":g()}],"mask-image-radial":[{"mask-radial":[X,J]}],"mask-image-radial-from-pos":[{"mask-radial-from":Z()}],"mask-image-radial-to-pos":[{"mask-radial-to":Z()}],"mask-image-radial-from-color":[{"mask-radial-from":g()}],"mask-image-radial-to-color":[{"mask-radial-to":g()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":M()}],"mask-image-conic-pos":[{"mask-conic":[se]}],"mask-image-conic-from-pos":[{"mask-conic-from":Z()}],"mask-image-conic-to-pos":[{"mask-conic-to":Z()}],"mask-image-conic-from-color":[{"mask-conic-from":g()}],"mask-image-conic-to-color":[{"mask-conic-to":g()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Y()}],"mask-repeat":[{mask:K()}],"mask-size":[{mask:A()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",X,J]}],filter:[{filter:["","none",X,J]}],blur:[{blur:ae()}],brightness:[{brightness:[se,X,J]}],contrast:[{contrast:[se,X,J]}],"drop-shadow":[{"drop-shadow":["","none",v,Pt,Rt]}],"drop-shadow-color":[{"drop-shadow":g()}],grayscale:[{grayscale:["",se,X,J]}],"hue-rotate":[{"hue-rotate":[se,X,J]}],invert:[{invert:["",se,X,J]}],saturate:[{saturate:[se,X,J]}],sepia:[{sepia:["",se,X,J]}],"backdrop-filter":[{"backdrop-filter":["","none",X,J]}],"backdrop-blur":[{"backdrop-blur":ae()}],"backdrop-brightness":[{"backdrop-brightness":[se,X,J]}],"backdrop-contrast":[{"backdrop-contrast":[se,X,J]}],"backdrop-grayscale":[{"backdrop-grayscale":["",se,X,J]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[se,X,J]}],"backdrop-invert":[{"backdrop-invert":["",se,X,J]}],"backdrop-opacity":[{"backdrop-opacity":[se,X,J]}],"backdrop-saturate":[{"backdrop-saturate":[se,X,J]}],"backdrop-sepia":[{"backdrop-sepia":["",se,X,J]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":f()}],"border-spacing-x":[{"border-spacing-x":f()}],"border-spacing-y":[{"border-spacing-y":f()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",X,J]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[se,"initial",X,J]}],ease:[{ease:["linear","initial",w,X,J]}],delay:[{delay:[se,X,J]}],animate:[{animate:["none",R,X,J]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[P,X,J]}],"perspective-origin":[{"perspective-origin":$()}],rotate:[{rotate:le()}],"rotate-x":[{"rotate-x":le()}],"rotate-y":[{"rotate-y":le()}],"rotate-z":[{"rotate-z":le()}],scale:[{scale:ue()}],"scale-x":[{"scale-x":ue()}],"scale-y":[{"scale-y":ue()}],"scale-z":[{"scale-z":ue()}],"scale-3d":["scale-3d"],skew:[{skew:Ie()}],"skew-x":[{"skew-x":Ie()}],"skew-y":[{"skew-y":Ie()}],transform:[{transform:[X,J,"","none","gpu","cpu"]}],"transform-origin":[{origin:$()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ce()}],"translate-x":[{"translate-x":Ce()}],"translate-y":[{"translate-y":Ce()}],"translate-z":[{"translate-z":Ce()}],"translate-none":["translate-none"],accent:[{accent:g()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:g()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",X,J]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":f()}],"scroll-mx":[{"scroll-mx":f()}],"scroll-my":[{"scroll-my":f()}],"scroll-ms":[{"scroll-ms":f()}],"scroll-me":[{"scroll-me":f()}],"scroll-mt":[{"scroll-mt":f()}],"scroll-mr":[{"scroll-mr":f()}],"scroll-mb":[{"scroll-mb":f()}],"scroll-ml":[{"scroll-ml":f()}],"scroll-p":[{"scroll-p":f()}],"scroll-px":[{"scroll-px":f()}],"scroll-py":[{"scroll-py":f()}],"scroll-ps":[{"scroll-ps":f()}],"scroll-pe":[{"scroll-pe":f()}],"scroll-pt":[{"scroll-pt":f()}],"scroll-pr":[{"scroll-pr":f()}],"scroll-pb":[{"scroll-pb":f()}],"scroll-pl":[{"scroll-pl":f()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",X,J]}],fill:[{fill:["none",...g()]}],"stroke-w":[{stroke:[se,ht,Ze,Xt]}],stroke:[{stroke:["none",...g()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},xs=En(Xn);function yt(...t){return xs(hr(t))}const Kn=gn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function pe({className:t,variant:a,size:r,asChild:s=!1,...n}){const i=s?ca:"button";return e.jsx(i,{"data-slot":"button",className:yt(Kn({variant:a,size:r,className:t})),...n})}const Te=u.forwardRef(({className:t,type:a,...r},s)=>e.jsx("input",{ref:s,type:a,"data-slot":"input",className:yt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r}));Te.displayName="Input";function Qn({onLoginSuccess:t,initialStep:a="login",onNavigateToRegister:r,language:s,t:n}){const[i,o]=u.useState(""),[d,p]=u.useState(""),[m,c]=u.useState(""),[l,h]=u.useState(a==="signup"),[v,x]=u.useState(!1),[P,E]=u.useState(null),w=jr(0),R=jr(0),k=wr(w,{stiffness:500,damping:50}),M=wr(R,{stiffness:500,damping:50});function $({currentTarget:_,clientX:j,clientY:N}){const{left:y,top:F,width:D,height:T}=_.getBoundingClientRect();w.set((j-y)/D-.5),R.set((N-F)/T-.5)}const q=Nr(M,[-.5,.5],[10,-10]),C=Nr(k,[-.5,.5],[-10,10]);u.useEffect(()=>{const _=localStorage.getItem("chat_app_username"),j=localStorage.getItem("chat_app_pin");_&&j&&(o(_),p(j))},[]);const f=_=>`${_.trim().toLowerCase().replace(/\s+/g,"_")}@app.local`,S=async _=>{if(_.preventDefault(),!(!i.trim()||!d.trim())&&!(l&&!m.trim())){x(!0),E(null);try{const j=f(i);if(await new Promise(N=>setTimeout(N,800)),l){const{error:N}=await ee.auth.signUp({email:j,password:d,options:{data:{username:i.trim().toLowerCase(),display_name:m.trim(),pin:d}}});if(N)throw N}else{let{error:N}=await ee.auth.signInWithPassword({email:j,password:d});if(N){const y=`${i.trim().toLowerCase().replace(/\s+/g,"_")}@chatapp.local`,{error:F}=await ee.auth.signInWithPassword({email:y,password:d});if(F)throw new Error(s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø±Ù…Ø² PIN ØºÙŠØ± ØµØ­ÙŠØ­":"Invalid username or PIN");N=null}localStorage.setItem("chat_app_username",i.trim()),localStorage.setItem("chat_app_pin",d)}t()}catch(j){E(j.message)}finally{x(!1)}}};return e.jsxs("div",{className:"h-screen w-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center relative group",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(z.div,{animate:{x:[0,30,0],y:[0,-50,0],scale:[1,1.1,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"},className:"absolute -top-[10%] -left-[5%] w-[60vw] h-[60vw] bg-indigo-600/15 rounded-full blur-[120px] mix-blend-screen"}),e.jsx(z.div,{animate:{x:[0,-30,0],y:[0,50,0],scale:[1,1.2,1]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute top-[30%] -right-[5%] w-[50vw] h-[50vw] bg-violet-600/15 rounded-full blur-[100px] mix-blend-screen"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 pointer-events-none mix-blend-multiply"})]}),e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:Array.from({length:20}).map((_,j)=>e.jsx(z.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1,0],x:["0%",`${Math.random()*100}%`],y:["0%",`${Math.random()*100}%`]},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"linear"},className:"absolute w-1 h-1 bg-indigo-400 rounded-full blur-[1px]",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},j))}),e.jsxs(z.div,{onMouseMove:$,style:{rotateX:q,rotateY:C,transformStyle:"preserve-3d"},initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},transition:{duration:.8,ease:[.16,1,.3,1]},className:"w-full max-w-md relative perspective-1000 z-10 mx-4",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-[2.5rem] blur-2xl opacity-50 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"}),e.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900/40 border border-white/10 shadow-[0_0_50px_-12px_rgba(0,0,0,0.5)] rounded-[2rem] p-8 overflow-hidden transform-gpu ring-1 ring-white/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-indigo-500/5 via-transparent to-violet-500/5 pointer-events-none"}),e.jsx("div",{className:"absolute -top-[150%] -left-[50%] w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none animate-[shimmer_10s_infinite_linear]"}),e.jsxs("div",{className:"flex flex-col items-center mb-10 relative z-10",children:[e.jsxs(z.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,type:"spring"},className:"relative group/logo",children:[e.jsxs("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/40 mb-5 transform rotate-3 hover:rotate-0 transition-all duration-500",children:[e.jsx(dr,{className:"w-10 h-10 text-white fill-white/10"}),e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-2xl opacity-0 group-hover/logo:opacity-100 transition-opacity"})]}),e.jsx(z.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:3},className:"absolute -top-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900 shadow-[0_0_15px_rgba(52,211,153,0.8)]"})]}),e.jsx(z.h1,{initial:{opacity:0,filter:"blur(10px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{delay:.5},className:`text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400 font-outfit ${s==="ar"?"font-arabic":""}`,children:l?s==="ar"?"Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§":"Join the Flow":s==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ":"Welcome"}),e.jsx(z.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:`text-slate-400 text-sm mt-3 font-medium text-center max-w-[250px] ${s==="ar"?"font-arabic":""}`,children:l?s==="ar"?"Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø¢Ù†":"Establish your decentralized identity":s==="ar"?"ÙˆØµÙˆÙ„ Ø¢Ù…Ù† Ù„Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©":"Secure access to your private conversations"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-5 relative z-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors animate-pulse-slow`,children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx(Te,{type:"text",value:i,onChange:_=>o(_.target.value),placeholder:s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"Username",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${s==="ar"?"font-arabic text-right":""}`,disabled:v})]}),e.jsx(je,{mode:"popLayout",children:l&&e.jsxs(z.div,{initial:{opacity:0,height:0,y:-20},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-20},className:"group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(tt,{className:"w-5 h-5"})}),e.jsx(Te,{type:"text",value:m,onChange:_=>c(_.target.value),placeholder:s==="ar"?"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±":"Display Name",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${s==="ar"?"font-arabic text-right":""}`,disabled:v})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(Vr,{className:"w-5 h-5"})}),e.jsx(Te,{type:"password",inputMode:"numeric",className:"pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 tracking-[0.5em] font-mono text-xl",maxLength:6,placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:d,onChange:_=>p(_.target.value),disabled:v})]})]}),e.jsx(je,{children:P&&e.jsxs(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 flex items-center gap-3 backdrop-blur-md",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)] ${s==="ar"?"ml-3":""}`}),e.jsx("span",{className:`text-red-400 text-sm font-medium leading-tight ${s==="ar"?"font-arabic":""}`,children:P})]})}),e.jsx(z.div,{initial:!1,animate:v?{scale:.98}:{scale:1},children:e.jsxs(pe,{type:"submit",disabled:v,className:"w-full h-14 bg-gradient-to-r from-indigo-600 via-indigo-500 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold text-lg rounded-2xl shadow-2xl shadow-indigo-600/30 border-0 relative overflow-hidden group/btn",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 -translate-x-full group-hover/btn:translate-x-0 transition-transform duration-500"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:v?e.jsx(_e,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[l?s==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ":"Sign Up Free":s==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"Authenticate",e.jsx(da,{className:`w-5 h-5 group-hover/btn:translate-x-2 transition-transform duration-300 ${s==="ar"?"rotate-180 group-hover/btn:-translate-x-2":""}`})]})})]})}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{type:"button",onClick:()=>{h(!l),E(null)},className:"text-slate-400 hover:text-white text-sm transition-all duration-300 group/link",children:l?e.jsxs("span",{className:s==="ar"?"font-arabic":"",children:[s==="ar"?"Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ":"Existing user? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:s==="ar"?"Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ":"Log in"})]}):e.jsxs("span",{className:s==="ar"?"font-arabic":"",children:[s==="ar"?"Ù‡ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ ":"New identity? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:s==="ar"?"Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†":"Sign up"})]})})})]})]}),e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-8 flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-slate-700",children:[e.jsx("div",{className:"h-px w-8 bg-current"}),e.jsx("p",{className:`text-[10px] uppercase tracking-[0.3em] font-black ${s==="ar"?"font-arabic":""}`,children:s==="ar"?"Ù‚Ù†Ø§Ø© Ù…Ø´ÙØ±Ø©":"Encrypted Channel"}),e.jsx("div",{className:"h-px w-8 bg-current"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3].map(_=>e.jsx("div",{className:"w-1 h-1 bg-slate-800 rounded-full"},_))})]})]})]})}var gr="Avatar",[Zn]=ua(gr),[ei,gs]=Zn(gr),bs=u.forwardRef((t,a)=>{const{__scopeAvatar:r,...s}=t,[n,i]=u.useState("idle");return e.jsx(ei,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(ur.span,{...s,ref:a})})});bs.displayName=gr;var vs="AvatarImage",ys=u.forwardRef((t,a)=>{const{__scopeAvatar:r,src:s,onLoadingStatusChange:n=()=>{},...i}=t,o=gs(vs,r),d=ti(s,i.referrerPolicy),p=ma(m=>{n(m),o.onImageLoadingStatusChange(m)});return Ur(()=>{d!=="idle"&&p(d)},[d,p]),d==="loaded"?e.jsx(ur.img,{...i,ref:a,src:s}):null});ys.displayName=vs;var js="AvatarFallback",ws=u.forwardRef((t,a)=>{const{__scopeAvatar:r,delayMs:s,...n}=t,i=gs(js,r),[o,d]=u.useState(s===void 0);return u.useEffect(()=>{if(s!==void 0){const p=window.setTimeout(()=>d(!0),s);return()=>window.clearTimeout(p)}},[s]),o&&i.imageLoadingStatus!=="loaded"?e.jsx(ur.span,{...n,ref:a}):null});ws.displayName=js;function ti(t,a){const[r,s]=u.useState("idle");return Ur(()=>{if(!t){s("error");return}let n=!0;const i=new window.Image,o=d=>()=>{n&&s(d)};return s("loading"),i.onload=o("loaded"),i.onerror=o("error"),i.src=t,a&&(i.referrerPolicy=a),()=>{n=!1}},[t,a]),r}var ri=bs,si=ys,ai=ws;function $e({className:t,...a}){return e.jsx(ri,{"data-slot":"avatar",className:yt("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...a})}function Je({className:t,...a}){return e.jsx(si,{"data-slot":"avatar-image",className:yt("aspect-square size-full",t),...a})}function Ge({className:t,...a}){return e.jsx(ai,{"data-slot":"avatar-fallback",className:yt("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}function te(...t){return xs(hr(t))}function Dr({user:t,hasStatus:a,isAllSeen:r,statusCount:s,onClick:n,size:i="md"}){const o={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20"}[i];return e.jsxs("div",{className:te("relative flex-shrink-0 cursor-pointer transition-transform active:scale-95",o),onClick:n,children:[a&&e.jsx("svg",{className:"absolute inset-0 w-full h-full -rotate-90 pointer-events-none p-[1px]",children:s===1?e.jsx("circle",{cx:"50%",cy:"50%",r:"47%",fill:"none",stroke:r?"rgba(255,255,255,0.2)":"var(--brand-color)",strokeWidth:"2.5",className:"transition-all duration-500"}):(()=>{const p=2*Math.PI*47,m=4,h=`${(360-m*s)/s/360*p} ${m/360*p}`;return e.jsx("circle",{cx:"50%",cy:"50%",r:"47%",fill:"none",stroke:r?"rgba(255,255,255,0.2)":"var(--brand-color)",strokeWidth:"2.5",strokeDasharray:h,className:"transition-all duration-500"})})()}),e.jsx("div",{className:te("p-[3px] w-full h-full rounded-full"),children:e.jsxs($e,{className:"w-full h-full border border-slate-900 shadow-inner",children:[e.jsx(Je,{src:t.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=random&color=fff`}),e.jsx(Ge,{className:"bg-slate-800 text-slate-300",children:t.name?t.name.charAt(0).toUpperCase():"?"})]})}),!r&&a&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-950 rounded-full ring-1 ring-white/20"})]})}function ni({chats:t,currentUser:a,onlineUsers:r,onSelectChat:s,onNewChat:n,onCreateGroup:i,onLogout:o,onAcceptRequest:d,onRejectRequest:p,pendingRequests:m,typingUsers:c,onSettings:l,onPinChat:h,statuses:v=[],onViewStatus:x,onAddStatus:P,language:E,t:w,isLoading:R}){const[k,M]=u.useState(""),$=u.useMemo(()=>t.filter(C=>C.partnerName.toLowerCase().includes(k.toLowerCase())||C.lastMessage.toLowerCase().includes(k.toLowerCase())).sort((C,f)=>C.isPinned&&!f.isPinned?-1:!C.isPinned&&f.isPinned?1:new Date(f.lastMessageTime).getTime()-new Date(C.lastMessageTime).getTime()),[t,k]),q=C=>{if(!C)return"";const f=new Date(C),_=new Date().getTime()-f.getTime(),j=Math.floor(_/(1e3*60*60*24));return j===0?f.toLocaleTimeString(E==="ar"?"ar-EG":"en-US",{hour:"2-digit",minute:"2-digit"}):j===1?E==="ar"?"Ø£Ù…Ø³":"Yesterday":j<7?f.toLocaleDateString(E==="ar"?"ar-EG":"en-US",{weekday:"short"}):f.toLocaleDateString(E==="ar"?"ar-EG":"en-US",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950/95 backdrop-blur-md border-r border-white/5 w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-brand/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"p-4 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(z.h1,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 flex items-center gap-2 ${E==="ar"?"font-arabic":""}`,children:[w("chats")," ",e.jsx("span",{className:"text-xs bg-brand/20 text-brand px-2 py-0.5 rounded-full border border-brand/30",children:t.length})]}),e.jsx("div",{className:"flex items-center gap-2",children:[{icon:bt,onClick:i,title:w("createGroup")},{icon:Qt,onClick:n,title:w("newChat")},{icon:pa,onClick:l,title:w("settings")}].map((C,f)=>e.jsx(z.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:f*.1},whileHover:{scale:1.1,backgroundColor:"rgba(255, 255, 255, 0.1)"},whileTap:{scale:.9},onClick:C.onClick,title:C.title,className:te("p-2 rounded-full transition-colors text-slate-400 hover:text-white"),children:e.jsx(C.icon,{className:"w-5 h-5"})},f))})]}),e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-4 mb-6 p-3 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/30 transition-colors group",children:[e.jsxs("div",{className:"relative",children:[e.jsxs($e,{className:"w-12 h-12 border-2 border-brand/20 group-hover:border-brand transition-colors",children:[e.jsx(Je,{src:a.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name)}&background=6366f1&color=fff`}),e.jsx(Ge,{className:"bg-brand text-white",children:a.name.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-bold truncate text-base",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-brand text-xs font-medium truncate bg-brand/10 px-2 py-0.5 rounded-md",children:["@",a.username]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`@${a.username}`),Q.success(E==="ar"?"ØªÙ… Ù†Ø³Ø® Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!":"Username copied!")},className:"text-slate-500 hover:text-white transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(fa,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex gap-4 overflow-x-auto py-2 no-scrollbar mb-4 relative z-10",children:[e.jsxs(z.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] group",onClick:P,children:[e.jsx(Dr,{user:{id:a.id,name:a.name,avatar_url:a.avatar_url},hasStatus:!1,isAllSeen:!1,statusCount:0,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:E==="ar"?"Ø­Ø§Ù„ØªÙÙŠ":"My Status"})]}),Object.entries(v.reduce((C,f)=>{const S=f.user_id;return C[S]||(C[S]=[]),C[S].push(f),C},{})).map(([C,f])=>{var S,_,j;return e.jsxs(z.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] cursor-pointer",onClick:()=>{const N=f.map(y=>{var F,D;return{id:y.id,user_id:y.user_id,user_name:((F=y.profiles)==null?void 0:F.display_name)||"User",user_avatar:(D=y.profiles)==null?void 0:D.avatar_url,content_type:y.content_type,content_url:y.content_url,text:y.text,created_at:y.created_at}});x==null||x(N,0)},children:[e.jsx(Dr,{user:{id:C,name:((S=f[0].profiles)==null?void 0:S.display_name)||"User",avatar_url:(_=f[0].profiles)==null?void 0:_.avatar_url},hasStatus:!0,isAllSeen:!1,statusCount:f.length,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-medium truncate w-14 text-center",children:((j=f[0].profiles)==null?void 0:j.display_name)||"User"})]},C)})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vt,{className:"w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"})}),e.jsx(Te,{type:"text",placeholder:w("search"),value:k,onChange:C=>M(C.target.value),className:"pl-10 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-500 h-10 transition-all font-light"})]})]}),e.jsx(je,{children:m.length>0&&e.jsx(z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/20 to-violet-900/20 border border-indigo-500/20 rounded-xl p-3 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Ot,{className:"w-3 h-3 animate-bounce"}),e.jsx("span",{className:E==="ar"?"font-arabic":"",children:E==="ar"?"Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©":"New Requests"})]}),e.jsx("div",{className:"space-y-2",children:m.map(C=>{var f;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-slate-900/50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate",children:e.jsxs("span",{className:"text-indigo-400",children:["@",(f=C.profiles)==null?void 0:f.username]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(C.id,C.sender_id),className:"p-1.5 bg-brand/20 text-brand hover:bg-brand hover:text-white rounded-md transition-colors",children:e.jsx(Fe,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>p(C.id),className:"p-1.5 bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white rounded-md transition-colors",children:e.jsx(Ee,{className:"w-3 h-3"})})]})]},C.id)})})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2 space-y-1",children:R?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx(_e,{className:"w-8 h-8 animate-spin text-brand mb-2"}),e.jsx("p",{className:E==="ar"?"font-arabic":"",children:E==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª...":"Loading chats..."})]}):$.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-4",children:e.jsx(dr,{className:"w-8 h-8 opacity-20"})}),e.jsx("p",{className:`font-medium text-slate-400 ${E==="ar"?"font-arabic":""}`,children:w("no_chats")}),e.jsx("p",{className:"text-xs mt-1 text-slate-600",children:E==="ar"?"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯.":"Start exploring to find new friends."})]}):$.map((C,f)=>{var S,_;return e.jsxs(z.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:f*.05},onClick:()=>s(C.partnerId,C.partnerName),className:"group relative flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer transition-all border border-transparent hover:border-white/5 active:scale-[0.98]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs($e,{className:"w-12 h-12 border border-white/10 group-hover:border-brand/50 transition-colors",children:[e.jsx(Je,{src:C.partnerAvatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(C.partnerName)}&background=random&color=fff`}),e.jsx(Ge,{className:"bg-slate-800 text-slate-300",children:C.partnerName.charAt(0).toUpperCase()})]}),!C.isGroup&&r.has(C.partnerId)&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-brand border-2 border-slate-950 rounded-full ring-2 ring-slate-950 animate-pulse"}),C.isGroup&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-slate-800 p-1 rounded-full border border-slate-700",children:e.jsx(bt,{className:"w-3 h-3 text-brand"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h3",{className:te("font-semibold truncate transition-colors text-base",C.unreadCount>0?"text-white":"text-slate-300 group-hover:text-white"),children:C.partnerName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),h(C.id,!C.isPinned)},className:te("p-1 rounded-md transition-all",C.isPinned?"text-indigo-400 opacity-100":"text-slate-600 opacity-0 group-hover:opacity-100 hover:text-white hover:bg-white/10"),children:e.jsx(tt,{className:te("w-3.5 h-3.5",C.isPinned&&"fill-indigo-400")})}),e.jsx("span",{className:te("text-[10px] flex-shrink-0 font-medium",C.unreadCount>0?"text-indigo-400":"text-slate-500"),children:q(C.lastMessageTime)})]})]}),e.jsxs("div",{className:"flex justify-between items-center h-5",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-2",children:c[C.partnerId]?e.jsxs("p",{className:"text-brand text-xs font-bold flex items-center gap-1",children:[E==="ar"?"ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†":"typing",e.jsxs("span",{className:"flex gap-0.5 pt-1",children:[e.jsx(z.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(z.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(z.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-1 h-1 bg-brand rounded-full"})]})]}):e.jsx("p",{className:te("text-sm truncate",C.unreadCount>0?"text-slate-100 font-medium":"text-slate-500 group-hover:text-slate-400"),children:(S=C.lastMessage)!=null&&S.includes("Voice Message")||(_=C.lastMessage)!=null&&_.includes("Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©")?"ðŸŽ¤":C.lastMessage||e.jsx("span",{className:"italic text-slate-600",children:E==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„":"No messages yet"})})}),C.unreadCount>0&&e.jsx(z.div,{initial:{scale:0},animate:{scale:1},className:"bg-brand text-white text-[10px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg shadow-brand/40",children:C.unreadCount})]})]})]},C.id)})})]})}const ii=u.memo(ni),Ns=u.createContext(void 0),oi=({children:t})=>{const[a,r]=u.useState(null),s=u.useRef(new Map),n=u.useRef(null);typeof window<"u"&&!n.current&&(n.current=new Audio("/sounds/digital.mp3"));const i=u.useCallback(c=>{r(c)},[]),o=u.useCallback(c=>{r(l=>l===c?null:l)},[]),d=u.useCallback((c,l)=>{s.current.set(c,l)},[]),p=u.useCallback(c=>{s.current.delete(c)},[]),m=u.useCallback(c=>{r(null);const l=s.current.get(c);l&&(n.current&&(n.current.volume=1,n.current.play().catch(()=>{})),setTimeout(()=>{l()},500))},[]);return e.jsx(Ns.Provider,{value:{activeMessageId:a,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:m},children:t})},Cs=()=>{const t=u.useContext(Ns);if(!t)throw new Error("useVoicePlayback must be used within a VoicePlaybackProvider");return t},Ss=u.createContext(void 0),sr={indigo:{name:"Royal Indigo",class:"indigo",hex:"#6366f1"},emerald:{name:"Forest Emerald",class:"emerald",hex:"#10b981"},rose:{name:"Velvet Rose",class:"rose",hex:"#f43f5e"},amber:{name:"Golden Amber",class:"amber",hex:"#f59e0b"},cyan:{name:"Ocean Cyan",class:"cyan",hex:"#06b6d4"},violet:{name:"Electric Violet",class:"violet",hex:"#8b5cf6"}};function li({children:t}){const[a,r]=u.useState(()=>localStorage.getItem("chat_theme_color")||"indigo"),[s,n]=u.useState(()=>localStorage.getItem("chat_wallpaper")||"doodles"),[i,o]=u.useState(()=>Number(localStorage.getItem("chat_bg_opacity"))||.05);return u.useEffect(()=>{localStorage.setItem("chat_theme_color",a);const d=sr[a];document.documentElement.style.setProperty("--brand-color",d.hex)},[a]),u.useEffect(()=>{localStorage.setItem("chat_wallpaper",s)},[s]),u.useEffect(()=>{localStorage.setItem("chat_bg_opacity",String(i)),document.documentElement.style.setProperty("--bg-opacity",String(i))},[i]),e.jsx(Ss.Provider,{value:{accentColor:a,setAccentColor:r,wallpaper:s,setWallpaper:n,bgOpacity:i,setBgOpacity:o},children:t})}function ks(){const t=u.useContext(Ss);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const ci=u.memo(({question:t,options:a,votes:r,currentUserId:s,onVote:n,isSent:i})=>{const o=Object.keys(r).length,d=r[s],p=m=>{const c=Object.values(r).filter(h=>h===m).length,l=o===0?0:c/o*100;return{count:c,percent:l}};return e.jsxs("div",{className:"flex flex-col gap-4 min-w-[240px] max-w-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl",children:e.jsx(bt,{className:"w-5 h-5 text-brand"})}),e.jsx("h3",{className:"text-lg font-bold text-white leading-tight",dir:"auto",children:t})]}),e.jsx("div",{className:"space-y-2",children:a.map((m,c)=>{const{count:l,percent:h}=p(c),v=d===c,x=/[\u0600-\u06FF]/.test(m);return e.jsxs("button",{onClick:()=>n(c),className:"w-full text-left group relative outline-none",dir:x?"rtl":"ltr",children:[e.jsxs("div",{className:te("relative z-10 flex items-center justify-between p-3 rounded-xl border transition-all duration-300",v?"bg-brand/30 border-brand/50 shadow-lg shadow-brand/10":"bg-white/5 border-white/5 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:te("w-5 h-5 rounded-full border flex items-center justify-center transition-colors",v?"bg-white border-white":"border-white/20 group-hover:border-white/40"),children:v&&e.jsx(Fe,{className:"w-3 h-3 text-brand stroke-[4px]"})}),e.jsx("span",{className:te("font-medium truncate",v?"text-white":"text-slate-200"),dir:"auto",children:m})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-400",children:l})})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl overflow-hidden pointer-events-none",children:e.jsx(z.div,{initial:{width:0},animate:{width:`${h}%`},transition:{type:"spring",stiffness:100,damping:20},className:te("h-full opacity-10 transition-colors",v?"bg-white":"bg-brand")})})]},c)})}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:[o," ",o===1?"Vote":"Votes"]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:d!==void 0?"Voted":"Not voted"})]})]})});function di({url:t,language:a}){const[r,s]=u.useState(null),[n,i]=u.useState(!0),[o,d]=u.useState(!1);return u.useEffect(()=>{let p=!0;return t&&(async()=>{i(!0),d(!1);try{const c=new URL(t).hostname;await new Promise(l=>setTimeout(l,1e3)),t.includes("google")||t.includes("youtube")?s({title:c==="www.youtube.com"?"YouTube Video":"Google Search",description:"Enjoy the videos and music you love, upload original content, and share it all with friends, family, and the world on YouTube.",siteName:c,image:c==="www.youtube.com"?"https://www.youtube.com/img/desktop/yt_1200.png":void 0}):s({title:c,siteName:c})}catch(c){console.error("Link preview failed:",c),d(!0)}finally{p&&i(!1)}})(),()=>{p=!1}},[t]),o||!r?null:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"block mt-2 mb-1 max-w-sm rounded-xl overflow-hidden bg-slate-800/50 border border-white/10 hover:bg-slate-800 transition-colors group",dir:a==="ar"?"rtl":"ltr",children:n?e.jsx("div",{className:"h-24 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 animate-spin text-slate-500"})}):e.jsxs(e.Fragment,{children:[r.image&&e.jsx("div",{className:"w-full h-32 overflow-hidden relative bg-slate-900 border-b border-white/5",children:e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-200 line-clamp-1 mb-1",children:r.title}),r.description&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-2 mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:[e.jsx(Hr,{className:"w-3 h-3"}),e.jsx("span",{children:r.siteName})]})]})]})})}const ui=u.memo(({message:t,currentUserId:a,partnerName:r,isGroup:s,isSequential:n,isMenuOpen:i,onToggleMenu:o,onReact:d,onReply:p,onDelete:m,onEdit:c,onVote:l,setViewingFile:h,repliedMessage:v,language:x,t:P,formatMessageTime:E,renderFilePreview:w,onJoinGroup:R,isAnyOverlayOpen:k})=>{var S,_,j;const M=t.senderId===a,$=x==="ar",q=M&&!$||!M&&$,C=(S=t.text)==null?void 0:S.match(/(https?:\/\/[^\s]+)/),f=C?C[0]:null;return e.jsx("div",{id:`msg-${t.id}`,className:te("flex w-full mb-6",M?"justify-end":"justify-start",i&&"z-[130] relative"),children:e.jsxs("div",{className:te("relative max-w-[80%] group",M?"items-end":"items-start"),children:[s&&!M&&!n&&e.jsx("p",{className:"text-[10px] font-bold mb-1 text-brand ml-1",children:"~User"}),!k&&e.jsx("div",{className:te("absolute top-0 z-10 transition-all duration-200",q?"left-0 -translate-x-full pr-1":"right-0 translate-x-full pl-1","opacity-100"),children:e.jsx("button",{onClick:N=>{N.stopPropagation(),o(t.id)},className:te("p-1 rounded-full transition-all bg-slate-900/50 backdrop-blur-sm shadow-sm border border-white/5",i?"text-brand bg-slate-800":"text-slate-400 hover:text-white"),children:e.jsx(mr,{className:"w-3.5 h-3.5"})})}),e.jsxs("div",{className:te("px-4 py-2.5 shadow-lg relative transition-all duration-300 select-none",M?"bg-gradient-to-br from-brand via-brand to-violet-600 text-white rounded-[20px] rounded-br-[4px] shadow-brand/20":"bg-slate-800/60 backdrop-blur-md text-slate-100 border border-white/10 rounded-[20px] rounded-bl-[4px] shadow-black/20",i&&"ring-2 ring-brand ring-offset-2 ring-offset-[#0b141a]"),children:[t.replyToId&&v&&e.jsxs("div",{onClick:N=>{N.stopPropagation();const y=document.getElementById(`msg-${v.id}`);y&&(y.scrollIntoView({behavior:"smooth",block:"center"}),y.classList.add("ring-2","ring-yellow-400","ring-offset-2"),setTimeout(()=>{y.classList.remove("ring-2","ring-yellow-400","ring-offset-2")},2e3))},className:te("mb-2 p-2 rounded-lg border-l-4 cursor-pointer hover:bg-white/5 transition-colors",M?"bg-white/10 border-white/30":"bg-slate-700/50 border-brand"),children:[e.jsx("p",{className:"text-[10px] font-semibold mb-0.5 opacity-80",children:v.senderId===a?x==="ar"?"Ø£Ù†Øª":"You":r}),e.jsx("p",{className:"text-xs opacity-70 line-clamp-2",children:v.text||((_=v.fileType)!=null&&_.startsWith("image/")?x==="ar"?"ðŸ“· ØµÙˆØ±Ø©":"ðŸ“· Photo":x==="ar"?"ðŸ“Ž Ù…Ù„Ù":"ðŸ“Ž File")})]}),w(t,M),t.poll?e.jsx(ci,{question:t.poll.question,options:t.poll.options,votes:t.poll.votes,onVote:N=>l(t.id,N),currentUserId:a,isSent:M}):!(((j=t.fileType)!=null&&j.startsWith("audio/")||t.fileType==="audio")&&(t.text==="ðŸŽ¤"||t.text==="ðŸŽ¤ Voice Message"||t.text==="Voice Message"))&&e.jsx("p",{className:"text-[15px] leading-relaxed break-words whitespace-pre-wrap",children:t.text.split(/(\bhttps?:\/\/[^\s]+)/g).map((N,y)=>{if(N.match(/^https?:\/\//)){try{const F=new URL(N);if(F.searchParams.has("join"))return e.jsxs("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 font-bold underline decoration-brand decoration-2 text-brand/80 hover:text-white transition-colors bg-brand/10 px-1 rounded mx-0.5",onClick:D=>{if(D.preventDefault(),R){const T=F.searchParams.get("join");T&&R(T)}},children:[e.jsx(zt,{className:"w-3 h-3"}),"Join Group"]},y)}catch{}return e.jsx("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-400 hover:text-blue-300 break-all",children:N},y)}return N})}),!t.poll&&!t.fileType&&f&&e.jsx(di,{url:f,language:x}),e.jsxs("div",{className:te("flex items-center gap-1.5 mt-1 opacity-60 text-[10px]",M?"justify-end":"justify-start"),children:[e.jsx("span",{children:E(t.timestamp)}),M&&(t.isRead?e.jsx(ha,{className:"w-3 h-3 text-sky-400"}):e.jsx(Fe,{className:"w-3 h-3"}))]}),t.reactions&&Object.keys(t.reactions).length>0&&e.jsx("div",{className:te("absolute -bottom-3 flex flex-wrap gap-1 z-10",M?"right-2":"left-2"),children:Object.entries(t.reactions).map(([N,y])=>e.jsxs(z.button,{initial:{scale:0},animate:{scale:1},onClick:F=>{F.stopPropagation(),d(t.id,N)},className:te("bg-slate-900/90 backdrop-blur-md border border-white/10 rounded-full px-1.5 py-0.5 text-[10px] flex items-center gap-1 shadow-lg",y.includes(a)&&"border-brand/50 bg-brand/10"),children:[e.jsx("span",{children:N}),y.length>1&&e.jsx("span",{className:"opacity-70 font-bold",children:y.length})]},N))})]}),e.jsx(je,{children:i&&e.jsx("div",{className:te("absolute top-8 z-30",q?"right-0":"left-0"),children:e.jsxs(z.div,{initial:{opacity:0,scale:.9,x:q?20:-20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.9,x:q?10:-10},className:"bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl py-1.5 min-w-[120px] overflow-hidden",children:[e.jsx("div",{className:"flex px-1.5 pb-1.5 mb-1.5 border-b border-white/5 overflow-x-auto scrollbar-hide gap-1",children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"].map(N=>e.jsx("button",{onClick:()=>{d(t.id,N),o()},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-lg",children:N},N))}),e.jsxs("button",{onClick:()=>{p(t),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Wr,{className:"w-3.5 h-3.5"})," ",P("reply")]}),M&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{c(t.id,t.text),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Yr,{className:"w-3.5 h-3.5"})," ",P("edit")]}),e.jsxs("button",{onClick:()=>{m(t.id),o()},className:"w-full text-left px-4 py-2 text-xs text-red-400 hover:bg-red-500/10 flex items-center gap-2",children:[e.jsx(pr,{className:"w-3.5 h-3.5"})," ",P("delete")]})]})]})})})]})})}),Et=[{id:"1",title:"Funny Cat",url:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif",preview:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"},{id:"2",title:"Excited",url:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif",preview:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif"},{id:"3",title:"Sad",url:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif",preview:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif"},{id:"4",title:"Thumbs Up",url:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif",preview:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif"},{id:"5",title:"Dancing",url:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif",preview:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif"},{id:"6",title:"Mind Blown",url:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif",preview:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif"},{id:"7",title:"Applause",url:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif",preview:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif"},{id:"8",title:"Laughing",url:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif",preview:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif"}];function mi({onSelect:t,onClose:a,language:r}){const[s,n]=u.useState(""),[i,o]=u.useState(Et),[d,p]=u.useState(!1);return u.useEffect(()=>{if(!s){o(Et);return}const m=setTimeout(()=>{p(!0);const c=Et.filter(h=>h.title.toLowerCase().includes(s.toLowerCase())),l=c.length>0?c:Et.slice(0,4);o(l),p(!1)},500);return()=>clearTimeout(m)},[s]),e.jsxs("div",{className:"w-full h-full flex flex-col bg-slate-900 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",value:s,onChange:m=>n(m.target.value),placeholder:r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† GIF...":"Search GIF...",className:"w-full bg-slate-800 text-white rounded-lg pl-9 pr-4 py-2 text-sm border-none focus:ring-1 focus:ring-brand placeholder:text-slate-500",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:d?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(_e,{className:"w-6 h-6 animate-spin text-brand"})}):e.jsxs(e.Fragment,{children:[!s&&e.jsxs("div",{className:"text-xs font-bold text-slate-500 mb-2 px-1 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3 text-yellow-500"})," Trending"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(m=>e.jsxs("button",{onClick:()=>t(m),className:"relative aspect-video rounded-lg overflow-hidden border border-white/5 hover:border-brand/50 transition-all group",children:[e.jsx("img",{src:m.preview,alt:m.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]},m.id))})]})}),e.jsx("div",{className:"p-2 border-t border-white/5 flex justify-center",children:e.jsx("span",{className:"text-[10px] text-slate-600 font-bold tracking-widest",children:"POWERED BY GIPHY"})})]})}function pi({repliedMessage:t,onCancel:a}){const r=()=>{var s,n,i;return(s=t.fileType)!=null&&s.startsWith("audio/")?"ðŸŽ¤":(n=t.fileType)!=null&&n.startsWith("image/")?"ðŸ“· Photo":(i=t.fileType)!=null&&i.startsWith("video/")?"ðŸŽ¥ Video":t.fileType?"ðŸ“Ž File":t.text};return e.jsx(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"bg-slate-800/60 backdrop-blur-md border border-white/10 border-l-4 border-l-indigo-500 px-3 py-2 mb-2 rounded-r-lg shadow-lg relative",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Wr,{className:"w-3 h-3 text-indigo-400"}),e.jsx("span",{className:"text-indigo-400 text-xs font-bold",children:t.senderName})]}),e.jsx("p",{className:"text-slate-300 text-sm truncate opacity-90",children:r()})]}),e.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(Ee,{className:"w-4 h-4"})})]})})}function fi({onSend:t,onCancel:a}){const[r,s]=u.useState(0),[n,i]=u.useState(new Array(25).fill(0)),o=u.useRef(null),d=u.useRef([]),p=u.useRef(0),m=u.useRef(!1),c=u.useRef(null),l=u.useRef(null),h=u.useRef(null),v=u.useCallback(async()=>{try{if(!await it.requestMicPermission()){Q.error("Microphone access is blocked! ðŸš«"),a();return}const R=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),k=new(window.AudioContext||window.webkitAudioContext);k.state==="suspended"&&await k.resume();const M=k.createMediaStreamSource(R),$=k.createGain();$.gain.value=3;const q=k.createAnalyser();q.fftSize=64;const C=k.createMediaStreamDestination();M.connect($),$.connect(C),$.connect(q),c.current=k,l.current=q;const f=q.frequencyBinCount,S=new Uint8Array(f);p.current=Date.now(),m.current=!0,s(0);const _=()=>{if(!m.current)return;if(l.current){l.current.getByteFrequencyData(S);const T=[],B=Math.floor(f/25);for(let g=0;g<25;g++)T.push(Math.max(4,S[g*B]||0));i(T)}const D=(Date.now()-p.current)/1e3;s(D),h.current=requestAnimationFrame(_)};let j={audioBitsPerSecond:128e3};const N=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/mpeg","audio/aac"];let y="";for(const D of N)if(MediaRecorder.isTypeSupported(D)){j.mimeType=D,y=D;break}console.log("ðŸŽ™ï¸ [DEBUG] Selected mimeType:",y);const F=new MediaRecorder(C.stream,j);o.current=F,d.current=[],F.ondataavailable=D=>{D.data.size>0&&d.current.push(D.data)},F.onstop=()=>{R.getTracks().forEach(D=>D.stop()),c.current&&c.current.close()},F.start(100),_()}catch(w){console.error("Microphone error:",w),Q.error("Unable to access microphone: "+w.message),a()}},[a]),x=u.useCallback(()=>{if(o.current&&m.current){m.current=!1;const w=(Date.now()-p.current)/1e3;o.current.onstop=()=>{var k;const R=new Blob(d.current,{type:((k=o.current)==null?void 0:k.mimeType)||"audio/webm"});console.log("ðŸŽ™ï¸ [DEBUG] Voice Blob created:",R.type,R.size),R.size>0?t(R,w):Q.error("Recording failed: Empty audio data")},o.current.stop()}},[t]),P=u.useCallback(()=>{o.current&&m.current&&(o.current.onstop=()=>{d.current=[]},o.current.stop(),m.current=!1),a()},[a]);u.useEffect(()=>(v(),()=>{m.current&&o.current&&o.current.stop(),h.current&&cancelAnimationFrame(h.current),c.current&&c.current.close()}),[]);const E=w=>{const R=Math.floor(w/60),k=Math.floor(w%60);return`${R}:${k.toString().padStart(2,"0")}`};return e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mx-auto w-full max-w-[220px] flex items-center justify-between gap-2 px-3 h-12 bg-slate-800/40 rounded-full border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{onClick:P,variant:"ghost",size:"icon",className:"text-slate-400 hover:text-red-400 rounded-full h-9 w-9 transition-colors flex-shrink-0",children:e.jsx(pr,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z.div,{animate:{opacity:[1,.5,1]},transition:{repeat:1/0,duration:1.5},className:"w-2.5 h-2.5 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-white font-mono text-xs font-medium min-w-[35px]",children:E(r)})]})]}),e.jsx("div",{className:"flex-1 px-1",children:e.jsx("div",{className:"h-4 flex items-center gap-[1px] overflow-hidden justify-center max-w-[80px] mx-auto opacity-30",children:n.map((w,R)=>e.jsx(z.div,{animate:{height:`${Math.min(100,Math.max(20,w/255*100))}%`},transition:{type:"spring",stiffness:300,damping:20},className:"w-1 bg-red-500/80 rounded-full"},R))})}),e.jsx("div",{className:"flex items-center",children:e.jsx(z.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:x,className:"w-9 h-9 bg-brand rounded-full flex items-center justify-center text-white shadow-lg shadow-brand/20 hover:bg-brand/80 transition-colors flex-shrink-0",children:e.jsx(Ut,{className:"w-4 h-4 fill-current ml-0.5"})})})]})}const hi=u.memo(({onSendMessage:t,currentUserId:a,replyTo:r,setReplyTo:s,onTyping:n,t:i,language:o,onSendVoiceMessage:d,editingMessage:p,setEditingMessage:m,onEditMessage:c,scrollToBottom:l,isGroup:h,setShowPollCreator:v})=>{const[x,P]=u.useState(!1),[E,w]=u.useState(""),[R,k]=u.useState(null),[M,$]=u.useState(!1),[q,C]=u.useState(!1),[f,S]=u.useState(null),[_,j]=u.useState(!1),[N,y]=u.useState(!1),[F,D]=u.useState(null),T=u.useRef(null),B=u.useRef(null),g=u.useRef(!1),Y=u.useRef(null);u.useEffect(()=>{p&&(w(p.text),T.current&&(T.current.value=p.text,T.current.focus()))},[p]);const K=u.useCallback(b=>{const W=b.target.value,V=W.trim().length>0;P(Z=>Z!==V?V:Z);const O=b.target;O.style.height="auto",O.style.height=`${Math.min(O.scrollHeight,120)}px`,W.length>0?(g.current||(g.current=!0,n(!0)),Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{g.current=!1,n(!1)},3e3)):g.current&&(g.current=!1,n(!1),Y.current&&clearTimeout(Y.current))},[n]),A=async b=>{var V;b==null||b.preventDefault();const W=((V=T.current)==null?void 0:V.value)||"";if(R){$(!0);try{const O=new FormData;O.append("file",R),O.append("userId",a);const ae=await(await fetch(`https://${qt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${Vt}`},body:O})).json();if(ae.error)throw new Error(ae.error);t(W.trim(),ae.fileUrl,ae.fileType,ae.fileName,r==null?void 0:r.id,f),T.current&&(T.current.value="",T.current.style.height="auto"),P(!1),k(null),s(null),setTimeout(()=>l(),100)}catch(O){Q.error("Upload failed: "+O.message)}finally{$(!1)}}else W.trim()&&(p&&c?(c(p.id,W.trim()),m(null)):t(W.trim(),void 0,void 0,void 0,r==null?void 0:r.id,f),T.current&&(T.current.value="",T.current.style.height="auto"),P(!1),s(null),S(null),setTimeout(()=>l(),100))},I=b=>{t(b.title||"GIF",b.url,"image/gif","animation.gif",r==null?void 0:r.id,f),y(!1),s(null),setTimeout(()=>l(),100)};return u.useLayoutEffect(()=>{if(!T.current)return;const b=T.current;b.style.height="auto",b.style.height=`${Math.min(b.scrollHeight,120)}px`,p&&P(!0)},[p]),e.jsxs("div",{className:"p-4 bg-slate-900 border-t border-white/5 relative z-50",children:[e.jsxs(je,{children:[r&&e.jsx(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3",children:e.jsx(pi,{repliedMessage:r,onCancel:()=>s(null)})}),p&&e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 p-3 bg-indigo-500/10 border-l-4 border-indigo-500 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand",children:[e.jsx(Yr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i("editing_message")})]}),e.jsx("button",{onClick:()=>{m(null),w(""),T.current&&(T.current.value="")},className:"text-slate-400 hover:text-white",children:e.jsx(Ee,{className:"w-4 h-4"})})]}),R&&e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-2 flex items-center gap-3 bg-slate-800/80 rounded-xl p-3 border border-brand/30",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-lg",children:e.jsx(Ft,{className:"w-5 h-5 text-brand"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:R.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(R.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>k(null),className:"p-1 hover:bg-white/10 rounded-full",children:e.jsx(Ee,{className:"w-4 h-4 text-slate-400"})})]})]}),e.jsx(je,{children:N&&e.jsxs(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:320},exit:{opacity:0,height:0},className:"absolute bottom-full left-0 right-0 z-50 bg-slate-900 border-t border-white/10 shadow-2xl overflow-hidden rounded-t-2xl mx-2 mb-2",children:[e.jsx("div",{className:"flex justify-end p-2 absolute top-0 right-0 z-10",children:e.jsx("button",{onClick:()=>y(!1),className:"bg-black/50 hover:bg-black/70 rounded-full p-1 text-white transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})}),e.jsx(mi,{onSelect:I,onClose:()=>y(!1),language:o})]})}),e.jsxs("div",{className:"flex items-end gap-3 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex-1 bg-slate-800 rounded-2xl flex items-end p-1 border border-white/10 shadow-lg focus-within:border-brand/50 focus-within:ring-1 focus-within:ring-brand/20 transition-all",children:q?e.jsx(fi,{onSend:(b,W)=>{d(b,W),C(!1)},onCancel:()=>C(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center self-center px-1",children:[e.jsx("input",{type:"file",ref:B,onChange:b=>{var W;return k(((W=b.target.files)==null?void 0:W[0])||null)},className:"hidden"}),e.jsx("button",{onClick:()=>{var b;return(b=B.current)==null?void 0:b.click()},className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(xa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>y(!N),className:te("p-2.5 rounded-xl transition-all",N?"text-brand bg-brand/10":"text-slate-400 hover:text-brand hover:bg-brand/10"),children:e.jsx(tt,{className:"w-5 h-5"})}),h&&e.jsx("button",{onClick:()=>v(!0),className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(Jr,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs(z.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>j(!_),className:te("p-2.5 rounded-xl transition-all flex items-center justify-center relative",f?"text-orange-400 bg-orange-500/20":"text-slate-400 hover:text-white"),children:[e.jsx(ga,{className:te("w-5 h-5",f&&"animate-pulse")}),f&&e.jsxs("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:[f,"s"]})]}),e.jsx(je,{children:_&&e.jsx(z.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-0 mb-4 bg-slate-900 border border-white/20 rounded-2xl p-2 shadow-2xl z-[200] min-w-[160px] backdrop-blur-2xl",children:e.jsx("div",{className:"flex flex-col gap-1",children:[{label:o==="ar"?"Ø¥ÙŠÙ‚Ø§Ù":"Off",value:null},{label:o==="ar"?"5 Ø«ÙˆØ§Ù†Ù":"5 Seconds",value:5},{label:o==="ar"?"10 Ø«ÙˆØ§Ù†Ù":"10 Seconds",value:10},{label:o==="ar"?"30 Ø«Ø§Ù†ÙŠØ©":"30 Seconds",value:30},{label:o==="ar"?"Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Minute",value:60},{label:o==="ar"?"Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Hour",value:3600}].map(b=>e.jsxs("button",{onClick:()=>{S(b.value),j(!1)},className:te("w-full text-left px-4 py-2.5 rounded-xl text-sm transition-all flex items-center justify-between",f===b.value?"bg-brand/20 text-brand font-bold":"text-slate-300 hover:bg-white/5"),children:[b.label,f===b.value&&e.jsx(Fe,{className:"w-4 h-4"})]},b.label))})})})]})]}),e.jsx("textarea",{ref:T,rows:1,placeholder:i("type_message"),defaultValue:E,onChange:K,inputMode:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"sentences",onKeyDown:b=>{if(b.key==="Enter"&&!b.shiftKey){if(b.preventDefault(),M)return;A(b)}},className:"flex-1 bg-transparent border-none text-white placeholder:text-slate-500 px-4 py-3 resize-none focus:outline-none max-h-[120px] scrollbar-hide text-[15px] leading-relaxed"})]})}),x||R?e.jsx(z.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:A,className:"h-[50px] w-[50px] bg-gradient-to-tr from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/25",children:M?e.jsx(_e,{className:"w-5 h-5 animate-spin"}):e.jsx(Ut,{className:"w-5 h-5 fill-current"})}):e.jsx(z.button,{onClick:()=>C(!0),whileHover:{scale:1.1},whileTap:{scale:.9},className:"h-[50px] w-[50px] bg-slate-800 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-slate-700 transition-colors",children:e.jsx($t,{className:"w-5 h-5"})})]})]})});function xi({url:t,type:a,name:r,onClose:s}){const n=a.startsWith("image/"),i=a.startsWith("video/"),o=a.includes("pdf");return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-200",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-[200px] sm:max-w-md",children:r}),e.jsx("p",{className:"text-gray-400 text-xs",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:t,download:r,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(Xr,{className:"w-6 h-6"})}),e.jsx("button",{onClick:s,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Ee,{className:"w-7 h-7"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 sm:p-10",children:n?e.jsx("img",{src:t,alt:r,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl animate-in zoom-in-95 duration-300"}):i?e.jsx("video",{src:t,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg shadow-2xl"}):o?e.jsx("iframe",{src:t,className:"w-full h-full max-w-5xl bg-white rounded-lg shadow-2xl",title:r}):e.jsxs("div",{className:"bg-[#202c33] p-8 rounded-2xl flex flex-col items-center gap-6 max-w-sm text-center shadow-2xl border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-brand/20 rounded-full flex items-center justify-center",children:e.jsx(Hr,{className:"w-10 h-10 text-brand"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"No Preview Available"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["This file type (",a,") cannot be previewed directly. You can download it to view."]})]}),e.jsx("a",{href:t,download:r,className:"w-full",children:e.jsx(pe,{className:"w-full bg-brand hover:bg-brand/80 text-white py-6 text-lg",children:"Download File"})})]})})]})}function gi({partnerId:t,partnerName:a,partnerAvatar:r,isGroup:s,onClose:n,messages:i,onOpenGallery:o,onAudioCall:d,onVideoCall:p,onShowProfile:m,language:c,t:l}){const[h,v]=u.useState(null),[x,P]=u.useState(!0),E=i.filter(w=>{var R,k;return w.fileUrl&&(((R=w.fileType)==null?void 0:R.startsWith("image/"))||((k=w.fileType)==null?void 0:k.startsWith("video/")))});return u.useEffect(()=>{async function w(){if(s){const{data:R,error:k}=await ee.from("groups").select("*").eq("id",t).single();R&&v(R),P(!1)}else{const{data:R,error:k}=await ee.from("profiles").select("*").eq("id",t).single();R&&v(R),P(!1)}}w()},[t,s]),e.jsxs(z.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"absolute top-0 right-0 h-full w-full md:w-[380px] bg-slate-950 border-l border-white/10 z-[1001] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/5 bg-slate-950",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Ee,{className:"w-5 h-5"})}),e.jsx("h2",{className:`text-lg font-semibold text-white ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Contact Info"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs(z.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative mb-4 group cursor-pointer",children:[e.jsxs($e,{className:"w-32 h-32 border-4 border-slate-800 shadow-2xl group-hover:border-indigo-500/50 transition-colors duration-300",children:[e.jsx(Je,{src:r||(h==null?void 0:h.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&color=fff`}),e.jsx(Ge,{className:"bg-slate-800 text-3xl font-bold text-indigo-400",children:a.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Kr,{className:"w-8 h-8 text-white/80"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-white text-center mb-1",children:a}),e.jsx("p",{className:"text-indigo-400 text-sm font-medium",children:h!=null&&h.username?`@${h.username}`:s?c==="ar"?"Ø¯Ø±Ø¯Ø´Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Chat":c==="ar"?"~Ù…Ø³ØªØ®Ø¯Ù…":"~User"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-8",children:[e.jsxs("button",{onClick:d,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(fr,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ØµÙˆØª":"Audio"})]}),e.jsxs("button",{onClick:p,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/10 flex items-center justify-center group-hover:bg-violet-500/20 text-violet-400 transition-colors",children:e.jsx(We,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ÙÙŠØ¯ÙŠÙˆ":"Video"})]}),e.jsxs("button",{onClick:m,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center group-hover:bg-emerald-500/20 text-emerald-400 transition-colors",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"Ø§Ù„Ù…Ù„Ù":"Profile"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5",children:[e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-widest font-black mb-4 ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©":"Personal Info"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400 shrink-0",children:e.jsx(He,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-100 text-[15px] leading-relaxed break-words",children:(h==null?void 0:h.about)||(c==="ar"?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©":"No bio provided")}),e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-wider mt-1 font-bold ${c==="ar"?"font-arabic":""}`,children:l("about")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-400",children:e.jsx(He,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.gender)==="male"?l("male"):(h==null?void 0:h.gender)==="female"?l("female"):c==="ar"?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":"Not specified"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("gender")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400",children:e.jsx(Gt,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.birth_year)||"----"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("birth_year")})]})]})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(Qr,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm truncate",children:(h==null?void 0:h.email)||(s?c==="ar"?"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Conversation":c==="ar"?"Ù…Ø®ÙÙŠ":"Hidden")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]})]}),(h==null?void 0:h.created_at)&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(Gt,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(h.created_at).toLocaleDateString(c==="ar"?"ar-EG":"en-US")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:o,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest font-bold",children:c==="ar"?"Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª":"Media, Links & Docs"}),e.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1 group-hover:text-indigo-400 transition-colors",children:[E.length," ",e.jsx("span",{className:"opacity-50",children:"â€º"})]})]}),E.length>0?e.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.slice(0,4).map((w,R)=>{var k;return e.jsxs("div",{className:"aspect-square rounded-lg bg-slate-800 border border-white/5 overflow-hidden relative group/img",children:[(k=w.fileType)!=null&&k.startsWith("image")?e.jsx("img",{src:w.fileUrl,alt:"Media",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-800",children:e.jsx(We,{className:"w-5 h-5 text-slate-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover/img:bg-transparent transition-colors"})]},w.id||R)})}):e.jsx("p",{className:"text-slate-600 text-xs italic py-2",children:c==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ³Ø§Ø¦Ø· Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¹Ø¯.":"No shared media yet."})]}),s&&(h==null?void 0:h.group_id)&&e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:()=>{const w=`${window.location.origin}?join=${h.group_id}`;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(w).then(()=>Q.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})).catch(()=>Q.error(c==="ar"?"ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·":"Failed to copy link"));else try{const R=document.createElement("textarea");R.value=w,document.body.appendChild(R),R.select(),document.execCommand("copy"),document.body.removeChild(R),Q.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})}catch{Q.error(c==="ar"?"ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ¸Ø©":"Clipboard access denied",{description:c==="ar"?"ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹.":"Please manually copy the link."})}},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white transition-colors",children:c==="ar"?"Ø¯Ø¹ÙˆØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·":"Invite to Group via Link"}),e.jsx("p",{className:"text-slate-500 text-xs",children:c==="ar"?"Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©":"Tap to copy invite link"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(Ot,{className:"w-5 h-5 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"ÙƒØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª":"Mute Notifications"})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(ba,{className:"w-5 h-5 text-slate-400 group-hover:text-yellow-400 transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ù†Ø¬Ù…Ø©":"Starred Messages"})})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(va,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?`Ø­Ø¸Ø± ${a}`:`Block ${a}`})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(ya,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?"Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Report Contact"})})]})]})]})]})]})}function bi({messages:t,onClose:a}){const[r,s]=u.useState("media"),[n,i]=u.useState(null),{media:o,docs:d,links:p}=u.useMemo(()=>{const c=[],l=[],h=[];return t.forEach(v=>{var E,w,R;v.fileUrl&&((E=v.fileType)!=null&&E.startsWith("image/")||(w=v.fileType)!=null&&w.startsWith("video/"))?c.push(v):v.fileUrl&&l.push(v);const x=/(https?:\/\/[^\s]+)/g,P=(R=v.text)==null?void 0:R.match(x);P&&P.forEach(k=>{h.push({...v,linkUrl:k})})}),{media:c.reverse(),docs:l.reverse(),links:h.reverse()}},[t]),m=[{id:"media",label:"Media"},{id:"docs",label:"Docs"},{id:"links",label:"Links"}];return e.jsxs(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute inset-0 z-[150] bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-900 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Ye,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Media, Links & Docs"})]}),e.jsx("div",{className:"flex border-b border-white/5 bg-slate-900/50",children:m.map(c=>e.jsxs("button",{onClick:()=>s(c.id),className:te("flex-1 py-3 text-sm font-medium relative transition-colors",r===c.id?"text-indigo-400":"text-slate-400 hover:text-slate-300"),children:[c.label,r===c.id&&e.jsx(z.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500"})]},c.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-950 p-4 custom-scrollbar",children:[r==="media"&&e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-2",children:o.length>0?o.map(c=>{var l;return e.jsx("div",{className:"aspect-square relative group overflow-hidden rounded-lg bg-slate-900 border border-white/5",children:(l=c.fileType)!=null&&l.startsWith("image/")?e.jsx("img",{src:c.fileUrl,alt:c.fileName,className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform duration-300",onClick:()=>i(c.fileUrl)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-slate-800",children:e.jsx(We,{className:"w-8 h-8 text-slate-400"})})},c.id)}):e.jsxs("div",{className:"col-span-full py-20 text-center text-slate-500",children:[e.jsx(Kr,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No media shared"})]})}),r==="docs"&&e.jsx("div",{className:"space-y-2",children:d.length>0?d.map(c=>{var l;return e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400",children:e.jsx(Ft,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:c.fileName}),e.jsxs("p",{className:"text-xs text-slate-500 uppercase",children:[((l=c.fileType)==null?void 0:l.split("/")[1])||"FILE"," â€¢ ",new Date(c.timestamp).toLocaleDateString()]})]}),e.jsx("a",{href:c.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-500 hover:text-white rounded-full hover:bg-white/10 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Xr,{className:"w-4 h-4"})})]},c.id)}):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(Ft,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No documents found"})]})}),r==="links"&&e.jsx("div",{className:"space-y-2",children:p.length>0?p.map((c,l)=>e.jsxs("div",{className:"flex gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400 flex-shrink-0",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("a",{href:c.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:underline text-sm font-medium truncate block",children:c.linkUrl}),c.text!==c.linkUrl&&e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5",children:c.text}),e.jsx("p",{className:"text-[10px] text-slate-600 mt-1",children:new Date(c.timestamp).toLocaleDateString()})]})]},l)):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No links shared"})]})})]}),e.jsx(je,{children:n&&e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200] bg-black/95 backdrop-blur-md flex items-center justify-center p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition-colors",onClick:()=>i(null),children:e.jsx(Ee,{className:"w-6 h-6"})}),e.jsx(z.img,{initial:{scale:.9},animate:{scale:1},src:n||"",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:c=>c.stopPropagation()})]})})]})}function vi({onClose:t,onSend:a}){const[r,s]=u.useState(""),[n,i]=u.useState(["",""]),o=()=>{n.length<10&&i([...n,""])},d=(c,l)=>{const h=[...n];h[c]=l,i(h)},p=c=>{n.length>2&&i(n.filter((l,h)=>h!==c))},m=()=>{const c=n.filter(l=>l.trim()!=="");r.trim()&&c.length>=2&&(a(r,c),t())};return e.jsx(z.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-3xl w-full max-w-md shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-gradient-to-r from-brand/10 to-violet-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl text-brand",children:e.jsx(Jr,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white leading-none",children:"Create Poll"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ask your friends anything"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full transition-all",children:e.jsx(Ee,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(ja,{className:"w-4 h-4 text-brand"}),"Question"]}),e.jsx(Te,{value:r,onChange:c=>s(c.target.value),placeholder:"What's on your mind?",dir:"auto",className:"bg-slate-950 border-white/5 focus:border-brand/50 h-12 text-white placeholder:text-slate-600 rounded-xl px-4"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Options"}),n.map((c,l)=>e.jsx(z.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-2 group",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Te,{value:c,onChange:h=>d(l,h.target.value),placeholder:`Option ${l+1}`,dir:"auto",className:"bg-slate-950/50 border-white/5 focus:border-brand/50 h-11 text-white placeholder:text-slate-700 rounded-xl px-4"}),l>=2&&e.jsx("button",{onClick:()=>p(l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Ee,{className:"w-4 h-4"})})]})},l)),n.length<10&&e.jsxs("button",{onClick:o,className:"w-full py-3 border-2 border-dashed border-slate-800 rounded-xl text-slate-500 hover:text-brand hover:border-brand/30 transition-all flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(wa,{className:"w-4 h-4"}),"Add Option"]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-950/50 flex gap-3",children:[e.jsx(pe,{variant:"ghost",onClick:t,className:"flex-1 text-slate-400 hover:text-white hover:bg-white/5 h-12 rounded-xl font-bold",children:"Cancel"}),e.jsxs(pe,{onClick:m,disabled:!r.trim()||n.filter(c=>c.trim()).length<2,className:"flex-1 bg-gradient-to-r from-brand to-violet-600 hover:from-brand/80 hover:to-violet-500 text-white shadow-lg shadow-brand/20 h-12 rounded-xl font-bold gap-2",children:[e.jsx(Ut,{className:"w-4 h-4"}),"Create Poll"]})]})]})})}function yi({audioUrl:t,duration:a,messageId:r,onPlayNext:s}){const{activeMessageId:n,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:m}=Cs(),[c,l]=u.useState(!1),[h,v]=u.useState(()=>r?localStorage.getItem(`vp_played_${r}`)==="true":!0),[x,P]=u.useState(a||0),[E,w]=u.useState(0),[R,k]=u.useState(1),[M,$]=u.useState(!1),[q,C]=u.useState(!1),f=u.useRef(null);u.useRef(null);const S=u.useRef(a||0),_=35,j=u.useMemo(()=>Array.from({length:_},()=>Math.floor(Math.random()*60)+20),[]);u.useEffect(()=>{a&&a>0&&(P(a),S.current=a)},[a]),u.useEffect(()=>{const g=f.current;if(!g)return;const Y=()=>w(g.currentTime),K=()=>{g.duration&&!isNaN(g.duration)&&g.duration!==1/0&&(P(g.duration),S.current=g.duration)};return g.addEventListener("timeupdate",Y),g.addEventListener("loadedmetadata",K),g.addEventListener("durationchange",K),g.addEventListener("play",()=>l(!0)),g.addEventListener("pause",()=>l(!1)),g.muted=q,()=>{g.removeEventListener("timeupdate",Y),g.removeEventListener("loadedmetadata",K),g.removeEventListener("durationchange",K)}},[t,q]),u.useEffect(()=>{r&&(n===r?f.current&&f.current.paused&&(f.current.play().catch(()=>{}),h||(v(!0),localStorage.setItem(`vp_played_${r}`,"true"))):f.current&&!f.current.paused&&f.current.pause())},[n,r,h]),u.useEffect(()=>{if(r&&s)return d(r,s),()=>p(r)},[r,s,d,p]);const N=u.useCallback(()=>{l(!1),w(0),f.current&&(f.current.currentTime=0),r&&m(r)},[r,m]);u.useEffect(()=>{const g=f.current;if(g)return g.addEventListener("ended",N),()=>g.removeEventListener("ended",N)},[N]);const y=async g=>{g==null||g.stopPropagation(),!(!f.current||!r)&&(h||(v(!0),localStorage.setItem(`vp_played_${r}`,"true")),c?o(r):i(r))},F=g=>{if(g.stopPropagation(),!f.current||!S.current)return;const Y=g.currentTarget.getBoundingClientRect(),K=g.clientX-Y.left,I=Math.min(Math.max(0,K/Y.width),1)*S.current;f.current.currentTime=I,w(I)},D=g=>{if(g.stopPropagation(),!f.current)return;const Y=[1,1.5,2],K=Y[(Y.indexOf(R)+1)%Y.length];k(K),f.current.playbackRate=K},T=g=>{const Y=Math.floor(g/60),K=Math.floor(g%60);return`${Y}:${K.toString().padStart(2,"0")}`},B=S.current>0?E/S.current*100:0;return e.jsxs("div",{className:"flex items-center gap-3 w-full py-1 group/player select-none",onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),children:[e.jsxs(z.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:y,className:te("w-10 h-10 rounded-full flex items-center justify-center transition-all bg-white/10 hover:bg-white/20 text-white border border-white/10 shadow-lg relative",c&&"bg-brand hover:bg-brand/80 border-brand",!h&&"ring-2 ring-sky-400 ring-offset-2 ring-offset-slate-900"),children:[c?e.jsx(Na,{className:"w-5 h-5 fill-current"}):e.jsx(Ca,{className:"w-5 h-5 fill-current ml-0.5"}),!h&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-sky-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsxs("div",{className:"h-10 flex items-center gap-[3px] cursor-pointer group/wave relative",onClick:F,children:[j.map((g,Y)=>{const K=Y/_*100,A=B>K;return e.jsx(z.div,{initial:!1,animate:{height:`${g}%`,backgroundColor:A?h?"#818cf8":"#38bdf8":h?"rgba(255,255,255,0.15)":"rgba(56,189,248,0.2)"},transition:{type:"spring",stiffness:300,damping:20},className:te("flex-1 rounded-full min-h-[4px] transition-shadow duration-300",A&&(h?"shadow-[0_0_8px_rgba(129,140,248,0.5)]":"shadow-[0_0_10px_rgba(56,189,248,0.6)]"))},Y)}),e.jsx("div",{className:"absolute inset-0 z-10 opacity-0 group-hover/wave:opacity-100 bg-gradient-to-r from-transparent via-white/5 to-transparent pointer-events-none transition-opacity duration-300"})]}),e.jsxs("div",{className:"flex justify-between items-center px-0.5 opacity-60 group-hover/player:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"text-[10px] font-mono font-medium text-white/70 flex gap-1",children:[e.jsx("span",{className:"text-white font-bold",children:T(E)}),e.jsxs("span",{children:["/ ",T(x)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>{const g=!q;C(g),f.current&&(f.current.muted=g)},className:"p-1 rounded-md bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/5 transition-all",title:q?"ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª":"ÙƒØªÙ… Ø§Ù„ØµÙˆØª",children:q?e.jsx(Zr,{className:"w-3 h-3"}):e.jsx(Bt,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:D,className:te("text-[10px] font-bold px-1.5 py-0.5 rounded-md transition-all border",R===1?"bg-white/5 text-white/40 border-white/5":"bg-brand text-white border-brand"),children:[R,"x"]})]})]})]}),e.jsx("audio",{ref:f,src:t,hidden:!0})]})}function ji({currentUserId:t,partnerId:a,partnerName:r,partnerAvatar:s,messages:n,isPartnerOnline:i,isPartnerTyping:o,onBack:d,onSendMessage:p,onSendVoiceMessage:m,onDeleteMessage:c,onTyping:l,onRefresh:h,onReact:v,onSendPoll:x,onVote:P,onStartCall:E,onEditMessage:w,smartReplies:R=[],isGroup:k,onJoinGroup:M,onShowProfile:$,onClearChat:q,language:C,t:f}){const{playMessage:S}=Cs(),[_,j]=u.useState(null),[N,y]=u.useState(null),[F,D]=u.useState(!1),T=u.useRef(null),[B,g]=u.useState(null),[Y,K]=u.useState(null),[A,I]=u.useState(!1),[b,W]=u.useState(!1),[V,O]=u.useState(""),[Z,ae]=u.useState(!1),[le,ue]=u.useState(!1),[Ie,Ce]=u.useState(!1),dt=Z||le||Ie||!!N,Re=u.useRef(null);u.useRef(!1);const Xe=u.useRef(null),Ke=u.useRef(n.length),{wallpaper:Se,bgOpacity:st}=ks();u.useEffect(()=>{g(null),K(null),j(null),O("")},[a]);const be=(U="auto")=>{T.current&&T.current.scrollIntoView({behavior:U})};u.useLayoutEffect(()=>{n.length>0&&(n[n.length-1].senderId===t||!F)&&be("smooth"),Ke.current=n.length},[n,t,F,a]),u.useLayoutEffect(()=>{be("auto"),Xe.current=a},[a]);const de=()=>{if(!Re.current)return;const{scrollTop:U,scrollHeight:ce,clientHeight:Oe}=Re.current,Be=ce-U-Oe<200;D(!Be)},ut=u.useCallback(U=>new Date(U).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),[]),we=u.useCallback(U=>{if(!U){g(null);return}g(ce=>ce===U?null:U)},[]),Ae=u.useCallback(U=>{j({id:U.id,senderName:U.senderId===t?C==="ar"?"Ø£Ù†Øª":"You":r,text:U.text,fileType:U.fileType}),g(null)},[t,C,r]),jt=u.useCallback((U,ce)=>{K({id:U,text:ce}),g(null)},[]),wt=u.useCallback(()=>{be("smooth")},[]),Qe=u.useCallback((U,ce)=>{var Oe,Me,Be;if(!U.fileUrl||!U.fileType)return null;if(U.fileType.startsWith("image/"))return e.jsx(z.div,{whileHover:{scale:1.02},className:"mb-2 overflow-hidden rounded-lg",children:e.jsx("img",{src:U.fileUrl,alt:U.fileName||"Image",className:"max-w-full max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>y({url:U.fileUrl,type:U.fileType,name:U.fileName||"Image"})})});if(U.fileType.startsWith("video/"))return e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-black/20",children:e.jsx("video",{src:U.fileUrl,controls:!0,className:"max-w-full max-h-64"})});if((Oe=U.fileType)!=null&&Oe.startsWith("audio/")||U.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(U.fileName||"")){const mt=n.findIndex(De=>De.id===U.id),qe=n[mt+1],ft=qe&&(De=>{var Pe;return((Pe=De.fileType)==null?void 0:Pe.startsWith("audio/"))||De.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(De.fileName||"")})(qe);return e.jsx(yi,{audioUrl:U.fileUrl||"",messageId:U.id,onPlayNext:ft?()=>S(qe.id):void 0,duration:((Me=U.fileName)!=null&&Me.includes("duration=")?parseFloat(U.fileName.split("duration=")[1]):void 0)||((Be=U.fileUrl)!=null&&Be.includes("duration=")?parseFloat(U.fileUrl.split("duration=")[1]):void 0)})}return e.jsxs("div",{className:te("flex items-center gap-3 mb-2 p-3 rounded-xl cursor-pointer hover:opacity-80 transition-all border",ce?"bg-brand/20 border-brand/30":"bg-slate-800/60 border-white/10"),onClick:()=>y({url:U.fileUrl,type:U.fileType,name:U.fileName||"File"}),children:[e.jsx("div",{className:te("p-2 rounded-lg",ce?"bg-brand/20":"bg-slate-700/50"),children:e.jsx(Ft,{className:te("w-5 h-5",ce?"text-brand":"text-slate-400")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:U.fileName}),e.jsx("p",{className:"text-xs opacity-70 uppercase",children:U.fileType.split("/")[1]||"FILE"})]})]})},[n,S]),Nt=u.useMemo(()=>{const U=new Map;return n.forEach(ce=>U.set(ce.id,ce)),U},[n]),ve=u.useMemo(()=>V.trim()?n.filter(U=>U.text.toLowerCase().includes(V.toLowerCase())):n,[n,V]);return e.jsxs("div",{className:"flex flex-col h-full bg-[#0b141a] overflow-hidden relative",children:[e.jsx(je,{children:B&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-20 bg-black/20 backdrop-blur-sm",onClick:()=>g(null)})}),e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden",children:[e.jsx(z.div,{animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-brand/15 rounded-full blur-[120px]"}),e.jsx(z.div,{animate:{scale:[1,1.3,1],x:[0,-40,0],y:[0,-20,0]},transition:{duration:25,repeat:1/0,ease:"linear",delay:2},className:"absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-violet-600/15 rounded-full blur-[100px]"}),e.jsx("div",{className:te("absolute inset-0 transition-opacity duration-700",Se==="doodles"&&"premium-doodle opacity-30 mix-blend-overlay",Se==="stars"&&"wallpaper-stars opacity-40 mix-blend-screen",Se==="geometric"&&"wallpaper-geometric opacity-20 mix-blend-overlay",Se==="solid"&&"wallpaper-solid"),style:{opacity:Se==="solid"?1:st}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-slate-950/50"})]}),e.jsxs("div",{className:"bg-[#0b141a]/60 backdrop-blur-xl px-4 py-3 flex items-center gap-3 sticky top-0 z-50 border-b border-white/5 shadow-lg",children:[e.jsx("button",{onClick:d,className:"text-slate-400 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full",children:e.jsx(Ye,{className:"w-6 h-6"})}),e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ae(!0),children:[e.jsxs($e,{className:"w-10 h-10 border-2 border-slate-800 group-hover:border-brand transition-colors",children:[e.jsx(Je,{src:s||`https://ui-avatars.com/api/?name=${encodeURIComponent(r)}&background=random&color=fff`}),e.jsx(Ge,{className:"bg-slate-800 text-brand font-bold",children:(r||"?").charAt(0).toUpperCase()})]}),i&&!k&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-emerald-500 border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>ae(!0),children:[e.jsxs("h2",{className:"text-white font-bold truncate text-lg flex items-center gap-2",children:[r," ",k&&e.jsx("span",{className:"bg-slate-800 text-slate-400 text-[10px] px-1.5 py-0.5 rounded border border-white/5",children:"GROUP"})]}),!k&&e.jsx("div",{className:"text-xs flex items-center gap-1 h-4",children:e.jsx(je,{mode:"wait",children:o?e.jsxs(z.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"flex items-center gap-1.5 text-indigo-400 font-medium",children:[e.jsx("span",{className:"text-[10px]",children:"typing"}),e.jsx("span",{className:"flex gap-0.5",children:[0,1,2].map(U=>e.jsx(z.span,{animate:{y:[0,-2,0]},transition:{repeat:1/0,duration:.5,delay:U*.1},className:"w-1 h-1 bg-indigo-400 rounded-full"},U))})]}):i?e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},className:"text-emerald-500 font-medium",children:"Online"}):e.jsx(z.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-500",children:"Offline"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>W(!b),className:te("p-2 rounded-full transition-colors",b?"text-indigo-400 bg-indigo-500/10":"text-slate-400 hover:text-white hover:bg-white/5"),children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:h,className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(es,{className:"w-5 h-5"})}),!k&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>E("audio"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(fr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>E("video"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(We,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>I(!A),className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(mr,{className:"w-5 h-5"})}),e.jsx(je,{children:A&&e.jsxs(z.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute top-full right-0 mt-2 w-48 bg-slate-900 border border-white/10 rounded-xl shadow-2xl py-1 z-[100] overflow-hidden",children:[e.jsx("button",{onClick:()=>{ae(!0),I(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Contact Info"}),e.jsx("button",{onClick:()=>{q&&q(),I(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Clear Chat"}),e.jsx("div",{className:"h-px bg-white/5 my-1"}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:"Close Chat"})]})})]})]})]}),e.jsx(je,{children:b&&e.jsx(z.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-slate-900/50 backdrop-blur-md border-b border-white/5 px-4 py-2 relative z-40 overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search in conversation...",value:V,onChange:U=>O(U.target.value),className:"w-full bg-slate-950/50 border border-white/5 rounded-xl pl-10 pr-10 py-2 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all font-light"}),V&&e.jsx("button",{onClick:()=>O(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white",children:e.jsx(Ee,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{ref:Re,onScroll:de,className:"flex-1 overflow-y-auto overflow-x-hidden p-4 px-6 space-y-4 custom-scrollbar relative message-container-glass",children:[ve.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-indigo-500/20 to-violet-500/20 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(tt,{className:"w-10 h-10 text-indigo-400"})}),e.jsxs("p",{className:"text-center font-medium",children:[V?"No matches found":"No messages yet.",e.jsx("br",{}),e.jsx("span",{className:"text-sm opacity-60",children:V?"Try searching for something else":"Start the conversation!"})]})]}):ve.map((U,ce)=>e.jsx(ui,{message:U,currentUserId:t,partnerName:r,isGroup:k,isSequential:ce>0&&ve[ce-1].senderId===U.senderId,isMenuOpen:B===U.id,onToggleMenu:we,onReact:v,onReply:Ae,onDelete:c,onEdit:jt,onVote:P,setViewingFile:y,repliedMessage:U.replyToId&&Nt.get(U.replyToId)||null,language:C,t:f,formatMessageTime:ut,renderFilePreview:Qe,onJoinGroup:M,isAnyOverlayOpen:dt},U.id)),e.jsx("div",{ref:T})]}),F&&e.jsx(z.button,{initial:{scale:0},animate:{scale:1},onClick:()=>be("smooth"),className:"absolute bottom-24 right-6 bg-indigo-600 text-white p-3 rounded-full shadow-lg z-40 hover:bg-indigo-500 transition-colors",children:e.jsx(Ye,{className:"w-6 h-6 rotate-[-90deg]"})}),e.jsx(je,{children:R.length>0&&!V&&e.jsx(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar relative z-30",children:R.map((U,ce)=>e.jsx("button",{onClick:()=>p(U),dir:/[\u0600-\u06FF]/.test(U)?"rtl":"ltr",className:te("whitespace-nowrap bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-300 border border-indigo-500/20 px-4 py-1.5 rounded-full text-xs font-medium transition-all backdrop-blur-md",/[\u0600-\u06FF]/.test(U)?"font-arabic":""),children:U},ce))})}),e.jsx(hi,{onSendMessage:p,currentUserId:t,replyTo:_,setReplyTo:j,onTyping:l,t:f,language:C,onSendVoiceMessage:m,editingMessage:Y,setEditingMessage:K,onEditMessage:w,scrollToBottom:wt,isGroup:k,setShowPollCreator:Ce}),N&&e.jsx(xi,{url:N.url,type:N.type,name:N.name,onClose:()=>y(null)}),e.jsx(je,{children:Z&&e.jsxs(e.Fragment,{children:[e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#020617] backdrop-blur-md z-[1000]",onClick:()=>ae(!1)}),e.jsx(gi,{partnerId:a,partnerName:r,partnerAvatar:s,isGroup:k,onClose:()=>ae(!1),messages:n,onOpenGallery:()=>{ue(!0),ae(!1)},onAudioCall:()=>E("audio"),onVideoCall:()=>E("video"),onShowProfile:()=>{$(a),ae(!1)},language:C,t:f})]})}),e.jsx(je,{children:le&&e.jsx(bi,{messages:n,onClose:()=>ue(!1)})}),e.jsx(je,{children:Ie&&e.jsx(vi,{onClose:()=>Ce(!1),onSend:x})})]})}const wi=u.memo(ji);function Ni({callerName:t,type:a,onAccept:r,onReject:s,language:n}){return e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:e.jsxs(z.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-8 shadow-2xl border border-white/10 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full flex items-center justify-center text-4xl text-white font-bold shadow-xl",children:t.charAt(0).toUpperCase()}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-indigo-400 text-sm",children:n==="ar"?a==="video"?"Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø±Ø¯Ø©...":"Ù…ÙƒØ§Ù„Ù…Ø© ØµÙˆØªÙŠØ© ÙˆØ§Ø±Ø¯Ø©...":`Incoming ${a} call...`})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:s,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 active:scale-95 transition-all flex items-center justify-center shadow-lg",children:e.jsx(ts,{className:"w-7 h-7 text-white"})}),e.jsx("button",{onClick:r,className:"w-16 h-16 rounded-full bg-green-600 hover:bg-green-700 active:scale-95 transition-all flex items-center justify-center shadow-lg animate-pulse",children:e.jsx(fr,{className:"w-7 h-7 text-white"})})]})]})})}function Ci({onFinish:t,language:a}){return u.useEffect(()=>{const r=setTimeout(()=>{t()},3e3);return()=>clearTimeout(r)},[t]),e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen w-full bg-slate-950 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[20%] left-[10%] w-[60vw] h-[60vw] bg-indigo-600/10 rounded-full blur-[120px] animate-blob"}),e.jsx("div",{className:"absolute bottom-[20%] right-[10%] w-[50vw] h-[50vw] bg-violet-600/10 rounded-full blur-[100px] animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-20"})]}),e.jsxs(z.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"relative z-10 flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx(z.div,{animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 bg-indigo-500 rounded-full blur-2xl"}),e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-[2.5rem] flex items-center justify-center shadow-2xl relative z-10 border border-white/20 transform rotate-3",children:e.jsx(dr,{className:"w-16 h-16 text-white fill-white/10",strokeWidth:1.5})}),e.jsx(z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"absolute -bottom-2 -right-2 w-12 h-12 bg-slate-900 border border-emerald-500/50 rounded-2xl flex items-center justify-center shadow-xl z-20",children:e.jsx(rs,{className:"w-6 h-6 text-emerald-400"})})]}),e.jsxs(z.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex flex-col items-center justify-center w-full max-w-md px-4",children:[e.jsx("h1",{className:"text-white text-4xl sm:text-5xl md:text-6xl font-black mb-4 tracking-tighter text-center w-full leading-tight",children:"Chat App"}),e.jsx("p",{className:"text-indigo-400 font-medium text-sm md:text-base mb-10 text-center w-full",children:a==="ar"?"Ø§Ø®ØªØ¨Ø± Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª":"Experience the Future"})]}),e.jsx("div",{className:"w-48 h-1 overflow-hidden bg-slate-900 border border-white/5 rounded-full relative",children:e.jsx(z.div,{initial:{left:"-100%"},animate:{left:"100%"},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 bottom-0 w-1/2 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"})})]}),e.jsx(z.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"absolute bottom-10 text-slate-600 text-[10px] uppercase font-bold tracking-[0.4em]",children:"Secure Quantum Encryption v2.4"})]})}function Si({items:t,initialIndex:a=0,onClose:r,onNext:s,onPrevious:n,onReply:i,onDelete:o,currentUserId:d,language:p}){const[m,c]=u.useState(""),[l,h]=u.useState(!1),[v,x]=u.useState(a),[P,E]=u.useState(0),[w,R]=u.useState(!1),[k,M]=u.useState(!1),[$,q]=u.useState(!0),[C,f]=u.useState(5e3),S=u.useRef(null),_=u.useRef(null),j=t[v];u.useEffect(()=>{E(0),q(!0),f((j==null?void 0:j.content_type)==="video"?3e4:5e3)},[v,j==null?void 0:j.content_type]);const N=u.useCallback(()=>{v<t.length-1?x(T=>T+1):r()},[v,t.length,r]),y=u.useCallback(()=>{v>0?x(T=>T-1):n&&n()},[v,n]);u.useEffect(()=>{if(!j||$||k||l||w){S.current&&clearInterval(S.current);return}const T=30,B=T/C*100;return S.current=setInterval(()=>{E(g=>g>=100?(clearInterval(S.current),N(),100):g+B)},T),()=>{S.current&&clearInterval(S.current)}},[v,j,N,l,w,k,$,C]);const F=T=>{const B=T.target.duration*1e3;f(B),q(!1)};if(u.useEffect(()=>{_.current&&(k||l||w?_.current.pause():_.current.play().catch(()=>{}))},[k,l,w,j]),!j)return null;const D=d===j.user_id;return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-black flex flex-col md:rounded-3xl overflow-hidden shadow-2xl",onMouseDown:()=>M(!0),onMouseUp:()=>M(!1),onTouchStart:()=>M(!0),onTouchEnd:()=>M(!1),children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full p-2 pt-4 px-4 z-50 bg-gradient-to-b from-black/80 to-transparent",children:[e.jsx("div",{className:"flex gap-1.5 mb-4",children:t.map((T,B)=>e.jsx("div",{className:"flex-1 h-[2px] bg-white/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-30 ease-linear",style:{width:B<v?"100%":B===v?`${P}%`:"0%"}})},B))}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs($e,{className:"w-10 h-10 border border-white/10",children:[e.jsx(Je,{src:j.user_avatar}),e.jsx(Ge,{children:j.user_name?j.user_name.charAt(0):"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:j.user_name}),e.jsx("p",{className:"text-[10px] opacity-60",children:new Date(j.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 relative",children:[D&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onMouseDown:T=>T.stopPropagation(),onClick:()=>R(!w),className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(mr,{className:"w-5 h-5"})}),w&&e.jsx(z.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},className:"absolute right-0 top-full mt-2 w-48 bg-[#1f2c34] rounded-lg shadow-xl border border-white/10 overflow-hidden z-[1020]",children:e.jsxs("button",{onClick:()=>{o&&o(j.id),R(!1)},className:"flex items-center gap-3 w-full px-4 py-3 text-red-500 hover:bg-white/5 transition-colors text-sm",children:[e.jsx(pr,{className:"w-4 h-4"}),p==="ar"?"Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Delete Story"]})})]}),e.jsx("button",{onMouseDown:T=>T.stopPropagation(),onClick:r,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Ee,{className:"w-6 h-6"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[$&&j.content_type!=="text"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 bg-black/20",children:e.jsx(z.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-10 h-10 border-4 border-white/20 border-t-white rounded-full"})}),j.content_type==="text"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center p-10 bg-gradient-to-br from-indigo-600 to-violet-700",onMouseEnter:()=>q(!1),children:e.jsx("p",{className:"text-3xl font-bold text-white text-center leading-relaxed",children:j.text})}),j.content_type==="image"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("img",{src:j.content_url,alt:"Status",onLoad:()=>q(!1),className:"max-w-full max-h-full object-contain"}),j.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:j.text})]}),j.content_type==="video"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative bg-black",children:[e.jsx("video",{ref:_,src:j.content_url,autoPlay:!0,playsInline:!0,onLoadedMetadata:F,onPlay:()=>{var T;q(!1),k&&((T=_.current)==null||T.pause())},className:"max-w-full max-h-full"}),j.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:j.text})]}),e.jsxs("div",{className:"absolute inset-0 flex z-30",children:[e.jsx("div",{className:"w-[30%] h-full cursor-pointer",onClick:T=>{T.stopPropagation(),y()}}),e.jsx("div",{className:"flex-1 h-full"}),e.jsx("div",{className:"w-[30%] h-full cursor-pointer",onClick:T=>{T.stopPropagation(),N()}})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 z-[1010] bg-gradient-to-t from-black/90 to-transparent",children:e.jsxs("form",{onSubmit:T=>{T.preventDefault(),m.trim()&&i&&(i(m,j.id),c(""))},className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"text",value:m,onChange:T=>c(T.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:p==="ar"?"Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Reply to story...",className:"flex-1 bg-white/10 border border-white/20 rounded-full px-4 py-3 text-white placeholder:text-white/60 focus:outline-none focus:bg-white/20 backdrop-blur-md transition-all text-sm"}),m.trim()&&e.jsx("button",{type:"submit",className:"p-3 bg-brand rounded-full text-white shadow-lg hover:brightness-110 transition-all",children:e.jsx(Ut,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -left-16 items-center",children:e.jsx("button",{onClick:y,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(Sa,{className:"w-8 h-8"})})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -right-16 items-center",children:e.jsx("button",{onClick:N,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(ss,{className:"w-8 h-8"})})})]})}let _s=!0,Ts=!0;function gt(t,a,r){const s=t.match(a);return s&&s.length>=r&&parseFloat(s[r],10)}function rt(t,a,r){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,n=s.addEventListener;s.addEventListener=function(o,d){if(o!==a)return n.apply(this,arguments);const p=m=>{const c=r(m);c&&(d.handleEvent?d.handleEvent(c):d(c))};return this._eventMap=this._eventMap||{},this._eventMap[a]||(this._eventMap[a]=new Map),this._eventMap[a].set(d,p),n.apply(this,[o,p])};const i=s.removeEventListener;s.removeEventListener=function(o,d){if(o!==a||!this._eventMap||!this._eventMap[a])return i.apply(this,arguments);if(!this._eventMap[a].has(d))return i.apply(this,arguments);const p=this._eventMap[a].get(d);return this._eventMap[a].delete(d),this._eventMap[a].size===0&&delete this._eventMap[a],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,p])},Object.defineProperty(s,"on"+a,{get(){return this["_on"+a]},set(o){this["_on"+a]&&(this.removeEventListener(a,this["_on"+a]),delete this["_on"+a]),o&&this.addEventListener(a,this["_on"+a]=o)},enumerable:!0,configurable:!0})}function ki(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(_s=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ts=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Rs(){if(typeof window=="object"){if(_s)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function br(t,a){Ts&&console.warn(t+" is deprecated, please use "+a+" instead.")}function Ti(t){const a={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return a.browser="Not a browser.",a;const{navigator:r}=t;if(r.userAgentData&&r.userAgentData.brands){const s=r.userAgentData.brands.find(n=>n.brand==="Chromium");if(s)return{browser:"chrome",version:parseInt(s.version,10)}}if(r.mozGetUserMedia)a.browser="firefox",a.version=parseInt(gt(r.userAgent,/Firefox\/(\d+)\./,1));else if(r.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)a.browser="chrome",a.version=parseInt(gt(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))a.browser="safari",a.version=parseInt(gt(r.userAgent,/AppleWebKit\/(\d+)\./,1)),a.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,a._safariVersion=gt(r.userAgent,/Version\/(\d+(\.?\d+))/,1);else return a.browser="Not a supported browser.",a;return a}function Lr(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ps(t){return Lr(t)?Object.keys(t).reduce(function(a,r){const s=Lr(t[r]),n=s?Ps(t[r]):t[r],i=s&&!Object.keys(n).length;return n===void 0||i?a:Object.assign(a,{[r]:n})},{}):t}function ar(t,a,r){!a||r.has(a.id)||(r.set(a.id,a),Object.keys(a).forEach(s=>{s.endsWith("Id")?ar(t,t.get(a[s]),r):s.endsWith("Ids")&&a[s].forEach(n=>{ar(t,t.get(n),r)})}))}function Or(t,a,r){const s=r?"outbound-rtp":"inbound-rtp",n=new Map;if(a===null)return n;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===a.id&&i.push(o)}),i.forEach(o=>{t.forEach(d=>{d.type===s&&d.trackId===o.id&&ar(t,d,n)})}),n}const zr=Rs;function Es(t,a){const r=t&&t.navigator;if(!r.mediaDevices)return;const s=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;const c=typeof d[m]=="object"?d[m]:{ideal:d[m]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const l=function(h,v){return h?h+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(c.ideal!==void 0){p.optional=p.optional||[];let h={};typeof c.ideal=="number"?(h[l("min",m)]=c.ideal,p.optional.push(h),h={},h[l("max",m)]=c.ideal,p.optional.push(h)):(h[l("",m)]=c.ideal,p.optional.push(h))}c.exact!==void 0&&typeof c.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[l("",m)]=c.exact):["min","max"].forEach(h=>{c[h]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[l(h,m)]=c[h])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},n=function(d,p){if(a.version>=61)return p(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const m=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])};d=JSON.parse(JSON.stringify(d)),m(d.audio,"autoGainControl","googAutoGainControl"),m(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=s(d.audio)}if(d&&typeof d.video=="object"){let m=d.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});const c=a.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete d.video.facingMode;let l;if(m.exact==="environment"||m.ideal==="environment"?l=["back","rear"]:(m.exact==="user"||m.ideal==="user")&&(l=["front"]),l)return r.mediaDevices.enumerateDevices().then(h=>{h=h.filter(x=>x.kind==="videoinput");let v=h.find(x=>l.some(P=>x.label.toLowerCase().includes(P)));return!v&&h.length&&l.includes("back")&&(v=h[h.length-1]),v&&(d.video.deviceId=m.exact?{exact:v.deviceId}:{ideal:v.deviceId}),d.video=s(d.video),zr("chrome: "+JSON.stringify(d)),p(d)})}d.video=s(d.video)}return zr("chrome: "+JSON.stringify(d)),p(d)},i=function(d){return a.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(d,p,m){n(d,c=>{r.webkitGetUserMedia(c,p,l=>{m&&m(i(l))})})};if(r.getUserMedia=o.bind(r),r.mediaDevices.getUserMedia){const d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return n(p,m=>d(m).then(c=>{if(m.audio&&!c.getAudioTracks().length||m.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(i(c))))}}}function Is(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Ms(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.track.id):i={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[s.stream],this.dispatchEvent(o)}),s.stream.getTracks().forEach(n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.id):i={track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[s.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),a.apply(this,arguments)}}else rt(t,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a))}function As(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const a=function(n,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=n.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:n}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,p){let m=n.apply(this,arguments);return m||(m=a(this,d),this._senders.push(m)),m};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){i.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(a(this,o))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(o=>{const d=this._senders.find(p=>p.track===o);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const a=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=a.apply(this,[]);return s.forEach(n=>n._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ds(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=s.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Or(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),rt(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>Or(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let n,i,o;return this.getSenders().forEach(d=>{d.track===s&&(n?o=!0:n=d)}),this.getReceivers().forEach(d=>(d.track===s&&(i?o=!0:i=d),d.track===s)),o||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}function Ls(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,d){if(!d)return a.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=a.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(m=>{if(this.getSenders().find(l=>l.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(m=>d.indexOf(m)===-1);this._shimmedLocalStreams[o.id]=[o].concat(p)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(o);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),n.apply(this,arguments)}}function Os(t,a){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&a.version>=65)return Ls(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(v=>v.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const l=new t.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}s.apply(this,[c])};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(P=>P===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(P=>P.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const x=this._streams[l.id];if(x)x.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const P=new t.MediaStream([c]);this._streams[l.id]=P,this._reverseStreams[P.id]=l,this.addStream(P)}return this.getSenders().find(P=>P.track===c)};function i(m,c){let l=c.sdp;return Object.keys(m._reverseStreams||[]).forEach(h=>{const v=m._reverseStreams[h],x=m._streams[v.id];l=l.replace(new RegExp(x.id,"g"),v.id)}),new RTCSessionDescription({type:c.type,sdp:l})}function o(m,c){let l=c.sdp;return Object.keys(m._reverseStreams||[]).forEach(h=>{const v=m._reverseStreams[h],x=m._streams[v.id];l=l.replace(new RegExp(v.id,"g"),x.id)}),new RTCSessionDescription({type:c.type,sdp:l})}["createOffer","createAnswer"].forEach(function(m){const c=t.RTCPeerConnection.prototype[m],l={[m](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[x=>{const P=i(this,x);h[0].apply(null,[P])},x=>{h[1]&&h[1].apply(null,x)},arguments[2]]):c.apply(this,arguments).then(x=>i(this,x))}};t.RTCPeerConnection.prototype[m]=l[m]});const d=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=o(this,arguments[0]),d.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return m.type===""?m:i(this,m)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(P=>c.track===P)&&(h=this._streams[v])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nr(t,a){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],n={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=n[r]})}function zs(t,a){rt(t,"negotiationneeded",r=>{const s=r.target;if(!((a.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return r})}const Fr=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:zs,shimAddTrackRemoveTrack:Os,shimAddTrackRemoveTrackWithNative:Ls,shimGetSendersWithDtmf:As,shimGetUserMedia:Es,shimMediaStream:Is,shimOnTrack:Ms,shimPeerConnection:nr,shimSenderReceiverGetStats:Ds},Symbol.toStringTag,{value:"Module"}));function Fs(t,a){const r=t&&t.navigator,s=t&&t.MediaStreamTrack;if(r.getUserMedia=function(n,i,o){br("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(n).then(i,o)},!(a.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const n=function(o,d,p){d in o&&!(p in o)&&(o[p]=o[d],delete o[d])},i=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},s&&s.prototype.getSettings){const o=s.prototype.getSettings;s.prototype.getSettings=function(){const d=o.apply(this,arguments);return n(d,"mozAutoGainControl","autoGainControl"),n(d,"mozNoiseSuppression","noiseSuppression"),d}}if(s&&s.prototype.applyConstraints){const o=s.prototype.applyConstraints;s.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),n(d,"autoGainControl","mozAutoGainControl"),n(d,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[d])}}}}function Ri(t,a){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return s.video===!0?s.video={mediaSource:a}:s.video.mediaSource=a,t.navigator.mediaDevices.getUserMedia(s)})}function $s(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ir(t,a){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=o[n]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,d]=arguments;return s.apply(this,[i||null]).then(p=>{if(a.version<53&&!o)try{p.forEach(m=>{m.type=r[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;p.forEach((c,l)=>{p.set(l,Object.assign({},c,{type:r[c.type]||c.type}))})}return p}).then(o,d)}}function Gs(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const a=t.RTCPeerConnection.prototype.getSenders;a&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=a.apply(this,[]);return n.forEach(i=>i._pc=this),n});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Bs(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const a=t.RTCPeerConnection.prototype.getReceivers;a&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=a.apply(this,[]);return s.forEach(n=>n._pc=this),s}),rt(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function qs(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){br("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&r.getTracks().includes(s.track)&&this.removeTrack(s)})})}function Vs(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Us(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.addTransceiver;a&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const n=s.length>0;n&&s.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=a.apply(this,arguments);if(n){const{sender:o}=i,d=o.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=s,o.sendEncodings=s,this.setParametersPromises.push(o.setParameters(d).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function Hs(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const a=t.RTCRtpSender.prototype.getParameters;a&&(t.RTCRtpSender.prototype.getParameters=function(){const s=a.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Ws(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}function Ys(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}const $r=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Us,shimCreateAnswer:Ys,shimCreateOffer:Ws,shimGetDisplayMedia:Ri,shimGetParameters:Hs,shimGetUserMedia:Fs,shimOnTrack:$s,shimPeerConnection:ir,shimRTCDataChannel:Vs,shimReceiverGetStats:Bs,shimRemoveStream:qs,shimSenderGetStats:Gs},Symbol.toStringTag,{value:"Module"}));function Js(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(n=>a.call(this,n,s)),s.getVideoTracks().forEach(n=>a.call(this,n,s))},t.RTCPeerConnection.prototype.addTrack=function(s,...n){return n&&n.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),a.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const n=r.getTracks();this.getSenders().forEach(i=>{n.includes(i.track)&&this.removeTrack(i)})})}}function Xs(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const i=new Event("addstream");i.stream=n,this.dispatchEvent(i)})})}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(i)>=0)return;s._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,s.dispatchEvent(o)})}),a.apply(s,arguments)}}}function Ks(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,r=a.createOffer,s=a.createAnswer,n=a.setLocalDescription,i=a.setRemoteDescription,o=a.addIceCandidate;a.createOffer=function(m,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[l]);return c?(h.then(m,c),Promise.resolve()):h},a.createAnswer=function(m,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=s.apply(this,[l]);return c?(h.then(m,c),Promise.resolve()):h};let d=function(p,m,c){const l=n.apply(this,[p]);return c?(l.then(m,c),Promise.resolve()):l};a.setLocalDescription=d,d=function(p,m,c){const l=i.apply(this,[p]);return c?(l.then(m,c),Promise.resolve()):l},a.setRemoteDescription=d,d=function(p,m,c){const l=o.apply(this,[p]);return c?(l.then(m,c),Promise.resolve()):l},a.addIceCandidate=d}function Qs(t){const a=t&&t.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){const r=a.mediaDevices,s=r.getUserMedia.bind(r);a.mediaDevices.getUserMedia=n=>s(Zs(n))}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=(function(s,n,i){a.mediaDevices.getUserMedia(s).then(n,i)}).bind(a))}function Zs(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ps(t.video)}):t}function ea(t){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection;t.RTCPeerConnection=function(s,n){if(s&&s.iceServers){const i=[];for(let o=0;o<s.iceServers.length;o++){let d=s.iceServers[o];d.urls===void 0&&d.url?(br("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,i.push(d)):i.push(s.iceServers[o])}s.iceServers=i}return new a(s,n)},t.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in a&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return a.generateCertificate}})}function ta(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ra(t){const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):s.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return a.apply(this,arguments)}}function sa(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Gr=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:sa,shimCallbacksAPI:Ks,shimConstraints:Zs,shimCreateOfferLegacy:ra,shimGetUserMedia:Qs,shimLocalStreamsAPI:Js,shimRTCIceServerUrls:ea,shimRemoteStreamsAPI:Xs,shimTrackEventTransceiver:ta},Symbol.toStringTag,{value:"Module"}));var Kt={exports:{}},Br;function Pi(){return Br||(Br=1,(function(t){const a={};a.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},a.localCName=a.generateIdentifier(),a.splitLines=function(r){return r.trim().split(`
`).map(s=>s.trim())},a.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},a.getDescription=function(r){const s=a.splitSections(r);return s&&s[0]},a.getMediaSections=function(r){const s=a.splitSections(r);return s.shift(),s},a.matchPrefix=function(r,s){return a.splitLines(r).filter(n=>n.indexOf(s)===0)},a.parseCandidate=function(r){let s;r.indexOf("a=candidate:")===0?s=r.substring(12).split(" "):s=r.substring(10).split(" ");const n={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let i=8;i<s.length;i+=2)switch(s[i]){case"raddr":n.relatedAddress=s[i+1];break;case"rport":n.relatedPort=parseInt(s[i+1],10);break;case"tcptype":n.tcpType=s[i+1];break;case"ufrag":n.ufrag=s[i+1],n.usernameFragment=s[i+1];break;default:n[s[i]]===void 0&&(n[s[i]]=s[i+1]);break}return n},a.writeCandidate=function(r){const s=[];s.push(r.foundation);const n=r.component;n==="rtp"?s.push(1):n==="rtcp"?s.push(2):s.push(n),s.push(r.protocol.toUpperCase()),s.push(r.priority),s.push(r.address||r.ip),s.push(r.port);const i=r.type;return s.push("typ"),s.push(i),i!=="host"&&r.relatedAddress&&r.relatedPort&&(s.push("raddr"),s.push(r.relatedAddress),s.push("rport"),s.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(s.push("ufrag"),s.push(r.usernameFragment||r.ufrag)),"candidate:"+s.join(" ")},a.parseIceOptions=function(r){return r.substring(14).split(" ")},a.parseRtpMap=function(r){let s=r.substring(9).split(" ");const n={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),n.name=s[0],n.clockRate=parseInt(s[1],10),n.channels=s.length===3?parseInt(s[2],10):1,n.numChannels=n.channels,n},a.writeRtpMap=function(r){let s=r.payloadType;r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType);const n=r.channels||r.numChannels||1;return"a=rtpmap:"+s+" "+r.name+"/"+r.clockRate+(n!==1?"/"+n:"")+`\r
`},a.parseExtmap=function(r){const s=r.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},a.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},a.parseFmtp=function(r){const s={};let n;const i=r.substring(r.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)n=i[o].trim().split("="),s[n[0].trim()]=n[1];return s},a.writeFmtp=function(r){let s="",n=r.payloadType;if(r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const i=[];Object.keys(r.parameters).forEach(o=>{r.parameters[o]!==void 0?i.push(o+"="+r.parameters[o]):i.push(o)}),s+="a=fmtp:"+n+" "+i.join(";")+`\r
`}return s},a.parseRtcpFb=function(r){const s=r.substring(r.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},a.writeRtcpFb=function(r){let s="",n=r.payloadType;return r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(i=>{s+="a=rtcp-fb:"+n+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),s},a.parseSsrcMedia=function(r){const s=r.indexOf(" "),n={ssrc:parseInt(r.substring(7,s),10)},i=r.indexOf(":",s);return i>-1?(n.attribute=r.substring(s+1,i),n.value=r.substring(i+1)):n.attribute=r.substring(s+1),n},a.parseSsrcGroup=function(r){const s=r.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(n=>parseInt(n,10))}},a.getMid=function(r){const s=a.matchPrefix(r,"a=mid:")[0];if(s)return s.substring(6)},a.parseFingerprint=function(r){const s=r.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},a.getDtlsParameters=function(r,s){return{role:"auto",fingerprints:a.matchPrefix(r+s,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(r,s){let n="a=setup:"+s+`\r
`;return r.fingerprints.forEach(i=>{n+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),n},a.parseCryptoLine=function(r){const s=r.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},a.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?a.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const s=r.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},a.getCryptoParameters=function(r,s){return a.matchPrefix(r+s,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(r,s){const n=a.matchPrefix(r+s,"a=ice-ufrag:")[0],i=a.matchPrefix(r+s,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},a.writeIceParameters=function(r){let s="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(s+=`a=ice-lite\r
`),s},a.parseRtpParameters=function(r){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=a.splitLines(r)[0].split(" ");s.profile=i[2];for(let d=3;d<i.length;d++){const p=i[d],m=a.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(m){const c=a.parseRtpMap(m),l=a.matchPrefix(r,"a=fmtp:"+p+" ");switch(c.parameters=l.length?a.parseFmtp(l[0]):{},c.rtcpFeedback=a.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),s.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(c.name.toUpperCase());break}}}a.matchPrefix(r,"a=extmap:").forEach(d=>{s.headerExtensions.push(a.parseExtmap(d))});const o=a.matchPrefix(r,"a=rtcp-fb:* ").map(a.parseRtcpFb);return s.codecs.forEach(d=>{o.forEach(p=>{d.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),s},a.writeRtpDescription=function(r,s){let n="";n+="m="+r+" ",n+=s.codecs.length>0?"9":"0",n+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=s.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(o=>{n+=a.writeRtpMap(o),n+=a.writeFmtp(o),n+=a.writeRtcpFb(o)});let i=0;return s.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(n+="a=maxptime:"+i+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(o=>{n+=a.writeExtmap(o)}),n},a.parseRtpEncodingParameters=function(r){const s=[],n=a.parseRtpParameters(r),i=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(r,"a=ssrc:").map(h=>a.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),p=d.length>0&&d[0].ssrc;let m;const c=a.matchPrefix(r,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(x=>parseInt(x,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(m=c[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let v={ssrc:p,codecPayloadType:parseInt(h.parameters.apt,10)};p&&m&&(v.rtx={ssrc:m}),s.push(v),i&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:p,mechanism:o?"red+ulpfec":"red"},s.push(v))}}),s.length===0&&p&&s.push({ssrc:p});let l=a.matchPrefix(r,"b=");return l.length&&(l[0].indexOf("b=TIAS:")===0?l=parseInt(l[0].substring(7),10):l[0].indexOf("b=AS:")===0?l=parseInt(l[0].substring(5),10)*1e3*.95-2e3*8:l=void 0,s.forEach(h=>{h.maxBitrate=l})),s},a.parseRtcpParameters=function(r){const s={},n=a.matchPrefix(r,"a=ssrc:").map(d=>a.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];n&&(s.cname=n.value,s.ssrc=n.ssrc);const i=a.matchPrefix(r,"a=rtcp-rsize");s.reducedSize=i.length>0,s.compound=i.length===0;const o=a.matchPrefix(r,"a=rtcp-mux");return s.mux=o.length>0,s},a.writeRtcpParameters=function(r){let s="";return r.reducedSize&&(s+=`a=rtcp-rsize\r
`),r.mux&&(s+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(s+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),s},a.parseMsid=function(r){let s;const n=a.matchPrefix(r,"a=msid:");if(n.length===1)return s=n[0].substring(7).split(" "),{stream:s[0],track:s[1]};const i=a.matchPrefix(r,"a=ssrc:").map(o=>a.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return s=i[0].value.split(" "),{stream:s[0],track:s[1]}},a.parseSctpDescription=function(r){const s=a.parseMLine(r),n=a.matchPrefix(r,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const o=a.matchPrefix(r,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:s.fmt,maxMessageSize:i};const d=a.matchPrefix(r,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},a.writeSctpDescription=function(r,s){let n=[];return r.protocol!=="DTLS/SCTP"?n=["m="+r.kind+" 9 "+r.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:n=["m="+r.kind+" 9 "+r.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&n.push("a=max-message-size:"+s.maxMessageSize+`\r
`),n.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(r,s,n){let i;const o=s!==void 0?s:2;return r?i=r:i=a.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(r,s){const n=a.splitLines(r);for(let i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substring(2)}return s?a.getDirection(s):"sendrecv"},a.getKind=function(r){return a.splitLines(r)[0].split(" ")[0].substring(2)},a.isRejected=function(r){return r.split(" ",2)[1]==="0"},a.parseMLine=function(r){const n=a.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},a.parseOLine=function(r){const n=a.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},a.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const s=a.splitLines(r);for(let n=0;n<s.length;n++)if(s[n].length<2||s[n].charAt(1)!=="=")return!1;return!0},t.exports=a})(Kt)),Kt.exports}var aa=Pi();const ot=ia(aa),Ei=Ma({__proto__:null,default:ot},[aa]);function It(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const a=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const n=new a(s),i=ot.parseCandidate(s.candidate);for(const o in i)o in n||Object.defineProperty(n,o,{value:i[o]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new a(s)},t.RTCIceCandidate.prototype=a.prototype,rt(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function or(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||rt(t,"icecandidate",a=>{if(a.candidate){const r=ot.parseCandidate(a.candidate.candidate);r.type==="relay"&&(a.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return a})}function Mt(t,a){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(d){if(!d||!d.sdp)return!1;const p=ot.splitSections(d.sdp);return p.shift(),p.some(m=>{const c=ot.parseMLine(m);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},s=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const m=parseInt(p[1],10);return m!==m?-1:m},n=function(d){let p=65536;return a.browser==="firefox"&&(a.version<57?d===-1?p=16384:p=2147483637:a.version<60?p=a.version===57?65535:65536:p=2147483637),p},i=function(d,p){let m=65536;a.browser==="firefox"&&a.version===57&&(m=65535);const c=ot.matchPrefix(d.sdp,"a=max-message-size:");return c.length>0?m=parseInt(c[0].substring(19),10):a.browser==="firefox"&&p!==-1&&(m=2147483637),m},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,a.browser==="chrome"&&a.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=s(arguments[0]),m=n(p),c=i(arguments[0],p);let l;m===0&&c===0?l=Number.POSITIVE_INFINITY:m===0||c===0?l=Math.max(m,c):l=Math.min(m,c);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return l}}),this._sctp=h}return o.apply(this,arguments)}}function At(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function a(s,n){const i=s.send;s.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(s.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(s,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return a(n,this),n},rt(t,"datachannel",s=>(a(s.channel,s.target),s))}function lr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const a=t.RTCPeerConnection.prototype;Object.defineProperty(a,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const s=a[r];a[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const i=n.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",n);i.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function cr(t,a){if(!t.RTCPeerConnection||a.browser==="chrome"&&a.version>=71||a.browser==="safari"&&a._safariVersion>=13.1)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function Dt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(a.browser==="chrome"&&a.version<78||a.browser==="firefox"&&a.version<68||a.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Lt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>r.apply(this,[o]))})}const Ii=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:cr,shimAddIceCandidateNullOrEmpty:Dt,shimConnectionState:lr,shimMaxMessageSize:Mt,shimParameterlessSetLocalDescription:Lt,shimRTCIceCandidate:It,shimRTCIceCandidateRelayProtocol:or,shimSendThrowTypeError:At},Symbol.toStringTag,{value:"Module"}));function Mi({window:t}={},a={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Rs,s=Ti(t),n={browserDetails:s,commonShim:Ii,extractVersion:gt,disableLog:ki,disableWarnings:_i,sdp:Ei};switch(s.browser){case"chrome":if(!Fr||!nr||!a.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(s.version===null)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=Fr,Dt(t,s),Lt(t),Es(t,s),Is(t),nr(t,s),Ms(t),Os(t,s),As(t),Ds(t),zs(t,s),It(t),or(t),lr(t),Mt(t,s),At(t),cr(t,s);break;case"firefox":if(!$r||!ir||!a.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=$r,Dt(t,s),Lt(t),Fs(t,s),ir(t,s),$s(t),qs(t),Gs(t),Bs(t),Vs(t),Us(t),Hs(t),Ws(t),Ys(t),It(t),lr(t),Mt(t,s),At(t);break;case"safari":if(!Gr||!a.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=Gr,Dt(t,s),Lt(t),ea(t),ra(t),Ks(t),Js(t),Xs(t),ta(t),Qs(t),sa(t),It(t),or(t),Mt(t,s),At(t),cr(t,s);break;default:r("Unsupported browser!");break}return n}Mi({window:typeof window>"u"?void 0:window});function Ai({callId:t,callerId:a,callerName:r,recipientId:s,isIncoming:n,type:i,onEndCall:o,currentUserId:d,sendSignaling:p,incomingOffer:m,remoteAnswer:c,remoteIceCandidates:l}){const[h,v]=u.useState("ringing"),[x,P]=u.useState(0),[E,w]=u.useState(!1),[R,k]=u.useState(i==="audio"),[M,$]=u.useState(!0),[q,C]=u.useState("user"),[f,S]=u.useState(null),[_,j]=u.useState(null),N=u.useRef(null),y=u.useRef(null),F=u.useRef(null),D=u.useRef(null),T={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceCandidatePoolSize:10},B=(V,O,Z)=>{const ae=V.split(`
`);let le=-1;for(let ue=0;ue<ae.length;ue++)if(ae[ue].indexOf("m="+O)===0){le=ue;break}if(le===-1)return V;for(le++;le<ae.length&&ae[le].indexOf("m=")!==0;){if(ae[le].indexOf("b=AS:")===0)return ae[le]="b=AS:"+Z,ae.join(`
`);le++}return ae.splice(le,0,"b=AS:"+Z),ae.join(`
`)},g=u.useCallback(()=>{f==null||f.getTracks().forEach(V=>V.stop()),N.current&&(N.current.onicecandidate=null,N.current.ontrack=null,N.current.close(),N.current=null),S(null),j(null)},[f]),Y=u.useCallback(()=>{g(),o()},[g,o]);u.useEffect(()=>{let V;return h==="connected"&&(V=setInterval(()=>{P(O=>O+1)},1e3)),()=>clearInterval(V)},[h]);const K=V=>{const O=Math.floor(V/60),Z=V%60;return`${O}:${Z.toString().padStart(2,"0")}`};u.useEffect(()=>{h!=="ended"&&(async()=>{try{f==null||f.getTracks().forEach(Z=>Z.stop());const O=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:i==="video"?{facingMode:q,width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:60}}:!1});if(S(O),N.current){const Z=O.getVideoTracks()[0],ae=N.current.getSenders().find(le=>{var ue;return((ue=le.track)==null?void 0:ue.kind)==="video"});ae&&Z&&ae.replaceTrack(Z).catch(le=>console.error("Replace track failed:",le))}}catch(O){console.error("getUserMedia failed:",O),Q.error("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©"),v("ended")}})()},[i,q,t]),u.useEffect(()=>{y.current&&f&&(y.current.srcObject=f)},[f]),u.useEffect(()=>f?((async()=>{try{if(!N.current){const O=new RTCPeerConnection(T);N.current=O,O.ontrack=Z=>{console.log("Remote track received"),j(Z.streams[0]),v("connected")},O.onicecandidate=Z=>{Z.candidate&&p(n?a:s,"ice-candidate",{id:t,candidate:Z.candidate})},O.oniceconnectionstatechange=()=>{(O.iceConnectionState==="disconnected"||O.iceConnectionState==="failed")&&console.log("ICE failed/disconnected")},f.getTracks().forEach(Z=>O.addTrack(Z,f))}if(n&&m&&N.current.signalingState==="stable"){await N.current.setRemoteDescription(new RTCSessionDescription(m));let O=await N.current.createAnswer();O.sdp=B(O.sdp,"audio",64),i==="video"&&(O.sdp=B(O.sdp,"video",1e3)),await N.current.setLocalDescription(O),p(a,"call-answer",{id:t,answer:O})}else if(!n&&N.current.signalingState==="stable"){let O=await N.current.createOffer();O.sdp=B(O.sdp,"audio",64),i==="video"&&(O.sdp=B(O.sdp,"video",1e3)),await N.current.setLocalDescription(O),p(s,"call-offer",{id:t,callerId:d,callerName:r,type:i,offer:O})}}catch(O){console.error("PC init failed:",O),Y()}})(),()=>{}):void 0,[f,t,n,m,i,d,r,p,Y,a,s]),u.useEffect(()=>{c&&N.current&&N.current.signalingState==="have-local-offer"&&N.current.setRemoteDescription(new RTCSessionDescription(c)).catch(V=>console.error("Error setting answer:",V))},[c]),u.useEffect(()=>{l&&N.current&&N.current.remoteDescription&&l.forEach(V=>{var O;(O=N.current)==null||O.addIceCandidate(new RTCIceCandidate(V)).catch(Z=>console.error("Error adding candidate:",Z))})},[l]),u.useEffect(()=>{F.current&&_&&i==="video"?(F.current.srcObject=_,F.current.play().catch(V=>console.warn("Auto-play blocked:",V))):D.current&&_&&i==="audio"&&(D.current.srcObject=_,D.current.play().catch(V=>console.warn("Auto-play blocked:",V)))},[_,i]);const A=()=>{if(f){const V=f.getAudioTracks()[0];V&&(V.enabled=E,w(!E))}},I=()=>{if(f&&i==="video"){const V=f.getVideoTracks()[0];V&&(V.enabled=R,k(!R))}},b=()=>{$(!M),F.current&&(F.current.muted=!M),D.current&&(D.current.muted=!M)},W=()=>{C(V=>V==="user"?"environment":"user")};return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-[#111b21] flex flex-col items-center justify-center p-4",children:[i==="video"?e.jsx("video",{ref:F,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-6 mb-20",children:[e.jsx($e,{className:"w-32 h-32 border-4 border-brand/30 shadow-2xl scale-in-center",children:e.jsx(Ge,{className:"bg-[#202c33] text-brand text-4xl font-bold",children:r.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-white text-3xl font-bold mb-2",children:r}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"text-brand font-medium animate-pulse uppercase tracking-widest text-xs",children:h==="ringing"?n?"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©...":_?"ÙŠØ±Ù† Ø§Ù„Ø¢Ù†...":"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...":h==="connected"?"Ù…ØªØµÙ„":"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©"}),h==="connected"&&e.jsx("p",{className:"text-white/60 font-mono text-lg",children:K(x)})]})]}),e.jsx("audio",{ref:D,autoPlay:!0})]}),i==="video"&&h==="connected"&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-20 bg-black/40 px-4 py-1 rounded-full backdrop-blur-md border border-white/10",children:e.jsx("p",{className:"text-white font-mono",children:K(x)})}),i==="video"&&f&&e.jsx("div",{className:"absolute top-6 right-6 w-32 md:w-48 aspect-[3/4] rounded-xl overflow-hidden shadow-2xl border-2 border-white/20 z-10",children:e.jsx("video",{ref:y,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover -scale-x-100"})}),e.jsxs("div",{className:"absolute bottom-12 flex items-center gap-6 bg-[#202c33]/90 backdrop-blur-xl p-6 rounded-full border border-white/10 shadow-2xl z-20",children:[e.jsx(pe,{onClick:A,className:`w-14 h-14 rounded-full transition-all ${E?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:E?e.jsx(ka,{}):e.jsx($t,{})}),i==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{onClick:I,className:`w-14 h-14 rounded-full transition-all ${R?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:R?e.jsx(_a,{}):e.jsx(We,{})}),e.jsx(pe,{onClick:W,className:"w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 transition-all",children:e.jsx(es,{className:"w-6 h-6"})})]}),e.jsx(pe,{onClick:b,className:`w-14 h-14 rounded-full ${M?"bg-gray-700":"bg-red-500"}`,children:M?e.jsx(Bt,{}):e.jsx(Zr,{})}),e.jsx(pe,{onClick:Y,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center",children:e.jsx(ts,{className:"w-8 h-8"})})]})]})}function nt({icon:t,title:a,subtitle:r,onClick:s,colorClass:n="bg-brand/10 text-brand",isDestructive:i=!1,trailing:o}){return e.jsxs("button",{onClick:s,className:`w-full flex items-center gap-4 p-4 rounded-xl border border-transparent hover:bg-white/5 transition-all text-left group ${i?"hover:bg-red-500/10":""}`,children:[e.jsx("div",{className:`p-2.5 rounded-xl ${i?"bg-red-500/10 text-red-500":n} transition-transform group-hover:scale-110`,children:e.jsx(t,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base ${i?"text-red-500":"text-white"}`,children:a}),r&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:r})]}),o||e.jsx("div",{className:`text-gray-600 ${i?"text-red-500/50":""}`,children:e.jsx(ss,{className:"w-5 h-5 rtl:rotate-180"})})]})}function xt({title:t,onBack:a,language:r}){return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ye,{className:`w-6 h-6 ${r==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent",children:t})]})}function Di({user:t,onBack:a,onGoToProfile:r,onLogout:s,notificationsEnabled:n,onEnableNotifications:i,micEnabled:o,onEnableMic:d,soundEnabled:p,onToggleSound:m,currentSoundId:c,notificationSounds:l,onSelectSound:h,onTestSound:v,language:x,onLanguageChange:P,t:E,camEnabled:w,onEnableCam:R}){const[k,M]=u.useState("main"),[$,q]=u.useState(null),C=u.useRef(null),{accentColor:f,setAccentColor:S,wallpaper:_,setWallpaper:j,bgOpacity:N,setBgOpacity:y}=ks();u.useEffect(()=>()=>{$==null||$.getTracks().forEach(I=>I.stop())},[$]),u.useEffect(()=>{C.current&&$&&(C.current.srcObject=$)},[$]);const F=()=>{$==null||$.getTracks().forEach(I=>I.stop()),q(null)},D=async()=>{try{const I=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});q(I)}catch{Q.error(x==="ar"?"ÙØ´Ù„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§":"Failed to access camera")}},T=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{onClick:r,className:"relative overflow-hidden flex items-center gap-4 bg-gradient-to-br from-[#202c33] to-[#111b21] p-5 rounded-2xl border border-white/5 hover:border-brand/30 transition-all cursor-pointer group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-brand/10 rounded-full blur-3xl -mr-16 -mt-16 transition-opacity group-hover:opacity-100 opacity-50"}),e.jsxs($e,{className:"w-16 h-16 border-2 border-white/10 group-hover:border-brand/50 transition-colors shadow-lg",children:[e.jsx(Je,{src:t.avatar_url}),e.jsx(Ge,{className:"text-xl bg-brand text-white",children:t.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 z-10",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-sm truncate",children:["@",t.username]})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-gray-400 group-hover:bg-brand group-hover:text-white transition-colors",children:e.jsx(He,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"px-1 text-xs font-bold text-gray-500 uppercase tracking-wider",children:x==="ar"?"Ø¹Ø§Ù…":"General"}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:[e.jsx(nt,{icon:Ot,title:x==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£ØµÙˆØ§Øª":"Notifications & Sounds",subtitle:x==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª":"Messages, groups, call tones",colorClass:"bg-red-500/10 text-red-400",onClick:()=>M("notifications")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(nt,{icon:Vr,title:x==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†":"Privacy & Security",subtitle:x==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©":"App lock, active sessions",colorClass:"bg-emerald-500/10 text-emerald-400",onClick:()=>M("privacy")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(nt,{icon:Cr,title:x==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",subtitle:x==="ar"?"Ù†Ù…Ø· Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ Ø§Ù„Ø£Ù„ÙˆØ§Ù†":"Wallpaper, theme colors",colorClass:"bg-purple-500/10 text-purple-400",onClick:()=>M("appearance")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(nt,{icon:Ta,title:x==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",subtitle:x==="ar"?"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"English",colorClass:"bg-blue-500/10 text-blue-400",onClick:()=>M("language")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(nt,{icon:We,title:x==="ar"?"Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Camera & Microphone",subtitle:x==="ar"?"Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙˆØ§Ù„Ø£Ø°ÙˆÙ†Ø§Øª":"Test hardware and permissions",colorClass:"bg-amber-500/10 text-amber-400",onClick:()=>M("media")})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:e.jsx(nt,{icon:Ra,title:x==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":"Log Out",onClick:s,isDestructive:!0})})}),e.jsx("p",{className:"text-center text-xs text-gray-600 pt-4",children:"Chat App v1.2.0 â€¢ 2024"})]}),B=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(xt,{title:x==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications",onBack:()=>M("main"),language:x}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n?"bg-brand/20 text-brand":"bg-gray-800 text-gray-500"}`,children:e.jsx(Ot,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:x==="ar"?"Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨":"Desktop Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:n?"Enabled":"Disabled"})]})]}),e.jsx(pe,{onClick:()=>{it.requestNotificationPermission().then(I=>{I?i():Q.error(x==="ar"?"ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications disabled in browser")})},disabled:n,variant:n?"ghost":"outline",children:n?x==="ar"?"Ù…ÙØ¹Ù„":"On":x==="ar"?"ØªÙØ¹ÙŠÙ„":"Turn On"})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${p?"bg-orange-500/20 text-orange-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(Bt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:x==="ar"?"Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Conversation Tones"}),e.jsx("p",{className:"text-sm text-gray-500",children:x==="ar"?"ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©":"Play sounds for incoming messages"})]})]}),e.jsx("div",{onClick:()=>m(!p),className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${p?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${p?"right-1":"left-1"}`})})]}),p&&e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 space-y-3",children:[e.jsx("p",{className:"text-sm font-bold text-gray-400 uppercase",children:x==="ar"?"Ù†ØºÙ…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±":"Alert Tone"}),l.map(I=>e.jsxs("div",{onClick:()=>h(I.id),className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all border ${c===I.id?"bg-brand/10 border-brand/50 scale-[1.02]":"bg-transparent border-transparent hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${c===I.id?"border-brand":"border-gray-500"}`,children:c===I.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand"})}),e.jsx("span",{className:"text-sm font-medium",children:I.name})]}),e.jsx("button",{onClick:b=>{b.stopPropagation(),new Audio(I.url).play()},className:"p-2 hover:bg-white/10 rounded-full text-brand",children:e.jsx(Bt,{className:"w-4 h-4"})})]},I.id))]})]})]}),g=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(xt,{title:x==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",onBack:()=>M("main"),language:x}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Cr,{className:"w-5 h-5 text-purple-400"}),e.jsx("h4",{className:"font-medium text-white",children:x==="ar"?"Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"Accent Color"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",children:Object.keys(sr).map(I=>e.jsx("button",{onClick:()=>S(I),className:`w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-lg ${f===I?"ring-2 ring-white scale-110":"opacity-70 hover:opacity-100 hover:scale-105"}`,style:{backgroundColor:sr[I].hex},children:f===I&&e.jsx(Fe,{className:"w-6 h-6 text-white drop-shadow-md"})},I))})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pa,{className:"w-5 h-5 text-amber-400"}),e.jsx("h4",{className:"font-medium text-white",children:x==="ar"?"Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Chat Wallpaper"})]}),e.jsxs("select",{value:_,onChange:I=>j(I.target.value),className:"bg-black/30 text-white text-sm rounded-lg px-3 py-2 outline-none border border-white/10 focus:border-brand",children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"doodles",children:"Doodles"}),e.jsx("option",{value:"stars",children:"Stars Pattern"}),e.jsx("option",{value:"geometric",children:"Geometric"}),e.jsx("option",{value:"solid",children:"Solid Color"})]})]}),_!=="solid"&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:x==="ar"?"Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ù†Ù…Ø·":"Pattern Opacity"}),e.jsxs("span",{className:"text-xs text-brand font-bold",children:[Math.round(N*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:N,onChange:I=>y(parseFloat(I.target.value)),className:"w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand"})]})]})]})]}),Y=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(xt,{title:x==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ©":"Privacy & Security",onBack:()=>M("main"),language:x}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-emerald-500/20 text-emerald-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(rs,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:x==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"App Lock"}),e.jsx("p",{className:"text-sm text-gray-500",children:x==="ar"?"ØªØ£Ù…ÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±Ù…Ø² Ù…Ø±ÙˆØ±":"Secure app with passcode"})]})]}),e.jsx("div",{onClick:()=>{const I=localStorage.getItem("chat_app_lock_enabled")==="true";localStorage.setItem("chat_app_lock_enabled",(!I).toString()),M("privacy"),window.dispatchEvent(new Event("storage"))},className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${localStorage.getItem("chat_app_lock_enabled")==="true"?"right-1":"left-1"}`})})]}),localStorage.getItem("chat_app_lock_enabled")==="true"&&e.jsxs("div",{className:"bg-[#202c33]/30 rounded-xl border border-white/5 overflow-hidden animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("span",{className:"text-sm font-medium",children:x==="ar"?"Ø±Ù…Ø² Ø§Ù„Ù…Ø±ÙˆØ±":"Passcode"}),e.jsx(pe,{onClick:()=>{if(localStorage.getItem("chat_app_pin"))localStorage.removeItem("chat_app_pin"),localStorage.removeItem("chat_app_biometric"),Q.success("Passcode removed"),M("privacy");else{const b=prompt("Enter new 6-digit PIN:");b&&b.length===6&&!isNaN(Number(b))&&(localStorage.setItem("chat_app_pin",b),Q.success("Passcode set"),M("privacy"))}},variant:"outline",size:"sm",className:"h-8",children:localStorage.getItem("chat_app_pin")?x==="ar"?"ØªØºÙŠÙŠØ± / Ø­Ø°Ù":"Change / Remove":x==="ar"?"Ø¥Ø¹Ø¯Ø§Ø¯":"Setup"})]}),localStorage.getItem("chat_app_pin")&&e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:x==="ar"?"Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡ / Ø§Ù„Ø¥ØµØ¨Ø¹":"Biometric Unlock"}),e.jsx(pe,{onClick:()=>{const I=localStorage.getItem("chat_app_biometric")==="true";localStorage.setItem("chat_app_biometric",(!I).toString()),M("privacy"),Q.success(I?"Biometrics disabled":"Biometrics enabled (if supported)")},variant:"ghost",size:"sm",className:localStorage.getItem("chat_app_biometric")==="true"?"text-brand":"text-gray-400",children:localStorage.getItem("chat_app_biometric")==="true"?x==="ar"?"Ù…ÙØ¹Ù„":"Enabled":x==="ar"?"Ù…Ø¹Ø·Ù„":"Disabled"})]})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${o?"bg-blue-500/20 text-blue-400":"bg-gray-800 text-gray-500"}`,children:e.jsx($t,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:x==="ar"?"Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Microphone Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:o?"Granted":"Needed for voice notes"})]})]}),e.jsx(pe,{onClick:()=>{it.requestMicPermission().then(I=>{I?d():Q.error(x==="ar"?"ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙˆØª":"Microphone access required")})},disabled:o,variant:o?"ghost":"outline",children:o?x==="ar"?"Ù…Ø³Ù…ÙˆØ­":"Allowed":x==="ar"?"Ø³Ù…Ø§Ø­":"Allow"})]})]})]}),K=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(xt,{title:x==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",onBack:()=>M("main"),language:x}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5 divide-y divide-white/5",children:[e.jsxs("button",{onClick:()=>{P("en"),M("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium",children:"English"}),x==="en"&&e.jsx(Fe,{className:"w-5 h-5 text-brand"})]}),e.jsxs("button",{onClick:()=>{P("ar"),M("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium font-arabic",children:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}),x==="ar"&&e.jsx(Fe,{className:"w-5 h-5 text-brand"})]})]})]}),A=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(xt,{title:x==="ar"?"Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Camera & Microphone",onBack:()=>{F(),M("main")},language:x}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-6 border border-white/5 flex flex-col items-center gap-6",children:[e.jsx("div",{className:"w-full aspect-video bg-black rounded-xl overflow-hidden relative border border-white/10 shadow-inner",children:$?e.jsx("video",{ref:C,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}):e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-500 gap-3",children:[e.jsx(We,{className:"w-12 h-12 opacity-20"}),e.jsx("p",{className:"text-sm",children:x==="ar"?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø©":"No preview"})]})}),e.jsx("div",{className:"flex gap-4 w-full",children:$?e.jsx(pe,{onClick:F,variant:"destructive",className:"flex-1 py-6 text-base shadow-lg",children:x==="ar"?"Ø¥ÙŠÙ‚Ø§Ù":"Stop Test"}):e.jsxs(pe,{onClick:D,className:"flex-1 bg-brand hover:bg-brand/90 py-6 text-base shadow-lg",children:[e.jsx(tt,{className:"w-5 h-5 mr-2"}),x==="ar"?"Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±":"Start Test"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 p-4 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-brand"}),e.jsx("span",{className:"text-sm font-bold text-white",children:x==="ar"?"Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§":"Camera"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:w?x==="ar"?"Ù…Ø³Ù…ÙˆØ­":"Granted":x==="ar"?"ØºÙŠØ± Ù…ÙØ¹Ù„":"Not granted"})]}),e.jsxs("div",{className:"bg-[#202c33]/50 p-4 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx($t,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-bold text-white",children:x==="ar"?"Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Microphone"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:o?x==="ar"?"Ù…Ø³Ù…ÙˆØ­":"Granted":x==="ar"?"ØºÙŠØ± Ù…ÙØ¹Ù„":"Not granted"})]})]}),e.jsx("div",{className:"bg-brand/5 p-4 rounded-xl border border-brand/20",children:e.jsx("p",{className:"text-xs leading-relaxed text-brand/80",children:x==="ar"?"Ù†ØµÙŠØ­Ø©: Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙˆØ§Ø¬Ù‡ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ù‡Ù†Ø§ ÙˆÙ‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.":"Tip: If you have issues with calls, ensure permissions are granted here and refresh your browser page."})})]})]});return e.jsxs("div",{className:"flex flex-col h-full bg-[#111b21] text-white",children:[k==="main"&&e.jsxs("div",{className:"p-4 bg-[#202c33]/80 backdrop-blur-md sticky top-0 z-10 flex items-center gap-4 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Ye,{className:`w-6 h-6 ${x==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold",children:E("settings")})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto ${k==="main"?"p-6":"p-6 bg-[#111b21]"}`,children:[k==="main"&&T(),k==="notifications"&&B(),k==="appearance"&&g(),k==="privacy"&&Y(),k==="language"&&K(),k==="media"&&A()]})]})}function qr({user:t,onBack:a,onUpdate:r,isPublicView:s,language:n,t:i,onStartChat:o}){var y;const[d,p]=u.useState((t==null?void 0:t.name)||""),[m,c]=u.useState((t==null?void 0:t.birth_year)||""),[l,h]=u.useState((t==null?void 0:t.gender)||""),[v,x]=u.useState((t==null?void 0:t.about)||(s?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")),[P,E]=u.useState(!1),[w,R]=u.useState(!1),[k,M]=u.useState(!1),[$,q]=u.useState(!1),[C,f]=u.useState(!1),S=u.useRef(null),_=u.useRef(null),j=u.useRef(null);if(u.useEffect(()=>{t&&(p(t.name||""),c(t.birth_year||""),h(t.gender||""),x(t.about||(s?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")))},[t,s,n]),u.useEffect(()=>{w&&S.current&&S.current.focus()},[w]),u.useEffect(()=>{k&&_.current&&_.current.focus()},[k]),u.useEffect(()=>{$&&j.current&&j.current.focus()},[$]),!t)return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 items-center justify-center p-8 text-center space-y-4",children:[e.jsx(_e,{className:"w-12 h-12 text-brand animate-spin"}),e.jsx("p",{className:"text-slate-400 font-medium",children:n==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...":"Loading profile..."}),e.jsx("button",{onClick:a,className:"text-brand hover:underline",children:n==="ar"?"Ø±Ø¬ÙˆØ¹":"Go Back"})]});const N=async()=>{if(!d.trim())return Q.error(n==="ar"?"Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹":"Name cannot be empty");E(!0);try{const{error:F}=await ee.from("profiles").update({name:d.trim(),about:v.trim(),birth_year:m?parseInt(m.toString()):null,gender:l||null}).eq("id",t.id);if(F)throw F;Q.success(i("profileUpdatedSuccessfully")),r&&r({...t,name:d.trim(),about:v.trim(),birth_year:m?parseInt(m.toString()):null,gender:l||null}),R(!1),M(!1),q(!1),f(!1)}catch(F){console.error("Error updating profile:",F),Q.error(n==="ar"?"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ":"Failed to update profile")}finally{E(!1)}};return e.jsxs(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col h-full bg-slate-950 w-full relative overflow-hidden z-[500]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-brand/10 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-violet-500/5 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950 border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Ye,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${n==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-white text-xl font-bold ${n==="ar"?"font-arabic":""}`,children:i(s?"partnerProfile":"profile")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[e.jsxs("div",{className:`relative group ${s?"":"cursor-pointer"}`,children:[e.jsxs($e,{className:"w-40 h-40 border-4 border-slate-900 shadow-2xl group-hover:border-brand/50 transition-colors duration-500",children:[e.jsx(Je,{src:t==null?void 0:t.avatar_url,className:"object-cover"}),e.jsx(Ge,{className:"bg-slate-800 text-4xl font-bold text-brand",children:(y=t==null?void 0:t.name)==null?void 0:y.charAt(0).toUpperCase()})]}),!s&&e.jsxs("div",{className:"absolute inset-0 bg-black/40 rounded-full flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-sm",children:[e.jsx(as,{className:"w-8 h-8 text-white mb-2"}),e.jsx("span",{className:"text-xs text-white font-medium",children:n==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©":"Change Photo"})]})]}),s&&o&&e.jsxs(pe,{onClick:o,className:"bg-brand hover:bg-brand/80 text-white rounded-full px-8 shadow-lg shadow-brand/20 mt-6",children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),n==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©":"Send Message"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand text-xs font-bold uppercase tracking-wider",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("name")})]}),!w&&!s&&e.jsx("button",{onClick:()=>R(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(kt,{className:"w-4 h-4"})})]}),w?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Te,{ref:S,value:d,onChange:F=>p(F.target.value),className:"bg-slate-950/50 border-white/10 text-lg font-medium text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ":"Enter your name"}),e.jsx(pe,{size:"icon",onClick:N,disabled:P,className:"bg-brand hover:bg-brand/80",children:P?e.jsx(_e,{className:"w-4 h-4 animate-spin"}):e.jsx(Yt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-white text-lg font-medium pl-1",children:d})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("about")})]}),!k&&!s&&e.jsx("button",{onClick:()=>M(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(kt,{className:"w-4 h-4"})})]}),k?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(Te,{ref:_,value:v,onChange:F=>x(F.target.value),className:"bg-slate-950/50 border-white/10 text-base text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¶Ù Ù†Ø¨Ø°Ø©":"Add a bio"}),e.jsx(pe,{size:"icon",onClick:N,disabled:P,className:"bg-brand hover:bg-brand/80",children:P?e.jsx(_e,{className:"w-4 h-4 animate-spin"}):e.jsx(Yt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-slate-300 text-base pl-1",children:v})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("birth_year")})]}),!$&&!s&&e.jsx("button",{onClick:()=>q(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(kt,{className:"w-3 h-3"})})]}),$?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Te,{ref:j,type:"number",value:m,onChange:F=>c(F.target.value),className:"bg-slate-950/50 border-white/10 text-sm text-white h-8",placeholder:"YYYY"}),e.jsx(pe,{size:"icon",onClick:N,className:"h-8 w-8 bg-brand hover:bg-brand/80",children:e.jsx(Yt,{className:"w-3 h-3"})})]}):e.jsx("p",{className:"text-white text-base pl-1",children:m||(n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified")})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("gender")})]}),!C&&!s&&e.jsx("button",{onClick:()=>f(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(kt,{className:"w-3 h-3"})})]}),C?e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:l,onChange:F=>{h(F.target.value),setTimeout(()=>N(),100)},className:"bg-slate-950 text-white text-sm border-white/10 rounded-md p-1 flex-1 outline-none ring-1 ring-white/10",children:[e.jsx("option",{value:"",children:n==="ar"?"Ø§Ø®ØªØ§Ø±":"Select"}),e.jsx("option",{value:"male",children:i("male")}),e.jsx("option",{value:"female",children:i("female")})]})}):e.jsx("p",{className:"text-white text-base pl-1",children:l==="male"?i("male"):l==="female"?i("female"):n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Qr,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]}),e.jsx("p",{className:"text-slate-300 font-mono text-sm truncate",children:t.email||"Hidden"})]}),e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Gt,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]}),e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(t.created_at||Date.now()).toLocaleDateString()})]})]})]})]})})]})}function Li({onBack:t,currentUserId:a,language:r,t:s}){const[n,i]=u.useState(""),[o,d]=u.useState("user"),[p,m]=u.useState(null),[c,l]=u.useState(!1),[h,v]=u.useState(!1),[x,P]=u.useState(!1),E=async()=>{if(!n.trim())return;const k=n.trim().toLowerCase().replace(o==="user"?"@":"#","");l(!0),v(!1),m(null),await new Promise(M=>setTimeout(M,600));try{if(o==="user"){const{data:M}=await ee.from("profiles").select("id, display_name, username").eq("username",k).maybeSingle();if(M){if(M.id===a){v(!0);return}const{data:$}=await ee.from("conversation_participants").select("conversation_id").eq("user_id",M.id),q=($==null?void 0:$.map(S=>S.conversation_id))||[];let C=!1;if(q.length>0){const{data:S}=await ee.from("conversation_participants").select("conversation_id").eq("user_id",a).in("conversation_id",q).maybeSingle();C=!!S}const{data:f}=await ee.from("chat_requests").select("status, sender_id").or(`and(sender_id.eq.${a},receiver_id.eq.${M.id}),and(sender_id.eq.${M.id},receiver_id.eq.${a})`).maybeSingle();m({id:M.id,identifier:M.username,name:M.display_name||M.username,hasChat:C,requestStatus:f==null?void 0:f.status,requestSenderId:f==null?void 0:f.sender_id})}else v(!0)}else{const{data:M}=await ee.from("groups").select("id, name, group_id, description").eq("group_id",k).maybeSingle();if(M){const{data:$}=await ee.from("group_members").select("id").eq("group_id",M.id).eq("user_id",a).maybeSingle();m({id:M.id,identifier:M.group_id,name:M.name,description:M.description,isMember:!!$})}else v(!0)}}catch(M){console.error("Search error:",M),v(!0)}finally{l(!1)}},w=async()=>{if(!(!p||x)){P(!0);try{const{error:k}=await ee.from("chat_requests").upsert({sender_id:a,receiver_id:p.id,status:"pending"},{onConflict:"sender_id,receiver_id"});if(k)throw k;Q.success(r==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!":"Request sent successfully!"),m(M=>M?{...M,requestStatus:"pending",requestSenderId:a}:null)}catch(k){Q.error(k.message||(r==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨":"Failed to send request"))}finally{P(!1)}}},R=async()=>{if(!(!p||x)){P(!0);try{const{error:k}=await ee.from("group_members").insert({group_id:p.id,user_id:a,role:"member"});if(k)throw k;Q.success(r==="ar"?"ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Joined group successfully!"),m(M=>M?{...M,isMember:!0}:null)}catch(k){console.error("Join group error:",k),Q.error(r==="ar"?"ÙØ´Ù„ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to join group")}finally{P(!1)}}};return e.jsxs("div",{className:"flex flex-col h-[100dvh] bg-slate-950 text-white overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-indigo-900/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3 relative z-10 border-b border-white/5 bg-slate-900/50 backdrop-blur-sm",children:[e.jsx(z.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t,className:"text-slate-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/5",children:e.jsx(Ye,{className:`w-6 h-6 ${r==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 ${r==="ar"?"font-arabic":""}`,children:s("newChat")})]}),e.jsxs("div",{className:"flex border-b border-white/5 relative z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{d("user"),m(null),v(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="user"?"text-brand":"text-slate-500 hover:text-slate-300"} ${r==="ar"?"font-arabic":""}`,children:[r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…":"Find User",o==="user"&&e.jsx(z.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]}),e.jsxs("button",{type:"button",onClick:()=>{d("group"),m(null),v(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="group"?"text-brand":"text-slate-500 hover:text-slate-300"} ${r==="ar"?"font-arabic":""}`,children:[r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©":"Find Group",o==="group"&&e.jsx(z.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]})]}),e.jsx("div",{className:"flex-1 px-4 py-8 overflow-y-auto relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(z.p,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 mb-6 text-center text-sm",children:o==="user"?r==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù… (Ù…Ø«Ù„Ø§Ù‹ elgin@)":"Search for users by their username (e.g. @elgin)":r==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù…Ø«Ù„Ø§Ù‹ #developers)":"Search for groups by their Group ID (e.g. #developers)"}),e.jsxs("form",{onSubmit:k=>{k.preventDefault(),E()},className:"flex gap-2 mb-8 relative z-50",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand font-bold pointer-events-none text-lg",children:o==="user"?"@":"#"}),e.jsx(Te,{type:"text",inputMode:"search",autoComplete:"off",autoCorrect:"off",spellCheck:"false",placeholder:o==="user"?r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"username":r==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"group-id",value:n,onChange:k=>{i(k.target.value),v(!1),m(null)},className:"pl-8 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-600 h-12 text-lg font-medium transition-all"})]}),e.jsx(z.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:c||!n.trim(),className:"bg-brand hover:bg-brand/80 disabled:opacity-50 text-white h-12 w-12 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-brand/20",children:e.jsx(vt,{className:"w-6 h-6 pointer-events-none"})})]}),c&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 py-8 gap-2",children:[e.jsx(_e,{className:"w-8 h-8 animate-spin text-brand"}),e.jsx("span",{className:"text-xs animate-pulse",children:r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©...":"Searching the network..."})]}),h&&e.jsxs(z.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900/50 border border-white/5 rounded-2xl p-6 text-center",children:[e.jsxs("p",{className:"text-slate-300 font-medium text-lg",children:[o==="user"?r==="ar"?"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"User":r==="ar"?"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Group"," ",r==="ar"?"ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯":"not found"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:r==="ar"?"ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù‘Ù ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.":"Check the ID and try again."})]}),e.jsx(je,{children:p&&e.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand via-purple-500 to-brand"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-xl font-bold",children:p.name}),e.jsxs("p",{className:"text-brand text-sm font-medium bg-brand/10 px-2 py-0.5 rounded-md w-fit mt-1",children:[o==="user"?"@":"#",p.identifier]}),p.description&&e.jsx("p",{className:"text-slate-400 text-sm mt-2 leading-relaxed",children:p.description})]}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20 rotate-3",children:o==="user"?e.jsx(He,{className:"w-7 h-7"}):e.jsx(bt,{className:"w-7 h-7"})})]}),o==="user"?p.hasChat?e.jsx("div",{className:"bg-brand/10 text-brand border border-brand/20 rounded-xl py-3 text-center text-sm font-medium",children:r==="ar"?"Ù„Ø¯ÙŠÙƒ Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"You already have a chat with this user"}):p.requestStatus==="pending"?e.jsx("div",{className:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded-xl py-3 text-center text-sm font-medium",children:p.requestSenderId===a?r==="ar"?"Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...":"Request Pending...":r==="ar"?"Ø£Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ Ø·Ù„Ø¨Ø§Ù‹!":"Sent you a request!"}):e.jsx(pe,{onClick:w,disabled:x,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:x?e.jsx(_e,{className:"w-5 h-5 animate-spin"}):r==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¯Ø±Ø¯Ø´Ø©":"Send Chat Request"}):p.isMember?e.jsx("div",{className:"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-xl py-3 text-center text-sm font-medium",children:r==="ar"?"Ø£Ù†Øª Ø¹Ø¶Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"You are already a member"}):e.jsx(pe,{onClick:R,disabled:x,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:x?e.jsx(_e,{className:"w-5 h-5 animate-spin"}):r==="ar"?"Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Join Group"})]})})]})})]})}function Oi({onBack:t,currentUserId:a,language:r,t:s}){const[n,i]=u.useState(""),[o,d]=u.useState(""),[p,m]=u.useState(""),[c,l]=u.useState(!1),[h,v]=u.useState(null),x=async()=>{if(!n.trim()||!o.trim()){Q.error(r==="ar"?"ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©":"Please fill in required fields",{description:r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.":"Group Name and Unique ID are required."});return}l(!0);try{const{data:P,error:E}=await ee.from("groups").insert({name:n.trim(),group_id:o.trim().toLowerCase(),description:p.trim(),created_by:a}).select().single();if(E)throw E;const{error:w}=await ee.from("group_members").insert({group_id:P.id,user_id:a,role:"admin"});if(w)throw w;Q.success(r==="ar"?"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Group Created Successfully!",{description:r==="ar"?`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ${n.trim()}`:`Welcome to ${n.trim()}`}),t()}catch(P){console.error("Error creating group:",P),P.code==="23505"?Q.error(r==="ar"?"Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø£Ø®ÙˆØ° Ø¨Ø§Ù„ÙØ¹Ù„":"Group ID already taken",{description:r==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø±Ù‘Ù ÙØ±ÙŠØ¯ Ø¢Ø®Ø±.":"Please choose a different unique ID."}):Q.error(r==="ar"?"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to create group",{description:P.message||(r==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.":"Please try again later.")})}finally{l(!1)}};return e.jsxs(z.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"flex flex-col h-full bg-slate-950 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-32 -left-32 w-64 h-64 bg-violet-500/10 rounded-full blur-3xl animate-pulse"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950/80 backdrop-blur-md border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Ye,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${r==="ar"?"rotate-180":""}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:`text-white text-xl font-bold flex items-center gap-2 ${r==="ar"?"font-arabic":""}`,children:[s("createGroup"),e.jsx(tt,{className:"w-4 h-4 text-indigo-400"})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:r==="ar"?"Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³ Ù…Ø¹Ø§Ù‹":"Bring people together"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(z.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-32 h-32 bg-gradient-to-tr from-slate-800 to-slate-700 rounded-full flex items-center justify-center cursor-pointer relative group border-4 border-slate-950 shadow-2xl",children:[e.jsx(as,{className:"w-10 h-10 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-medium",children:r==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©":"Change Icon"})}),e.jsx("div",{className:"absolute -inset-1 rounded-full border border-indigo-500/30 opacity-0 group-hover:opacity-100 transition-opacity scale-110"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:r==="ar"?"Ø§Ø¶ØºØ· Ù„ØªØ¹ÙŠÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Tap to set group icon"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:te("text-sm font-medium transition-colors ml-1",h==="name"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:[s("name")," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:te("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="name"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(bt,{className:te("w-5 h-5 transition-colors",h==="name"?"text-indigo-400":"text-slate-500")}),e.jsx(Te,{type:"text",placeholder:r==="ar"?"Ù…Ø«Ù„Ø§Ù‹: Ø±Ø­Ù„Ø© Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹":"e.g. Weekend Trip Squad",value:n,onChange:P=>i(P.target.value),onFocus:()=>v("name"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:te("text-sm font-medium transition-colors ml-1",h==="id"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:[r==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯":"Unique ID"," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:te("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="id"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ea,{className:te("w-5 h-5 transition-colors",h==="id"?"text-indigo-400":"text-slate-500")}),e.jsx(Te,{type:"text",placeholder:r==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ù…Ø¬Ù…ÙˆØ¹Ø©-ÙØ±ÙŠØ¯":"unique-group-handle",value:o,onChange:P=>d(P.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-")),onFocus:()=>v("id"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 ml-1",children:[r==="ar"?"ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¹Ø¨Ø±":"Users can join via"," ",e.jsxs("span",{className:"font-mono text-indigo-400 bg-indigo-500/10 px-1 rounded",children:["#",o||(r==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù":"handle")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:te("text-sm font-medium transition-colors ml-1",h==="desc"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:s("about")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:te("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="desc"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ia,{className:te("w-5 h-5 transition-colors",h==="desc"?"text-indigo-400":"text-slate-500")}),e.jsx(Te,{type:"text",placeholder:r==="ar"?"Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¯ÙˆØ± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ":"What's this group about?",value:p,onChange:P=>m(P.target.value),onFocus:()=>v("desc"),onBlur:()=>v(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]})]}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(pe,{onClick:x,disabled:c||!n.trim()||!o.trim(),className:"w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white h-14 text-lg font-semibold rounded-xl shadow-lg shadow-indigo-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5 mr-2 animate-spin"}),r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©...":"Creating Group..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"}),r==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Create Group"]})})})]})})]})}function zi(){const[t,a]=u.useState(()=>localStorage.getItem("chat_app_language")||"en"),[r,s]=u.useState(()=>localStorage.getItem("chat_app_theme")==="dark"),[n,i]=u.useState(()=>localStorage.getItem("chat_app_view")||"chatList");u.useEffect(()=>{localStorage.setItem("chat_app_view",n)},[n]);const[o,d]=u.useState(!1),[p,m]=u.useState(()=>localStorage.getItem("chat_app_sound_enabled")!=="false"),[c,l]=u.useState(!1),[h,v]=u.useState(!1),[x,P]=u.useState(!1),[E,w]=u.useState(()=>localStorage.getItem("chat_app_sound_id")||Ue[0].id),[R,k]=u.useState([]),[M,$]=u.useState([]),[q,C]=u.useState(null),[f,S]=u.useState(null),_=u.useRef(null),j=u.useRef(null),N=u.useRef(null);console.log("ðŸ”— Initializing hooks...");const{currentUser:y,isLoading:F,logout:D}=pn();console.log("ðŸ‘¤ Auth State:",{currentUser:y==null?void 0:y.id,authLoading:F});const{chats:T,isLoading:B,selectedChat:g,messages:Y,loadChats:K,loadMessages:A,handleSelectChat:I,handleSendMessage:b,handleDeleteMessage:W,handlePinChat:V,handleSendPoll:O,handleIncomingMessage:Z,handleIncomingUpdate:ae,sendMessageToChat:le}=fn(y),ue=u.useCallback(L=>{j.current=L,I(L)},[I]);u.useEffect(()=>{j.current=g},[g]);const Ie=u.useCallback(async()=>{if(!y)return;const{data:L}=await ee.from("chat_requests").select("*, profiles:sender_id(username, display_name, avatar_url)").eq("receiver_id",y.id).eq("status","pending");L&&k(H=>JSON.stringify(H)!==JSON.stringify(L)?L:H)},[y==null?void 0:y.id]),Ce=u.useCallback(async()=>{if(!y)return;const{data:L}=await ee.from("statuses").select("*, profiles:user_id(id, display_name, avatar_url)").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});L&&$(H=>JSON.stringify(H)!==JSON.stringify(L)?L:H)},[y==null?void 0:y.id]),dt=u.useMemo(()=>y?{id:y.id,name:y.name||y.username,username:y.username}:null,[y]),Re=u.useRef(null),{onlineUsers:Xe,typingUsers:Ke,sendTypingIndicator:Se,sendSignalingMessage:st}=xn({currentUser:dt,selectedChatRef:j,onNewMessage:Z,onUpdateMessage:ae,onReloadChats:u.useCallback(()=>{y&&K(y.id)},[y,K]),soundEnabled:p,onIncomingCall:L=>{var H;return(H=Re.current)==null?void 0:H.handleIncomingCall(L)},onCallAnswer:L=>{var H;return(H=Re.current)==null?void 0:H.handleCallAnswer(L)},onIceCandidate:L=>{var H;return(H=Re.current)==null?void 0:H.handleIceCandidate(L)},onCallEnded:L=>{var H;return(H=Re.current)==null?void 0:H.handleCallEnded(L)},onReloadStatuses:Ce,onReloadRequests:Ie}),be=hn({currentUser:y,soundEnabled:p,onlineUsers:Xe||new Set});u.useEffect(()=>{Re.current=be},[be]);const{activeCall:de,handleStartCall:ut,handleAcceptCall:we,handleRejectCall:Ae,handleIncomingCall:jt,handleCallAnswer:wt,handleIceCandidate:Qe,handleCallEnded:Nt}=be,ve=u.useCallback(L=>za[t][L]||L,[t]);u.useEffect(()=>{const L=setTimeout(()=>d(!1),2500);return()=>clearTimeout(L)},[]),u.useEffect(()=>{r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("chat_app_theme",r?"dark":"light")},[r]),u.useEffect(()=>{"Notification"in window&&P(Notification.permission==="granted"),navigator.permissions&&navigator.permissions.query&&(navigator.permissions.query({name:"microphone"}).then(L=>{l(L.state==="granted"),L.onchange=()=>l(L.state==="granted")}).catch(()=>{}),navigator.permissions.query({name:"camera"}).then(L=>{v(L.state==="granted"),L.onchange=()=>v(L.state==="granted")}).catch(()=>{}))},[]),u.useEffect(()=>{const L=()=>{document.removeEventListener("click",L)};return document.addEventListener("click",L),()=>document.removeEventListener("click",L)},[]),u.useEffect(()=>{const L=Ue.find(H=>H.id===E)||Ue[0];_.current=new Audio(L.url),localStorage.setItem("chat_app_sound_id",E)},[E]),u.useEffect(()=>{localStorage.setItem("chat_app_sound_enabled",String(p))},[p]);const U=u.useCallback((L,H)=>{Se(L,H)},[Se]),ce=u.useCallback(async(L,H)=>{if(!j.current||!y)return;const ne=j.current;try{const me=`voice_${Date.now()}.webm`,ie=new File([L],me,{type:L.type}),oe=new FormData;oe.append("file",ie),oe.append("userId",y.id);const xe=await(await fetch(`https://${qt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${Vt}`},body:oe})).json();if(xe.error)throw new Error(xe.error);await le(ne,"ðŸŽ¤ Voice Message",xe.fileUrl,"audio",me),Q.success(t==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ©":"Voice message sent")}catch(me){console.error("Voice send error:",me),Q.error(t==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª":"Failed to send voice")}},[y,t,le]),Oe=u.useCallback(async(L,H)=>{if(!y||!j.current)return;const me=j.current.isGroup?"group_messages":"messages";try{const{data:ie}=await ee.from(me).select("reactions").eq("id",L).single(),oe=(ie==null?void 0:ie.reactions)||{},fe=oe[H]||[];fe.includes(y.id)?(oe[H]=fe.filter(xe=>xe!==y.id),oe[H].length===0&&delete oe[H]):oe[H]=[...fe,y.id],await ee.from(me).update({reactions:oe}).eq("id",L)}catch(ie){console.error("Reaction error:",ie)}},[y]),Me=u.useCallback(async(L,H)=>{if(!y||!j.current)return;const me=j.current.isGroup?"group_messages":"messages";try{const{data:ie}=await ee.from(me).select("poll").eq("id",L).single();if(!(ie!=null&&ie.poll))return;const oe={...ie.poll};oe.votes=oe.votes||{},Object.keys(oe.votes).forEach(fe=>{oe.votes[fe]=(oe.votes[fe]||[]).filter(xe=>xe!==y.id)}),oe.votes[H]=[...oe.votes[H]||[],y.id],await ee.from(me).update({poll:oe}).eq("id",L)}catch(ie){console.error("Vote error:",ie)}},[y]),Be=u.useCallback(()=>{i("chatList")},[]),mt=u.useCallback(L=>{j.current&&W(L,j.current.isGroup)},[W]),qe=u.useCallback(()=>{j.current&&A(j.current.id,j.current.isGroup)},[A]),pt=u.useCallback(L=>{j.current&&U(L,j.current.partnerId)},[U]),ft=u.useCallback(()=>{Q.info(t==="ar"?"Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Coming Soon: Clear Chat")},[t]),De=async(L,H)=>{if(!y)return;let ne=null;const me=M.find(fe=>fe.id===H);if(me&&(ne=me.user_id),!ne&&q&&q.items){const fe=q.items.find(xe=>xe.id===H);fe&&(ne=fe.user_id)}if(!ne){Q.error("Could not find status owner");return}const ie=T.find(fe=>fe.partnerId===ne),oe=`Replied to story: ${L} `;ie?(await le(ie,oe),Q.success(t==="ar"?"ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­":"Reply sent"),C(null)):Q.error("You must have a chat with this user to reply")},Pe=async L=>{var me;const H=(me=L.target.files)==null?void 0:me[0];if(!H||!y)return;if(!H.type.startsWith("image/")&&!H.type.startsWith("video/")){Q.error(t==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ":"Please select an image or video");return}const ne=Q.custom(ie=>e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-4 w-[300px] shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(_e,{className:"w-5 h-5 animate-spin text-brand"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Uploading story..."})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx(z.div,{initial:{width:"0%"},animate:{width:"90%"},transition:{duration:2,ease:"easeInOut"},className:"h-full bg-brand"})})]}),{duration:1/0});try{const ie=new FormData;ie.append("file",H),ie.append("userId",y.id);const fe=await(await fetch(`https://${qt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${Vt}`},body:ie})).json();if(fe.error)throw new Error(fe.error);const xe=new Date;xe.setDate(xe.getDate()+1);const vr=fe.fileType.startsWith("video/")?"video":"image",{error:yr}=await ee.from("statuses").insert({user_id:y.id,content_url:fe.fileUrl,content_type:vr,text:"",expires_at:xe.toISOString()});if(yr)throw yr;Q.dismiss(ne),Q.custom(()=>e.jsxs("div",{className:"bg-green-500/10 border border-green-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 rounded-full p-1",children:e.jsx(Fe,{className:"w-4 h-4 text-black"})}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­":"Story uploaded successfully"})]}),{duration:3e3}),Ce()}catch(ie){console.error("Story upload error:",ie),Q.dismiss(ne),Q.custom(()=>e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹":"Upload failed"})]}),{duration:4e3})}finally{N.current&&(N.current.value="")}},Ht=L=>{g&&ut(g.partnerId,g.partnerName,L)},Wt=async(L,H)=>{if(y)try{await ee.from("chat_requests").update({status:"accepted"}).eq("id",L);const{data:ne}=await ee.from("conversations").insert({}).select().single();ne&&(await ee.from("conversation_participants").insert([{conversation_id:ne.id,user_id:y.id},{conversation_id:ne.id,user_id:H}]),Q.success("Request accepted"),Ie(),K(y.id))}catch{Q.error("Failed to accept")}},Ct=async L=>{await ee.from("chat_requests").update({status:"rejected"}).eq("id",L),Q.success("Request rejected"),Ie()},St=async L=>{if(y)try{const{error:H}=await ee.from("statuses").delete().eq("id",L).eq("user_id",y.id);if(H)throw H;Q.success(t==="ar"?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Story deleted"),C(null),Ce()}catch(H){console.error("Error deleting status:",H),Q.error(t==="ar"?"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Failed to delete story")}},re=async(L,H)=>{if(i(L),typeof H=="string"){S(null);const{data:ne}=await ee.from("profiles").select("*").eq("id",H).single();ne&&S(ne)}else S(H||null)},he=async()=>{const L=await it.requestNotificationPermission(ve);P(L),L&&Q.success(ve("notifications")+" "+ve("success"))},ye=async()=>{const L=await it.requestMicPermission();l(L),L?Q.success("Microphone enabled"):Q.error("Microphone access denied")},Ne=async()=>{const L=await it.requestCameraPermission();v(L),L?Q.success("Camera enabled"):Q.error("Camera access denied")};return F||o?e.jsx("div",{className:"w-full h-screen bg-[#111b21] flex flex-col items-center justify-center",children:e.jsx(Ci,{onFinish:()=>d(!1),language:t})}):y?e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"h-screen bg-[#111b21] flex items-center justify-center",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-green-500"})}),children:e.jsx(oi,{children:e.jsxs("div",{className:"flex h-screen bg-[#111b21] relative overflow-hidden font-outfit text-white",children:[e.jsx(Tr,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx("input",{type:"file",ref:N,className:"hidden",accept:"image/*,video/*",onChange:Pe}),de&&de.status==="ringing"&&de.callerId!==y.id&&e.jsx(Ni,{callerName:de.callerName,type:de.type,onAccept:we,onReject:Ae,language:t}),de&&(de.status==="connected"||de.status==="connecting"||de.status==="ringing"&&de.callerId===y.id)&&e.jsx(Ai,{callId:de.id,isIncoming:de.callerId!==y.id,callerName:de.callerId===y.id?de.recipientId:de.callerName,type:de.type,onEndCall:Ae,currentUserId:y.id,callerId:de.callerId,recipientId:de.recipientId,sendSignaling:st,incomingOffer:de.offer,remoteAnswer:de.answer,remoteIceCandidates:de.iceCandidates||[]}),e.jsx(je,{children:q&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[1000] bg-black",children:e.jsx(Si,{items:q.items,initialIndex:q.index,onClose:()=>C(null),onReply:De,onDelete:St,currentUserId:y.id,language:t})})}),e.jsxs("div",{className:`flex w-full h-full ${n==="chatList"?"":"md:flex"}`,children:[e.jsx("div",{className:`${n==="chatList"?"flex":"hidden md:flex"} w-full md:w-[400px] flex-col h-full border-r border-white/5`,children:e.jsx(ii,{chats:T,currentUser:y,onlineUsers:Xe,onSelectChat:(L,H)=>{const ne=T.find(me=>me.partnerId===L);ne&&(ue(ne),i("chatWindow"))},onNewChat:()=>i("newChat"),onCreateGroup:()=>i("createGroup"),onLogout:D,onSettings:()=>i("settings"),onAcceptRequest:Wt,onRejectRequest:Ct,pendingRequests:R,typingUsers:Ke,onPinChat:V,statuses:M,onViewStatus:(L,H)=>C({items:L,index:H}),onAddStatus:()=>{var L;return(L=N.current)==null?void 0:L.click()},language:t,t:ve,onEnableNotifications:he,notificationsEnabled:x,isLoading:B})}),e.jsxs("div",{className:`${n!=="chatList"?"flex":"hidden md:flex"} flex-1 flex-col h-full bg-[#0b141a]`,children:[n==="chatList"&&e.jsx("div",{className:"hidden md:flex items-center justify-center h-full text-gray-500",children:e.jsx("p",{children:"Select a chat to start messaging"})}),n==="chatWindow"&&g&&e.jsx(wi,{currentUserId:y.id,partnerId:g.partnerId,partnerName:g.partnerName,partnerAvatar:g.partnerAvatar,messages:Y,isPartnerOnline:Xe.has(g.partnerId),isPartnerTyping:Ke[g.partnerId],onBack:Be,onSendMessage:b,onSendVoiceMessage:ce,onDeleteMessage:mt,onTyping:pt,onRefresh:qe,onReact:Oe,onSendPoll:O,onVote:Me,onStartCall:Ht,isGroup:g.isGroup,onShowProfile:L=>re("partnerProfile",L),onClearChat:ft,language:t,t:ve}),n==="settings"&&e.jsx(Di,{user:y,onBack:()=>i("chatList"),onGoToProfile:()=>i("profile"),onLogout:D,notificationsEnabled:x,onEnableNotifications:he,micEnabled:c,onEnableMic:ye,soundEnabled:p,onToggleSound:m,currentSoundId:E,notificationSounds:Ue,onSelectSound:w,onTestSound:()=>{var L;return(L=_.current)==null?void 0:L.play()},language:t,onLanguageChange:a,t:ve,camEnabled:h,onEnableCam:Ne}),n==="newChat"&&e.jsx(Li,{onBack:()=>i("chatList"),currentUserId:y.id,language:t,t:ve}),n==="createGroup"&&e.jsx(Oi,{onBack:()=>{K(y.id),i("chatList")},currentUserId:y.id,language:t,t:ve}),n==="profile"&&e.jsx(qr,{user:y,onBack:()=>i("settings"),onUpdate:()=>{},language:t,t:ve}),n==="partnerProfile"&&e.jsx(qr,{user:f,isPublicView:!0,onBack:()=>i("chatWindow"),onStartChat:()=>{i("chatWindow")},language:t,t:ve})]})]})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(Tr,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx(Qn,{onLoginSuccess:()=>{},language:t,t:ve})]})}console.log("ðŸš€ main.tsx execution started");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/firebase-messaging-sw.js").then(t=>{console.log("âœ… ServiceWorker registration successful with scope: ",t.scope)},t=>{console.log("âŒ ServiceWorker registration failed: ",t)})});console.log("ðŸ—ï¸ Creating root and rendering App...");Da.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(li,{children:e.jsx(zi,{})})}));console.log("ðŸ main.tsx end of file reached");
