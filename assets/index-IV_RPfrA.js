import{a as ra,R as D,r as m,j as e,u as vs,b as ys,c as js,m as A,A as he,g as aa}from"./vendor-C2tG_28P.js";import{c as na}from"./supabase-2A4keVzc.js";import{R as ia,S as oa,M as is,U as Ve,b as nt,L as Bs,c as ye,A as la,d as ca,P as os,u as da,e as qs,f as bt,g as Yt,h as ua,C as ma,i as vt,B as Ot,j as De,X as Se,E as Vs,k as ls,l as zt,m as pa,n as Us,o as Hs,T as cs,p as Bt,F as Ft,q as fa,r as Ws,s as ha,t as ds,D as Ys,I as Js,v as us,V as yt,w as $t,x as Xs,y as xa,z as ga,G as ba,H as Ue,J as va,K as ya,N as ja,O as wa,Q as Ks,W as Gt,Y as Qs,Z as Zs,$ as er,a0 as Na,a1 as tr,a2 as Ca,a3 as Sa,a4 as ws,a5 as ka,a6 as _a,a7 as Ta,a8 as sr,a9 as St,aa as Vt,ab as Ra,ac as Pa}from"./ui-wo5GeGEf.js";function Ea(t,a){for(var s=0;s<a.length;s++){const r=a[s];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(r,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();var kt={},Ns;function Ia(){if(Ns)return kt;Ns=1;var t=ra();return kt.createRoot=t.createRoot,kt.hydrateRoot=t.hydrateRoot,kt}var Ma=Ia();const ms="umgfxbipblzpgpejlnzg",ps="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtZ2Z4YmlwYmx6cGdwZWpsbnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODY5MDIsImV4cCI6MjA4MjE2MjkwMn0.fkNxfMwxqGR5EUALb5C3QxQvSMXsDyRyHf8tltWpm2Y",Aa=`https://${ms}.supabase.co`,Da=ps,Q=na(Aa,Da,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}}),La={en:{loginTitle:"Welcome Back",loginSubtitle:"Sign in to continue",emailPlaceholder:"Email address",passwordPlaceholder:"Password",loginButton:"Sign In",signupLink:"Create an account",chatsTitle:"Chats",searchPlaceholder:"Search conversations...",newChatButton:"New Chat",typeMessage:"Type a message...",online:"Online",offline:"Last seen",typing:"typing...",settings:"Settings",profile:"Profile",language:"Language",logout:"Log Out",notifications:"Notifications",sounds:"Sounds",privacy:"Privacy",help:"Help",theme:"Theme",account:"Account",blocked:"Blocked Users",general:"General",darkMode:"Dark Mode",lightMode:"Light Mode",systemMode:"System",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy",info:"Info",members:"Members",media:"Media",files:"Files",links:"Links",voice:"Voice",video:"Video",call:"Call",mute:"Mute",unmute:"Unmute",camera:"Camera",screenShare:"Screen Share",endCall:"End Call",accept:"Accept",reject:"Reject",calling:"Calling...",ringing:"Ringing...",connecting:"Connecting...",reconnecting:"Reconnecting...",ended:"Call Ended",missed:"Missed Call",incoming:"Incoming Call",outgoing:"Outgoing Call",today:"Today",yesterday:"Yesterday",justNow:"Just now",sent:"Sent",delivered:"Delivered",read:"Read",failed:"Failed",uploading:"Uploading...",downloading:"Downloading...",success:"Success",error:"Error",retry:"Retry",loading:"Loading...",noChats:"No chats yet",startChat:"Start a conversation",createGroup:"Create Group",groupName:"Group Name",addMembers:"Add Members",create:"Create",groupCreated:"Group created successfully",userJoined:"User joined",userLeft:"User left",admin:"Admin",kick:"Remote",promote:"Promote",demote:"Demote",leaveGroup:"Leave Group",deleteGroup:"Delete Group",areYouSure:"Are you sure?",cannotUndo:"This action cannot be undone.",yes:"Yes",no:"No",ok:"OK"},ar:{loginTitle:"Ù…Ø±Ø­Ø¨Ø§Ù‹",loginSubtitle:"Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©",emailPlaceholder:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",passwordPlaceholder:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",loginButton:"Ø¯Ø®ÙˆÙ„",signupLink:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",chatsTitle:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª",searchPlaceholder:"Ø¨Ø­Ø«...",newChatButton:"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",typeMessage:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...",online:"Ù…ØªØµÙ„",offline:"Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±",typing:"ÙŠÙƒØªØ¨...",settings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",profile:"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",language:"Ø§Ù„Ù„ØºØ©",logout:"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",notifications:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",sounds:"Ø§Ù„Ø£ØµÙˆØ§Øª",privacy:"Ø§Ù„Ø®ØµÙˆØµÙŠØ©",help:"Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",theme:"Ø§Ù„Ù…Ø¸Ù‡Ø±",account:"Ø§Ù„Ø­Ø³Ø§Ø¨",blocked:"Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†",general:"Ø¹Ø§Ù…",darkMode:"Ø¯Ø§ÙƒÙ†",lightMode:"ÙØ§ØªØ­",systemMode:"Ø§Ù„Ù†Ø¸Ø§Ù…",save:"Ø­ÙØ¸",cancel:"Ø¥Ù„ØºØ§Ø¡",edit:"ØªØ¹Ø¯ÙŠÙ„",delete:"Ø­Ø°Ù",reply:"Ø±Ø¯",forward:"ØªØ­ÙˆÙŠÙ„",copy:"Ù†Ø³Ø®",info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",members:"Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡",media:"Ø§Ù„ÙˆØ³Ø§Ø¦Ø·",files:"Ø§Ù„Ù…Ù„ÙØ§Øª",links:"Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",voice:"ØµÙˆØªÙŠ",video:"ÙÙŠØ¯ÙŠÙˆ",call:"Ø§ØªØµØ§Ù„",mute:"ÙƒØªÙ…",unmute:"ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª",camera:"ÙƒØ§Ù…ÙŠØ±Ø§",screenShare:"Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©",endCall:"Ø¥Ù†Ù‡Ø§Ø¡",accept:"Ø±Ø¯",reject:"Ø±ÙØ¶",calling:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...",ringing:"ÙŠØ±Ù†...",connecting:"ÙŠØªØµÙ„...",reconnecting:"ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„...",ended:"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",missed:"Ù…ÙƒØ§Ù„Ù…Ø© ÙØ§Ø¦ØªØ©",incoming:"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©",outgoing:"Ù…ÙƒØ§Ù„Ù…Ø© ØµØ§Ø¯Ø±Ø©",today:"Ø§Ù„ÙŠÙˆÙ…",yesterday:"Ø£Ù…Ø³",justNow:"Ø§Ù„Ø¢Ù†",sent:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",delivered:"ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„",read:"ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",failed:"ÙØ´Ù„",uploading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...",downloading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",success:"ØªÙ… Ø¨Ù†Ø¬Ø§Ø­",error:"Ø®Ø·Ø£",retry:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",loading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",noChats:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª",startChat:"Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",createGroup:"Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©",groupName:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",addMembers:"Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡",create:"Ø¥Ù†Ø´Ø§Ø¡",groupCreated:"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",userJoined:"Ø§Ù†Ø¶Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",userLeft:"ØºØ§Ø¯Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",admin:"Ù…Ø´Ø±Ù",kick:"Ø·Ø±Ø¯",promote:"ØªØ±Ù‚ÙŠØ©",demote:"ØªØ®ÙÙŠØ¶",leaveGroup:"Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",deleteGroup:"Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",areYouSure:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ",cannotUndo:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.",yes:"Ù†Ø¹Ù…",no:"Ù„Ø§",ok:"Ø­Ø³Ù†Ø§Ù‹"}};function Oa(t){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",a.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}const za=t=>{switch(t){case"success":return Ga;case"info":return qa;case"warning":return Ba;case"error":return Va;default:return null}},Fa=Array(12).fill(0),$a=({visible:t,className:a})=>D.createElement("div",{className:["sonner-loading-wrapper",a].filter(Boolean).join(" "),"data-visible":t},D.createElement("div",{className:"sonner-spinner"},Fa.map((s,r)=>D.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),Ga=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ba=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),qa=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Va=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},D.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ua=D.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},D.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),D.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ha=()=>{const[t,a]=D.useState(document.hidden);return D.useEffect(()=>{const s=()=>{a(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),t};let Jt=1;class Wa{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{const s=this.subscribers.indexOf(a);this.subscribers.splice(s,1)}),this.publish=a=>{this.subscribers.forEach(s=>s(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var s;const{message:r,...n}=a,i=typeof(a==null?void 0:a.id)=="number"||((s=a.id)==null?void 0:s.length)>0?a.id:Jt++,o=this.toasts.find(p=>p.id===i),d=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(p=>p.id===i?(this.publish({...p,...a,id:i,title:r}),{...p,...a,id:i,dismissible:d,title:r}):p):this.addToast({title:r,...n,dismissible:d,id:i}),i},this.dismiss=a=>(a?(this.dismissedToasts.add(a),requestAnimationFrame(()=>this.subscribers.forEach(s=>s({id:a,dismiss:!0})))):this.toasts.forEach(s=>{this.subscribers.forEach(r=>r({id:s.id,dismiss:!0}))}),a),this.message=(a,s)=>this.create({...s,message:a}),this.error=(a,s)=>this.create({...s,message:a,type:"error"}),this.success=(a,s)=>this.create({...s,type:"success",message:a}),this.info=(a,s)=>this.create({...s,type:"info",message:a}),this.warning=(a,s)=>this.create({...s,type:"warning",message:a}),this.loading=(a,s)=>this.create({...s,type:"loading",message:a}),this.promise=(a,s)=>{if(!s)return;let r;s.loading!==void 0&&(r=this.create({...s,promise:a,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));const n=Promise.resolve(a instanceof Function?a():a);let i=r!==void 0,o;const d=n.then(async u=>{if(o=["resolve",u],D.isValidElement(u))i=!1,this.create({id:r,type:"default",message:u});else if(Ja(u)&&!u.ok){i=!1;const l=typeof s.error=="function"?await s.error(`HTTP error! status: ${u.status}`):s.error,h=typeof s.description=="function"?await s.description(`HTTP error! status: ${u.status}`):s.description,b=typeof l=="object"&&!D.isValidElement(l)?l:{message:l};this.create({id:r,type:"error",description:h,...b})}else if(u instanceof Error){i=!1;const l=typeof s.error=="function"?await s.error(u):s.error,h=typeof s.description=="function"?await s.description(u):s.description,b=typeof l=="object"&&!D.isValidElement(l)?l:{message:l};this.create({id:r,type:"error",description:h,...b})}else if(s.success!==void 0){i=!1;const l=typeof s.success=="function"?await s.success(u):s.success,h=typeof s.description=="function"?await s.description(u):s.description,b=typeof l=="object"&&!D.isValidElement(l)?l:{message:l};this.create({id:r,type:"success",description:h,...b})}}).catch(async u=>{if(o=["reject",u],s.error!==void 0){i=!1;const c=typeof s.error=="function"?await s.error(u):s.error,l=typeof s.description=="function"?await s.description(u):s.description,y=typeof c=="object"&&!D.isValidElement(c)?c:{message:c};this.create({id:r,type:"error",description:l,...y})}}).finally(()=>{i&&(this.dismiss(r),r=void 0),s.finally==null||s.finally.call(s)}),p=()=>new Promise((u,c)=>d.then(()=>o[0]==="reject"?c(o[1]):u(o[1])).catch(c));return typeof r!="string"&&typeof r!="number"?{unwrap:p}:Object.assign(r,{unwrap:p})},this.custom=(a,s)=>{const r=(s==null?void 0:s.id)||Jt++;return this.create({jsx:a(r),id:r,...s}),r},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const ve=new Wa,Ya=(t,a)=>{const s=(a==null?void 0:a.id)||Jt++;return ve.addToast({title:t,...a,id:s}),s},Ja=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",Xa=Ya,Ka=()=>ve.toasts,Qa=()=>ve.getActiveToasts(),te=Object.assign(Xa,{success:ve.success,info:ve.info,warning:ve.warning,error:ve.error,custom:ve.custom,message:ve.message,promise:ve.promise,dismiss:ve.dismiss,loading:ve.loading},{getHistory:Ka,getToasts:Qa});Oa("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function _t(t){return t.label!==void 0}const Za=3,en="24px",tn="16px",Cs=4e3,sn=356,rn=14,an=45,nn=200;function Pe(...t){return t.filter(Boolean).join(" ")}function on(t){const[a,s]=t.split("-"),r=[];return a&&r.push(a),s&&r.push(s),r}const ln=t=>{var a,s,r,n,i,o,d,p,u;const{invert:c,toast:l,unstyled:h,interacting:y,setHeights:b,visibleToasts:v,heights:C,index:T,toasts:P,expanded:E,removeToast:R,defaultRichColors:F,closeButton:W,style:g,cancelButtonStyle:f,actionButtonStyle:_,className:I="",descriptionClassName:x="",duration:S,position:w,gap:j,expandByDefault:U,classNames:k,icons:G,closeButtonAriaLabel:N="Close toast"}=t,[B,ee]=D.useState(null),[Y,K]=D.useState(null),[M,X]=D.useState(!1),[H,L]=D.useState(!1),[J,ae]=D.useState(!1),[Z,de]=D.useState(!1),[Re,we]=D.useState(!1),[lt,Ee]=D.useState(0),[ct,Qe]=D.useState(0),Ne=D.useRef(l.duration||S||Cs),We=D.useRef(null),xe=D.useRef(null),Ze=T===0,dt=T+1<=v,oe=l.type,ge=l.dismissible!==!1,Ie=l.className||"",et=l.descriptionClassName||"",ze=D.useMemo(()=>C.findIndex(O=>O.toastId===l.id)||0,[C,l.id]),ut=D.useMemo(()=>{var O;return(O=l.closeButton)!=null?O:W},[l.closeButton,W]),Fe=D.useMemo(()=>l.duration||S||Cs,[l.duration,S]),z=D.useRef(0),le=D.useRef(0),Me=D.useRef(0),ke=D.useRef(null),[$e,mt]=w.split("-"),Ge=D.useMemo(()=>C.reduce((O,ne,ce)=>ce>=ze?O:O+ne.height,0),[C,ze]),pt=Ha(),ft=l.invert||c,_e=oe==="loading";le.current=D.useMemo(()=>ze*j+Ge,[ze,Ge]),D.useEffect(()=>{Ne.current=Fe},[Fe]),D.useEffect(()=>{X(!0)},[]),D.useEffect(()=>{const O=xe.current;if(O){const ne=O.getBoundingClientRect().height;return Qe(ne),b(ce=>[{toastId:l.id,height:ne,position:l.position},...ce]),()=>b(ce=>ce.filter(ue=>ue.toastId!==l.id))}},[b,l.id]),D.useLayoutEffect(()=>{if(!M)return;const O=xe.current,ne=O.style.height;O.style.height="auto";const ce=O.getBoundingClientRect().height;O.style.height=ne,Qe(ce),b(ue=>ue.find(ie=>ie.toastId===l.id)?ue.map(ie=>ie.toastId===l.id?{...ie,height:ce}:ie):[{toastId:l.id,height:ce,position:l.position},...ue])},[M,l.title,l.description,b,l.id]);const Ce=D.useCallback(()=>{L(!0),Ee(le.current),b(O=>O.filter(ne=>ne.toastId!==l.id)),setTimeout(()=>{R(l)},nn)},[l,R,b,le]);D.useEffect(()=>{if(l.promise&&oe==="loading"||l.duration===1/0||l.type==="loading")return;let O;return E||y||pt?(()=>{if(Me.current<z.current){const ue=new Date().getTime()-z.current;Ne.current=Ne.current-ue}Me.current=new Date().getTime()})():(()=>{Ne.current!==1/0&&(z.current=new Date().getTime(),O=setTimeout(()=>{l.onAutoClose==null||l.onAutoClose.call(l,l),Ce()},Ne.current))})(),()=>clearTimeout(O)},[E,y,l,oe,pt,Ce]),D.useEffect(()=>{l.delete&&Ce()},[Ce,l.delete]);function qt(){var O;if(G!=null&&G.loading){var ne;return D.createElement("div",{className:Pe(k==null?void 0:k.loader,l==null||(ne=l.classNames)==null?void 0:ne.loader,"sonner-loader"),"data-visible":oe==="loading"},G.loading)}return D.createElement($a,{className:Pe(k==null?void 0:k.loader,l==null||(O=l.classNames)==null?void 0:O.loader),visible:oe==="loading"})}const Nt=l.icon||(G==null?void 0:G[oe])||za(oe);var Ct,$;return D.createElement("li",{tabIndex:0,ref:xe,className:Pe(I,Ie,k==null?void 0:k.toast,l==null||(a=l.classNames)==null?void 0:a.toast,k==null?void 0:k.default,k==null?void 0:k[oe],l==null||(s=l.classNames)==null?void 0:s[oe]),"data-sonner-toast":"","data-rich-colors":(Ct=l.richColors)!=null?Ct:F,"data-styled":!(l.jsx||l.unstyled||h),"data-mounted":M,"data-promise":!!l.promise,"data-swiped":Re,"data-removed":H,"data-visible":dt,"data-y-position":$e,"data-x-position":mt,"data-index":T,"data-front":Ze,"data-swiping":J,"data-dismissible":ge,"data-type":oe,"data-invert":ft,"data-swipe-out":Z,"data-swipe-direction":Y,"data-expanded":!!(E||U&&M),style:{"--index":T,"--toasts-before":T,"--z-index":P.length-T,"--offset":`${H?lt:le.current}px`,"--initial-height":U?"auto":`${ct}px`,...g,...l.style},onDragEnd:()=>{ae(!1),ee(null),ke.current=null},onPointerDown:O=>{_e||!ge||(We.current=new Date,Ee(le.current),O.target.setPointerCapture(O.pointerId),O.target.tagName!=="BUTTON"&&(ae(!0),ke.current={x:O.clientX,y:O.clientY}))},onPointerUp:()=>{var O,ne,ce;if(Z||!ge)return;ke.current=null;const ue=Number(((O=xe.current)==null?void 0:O.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ye=Number(((ne=xe.current)==null?void 0:ne.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ie=new Date().getTime()-((ce=We.current)==null?void 0:ce.getTime()),fe=B==="x"?ue:Ye,tt=Math.abs(fe)/ie;if(Math.abs(fe)>=an||tt>.11){Ee(le.current),l.onDismiss==null||l.onDismiss.call(l,l),K(B==="x"?ue>0?"right":"left":Ye>0?"down":"up"),Ce(),de(!0);return}else{var be,Te;(be=xe.current)==null||be.style.setProperty("--swipe-amount-x","0px"),(Te=xe.current)==null||Te.style.setProperty("--swipe-amount-y","0px")}we(!1),ae(!1),ee(null)},onPointerMove:O=>{var ne,ce,ue;if(!ke.current||!ge||((ne=window.getSelection())==null?void 0:ne.toString().length)>0)return;const ie=O.clientY-ke.current.y,fe=O.clientX-ke.current.x;var tt;const be=(tt=t.swipeDirections)!=null?tt:on(w);!B&&(Math.abs(fe)>1||Math.abs(ie)>1)&&ee(Math.abs(fe)>Math.abs(ie)?"x":"y");let Te={x:0,y:0};const bs=Je=>1/(1.5+Math.abs(Je)/20);if(B==="y"){if(be.includes("top")||be.includes("bottom"))if(be.includes("top")&&ie<0||be.includes("bottom")&&ie>0)Te.y=ie;else{const Je=ie*bs(ie);Te.y=Math.abs(Je)<Math.abs(ie)?Je:ie}}else if(B==="x"&&(be.includes("left")||be.includes("right")))if(be.includes("left")&&fe<0||be.includes("right")&&fe>0)Te.x=fe;else{const Je=fe*bs(fe);Te.x=Math.abs(Je)<Math.abs(fe)?Je:fe}(Math.abs(Te.x)>0||Math.abs(Te.y)>0)&&we(!0),(ce=xe.current)==null||ce.style.setProperty("--swipe-amount-x",`${Te.x}px`),(ue=xe.current)==null||ue.style.setProperty("--swipe-amount-y",`${Te.y}px`)}},ut&&!l.jsx&&oe!=="loading"?D.createElement("button",{"aria-label":N,"data-disabled":_e,"data-close-button":!0,onClick:_e||!ge?()=>{}:()=>{Ce(),l.onDismiss==null||l.onDismiss.call(l,l)},className:Pe(k==null?void 0:k.closeButton,l==null||(r=l.classNames)==null?void 0:r.closeButton)},($=G==null?void 0:G.close)!=null?$:Ua):null,(oe||l.icon||l.promise)&&l.icon!==null&&((G==null?void 0:G[oe])!==null||l.icon)?D.createElement("div",{"data-icon":"",className:Pe(k==null?void 0:k.icon,l==null||(n=l.classNames)==null?void 0:n.icon)},l.promise||l.type==="loading"&&!l.icon?l.icon||qt():null,l.type!=="loading"?Nt:null):null,D.createElement("div",{"data-content":"",className:Pe(k==null?void 0:k.content,l==null||(i=l.classNames)==null?void 0:i.content)},D.createElement("div",{"data-title":"",className:Pe(k==null?void 0:k.title,l==null||(o=l.classNames)==null?void 0:o.title)},l.jsx?l.jsx:typeof l.title=="function"?l.title():l.title),l.description?D.createElement("div",{"data-description":"",className:Pe(x,et,k==null?void 0:k.description,l==null||(d=l.classNames)==null?void 0:d.description)},typeof l.description=="function"?l.description():l.description):null),D.isValidElement(l.cancel)?l.cancel:l.cancel&&_t(l.cancel)?D.createElement("button",{"data-button":!0,"data-cancel":!0,style:l.cancelButtonStyle||f,onClick:O=>{_t(l.cancel)&&ge&&(l.cancel.onClick==null||l.cancel.onClick.call(l.cancel,O),Ce())},className:Pe(k==null?void 0:k.cancelButton,l==null||(p=l.classNames)==null?void 0:p.cancelButton)},l.cancel.label):null,D.isValidElement(l.action)?l.action:l.action&&_t(l.action)?D.createElement("button",{"data-button":!0,"data-action":!0,style:l.actionButtonStyle||_,onClick:O=>{_t(l.action)&&(l.action.onClick==null||l.action.onClick.call(l.action,O),!O.defaultPrevented&&Ce())},className:Pe(k==null?void 0:k.actionButton,l==null||(u=l.classNames)==null?void 0:u.actionButton)},l.action.label):null)};function Ss(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function cn(t,a){const s={};return[t,a].forEach((r,n)=>{const i=n===1,o=i?"--mobile-offset":"--offset",d=i?tn:en;function p(u){["top","right","bottom","left"].forEach(c=>{s[`${o}-${c}`]=typeof u=="number"?`${u}px`:u})}typeof r=="number"||typeof r=="string"?p(r):typeof r=="object"?["top","right","bottom","left"].forEach(u=>{r[u]===void 0?s[`${o}-${u}`]=d:s[`${o}-${u}`]=typeof r[u]=="number"?`${r[u]}px`:r[u]}):p(d)}),s}const ks=D.forwardRef(function(a,s){const{invert:r,position:n="bottom-right",hotkey:i=["altKey","KeyT"],expand:o,closeButton:d,className:p,offset:u,mobileOffset:c,theme:l="light",richColors:h,duration:y,style:b,visibleToasts:v=Za,toastOptions:C,dir:T=Ss(),gap:P=rn,icons:E,containerAriaLabel:R="Notifications"}=a,[F,W]=D.useState([]),g=D.useMemo(()=>Array.from(new Set([n].concat(F.filter(Y=>Y.position).map(Y=>Y.position)))),[F,n]),[f,_]=D.useState([]),[I,x]=D.useState(!1),[S,w]=D.useState(!1),[j,U]=D.useState(l!=="system"?l:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),k=D.useRef(null),G=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),N=D.useRef(null),B=D.useRef(!1),ee=D.useCallback(Y=>{W(K=>{var M;return(M=K.find(X=>X.id===Y.id))!=null&&M.delete||ve.dismiss(Y.id),K.filter(({id:X})=>X!==Y.id)})},[]);return D.useEffect(()=>ve.subscribe(Y=>{if(Y.dismiss){requestAnimationFrame(()=>{W(K=>K.map(M=>M.id===Y.id?{...M,delete:!0}:M))});return}setTimeout(()=>{ia.flushSync(()=>{W(K=>{const M=K.findIndex(X=>X.id===Y.id);return M!==-1?[...K.slice(0,M),{...K[M],...Y},...K.slice(M+1)]:[Y,...K]})})})}),[F]),D.useEffect(()=>{if(l!=="system"){U(l);return}if(l==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?U("dark"):U("light")),typeof window>"u")return;const Y=window.matchMedia("(prefers-color-scheme: dark)");try{Y.addEventListener("change",({matches:K})=>{U(K?"dark":"light")})}catch{Y.addListener(({matches:M})=>{try{U(M?"dark":"light")}catch(X){console.error(X)}})}},[l]),D.useEffect(()=>{F.length<=1&&x(!1)},[F]),D.useEffect(()=>{const Y=K=>{var M;if(i.every(L=>K[L]||K.code===L)){var H;x(!0),(H=k.current)==null||H.focus()}K.code==="Escape"&&(document.activeElement===k.current||(M=k.current)!=null&&M.contains(document.activeElement))&&x(!1)};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[i]),D.useEffect(()=>{if(k.current)return()=>{N.current&&(N.current.focus({preventScroll:!0}),N.current=null,B.current=!1)}},[k.current]),D.createElement("section",{ref:s,"aria-label":`${R} ${G}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},g.map((Y,K)=>{var M;const[X,H]=Y.split("-");return F.length?D.createElement("ol",{key:Y,dir:T==="auto"?Ss():T,tabIndex:-1,ref:k,className:p,"data-sonner-toaster":!0,"data-sonner-theme":j,"data-y-position":X,"data-lifted":I&&F.length>1&&!o,"data-x-position":H,style:{"--front-toast-height":`${((M=f[0])==null?void 0:M.height)||0}px`,"--width":`${sn}px`,"--gap":`${P}px`,...b,...cn(u,c)},onBlur:L=>{B.current&&!L.currentTarget.contains(L.relatedTarget)&&(B.current=!1,N.current&&(N.current.focus({preventScroll:!0}),N.current=null))},onFocus:L=>{L.target instanceof HTMLElement&&L.target.dataset.dismissible==="false"||B.current||(B.current=!0,N.current=L.relatedTarget)},onMouseEnter:()=>x(!0),onMouseMove:()=>x(!0),onMouseLeave:()=>{S||x(!1)},onDragEnd:()=>x(!1),onPointerDown:L=>{L.target instanceof HTMLElement&&L.target.dataset.dismissible==="false"||w(!0)},onPointerUp:()=>w(!1)},F.filter(L=>!L.position&&K===0||L.position===Y).map((L,J)=>{var ae,Z;return D.createElement(ln,{key:L.id,icons:E,index:J,toast:L,defaultRichColors:h,duration:(ae=C==null?void 0:C.duration)!=null?ae:y,className:C==null?void 0:C.className,descriptionClassName:C==null?void 0:C.descriptionClassName,invert:r,visibleToasts:v,closeButton:(Z=C==null?void 0:C.closeButton)!=null?Z:d,interacting:S,position:Y,style:C==null?void 0:C.style,unstyled:C==null?void 0:C.unstyled,classNames:C==null?void 0:C.classNames,cancelButtonStyle:C==null?void 0:C.cancelButtonStyle,actionButtonStyle:C==null?void 0:C.actionButtonStyle,closeButtonAriaLabel:C==null?void 0:C.closeButtonAriaLabel,removeToast:ee,toasts:F.filter(de=>de.position==L.position),heights:f.filter(de=>de.position==L.position),setHeights:_,expandByDefault:o,gap:P,expanded:I,swipeDirections:a.swipeDirections})})):null}))}),rt=t=>{const a="/Chat-App/",s=a.startsWith("/")?a:`/${a}`,r=s.endsWith("/")?s:`${s}/`,n=t.startsWith("/")?t.substring(1):t;return`${r}${n}`},qe=[{id:"whistle",name:"Whistle Chime",url:rt("sounds/whistle.mp3")},{id:"bell",name:"Success Bell",url:rt("sounds/bell.mp3")},{id:"note",name:"Electronic Note",url:rt("sounds/note.mp3")},{id:"digital",name:"Digital Alert",url:rt("sounds/digital.mp3")}];class dn{async getCameraPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"camera"})).state}catch{return"unknown"}}async requestCameraPermission(){try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(s=>s.stop()),!0}catch(a){return console.error("Camera permission denied",a),!1}}async getMicPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"microphone"})).state}catch{return"unknown"}}async requestMicPermission(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(s=>s.stop()),!0}catch(a){return console.error("Mic permission denied",a),!1}}async getNotificationPermission(){return"Notification"in window?Notification.permission:"denied"}async requestNotificationPermission(a){return"Notification"in window?await Notification.requestPermission()==="granted":(a&&te.error("Notifications not supported"),!1)}isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}isPWA(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}vibrate(a=200){"vibrate"in navigator&&navigator.vibrate(a)}}const jt=new dn;function un(){const[t,a]=m.useState(null),[s,r]=m.useState(!0),[n,i]=m.useState("login"),o=m.useRef(null),d=m.useRef(!1),p=m.useRef(!1);m.useEffect(()=>{s||(p.current=!0)},[s]);const u=async l=>{var h;if(d.current)return null;if(o.current===l&&t)return r(!1),t;d.current=!0,console.log("ðŸ“¥ Fetching profile for:",l);try{const{data:y,error:b}=await Q.from("profiles").select("*").eq("id",l).single();if(b)return console.error("âŒ Profile fetch error:",b),(b.code==="PGRST116"||(h=b.message)!=null&&h.includes("406"))&&(console.warn("Profile missing for user. Logging out to clear stale session."),await Q.auth.signOut(),a(null),o.current=null),null;console.log("âœ… Profile fetched successfully");const v={id:y.id,username:y.username,name:y.display_name||y.username,avatar_url:y.avatar_url};return o.current=l,(!t||t.id!==v.id||t.username!==v.username||t.name!==v.name||t.avatar_url!==v.avatar_url)&&(console.log("ðŸ‘¤ Updating currentUser state (reference change)"),a(v)),y.display_name||i("signup"),v}finally{d.current=!1,r(!1)}},c=async()=>{await Q.auth.signOut(),a(null),localStorage.removeItem("chat_app_view"),localStorage.removeItem("chat_app_selected_chat")};return m.useEffect(()=>{console.log("ðŸ”Œ useAuth effect started");let l=!0;const h=setTimeout(()=>{l&&!p.current&&(console.warn("âš ï¸ Auth check timed out, forcing load completion"),r(!1))},12e3);console.log("ðŸ” Checking initial session..."),Q.auth.getSession().then(({data:{session:b}})=>{console.log("ðŸ“„ Session result:",b?"Found":"Not Found"),l&&(b?u(b.user.id):r(!1))}).catch(b=>{console.error("âŒ Session check failed:",b),l&&r(!1)});const{data:{subscription:y}}=Q.auth.onAuthStateChange((b,v)=>{console.log("ðŸ”„ Auth state changed:",b),l&&(v?u(v.user.id):(a(null),i("login"),r(!1)))});return()=>{l=!1,clearTimeout(h),y.unsubscribe()}},[]),{currentUser:t,setCurrentUser:a,isLoading:s,setIsLoading:r,loginStep:n,setLoginStep:i,fetchProfile:u,logout:c}}function mn(t){const[a,s]=m.useState([]),[r,n]=m.useState(!1),[i,o]=m.useState(null),[d,p]=m.useState([]),u=m.useRef(null),c=m.useRef(0);m.useEffect(()=>{u.current=i},[i]);const l=m.useCallback(async g=>{if(g){console.log("ðŸ“¨ loadChats started for:",g),n(!0);try{const{data:f,error:_}=await Q.from("conversation_participants").select(`
          conversation_id,
          conversations (
              id,
              last_message_text,
              last_message_at
          )
        `).eq("user_id",g);if(_)throw _;const I=f.map(k=>k.conversation_id);let x=[],S={};if(I.length>0){const{data:k,error:G}=await Q.from("conversation_participants").select(`
            conversation_id,
            user_id,
            profiles (id, display_name, avatar_url)
          `).in("conversation_id",I).neq("user_id",g);if(G)throw G;x=k||[];const{data:N}=await Q.from("messages").select("conversation_id").eq("is_read",!1).neq("sender_id",g).in("conversation_id",I);N==null||N.forEach(B=>{S[B.conversation_id]=(S[B.conversation_id]||0)+1})}const w=f.map(k=>{var B,ee;const G=x.find(Y=>Y.conversation_id===k.conversation_id),N=G!=null&&G.profiles&&!Array.isArray(G.profiles)?G.profiles.display_name:"Unknown User";return{id:k.conversation_id,partnerId:(G==null?void 0:G.user_id)||"unknown",partnerName:N,partnerAvatar:G!=null&&G.profiles&&!Array.isArray(G.profiles)?G.profiles.avatar_url:void 0,lastMessage:((B=k.conversations)==null?void 0:B.last_message_text)||"",lastMessageTime:((ee=k.conversations)==null?void 0:ee.last_message_at)||"",unreadCount:S[k.conversation_id]||0,isGroup:!1}});let j=[];try{const{data:k,error:G}=await Q.from("group_members").select(`
              group_id,
              groups (id, name, updated_at)
            `).eq("user_id",g);if(!G&&k&&k.length>0){const N=k.map(K=>K.group_id),{data:B}=await Q.from("group_messages").select("group_id").eq("is_read",!1).neq("sender_id",g).in("group_id",N),ee={};B==null||B.forEach(K=>{ee[K.group_id]=(ee[K.group_id]||0)+1});const{data:Y}=await Q.from("group_messages").select("group_id, text, created_at").in("group_id",N).order("created_at",{ascending:!1});j=k.map(K=>{const M=K.groups,X=Y==null?void 0:Y.find(H=>H.group_id===M.id);return{id:M.id,partnerId:M.id,partnerName:M.name,partnerAvatar:void 0,lastMessage:(X==null?void 0:X.text)||"No messages yet",lastMessageTime:(X==null?void 0:X.created_at)||M.updated_at,unreadCount:ee[M.id]||0,isGroup:!0}})}}catch(k){console.warn("Group fetch error:",k)}const U=[...w,...j].sort((k,G)=>{const N=new Date(k.lastMessageTime).getTime();return new Date(G.lastMessageTime).getTime()-N});s(U),c.current=U.reduce((k,G)=>k+G.unreadCount,0)}catch(f){console.error("Error loading chats:",f),f.code==="42P17"&&te.error("Database Error: Recursive policy detected. Please run the SQL fix.")}finally{n(!1)}}},[]),h=async(g,f,_=!1)=>{_?await Q.from("group_messages").update({is_read:!0}).eq("group_id",g).neq("sender_id",f).eq("is_read",!1):await Q.from("messages").update({is_read:!0}).eq("conversation_id",g).neq("sender_id",f).eq("is_read",!1)},y=m.useCallback(async(g,f=!1)=>{var S,w;if(g!==((S=u.current)==null?void 0:S.id)||!g)return;let _,I;if(f){const j=await Q.from("group_messages").select("*").eq("group_id",g).order("created_at",{ascending:!1}).limit(50);_=j.data?j.data.reverse():[],I=j.error}else{const j=await Q.from("messages").select("*").eq("conversation_id",g).order("created_at",{ascending:!1}).limit(50);_=j.data?j.data.reverse():[],I=j.error}if(I){console.error("Error loading messages:",I);return}if(g!==((w=u.current)==null?void 0:w.id))return;const x=(_||[]).map(j=>({id:j.id,senderId:j.sender_id,text:j.text,fileUrl:j.file_url,fileType:j.file_type,fileName:j.file_name,timestamp:j.created_at,isRead:j.is_read||!1,replyToId:j.reply_to_id,reactions:j.reactions||{},poll:j.poll}));p(j=>{const U=j.filter(N=>N.isOptimistic),k=new Set(x.map(N=>N.id)),G=U.filter(N=>!k.has(N.id));return[...x,...G]}),t&&t.id&&h(g,t.id,f)},[t==null?void 0:t.id]);m.useEffect(()=>{t!=null&&t.id?(console.log("ðŸš€ useChats auto-loading for:",t.id),l(t.id).then(()=>{const g=localStorage.getItem("chat_app_selected_chat");if(g&&!u.current)try{const f=JSON.parse(g);console.log("ðŸ•¯ï¸ Restoring saved chat:",f.id),o(f),y(f.id,f.isGroup)}catch(f){console.error("Failed to parse saved chat",f)}})):(console.log("Emptying chats as no user is present"),s([]))},[t==null?void 0:t.id,l,y]);const b=m.useCallback(g=>{o(g),s(f=>f.map(_=>_.id===g.id?{..._,unreadCount:0}:_)),y(g.id,g.isGroup),localStorage.setItem("chat_app_selected_chat",JSON.stringify(g)),t!=null&&t.id&&h(g.id,t.id,g.isGroup)},[y,t]),v=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){const f=Math.random()*16|0;return(g==="x"?f:f&3|8).toString(16)}),C=m.useCallback(async(g,f)=>{p(_=>_.filter(I=>I.id!==g));try{const _=f?"group_messages":"messages";await Q.from(_).delete().eq("id",g)}catch(_){console.error("Error deleting message:",_)}},[]),T=m.useCallback(async(g,f,_,I,x,S,w)=>{var k,G,N;if(!t)return;const j=v(),U={id:j,senderId:t.id,text:f,fileUrl:_,fileType:I,fileName:x,timestamp:new Date().toISOString(),isRead:!1,isOptimistic:!0,replyToId:S};((k=u.current)==null?void 0:k.id)===g.id&&p(B=>[...B,U]);try{let B,ee;if(g.isGroup){const Y=await Q.from("group_messages").insert({id:j,group_id:g.id,sender_id:t.id,text:f,file_url:_,file_type:I,file_name:x,reply_to_id:S}).select().single();B=Y.data,ee=Y.error}else{const Y=await Q.from("messages").insert({id:j,conversation_id:g.id,sender_id:t.id,text:f,file_url:_,file_type:I,file_name:x,reply_to_id:S}).select().single();B=Y.data,ee=Y.error}if(ee)throw ee;B&&(((G=u.current)==null?void 0:G.id)===g.id&&p(Y=>Y.map(K=>K.id===j?{...K,isOptimistic:!1}:K)),w&&w>0&&setTimeout(()=>C(j,g.isGroup),w*1e3),g.isGroup||await Q.from("conversations").update({last_message_text:f,last_message_at:new Date().toISOString()}).eq("id",g.id))}catch(B){console.error("Error sending message:",B),((N=u.current)==null?void 0:N.id)===g.id&&p(ee=>ee.filter(Y=>Y.id!==j)),te.error("Failed to send message")}},[t,C]),P=m.useCallback(async(g,f,_,I,x,S)=>{u.current&&await T(u.current,g,f,_,I,x,S)},[T]),E=async(g,f)=>{if(t){s(_=>_.map(I=>I.id===g?{...I,isPinned:f}:I));try{f?await Q.from("pinned_conversations").insert({user_id:t.id,conversation_id:g}):await Q.from("pinned_conversations").delete().eq("user_id",t.id).eq("conversation_id",g)}catch(_){console.error("Error pinning chat:",_)}}},R=m.useCallback(async(g,f)=>{if(!t||!u.current)return;const _=u.current,I={question:g,options:f,votes:{}},x=_.isGroup?"group_messages":"messages",S=_.isGroup?"group_id":"conversation_id",w={id:Math.random().toString(36).substring(7),senderId:t.id,text:`Poll: ${g}`,timestamp:new Date().toISOString(),isRead:!1,poll:I};p(j=>[...j,w]);try{const{error:j}=await Q.from(x).insert({[S]:_.id,sender_id:t.id,text:`Poll: ${g}`,poll:I});if(j)throw j}catch(j){console.error("Poll error:",j)}},[t]),F=m.useCallback((g,f,_)=>{console.log("ðŸ“© useChats: Incoming message received:",g.id,"for chatId:",_),p(I=>{if(I.find(w=>w.id===g.id))return console.log("â™»ï¸ useChats: Message already exists, skipping."),I;const x=u.current,S=_||(f?g.group_id:g.conversation_id);return console.log("ðŸ§ useChats: Matching...",{msgChatId:S,currentChatId:x==null?void 0:x.id}),t&&g.senderId!==t.id&&x&&S===x.id&&(console.log("ðŸ‘ï¸ useChats: Auto-marking as read"),h(x.id,t.id,f)),x&&S===x.id?(console.log("âœ¨ useChats: Appending message to state"),[...I,g]):(console.log("â­ï¸ useChats: Message not for current chat, ignoring append."),I)})},[t,h]),W=m.useCallback(g=>{p(f=>f.map(_=>_.id===g.id?g:_))},[]);return{chats:a,setChats:s,isLoading:r,selectedChat:i,setSelectedChat:o,messages:d,setMessages:p,loadChats:l,loadMessages:y,handleSelectChat:b,selectedChatRef:u,markMessagesAsRead:h,handleSendMessage:P,handleDeleteMessage:C,handlePinChat:E,handleSendPoll:R,handleIncomingMessage:F,handleIncomingUpdate:W,sendMessageToChat:T}}function pn({currentUser:t,soundEnabled:a}){const[s,r]=m.useState(null),n=m.useRef(null),i=m.useRef(null),o=m.useRef(null);m.useEffect(()=>{o.current=s},[s]),m.useEffect(()=>(n.current=new Audio(rt("sounds/ringtone.mp3")),n.current.loop=!0,n.current.load(),()=>{var v;(v=n.current)==null||v.pause()}),[]);const d=m.useCallback((v,C,T)=>{(i.current||Q.channel("chat-realtime-global")).send({type:"broadcast",event:C,payload:{...T,recipientId:v}})},[]),p=async(v,C,T)=>{if(!t)return;const E={id:Math.random().toString(36).substring(7),callerId:t.id,callerName:t.name||t.username,recipientId:v,type:T,status:"ringing"};r(E)},u=async()=>{var v;s&&(r(C=>C?{...C,status:"connecting"}:null),(v=n.current)==null||v.pause())},c=m.useCallback(()=>{var C;const v=o.current;v&&(d(v.callerId,"call-ended",{id:v.id}),r(null),(C=n.current)==null||C.pause(),n.current&&(n.current.currentTime=0))},[d]),l=m.useCallback(v=>{if(v.recipientId===t.id){if(o.current){d(v.callerId,"call-ended",{id:v.id,reason:"busy"});return}a&&n.current&&n.current.play().catch(console.error),r({id:v.id,callerId:v.callerId,callerName:v.callerName,recipientId:v.recipientId,type:v.type,status:"ringing",offer:v.offer,iceCandidates:[]})}},[t==null?void 0:t.id,a,d]),h=m.useCallback(v=>{var C;v.recipientId===t.id&&(r(T=>T&&T.id===v.id?{...T,status:"connected",answer:v.answer}:T),(C=n.current)==null||C.pause())},[t==null?void 0:t.id]),y=m.useCallback(v=>{v.recipientId===t.id&&r(C=>C&&C.id===v.id?{...C,iceCandidates:[...C.iceCandidates||[],v.candidate]}:C)},[t==null?void 0:t.id]),b=m.useCallback(v=>{var C;r(T=>T&&T.id===v.id?(te.info("Call ended"),null):T),(C=n.current)==null||C.pause(),n.current&&(n.current.currentTime=0)},[]);return{activeCall:s,setActiveCall:r,handleStartCall:p,handleAcceptCall:u,handleRejectCall:c,sendSignalingMessage:d,handleIncomingCall:l,handleCallAnswer:h,handleIceCandidate:y,handleCallEnded:b}}function fn({currentUser:t,selectedChatRef:a,onNewMessage:s,onUpdateMessage:r,onReloadChats:n,soundEnabled:i,onIncomingCall:o,onCallAnswer:d,onIceCandidate:p,onCallEnded:u}){const[c,l]=m.useState(new Set),[h,y]=m.useState({}),b=m.useRef(null),v=m.useRef(null),C=m.useRef(null),T=m.useRef(s),P=m.useRef(r),E=m.useRef(n);m.useEffect(()=>{T.current=s,P.current=r,E.current=n},[s,r,n]);const[R,F]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||qe[0].id);m.useEffect(()=>{localStorage.setItem("chat_app_sound_id",R);const x=qe.find(S=>S.id===R)||qe[0];b.current=new Audio(x.url),b.current.load(),v.current=new Audio(rt("sounds/ringtone.mp3")),v.current.loop=!0,v.current.load()},[R]);const W=()=>{b.current&&i&&(b.current.currentTime=0,b.current.play().catch(x=>console.log("Sound play failed:",x)))};m.useEffect(()=>{if(!t)return;const x="chat-realtime-global";console.log(`ðŸ”Œ Subscribing to GLOBAL channel: ${x}`);const S=Q.channel(x);return C.current=S,S.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},w=>{console.log("ðŸ“¥ New 1-1 Message received",w.new.id),g(w.new,!1)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},w=>{console.log("ðŸ“¥ New Group Message received",w.new.id),g(w.new,!0)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},w=>{f(w.new,!1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages"},w=>{f(w.new,!0)}).on("postgres_changes",{event:"*",schema:"public",table:"conversations"},w=>{console.log("ðŸ”„ Conversation updated, reloading chats..."),E.current()}).on("postgres_changes",{event:"*",schema:"public",table:"group_members"},()=>E.current()).on("presence",{event:"sync"},()=>{const w=S.presenceState(),j=new Set;Object.values(w).forEach(U=>{U.forEach(k=>j.add(k.user_id))}),l(j),console.log("ðŸ‘¥ Online Users updated:",Array.from(j))}).on("broadcast",{event:"typing"},({payload:w})=>{w.partner_id===t.id&&y(j=>({...j,[w.user_id]:w.isTyping}))}).on("broadcast",{event:"call-offer"},({payload:w})=>{w.recipientId===t.id&&o&&(i&&v.current&&v.current.play().catch(console.error),o(w))}).on("broadcast",{event:"call-answer"},({payload:w})=>{var j;w.recipientId===t.id&&d&&(d(w),(j=v.current)==null||j.pause())}).on("broadcast",{event:"ice-candidate"},({payload:w})=>{w.recipientId===t.id&&p&&p(w)}).on("broadcast",{event:"call-ended"},({payload:w})=>{var j;(w.recipientId===t.id||w.callerId===t.id)&&(u&&u(w),(j=v.current)==null||j.pause(),v.current&&(v.current.currentTime=0))}).subscribe(async w=>{console.log(`ðŸ“¡ Subscription status for ${x}:`,w),w==="SUBSCRIBED"&&await S.track({user_id:t.id,online_at:new Date().toISOString()}),w==="CHANNEL_ERROR"&&(console.error("ðŸš· Realtime subscription error. Retrying in 5s..."),setTimeout(()=>E.current(),5e3))}),()=>{var w;console.log(`ðŸ”Œ Unsubscribing from ${x}`),S.unsubscribe(),(w=v.current)==null||w.pause()}},[t==null?void 0:t.id,i]);const g=(x,S)=>{const w=a.current;console.log("ðŸ“© Raw Realtime Message:",x),console.log("ðŸ’¬ Current Chat in Ref:",w==null?void 0:w.id,"isGroup:",w==null?void 0:w.isGroup);const j={id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read||!1,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},U=x.group_id||x.conversation_id,k=!!w&&w.id===U;console.log(`ðŸ” Comparison Result: ${k?"âœ… MATCH":"âŒ NO MATCH"} (MsgChat: ${U} vs Current: ${w==null?void 0:w.id})`),k?(console.log("âœ… Message matches current chat, updating UI..."),T.current(j,S,U)):(console.log("â„¹ï¸ Message is for another chat:",U),te.info(`New message in another chat: ${U.substring(0,8)}`)),x.sender_id!==(t==null?void 0:t.id)&&W(),E.current()},f=(x,S)=>{const w=a.current;(S?(w==null?void 0:w.isGroup)&&w.id===x.group_id:!(w!=null&&w.isGroup)&&(w==null?void 0:w.id)===x.conversation_id)&&P.current({id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},S)};return{onlineUsers:c,typingUsers:h,sendTypingIndicator:(x,S)=>{var w;(w=C.current)==null||w.send({type:"broadcast",event:"typing",payload:{user_id:t==null?void 0:t.id,partner_id:S,isTyping:x}})},sendSignalingMessage:(x,S,w)=>{C.current&&C.current.send({type:"broadcast",event:S,payload:{...w,recipientId:x}})},notificationSounds:qe,currentSoundId:R,setCurrentSoundId:F,ringtoneSoundRef:v}}function rr(t){var a,s,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(s=rr(t[a]))&&(r&&(r+=" "),r+=s)}else for(s in t)t[s]&&(r&&(r+=" "),r+=s);return r}function fs(){for(var t,a,s=0,r="",n=arguments.length;s<n;s++)(t=arguments[s])&&(a=rr(t))&&(r&&(r+=" "),r+=a);return r}const _s=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Ts=fs,hn=(t,a)=>s=>{var r;if((a==null?void 0:a.variants)==null)return Ts(t,s==null?void 0:s.class,s==null?void 0:s.className);const{variants:n,defaultVariants:i}=a,o=Object.keys(n).map(u=>{const c=s==null?void 0:s[u],l=i==null?void 0:i[u];if(c===null)return null;const h=_s(c)||_s(l);return n[u][h]}),d=s&&Object.entries(s).reduce((u,c)=>{let[l,h]=c;return h===void 0||(u[l]=h),u},{}),p=a==null||(r=a.compoundVariants)===null||r===void 0?void 0:r.reduce((u,c)=>{let{class:l,className:h,...y}=c;return Object.entries(y).every(b=>{let[v,C]=b;return Array.isArray(C)?C.includes({...i,...d}[v]):{...i,...d}[v]===C})?[...u,l,h]:u},[]);return Ts(t,o,p,s==null?void 0:s.class,s==null?void 0:s.className)},hs="-",xn=t=>{const a=bn(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:o=>{const d=o.split(hs);return d[0]===""&&d.length!==1&&d.shift(),ar(d,a)||gn(o)},getConflictingClassGroupIds:(o,d)=>{const p=s[o]||[];return d&&r[o]?[...p,...r[o]]:p}}},ar=(t,a)=>{var o;if(t.length===0)return a.classGroupId;const s=t[0],r=a.nextPart.get(s),n=r?ar(t.slice(1),r):void 0;if(n)return n;if(a.validators.length===0)return;const i=t.join(hs);return(o=a.validators.find(({validator:d})=>d(i)))==null?void 0:o.classGroupId},Rs=/^\[(.+)\]$/,gn=t=>{if(Rs.test(t)){const a=Rs.exec(t)[1],s=a==null?void 0:a.substring(0,a.indexOf(":"));if(s)return"arbitrary.."+s}},bn=t=>{const{theme:a,classGroups:s}=t,r={nextPart:new Map,validators:[]};for(const n in s)Xt(s[n],r,n,a);return r},Xt=(t,a,s,r)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?a:Ps(a,n);i.classGroupId=s;return}if(typeof n=="function"){if(vn(n)){Xt(n(r),a,s,r);return}a.validators.push({validator:n,classGroupId:s});return}Object.entries(n).forEach(([i,o])=>{Xt(o,Ps(a,i),s,r)})})},Ps=(t,a)=>{let s=t;return a.split(hs).forEach(r=>{s.nextPart.has(r)||s.nextPart.set(r,{nextPart:new Map,validators:[]}),s=s.nextPart.get(r)}),s},vn=t=>t.isThemeGetter,yn=t=>{if(t<1)return{get:()=>{},set:()=>{}};let a=0,s=new Map,r=new Map;const n=(i,o)=>{s.set(i,o),a++,a>t&&(a=0,r=s,s=new Map)};return{get(i){let o=s.get(i);if(o!==void 0)return o;if((o=r.get(i))!==void 0)return n(i,o),o},set(i,o){s.has(i)?s.set(i,o):n(i,o)}}},Kt="!",Qt=":",jn=Qt.length,wn=t=>{const{prefix:a,experimentalParseClassName:s}=t;let r=n=>{const i=[];let o=0,d=0,p=0,u;for(let b=0;b<n.length;b++){let v=n[b];if(o===0&&d===0){if(v===Qt){i.push(n.slice(p,b)),p=b+jn;continue}if(v==="/"){u=b;continue}}v==="["?o++:v==="]"?o--:v==="("?d++:v===")"&&d--}const c=i.length===0?n:n.substring(p),l=Nn(c),h=l!==c,y=u&&u>p?u-p:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:l,maybePostfixModifierPosition:y}};if(a){const n=a+Qt,i=r;r=o=>o.startsWith(n)?i(o.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(s){const n=r;r=i=>s({className:i,parseClassName:n})}return r},Nn=t=>t.endsWith(Kt)?t.substring(0,t.length-1):t.startsWith(Kt)?t.substring(1):t,Cn=t=>{const a=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const n=[];let i=[];return r.forEach(o=>{o[0]==="["||a[o]?(n.push(...i.sort(),o),i=[]):i.push(o)}),n.push(...i.sort()),n}},Sn=t=>({cache:yn(t.cacheSize),parseClassName:wn(t),sortModifiers:Cn(t),...xn(t)}),kn=/\s+/,_n=(t,a)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n,sortModifiers:i}=a,o=[],d=t.trim().split(kn);let p="";for(let u=d.length-1;u>=0;u-=1){const c=d[u],{isExternal:l,modifiers:h,hasImportantModifier:y,baseClassName:b,maybePostfixModifierPosition:v}=s(c);if(l){p=c+(p.length>0?" "+p:p);continue}let C=!!v,T=r(C?b.substring(0,v):b);if(!T){if(!C){p=c+(p.length>0?" "+p:p);continue}if(T=r(b),!T){p=c+(p.length>0?" "+p:p);continue}C=!1}const P=i(h).join(":"),E=y?P+Kt:P,R=E+T;if(o.includes(R))continue;o.push(R);const F=n(T,C);for(let W=0;W<F.length;++W){const g=F[W];o.push(E+g)}p=c+(p.length>0?" "+p:p)}return p};function Tn(){let t=0,a,s,r="";for(;t<arguments.length;)(a=arguments[t++])&&(s=nr(a))&&(r&&(r+=" "),r+=s);return r}const nr=t=>{if(typeof t=="string")return t;let a,s="";for(let r=0;r<t.length;r++)t[r]&&(a=nr(t[r]))&&(s&&(s+=" "),s+=a);return s};function Rn(t,...a){let s,r,n,i=o;function o(p){const u=a.reduce((c,l)=>l(c),t());return s=Sn(u),r=s.cache.get,n=s.cache.set,i=d,d(p)}function d(p){const u=r(p);if(u)return u;const c=_n(p,s);return n(p,c),c}return function(){return i(Tn.apply(null,arguments))}}const pe=t=>{const a=s=>s[t]||[];return a.isThemeGetter=!0,a},ir=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,or=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Pn=/^\d+\/\d+$/,En=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,In=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Mn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,An=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Dn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,st=t=>Pn.test(t),re=t=>!!t&&!Number.isNaN(Number(t)),Be=t=>!!t&&Number.isInteger(Number(t)),Ut=t=>t.endsWith("%")&&re(t.slice(0,-1)),Ae=t=>En.test(t),Ln=()=>!0,On=t=>In.test(t)&&!Mn.test(t),lr=()=>!1,zn=t=>An.test(t),Fn=t=>Dn.test(t),$n=t=>!q(t)&&!V(t),Gn=t=>it(t,ur,lr),q=t=>ir.test(t),Xe=t=>it(t,mr,On),Ht=t=>it(t,Hn,re),Es=t=>it(t,cr,lr),Bn=t=>it(t,dr,Fn),Tt=t=>it(t,pr,zn),V=t=>or.test(t),ht=t=>ot(t,mr),qn=t=>ot(t,Wn),Is=t=>ot(t,cr),Vn=t=>ot(t,ur),Un=t=>ot(t,dr),Rt=t=>ot(t,pr,!0),it=(t,a,s)=>{const r=ir.exec(t);return r?r[1]?a(r[1]):s(r[2]):!1},ot=(t,a,s=!1)=>{const r=or.exec(t);return r?r[1]?a(r[1]):s:!1},cr=t=>t==="position"||t==="percentage",dr=t=>t==="image"||t==="url",ur=t=>t==="length"||t==="size"||t==="bg-size",mr=t=>t==="length",Hn=t=>t==="number",Wn=t=>t==="family-name",pr=t=>t==="shadow",Yn=()=>{const t=pe("color"),a=pe("font"),s=pe("text"),r=pe("font-weight"),n=pe("tracking"),i=pe("leading"),o=pe("breakpoint"),d=pe("container"),p=pe("spacing"),u=pe("radius"),c=pe("shadow"),l=pe("inset-shadow"),h=pe("text-shadow"),y=pe("drop-shadow"),b=pe("blur"),v=pe("perspective"),C=pe("aspect"),T=pe("ease"),P=pe("animate"),E=()=>["auto","avoid","all","avoid-page","page","left","right","column"],R=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],F=()=>[...R(),V,q],W=()=>["auto","hidden","clip","visible","scroll"],g=()=>["auto","contain","none"],f=()=>[V,q,p],_=()=>[st,"full","auto",...f()],I=()=>[Be,"none","subgrid",V,q],x=()=>["auto",{span:["full",Be,V,q]},Be,V,q],S=()=>[Be,"auto",V,q],w=()=>["auto","min","max","fr",V,q],j=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],U=()=>["start","end","center","stretch","center-safe","end-safe"],k=()=>["auto",...f()],G=()=>[st,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...f()],N=()=>[t,V,q],B=()=>[...R(),Is,Es,{position:[V,q]}],ee=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Y=()=>["auto","cover","contain",Vn,Gn,{size:[V,q]}],K=()=>[Ut,ht,Xe],M=()=>["","none","full",u,V,q],X=()=>["",re,ht,Xe],H=()=>["solid","dashed","dotted","double"],L=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>[re,Ut,Is,Es],ae=()=>["","none",b,V,q],Z=()=>["none",re,V,q],de=()=>["none",re,V,q],Re=()=>[re,V,q],we=()=>[st,"full",...f()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Ae],breakpoint:[Ae],color:[Ln],container:[Ae],"drop-shadow":[Ae],ease:["in","out","in-out"],font:[$n],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Ae],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Ae],shadow:[Ae],spacing:["px",re],text:[Ae],"text-shadow":[Ae],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",st,q,V,C]}],container:["container"],columns:[{columns:[re,q,V,d]}],"break-after":[{"break-after":E()}],"break-before":[{"break-before":E()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:F()}],overflow:[{overflow:W()}],"overflow-x":[{"overflow-x":W()}],"overflow-y":[{"overflow-y":W()}],overscroll:[{overscroll:g()}],"overscroll-x":[{"overscroll-x":g()}],"overscroll-y":[{"overscroll-y":g()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:_()}],"inset-x":[{"inset-x":_()}],"inset-y":[{"inset-y":_()}],start:[{start:_()}],end:[{end:_()}],top:[{top:_()}],right:[{right:_()}],bottom:[{bottom:_()}],left:[{left:_()}],visibility:["visible","invisible","collapse"],z:[{z:[Be,"auto",V,q]}],basis:[{basis:[st,"full","auto",d,...f()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[re,st,"auto","initial","none",q]}],grow:[{grow:["",re,V,q]}],shrink:[{shrink:["",re,V,q]}],order:[{order:[Be,"first","last","none",V,q]}],"grid-cols":[{"grid-cols":I()}],"col-start-end":[{col:x()}],"col-start":[{"col-start":S()}],"col-end":[{"col-end":S()}],"grid-rows":[{"grid-rows":I()}],"row-start-end":[{row:x()}],"row-start":[{"row-start":S()}],"row-end":[{"row-end":S()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":w()}],"auto-rows":[{"auto-rows":w()}],gap:[{gap:f()}],"gap-x":[{"gap-x":f()}],"gap-y":[{"gap-y":f()}],"justify-content":[{justify:[...j(),"normal"]}],"justify-items":[{"justify-items":[...U(),"normal"]}],"justify-self":[{"justify-self":["auto",...U()]}],"align-content":[{content:["normal",...j()]}],"align-items":[{items:[...U(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...U(),{baseline:["","last"]}]}],"place-content":[{"place-content":j()}],"place-items":[{"place-items":[...U(),"baseline"]}],"place-self":[{"place-self":["auto",...U()]}],p:[{p:f()}],px:[{px:f()}],py:[{py:f()}],ps:[{ps:f()}],pe:[{pe:f()}],pt:[{pt:f()}],pr:[{pr:f()}],pb:[{pb:f()}],pl:[{pl:f()}],m:[{m:k()}],mx:[{mx:k()}],my:[{my:k()}],ms:[{ms:k()}],me:[{me:k()}],mt:[{mt:k()}],mr:[{mr:k()}],mb:[{mb:k()}],ml:[{ml:k()}],"space-x":[{"space-x":f()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":f()}],"space-y-reverse":["space-y-reverse"],size:[{size:G()}],w:[{w:[d,"screen",...G()]}],"min-w":[{"min-w":[d,"screen","none",...G()]}],"max-w":[{"max-w":[d,"screen","none","prose",{screen:[o]},...G()]}],h:[{h:["screen",...G()]}],"min-h":[{"min-h":["screen","none",...G()]}],"max-h":[{"max-h":["screen",...G()]}],"font-size":[{text:["base",s,ht,Xe]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,V,Ht]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ut,q]}],"font-family":[{font:[qn,q,a]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,V,q]}],"line-clamp":[{"line-clamp":[re,"none",V,Ht]}],leading:[{leading:[i,...f()]}],"list-image":[{"list-image":["none",V,q]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",V,q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:N()}],"text-color":[{text:N()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:[re,"from-font","auto",V,Xe]}],"text-decoration-color":[{decoration:N()}],"underline-offset":[{"underline-offset":[re,"auto",V,q]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:f()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",V,q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",V,q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:B()}],"bg-repeat":[{bg:ee()}],"bg-size":[{bg:Y()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Be,V,q],radial:["",V,q],conic:[Be,V,q]},Un,Bn]}],"bg-color":[{bg:N()}],"gradient-from-pos":[{from:K()}],"gradient-via-pos":[{via:K()}],"gradient-to-pos":[{to:K()}],"gradient-from":[{from:N()}],"gradient-via":[{via:N()}],"gradient-to":[{to:N()}],rounded:[{rounded:M()}],"rounded-s":[{"rounded-s":M()}],"rounded-e":[{"rounded-e":M()}],"rounded-t":[{"rounded-t":M()}],"rounded-r":[{"rounded-r":M()}],"rounded-b":[{"rounded-b":M()}],"rounded-l":[{"rounded-l":M()}],"rounded-ss":[{"rounded-ss":M()}],"rounded-se":[{"rounded-se":M()}],"rounded-ee":[{"rounded-ee":M()}],"rounded-es":[{"rounded-es":M()}],"rounded-tl":[{"rounded-tl":M()}],"rounded-tr":[{"rounded-tr":M()}],"rounded-br":[{"rounded-br":M()}],"rounded-bl":[{"rounded-bl":M()}],"border-w":[{border:X()}],"border-w-x":[{"border-x":X()}],"border-w-y":[{"border-y":X()}],"border-w-s":[{"border-s":X()}],"border-w-e":[{"border-e":X()}],"border-w-t":[{"border-t":X()}],"border-w-r":[{"border-r":X()}],"border-w-b":[{"border-b":X()}],"border-w-l":[{"border-l":X()}],"divide-x":[{"divide-x":X()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":X()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...H(),"hidden","none"]}],"divide-style":[{divide:[...H(),"hidden","none"]}],"border-color":[{border:N()}],"border-color-x":[{"border-x":N()}],"border-color-y":[{"border-y":N()}],"border-color-s":[{"border-s":N()}],"border-color-e":[{"border-e":N()}],"border-color-t":[{"border-t":N()}],"border-color-r":[{"border-r":N()}],"border-color-b":[{"border-b":N()}],"border-color-l":[{"border-l":N()}],"divide-color":[{divide:N()}],"outline-style":[{outline:[...H(),"none","hidden"]}],"outline-offset":[{"outline-offset":[re,V,q]}],"outline-w":[{outline:["",re,ht,Xe]}],"outline-color":[{outline:N()}],shadow:[{shadow:["","none",c,Rt,Tt]}],"shadow-color":[{shadow:N()}],"inset-shadow":[{"inset-shadow":["none",l,Rt,Tt]}],"inset-shadow-color":[{"inset-shadow":N()}],"ring-w":[{ring:X()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:N()}],"ring-offset-w":[{"ring-offset":[re,Xe]}],"ring-offset-color":[{"ring-offset":N()}],"inset-ring-w":[{"inset-ring":X()}],"inset-ring-color":[{"inset-ring":N()}],"text-shadow":[{"text-shadow":["none",h,Rt,Tt]}],"text-shadow-color":[{"text-shadow":N()}],opacity:[{opacity:[re,V,q]}],"mix-blend":[{"mix-blend":[...L(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":L()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[re]}],"mask-image-linear-from-pos":[{"mask-linear-from":J()}],"mask-image-linear-to-pos":[{"mask-linear-to":J()}],"mask-image-linear-from-color":[{"mask-linear-from":N()}],"mask-image-linear-to-color":[{"mask-linear-to":N()}],"mask-image-t-from-pos":[{"mask-t-from":J()}],"mask-image-t-to-pos":[{"mask-t-to":J()}],"mask-image-t-from-color":[{"mask-t-from":N()}],"mask-image-t-to-color":[{"mask-t-to":N()}],"mask-image-r-from-pos":[{"mask-r-from":J()}],"mask-image-r-to-pos":[{"mask-r-to":J()}],"mask-image-r-from-color":[{"mask-r-from":N()}],"mask-image-r-to-color":[{"mask-r-to":N()}],"mask-image-b-from-pos":[{"mask-b-from":J()}],"mask-image-b-to-pos":[{"mask-b-to":J()}],"mask-image-b-from-color":[{"mask-b-from":N()}],"mask-image-b-to-color":[{"mask-b-to":N()}],"mask-image-l-from-pos":[{"mask-l-from":J()}],"mask-image-l-to-pos":[{"mask-l-to":J()}],"mask-image-l-from-color":[{"mask-l-from":N()}],"mask-image-l-to-color":[{"mask-l-to":N()}],"mask-image-x-from-pos":[{"mask-x-from":J()}],"mask-image-x-to-pos":[{"mask-x-to":J()}],"mask-image-x-from-color":[{"mask-x-from":N()}],"mask-image-x-to-color":[{"mask-x-to":N()}],"mask-image-y-from-pos":[{"mask-y-from":J()}],"mask-image-y-to-pos":[{"mask-y-to":J()}],"mask-image-y-from-color":[{"mask-y-from":N()}],"mask-image-y-to-color":[{"mask-y-to":N()}],"mask-image-radial":[{"mask-radial":[V,q]}],"mask-image-radial-from-pos":[{"mask-radial-from":J()}],"mask-image-radial-to-pos":[{"mask-radial-to":J()}],"mask-image-radial-from-color":[{"mask-radial-from":N()}],"mask-image-radial-to-color":[{"mask-radial-to":N()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":R()}],"mask-image-conic-pos":[{"mask-conic":[re]}],"mask-image-conic-from-pos":[{"mask-conic-from":J()}],"mask-image-conic-to-pos":[{"mask-conic-to":J()}],"mask-image-conic-from-color":[{"mask-conic-from":N()}],"mask-image-conic-to-color":[{"mask-conic-to":N()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:B()}],"mask-repeat":[{mask:ee()}],"mask-size":[{mask:Y()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",V,q]}],filter:[{filter:["","none",V,q]}],blur:[{blur:ae()}],brightness:[{brightness:[re,V,q]}],contrast:[{contrast:[re,V,q]}],"drop-shadow":[{"drop-shadow":["","none",y,Rt,Tt]}],"drop-shadow-color":[{"drop-shadow":N()}],grayscale:[{grayscale:["",re,V,q]}],"hue-rotate":[{"hue-rotate":[re,V,q]}],invert:[{invert:["",re,V,q]}],saturate:[{saturate:[re,V,q]}],sepia:[{sepia:["",re,V,q]}],"backdrop-filter":[{"backdrop-filter":["","none",V,q]}],"backdrop-blur":[{"backdrop-blur":ae()}],"backdrop-brightness":[{"backdrop-brightness":[re,V,q]}],"backdrop-contrast":[{"backdrop-contrast":[re,V,q]}],"backdrop-grayscale":[{"backdrop-grayscale":["",re,V,q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[re,V,q]}],"backdrop-invert":[{"backdrop-invert":["",re,V,q]}],"backdrop-opacity":[{"backdrop-opacity":[re,V,q]}],"backdrop-saturate":[{"backdrop-saturate":[re,V,q]}],"backdrop-sepia":[{"backdrop-sepia":["",re,V,q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":f()}],"border-spacing-x":[{"border-spacing-x":f()}],"border-spacing-y":[{"border-spacing-y":f()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",V,q]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[re,"initial",V,q]}],ease:[{ease:["linear","initial",T,V,q]}],delay:[{delay:[re,V,q]}],animate:[{animate:["none",P,V,q]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[v,V,q]}],"perspective-origin":[{"perspective-origin":F()}],rotate:[{rotate:Z()}],"rotate-x":[{"rotate-x":Z()}],"rotate-y":[{"rotate-y":Z()}],"rotate-z":[{"rotate-z":Z()}],scale:[{scale:de()}],"scale-x":[{"scale-x":de()}],"scale-y":[{"scale-y":de()}],"scale-z":[{"scale-z":de()}],"scale-3d":["scale-3d"],skew:[{skew:Re()}],"skew-x":[{"skew-x":Re()}],"skew-y":[{"skew-y":Re()}],transform:[{transform:[V,q,"","none","gpu","cpu"]}],"transform-origin":[{origin:F()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:we()}],"translate-x":[{"translate-x":we()}],"translate-y":[{"translate-y":we()}],"translate-z":[{"translate-z":we()}],"translate-none":["translate-none"],accent:[{accent:N()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:N()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",V,q]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":f()}],"scroll-mx":[{"scroll-mx":f()}],"scroll-my":[{"scroll-my":f()}],"scroll-ms":[{"scroll-ms":f()}],"scroll-me":[{"scroll-me":f()}],"scroll-mt":[{"scroll-mt":f()}],"scroll-mr":[{"scroll-mr":f()}],"scroll-mb":[{"scroll-mb":f()}],"scroll-ml":[{"scroll-ml":f()}],"scroll-p":[{"scroll-p":f()}],"scroll-px":[{"scroll-px":f()}],"scroll-py":[{"scroll-py":f()}],"scroll-ps":[{"scroll-ps":f()}],"scroll-pe":[{"scroll-pe":f()}],"scroll-pt":[{"scroll-pt":f()}],"scroll-pr":[{"scroll-pr":f()}],"scroll-pb":[{"scroll-pb":f()}],"scroll-pl":[{"scroll-pl":f()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",V,q]}],fill:[{fill:["none",...N()]}],"stroke-w":[{stroke:[re,ht,Xe,Ht]}],stroke:[{stroke:["none",...N()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},fr=Rn(Yn);function wt(...t){return fr(fs(t))}const Jn=hn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function me({className:t,variant:a,size:s,asChild:r=!1,...n}){const i=r?oa:"button";return e.jsx(i,{"data-slot":"button",className:wt(Jn({variant:a,size:s,className:t})),...n})}const je=m.forwardRef(({className:t,type:a,...s},r)=>e.jsx("input",{ref:r,type:a,"data-slot":"input",className:wt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s}));je.displayName="Input";function Xn({onLoginSuccess:t,initialStep:a="login",onNavigateToRegister:s,language:r,t:n}){const[i,o]=m.useState(""),[d,p]=m.useState(""),[u,c]=m.useState(""),[l,h]=m.useState(a==="signup"),[y,b]=m.useState(!1),[v,C]=m.useState(null),T=vs(0),P=vs(0),E=ys(T,{stiffness:500,damping:50}),R=ys(P,{stiffness:500,damping:50});function F({currentTarget:I,clientX:x,clientY:S}){const{left:w,top:j,width:U,height:k}=I.getBoundingClientRect();T.set((x-w)/U-.5),P.set((S-j)/k-.5)}const W=js(R,[-.5,.5],[10,-10]),g=js(E,[-.5,.5],[-10,10]);m.useEffect(()=>{const I=localStorage.getItem("chat_app_username"),x=localStorage.getItem("chat_app_pin");I&&x&&(o(I),p(x))},[]);const f=I=>`${I.trim().toLowerCase().replace(/\s+/g,"_")}@app.local`,_=async I=>{if(I.preventDefault(),!(!i.trim()||!d.trim())&&!(l&&!u.trim())){b(!0),C(null);try{const x=f(i);if(await new Promise(S=>setTimeout(S,800)),l){const{error:S}=await Q.auth.signUp({email:x,password:d,options:{data:{username:i.trim().toLowerCase(),display_name:u.trim(),pin:d}}});if(S)throw S}else{let{error:S}=await Q.auth.signInWithPassword({email:x,password:d});if(S){const w=`${i.trim().toLowerCase().replace(/\s+/g,"_")}@chatapp.local`,{error:j}=await Q.auth.signInWithPassword({email:w,password:d});if(j)throw new Error(r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø±Ù…Ø² PIN ØºÙŠØ± ØµØ­ÙŠØ­":"Invalid username or PIN");S=null}localStorage.setItem("chat_app_username",i.trim()),localStorage.setItem("chat_app_pin",d)}t()}catch(x){C(x.message)}finally{b(!1)}}};return e.jsxs("div",{className:"h-screen w-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center relative group",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(A.div,{animate:{x:[0,30,0],y:[0,-50,0],scale:[1,1.1,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"},className:"absolute -top-[10%] -left-[5%] w-[60vw] h-[60vw] bg-indigo-600/15 rounded-full blur-[120px] mix-blend-screen"}),e.jsx(A.div,{animate:{x:[0,-30,0],y:[0,50,0],scale:[1,1.2,1]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute top-[30%] -right-[5%] w-[50vw] h-[50vw] bg-violet-600/15 rounded-full blur-[100px] mix-blend-screen"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 pointer-events-none mix-blend-multiply"})]}),e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:Array.from({length:20}).map((I,x)=>e.jsx(A.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1,0],x:["0%",`${Math.random()*100}%`],y:["0%",`${Math.random()*100}%`]},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"linear"},className:"absolute w-1 h-1 bg-indigo-400 rounded-full blur-[1px]",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},x))}),e.jsxs(A.div,{onMouseMove:F,style:{rotateX:W,rotateY:g,transformStyle:"preserve-3d"},initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},transition:{duration:.8,ease:[.16,1,.3,1]},className:"w-full max-w-md relative perspective-1000 z-10 mx-4",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-[2.5rem] blur-2xl opacity-50 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"}),e.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900/40 border border-white/10 shadow-[0_0_50px_-12px_rgba(0,0,0,0.5)] rounded-[2rem] p-8 overflow-hidden transform-gpu ring-1 ring-white/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-indigo-500/5 via-transparent to-violet-500/5 pointer-events-none"}),e.jsx("div",{className:"absolute -top-[150%] -left-[50%] w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none animate-[shimmer_10s_infinite_linear]"}),e.jsxs("div",{className:"flex flex-col items-center mb-10 relative z-10",children:[e.jsxs(A.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,type:"spring"},className:"relative group/logo",children:[e.jsxs("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/40 mb-5 transform rotate-3 hover:rotate-0 transition-all duration-500",children:[e.jsx(is,{className:"w-10 h-10 text-white fill-white/10"}),e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-2xl opacity-0 group-hover/logo:opacity-100 transition-opacity"})]}),e.jsx(A.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:3},className:"absolute -top-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900 shadow-[0_0_15px_rgba(52,211,153,0.8)]"})]}),e.jsx(A.h1,{initial:{opacity:0,filter:"blur(10px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{delay:.5},className:`text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400 font-outfit ${r==="ar"?"font-arabic":""}`,children:l?r==="ar"?"Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§":"Join the Flow":r==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ":"Welcome"}),e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:`text-slate-400 text-sm mt-3 font-medium text-center max-w-[250px] ${r==="ar"?"font-arabic":""}`,children:l?r==="ar"?"Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø¢Ù†":"Establish your decentralized identity":r==="ar"?"ÙˆØµÙˆÙ„ Ø¢Ù…Ù† Ù„Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©":"Secure access to your private conversations"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-5 relative z-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors animate-pulse-slow`,children:e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx(je,{type:"text",value:i,onChange:I=>o(I.target.value),placeholder:r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"Username",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${r==="ar"?"font-arabic text-right":""}`,disabled:y})]}),e.jsx(he,{mode:"popLayout",children:l&&e.jsxs(A.div,{initial:{opacity:0,height:0,y:-20},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-20},className:"group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx(je,{type:"text",value:u,onChange:I=>c(I.target.value),placeholder:r==="ar"?"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±":"Display Name",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${r==="ar"?"font-arabic text-right":""}`,disabled:y})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${r==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(Bs,{className:"w-5 h-5"})}),e.jsx(je,{type:"password",inputMode:"numeric",className:"pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 tracking-[0.5em] font-mono text-xl",maxLength:6,placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:d,onChange:I=>p(I.target.value),disabled:y})]})]}),e.jsx(he,{children:v&&e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 flex items-center gap-3 backdrop-blur-md",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)] ${r==="ar"?"ml-3":""}`}),e.jsx("span",{className:`text-red-400 text-sm font-medium leading-tight ${r==="ar"?"font-arabic":""}`,children:v})]})}),e.jsx(A.div,{initial:!1,animate:y?{scale:.98}:{scale:1},children:e.jsxs(me,{type:"submit",disabled:y,className:"w-full h-14 bg-gradient-to-r from-indigo-600 via-indigo-500 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold text-lg rounded-2xl shadow-2xl shadow-indigo-600/30 border-0 relative overflow-hidden group/btn",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 -translate-x-full group-hover/btn:translate-x-0 transition-transform duration-500"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:y?e.jsx(ye,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[l?r==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ":"Sign Up Free":r==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"Authenticate",e.jsx(la,{className:`w-5 h-5 group-hover/btn:translate-x-2 transition-transform duration-300 ${r==="ar"?"rotate-180 group-hover/btn:-translate-x-2":""}`})]})})]})}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{type:"button",onClick:()=>{h(!l),C(null)},className:"text-slate-400 hover:text-white text-sm transition-all duration-300 group/link",children:l?e.jsxs("span",{className:r==="ar"?"font-arabic":"",children:[r==="ar"?"Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ":"Existing user? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:r==="ar"?"Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ":"Log in"})]}):e.jsxs("span",{className:r==="ar"?"font-arabic":"",children:[r==="ar"?"Ù‡ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ ":"New identity? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:r==="ar"?"Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†":"Sign up"})]})})})]})]}),e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-8 flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-slate-700",children:[e.jsx("div",{className:"h-px w-8 bg-current"}),e.jsx("p",{className:`text-[10px] uppercase tracking-[0.3em] font-black ${r==="ar"?"font-arabic":""}`,children:r==="ar"?"Ù‚Ù†Ø§Ø© Ù…Ø´ÙØ±Ø©":"Encrypted Channel"}),e.jsx("div",{className:"h-px w-8 bg-current"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3].map(I=>e.jsx("div",{className:"w-1 h-1 bg-slate-800 rounded-full"},I))})]})]})]})}var xs="Avatar",[Kn]=ca(xs),[Qn,hr]=Kn(xs),xr=m.forwardRef((t,a)=>{const{__scopeAvatar:s,...r}=t,[n,i]=m.useState("idle");return e.jsx(Qn,{scope:s,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(os.span,{...r,ref:a})})});xr.displayName=xs;var gr="AvatarImage",br=m.forwardRef((t,a)=>{const{__scopeAvatar:s,src:r,onLoadingStatusChange:n=()=>{},...i}=t,o=hr(gr,s),d=Zn(r,i.referrerPolicy),p=da(u=>{n(u),o.onImageLoadingStatusChange(u)});return qs(()=>{d!=="idle"&&p(d)},[d,p]),d==="loaded"?e.jsx(os.img,{...i,ref:a,src:r}):null});br.displayName=gr;var vr="AvatarFallback",yr=m.forwardRef((t,a)=>{const{__scopeAvatar:s,delayMs:r,...n}=t,i=hr(vr,s),[o,d]=m.useState(r===void 0);return m.useEffect(()=>{if(r!==void 0){const p=window.setTimeout(()=>d(!0),r);return()=>window.clearTimeout(p)}},[r]),o&&i.imageLoadingStatus!=="loaded"?e.jsx(os.span,{...n,ref:a}):null});yr.displayName=vr;function Zn(t,a){const[s,r]=m.useState("idle");return qs(()=>{if(!t){r("error");return}let n=!0;const i=new window.Image,o=d=>()=>{n&&r(d)};return r("loading"),i.onload=o("loaded"),i.onerror=o("error"),i.src=t,a&&(i.referrerPolicy=a),()=>{n=!1}},[t,a]),s}var ei=xr,ti=br,si=yr;function Le({className:t,...a}){return e.jsx(ei,{"data-slot":"avatar",className:wt("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...a})}function He({className:t,...a}){return e.jsx(ti,{"data-slot":"avatar-image",className:wt("aspect-square size-full",t),...a})}function Oe({className:t,...a}){return e.jsx(si,{"data-slot":"avatar-fallback",className:wt("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}function se(...t){return fr(fs(t))}function Ms({user:t,hasStatus:a,isAllSeen:s,statusCount:r,onClick:n,size:i="md"}){const o={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20"}[i];return e.jsxs("div",{className:se("relative flex-shrink-0 cursor-pointer transition-transform active:scale-95",o),onClick:n,children:[a&&e.jsx("svg",{className:"absolute inset-0 w-full h-full -rotate-90 pointer-events-none",children:e.jsx("circle",{cx:"50%",cy:"50%",r:"48%",fill:"none",stroke:s?"rgba(255,255,255,0.2)":"var(--brand-color)",strokeWidth:"2",strokeDasharray:r>1?"10 2":"0",className:"transition-all duration-500"})}),e.jsx("div",{className:se("p-[3px] w-full h-full rounded-full"),children:e.jsxs(Le,{className:"w-full h-full border border-slate-900 shadow-inner",children:[e.jsx(He,{src:t.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=random&color=fff`}),e.jsx(Oe,{className:"bg-slate-800 text-slate-300",children:t.name?t.name.charAt(0).toUpperCase():"?"})]})}),!s&&a&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-950 rounded-full ring-1 ring-white/20"})]})}function ri({chats:t,currentUser:a,onlineUsers:s,onSelectChat:r,onNewChat:n,onCreateGroup:i,onLogout:o,onAcceptRequest:d,onRejectRequest:p,pendingRequests:u,typingUsers:c,onSettings:l,onPinChat:h,statuses:y=[],onViewStatus:b,onAddStatus:v,language:C,t:T,isLoading:P}){const[E,R]=m.useState(""),F=m.useMemo(()=>t.filter(g=>g.partnerName.toLowerCase().includes(E.toLowerCase())||g.lastMessage.toLowerCase().includes(E.toLowerCase())).sort((g,f)=>g.isPinned&&!f.isPinned?-1:!g.isPinned&&f.isPinned?1:new Date(f.lastMessageTime).getTime()-new Date(g.lastMessageTime).getTime()),[t,E]),W=g=>{if(!g)return"";const f=new Date(g),I=new Date().getTime()-f.getTime(),x=Math.floor(I/(1e3*60*60*24));return x===0?f.toLocaleTimeString(C==="ar"?"ar-EG":"en-US",{hour:"2-digit",minute:"2-digit"}):x===1?C==="ar"?"Ø£Ù…Ø³":"Yesterday":x<7?f.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{weekday:"short"}):f.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950/95 backdrop-blur-md border-r border-white/5 w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-brand/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"p-4 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(A.h1,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 flex items-center gap-2 ${C==="ar"?"font-arabic":""}`,children:[T("chats")," ",e.jsx("span",{className:"text-xs bg-brand/20 text-brand px-2 py-0.5 rounded-full border border-brand/30",children:t.length})]}),e.jsx("div",{className:"flex items-center gap-2",children:[{icon:bt,onClick:i,title:T("createGroup")},{icon:Yt,onClick:n,title:T("newChat")},{icon:ua,onClick:l,title:T("settings")}].map((g,f)=>e.jsx(A.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:f*.1},whileHover:{scale:1.1,backgroundColor:"rgba(255, 255, 255, 0.1)"},whileTap:{scale:.9},onClick:g.onClick,title:g.title,className:se("p-2 rounded-full transition-colors text-slate-400 hover:text-white"),children:e.jsx(g.icon,{className:"w-5 h-5"})},f))})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-4 mb-6 p-3 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/30 transition-colors group",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Le,{className:"w-12 h-12 border-2 border-brand/20 group-hover:border-brand transition-colors",children:[e.jsx(He,{src:a.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name)}&background=6366f1&color=fff`}),e.jsx(Oe,{className:"bg-brand text-white",children:a.name.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-bold truncate text-base",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-brand text-xs font-medium truncate bg-brand/10 px-2 py-0.5 rounded-md",children:["@",a.username]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`@${a.username}`),te.success(C==="ar"?"ØªÙ… Ù†Ø³Ø® Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!":"Username copied!")},className:"text-slate-500 hover:text-white transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ma,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex gap-4 overflow-x-auto py-2 no-scrollbar mb-4 relative z-10",children:[e.jsxs(A.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] group",onClick:v,children:[e.jsx(Ms,{user:{id:a.id,name:a.name,avatar_url:a.avatar_url},hasStatus:!1,isAllSeen:!1,statusCount:0,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:C==="ar"?"Ø­Ø§Ù„ØªÙÙŠ":"My Status"})]}),Object.entries(y.reduce((g,f)=>{const _=f.user_id;return g[_]||(g[_]=[]),g[_].push(f),g},{})).map(([g,f])=>{var _,I,x;return e.jsxs(A.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] cursor-pointer",onClick:()=>{const S=f.map(w=>{var j,U;return{id:w.id,user_id:w.user_id,user_name:((j=w.profiles)==null?void 0:j.display_name)||"User",user_avatar:(U=w.profiles)==null?void 0:U.avatar_url,content_type:w.content_type,content_url:w.content_url,text:w.text,created_at:w.created_at}});b==null||b(S,0)},children:[e.jsx(Ms,{user:{id:g,name:((_=f[0].profiles)==null?void 0:_.display_name)||"User",avatar_url:(I=f[0].profiles)==null?void 0:I.avatar_url},hasStatus:!0,isAllSeen:!1,statusCount:f.length,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-medium truncate w-14 text-center",children:((x=f[0].profiles)==null?void 0:x.display_name)||"User"})]},g)})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vt,{className:"w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"})}),e.jsx(je,{type:"text",placeholder:T("search"),value:E,onChange:g=>R(g.target.value),className:"pl-10 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-500 h-10 transition-all font-light"})]})]}),e.jsx(he,{children:u.length>0&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/20 to-violet-900/20 border border-indigo-500/20 rounded-xl p-3 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Ot,{className:"w-3 h-3 animate-bounce"}),e.jsx("span",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©":"New Requests"})]}),e.jsx("div",{className:"space-y-2",children:u.map(g=>{var f;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-slate-900/50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate",children:e.jsxs("span",{className:"text-indigo-400",children:["@",(f=g.profiles)==null?void 0:f.username]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(g.id,g.sender_id),className:"p-1.5 bg-brand/20 text-brand hover:bg-brand hover:text-white rounded-md transition-colors",children:e.jsx(De,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>p(g.id),className:"p-1.5 bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white rounded-md transition-colors",children:e.jsx(Se,{className:"w-3 h-3"})})]})]},g.id)})})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2 space-y-1",children:P?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx(ye,{className:"w-8 h-8 animate-spin text-brand mb-2"}),e.jsx("p",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª...":"Loading chats..."})]}):F.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-4",children:e.jsx(is,{className:"w-8 h-8 opacity-20"})}),e.jsx("p",{className:`font-medium text-slate-400 ${C==="ar"?"font-arabic":""}`,children:T("no_chats")}),e.jsx("p",{className:"text-xs mt-1 text-slate-600",children:C==="ar"?"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯.":"Start exploring to find new friends."})]}):F.map((g,f)=>{var _,I;return e.jsxs(A.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:f*.05},onClick:()=>r(g.partnerId,g.partnerName),className:"group relative flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer transition-all border border-transparent hover:border-white/5 active:scale-[0.98]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(Le,{className:"w-12 h-12 border border-white/10 group-hover:border-brand/50 transition-colors",children:[e.jsx(He,{src:g.partnerAvatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(g.partnerName)}&background=random&color=fff`}),e.jsx(Oe,{className:"bg-slate-800 text-slate-300",children:g.partnerName.charAt(0).toUpperCase()})]}),!g.isGroup&&s.has(g.partnerId)&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-brand border-2 border-slate-950 rounded-full ring-2 ring-slate-950 animate-pulse"}),g.isGroup&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-slate-800 p-1 rounded-full border border-slate-700",children:e.jsx(bt,{className:"w-3 h-3 text-brand"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h3",{className:se("font-semibold truncate transition-colors text-base",g.unreadCount>0?"text-white":"text-slate-300 group-hover:text-white"),children:g.partnerName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),h(g.id,!g.isPinned)},className:se("p-1 rounded-md transition-all",g.isPinned?"text-indigo-400 opacity-100":"text-slate-600 opacity-0 group-hover:opacity-100 hover:text-white hover:bg-white/10"),children:e.jsx(nt,{className:se("w-3.5 h-3.5",g.isPinned&&"fill-indigo-400")})}),e.jsx("span",{className:se("text-[10px] flex-shrink-0 font-medium",g.unreadCount>0?"text-indigo-400":"text-slate-500"),children:W(g.lastMessageTime)})]})]}),e.jsxs("div",{className:"flex justify-between items-center h-5",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-2",children:c[g.partnerId]?e.jsxs("p",{className:"text-brand text-xs font-bold flex items-center gap-1",children:[C==="ar"?"ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†":"typing",e.jsxs("span",{className:"flex gap-0.5 pt-1",children:[e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(A.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-1 h-1 bg-brand rounded-full"})]})]}):e.jsx("p",{className:se("text-sm truncate",g.unreadCount>0?"text-slate-100 font-medium":"text-slate-500 group-hover:text-slate-400"),children:(_=g.lastMessage)!=null&&_.includes("Voice Message")||(I=g.lastMessage)!=null&&I.includes("Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©")?"ðŸŽ¤":g.lastMessage||e.jsx("span",{className:"italic text-slate-600",children:C==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„":"No messages yet"})})}),g.unreadCount>0&&e.jsx(A.div,{initial:{scale:0},animate:{scale:1},className:"bg-brand text-white text-[10px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg shadow-brand/40",children:g.unreadCount})]})]})]},g.id)})})]})}const ai=m.memo(ri),jr=m.createContext(void 0),ni=({children:t})=>{const[a,s]=m.useState(null),r=m.useRef(new Map),n=m.useRef(null);typeof window<"u"&&!n.current&&(n.current=new Audio("/sounds/digital.mp3"));const i=m.useCallback(c=>{s(c)},[]),o=m.useCallback(c=>{s(l=>l===c?null:l)},[]),d=m.useCallback((c,l)=>{r.current.set(c,l)},[]),p=m.useCallback(c=>{r.current.delete(c)},[]),u=m.useCallback(c=>{s(null);const l=r.current.get(c);l&&(n.current&&(n.current.volume=1,n.current.play().catch(()=>{})),setTimeout(()=>{l()},500))},[]);return e.jsx(jr.Provider,{value:{activeMessageId:a,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:u},children:t})},wr=()=>{const t=m.useContext(jr);if(!t)throw new Error("useVoicePlayback must be used within a VoicePlaybackProvider");return t},Nr=m.createContext(void 0),Zt={indigo:{name:"Royal Indigo",class:"indigo",hex:"#6366f1"},emerald:{name:"Forest Emerald",class:"emerald",hex:"#10b981"},rose:{name:"Velvet Rose",class:"rose",hex:"#f43f5e"},amber:{name:"Golden Amber",class:"amber",hex:"#f59e0b"},cyan:{name:"Ocean Cyan",class:"cyan",hex:"#06b6d4"},violet:{name:"Electric Violet",class:"violet",hex:"#8b5cf6"}};function ii({children:t}){const[a,s]=m.useState(()=>localStorage.getItem("chat_theme_color")||"indigo"),[r,n]=m.useState(()=>localStorage.getItem("chat_wallpaper")||"doodles"),[i,o]=m.useState(()=>Number(localStorage.getItem("chat_bg_opacity"))||.05);return m.useEffect(()=>{localStorage.setItem("chat_theme_color",a);const d=Zt[a];document.documentElement.style.setProperty("--brand-color",d.hex)},[a]),m.useEffect(()=>{localStorage.setItem("chat_wallpaper",r)},[r]),m.useEffect(()=>{localStorage.setItem("chat_bg_opacity",String(i)),document.documentElement.style.setProperty("--bg-opacity",String(i))},[i]),e.jsx(Nr.Provider,{value:{accentColor:a,setAccentColor:s,wallpaper:r,setWallpaper:n,bgOpacity:i,setBgOpacity:o},children:t})}function Cr(){const t=m.useContext(Nr);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const oi=m.memo(({question:t,options:a,votes:s,currentUserId:r,onVote:n,isSent:i})=>{const o=Object.keys(s).length,d=s[r],p=u=>{const c=Object.values(s).filter(h=>h===u).length,l=o===0?0:c/o*100;return{count:c,percent:l}};return e.jsxs("div",{className:"flex flex-col gap-4 min-w-[240px] max-w-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl",children:e.jsx(bt,{className:"w-5 h-5 text-brand"})}),e.jsx("h3",{className:"text-lg font-bold text-white leading-tight",dir:"auto",children:t})]}),e.jsx("div",{className:"space-y-2",children:a.map((u,c)=>{const{count:l,percent:h}=p(c),y=d===c,b=/[\u0600-\u06FF]/.test(u);return e.jsxs("button",{onClick:()=>n(c),className:"w-full text-left group relative outline-none",dir:b?"rtl":"ltr",children:[e.jsxs("div",{className:se("relative z-10 flex items-center justify-between p-3 rounded-xl border transition-all duration-300",y?"bg-brand/30 border-brand/50 shadow-lg shadow-brand/10":"bg-white/5 border-white/5 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:se("w-5 h-5 rounded-full border flex items-center justify-center transition-colors",y?"bg-white border-white":"border-white/20 group-hover:border-white/40"),children:y&&e.jsx(De,{className:"w-3 h-3 text-brand stroke-[4px]"})}),e.jsx("span",{className:se("font-medium truncate",y?"text-white":"text-slate-200"),dir:"auto",children:u})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-400",children:l})})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl overflow-hidden pointer-events-none",children:e.jsx(A.div,{initial:{width:0},animate:{width:`${h}%`},transition:{type:"spring",stiffness:100,damping:20},className:se("h-full opacity-10 transition-colors",y?"bg-white":"bg-brand")})})]},c)})}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:[o," ",o===1?"Vote":"Votes"]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:d!==void 0?"Voted":"Not voted"})]})]})});function li({url:t,language:a}){const[s,r]=m.useState(null),[n,i]=m.useState(!0),[o,d]=m.useState(!1);return m.useEffect(()=>{let p=!0;return t&&(async()=>{i(!0),d(!1);try{const c=new URL(t).hostname;await new Promise(l=>setTimeout(l,1e3)),t.includes("google")||t.includes("youtube")?r({title:c==="www.youtube.com"?"YouTube Video":"Google Search",description:"Enjoy the videos and music you love, upload original content, and share it all with friends, family, and the world on YouTube.",siteName:c,image:c==="www.youtube.com"?"https://www.youtube.com/img/desktop/yt_1200.png":void 0}):r({title:c,siteName:c})}catch(c){console.error("Link preview failed:",c),d(!0)}finally{p&&i(!1)}})(),()=>{p=!1}},[t]),o||!s?null:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"block mt-2 mb-1 max-w-sm rounded-xl overflow-hidden bg-slate-800/50 border border-white/10 hover:bg-slate-800 transition-colors group",dir:a==="ar"?"rtl":"ltr",children:n?e.jsx("div",{className:"h-24 flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 animate-spin text-slate-500"})}):e.jsxs(e.Fragment,{children:[s.image&&e.jsx("div",{className:"w-full h-32 overflow-hidden relative bg-slate-900 border-b border-white/5",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-200 line-clamp-1 mb-1",children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-2 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:[e.jsx(Vs,{className:"w-3 h-3"}),e.jsx("span",{children:s.siteName})]})]})]})})}const ci=m.memo(({message:t,currentUserId:a,partnerName:s,isGroup:r,isSequential:n,isMenuOpen:i,onToggleMenu:o,onReact:d,onReply:p,onDelete:u,onEdit:c,onVote:l,setViewingFile:h,repliedMessage:y,language:b,t:v,formatMessageTime:C,renderFilePreview:T,onJoinGroup:P,isAnyOverlayOpen:E})=>{var _,I,x;const R=t.senderId===a,F=b==="ar",W=R&&!F||!R&&F,g=(_=t.text)==null?void 0:_.match(/(https?:\/\/[^\s]+)/),f=g?g[0]:null;return e.jsx("div",{id:`msg-${t.id}`,className:se("flex w-full mb-4",R?"justify-end":"justify-start",i&&"z-[130] relative"),children:e.jsxs("div",{className:se("relative max-w-[80%] group",R?"items-end":"items-start"),children:[r&&!R&&!n&&e.jsx("p",{className:"text-[10px] font-bold mb-1 text-brand ml-1",children:"~User"}),!E&&e.jsx("div",{className:se("absolute top-0 z-10 transition-all duration-200",W?"left-0 -translate-x-full pr-1":"right-0 translate-x-full pl-1","opacity-100"),children:e.jsx("button",{onClick:S=>{S.stopPropagation(),o(t.id)},className:se("p-1 rounded-full transition-all bg-slate-900/50 backdrop-blur-sm shadow-sm border border-white/5",i?"text-brand bg-slate-800":"text-slate-400 hover:text-white"),children:e.jsx(ls,{className:"w-3.5 h-3.5"})})}),e.jsxs("div",{className:se("rounded-2xl px-4 py-2 shadow-sm relative transition-all duration-200 select-none",R?"bg-gradient-to-br from-brand to-violet-600 text-white rounded-br-none":"bg-slate-800/80 backdrop-blur-sm text-slate-100 border border-white/5 rounded-bl-none",i&&"ring-2 ring-brand ring-offset-2 ring-offset-slate-900"),children:[t.replyToId&&y&&e.jsxs("div",{onClick:S=>{S.stopPropagation();const w=document.getElementById(`msg-${y.id}`);w&&(w.scrollIntoView({behavior:"smooth",block:"center"}),w.classList.add("ring-2","ring-yellow-400","ring-offset-2"),setTimeout(()=>{w.classList.remove("ring-2","ring-yellow-400","ring-offset-2")},2e3))},className:se("mb-2 p-2 rounded-lg border-l-4 cursor-pointer hover:bg-white/5 transition-colors",R?"bg-white/10 border-white/30":"bg-slate-700/50 border-brand"),children:[e.jsx("p",{className:"text-[10px] font-semibold mb-0.5 opacity-80",children:y.senderId===a?b==="ar"?"Ø£Ù†Øª":"You":s}),e.jsx("p",{className:"text-xs opacity-70 line-clamp-2",children:y.text||((I=y.fileType)!=null&&I.startsWith("image/")?b==="ar"?"ðŸ“· ØµÙˆØ±Ø©":"ðŸ“· Photo":b==="ar"?"ðŸ“Ž Ù…Ù„Ù":"ðŸ“Ž File")})]}),T(t,R),t.poll?e.jsx(oi,{question:t.poll.question,options:t.poll.options,votes:t.poll.votes,onVote:S=>l(t.id,S),currentUserId:a,isSent:R}):!(((x=t.fileType)!=null&&x.startsWith("audio/")||t.fileType==="audio")&&(t.text==="ðŸŽ¤"||t.text==="ðŸŽ¤ Voice Message"||t.text==="Voice Message"))&&e.jsx("p",{className:"text-[15px] leading-relaxed break-words whitespace-pre-wrap",children:t.text.split(/(\bhttps?:\/\/[^\s]+)/g).map((S,w)=>{if(S.match(/^https?:\/\//)){try{const j=new URL(S);if(j.searchParams.has("join"))return e.jsxs("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 font-bold underline decoration-brand decoration-2 text-brand/80 hover:text-white transition-colors bg-brand/10 px-1 rounded mx-0.5",onClick:U=>{if(U.preventDefault(),P){const k=j.searchParams.get("join");k&&P(k)}},children:[e.jsx(zt,{className:"w-3 h-3"}),"Join Group"]},w)}catch{}return e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-400 hover:text-blue-300 break-all",children:S},w)}return S})}),!t.poll&&!t.fileType&&f&&e.jsx(li,{url:f,language:b}),e.jsxs("div",{className:se("flex items-center gap-1.5 mt-1 opacity-60 text-[10px]",R?"justify-end":"justify-start"),children:[e.jsx("span",{children:C(t.timestamp)}),R&&(t.isRead?e.jsx(pa,{className:"w-3 h-3 text-sky-400"}):e.jsx(De,{className:"w-3 h-3"}))]}),t.reactions&&Object.keys(t.reactions).length>0&&e.jsx("div",{className:se("absolute -bottom-3 flex flex-wrap gap-1 z-10",R?"right-2":"left-2"),children:Object.entries(t.reactions).map(([S,w])=>e.jsxs(A.button,{initial:{scale:0},animate:{scale:1},onClick:j=>{j.stopPropagation(),d(t.id,S)},className:se("bg-slate-900/90 backdrop-blur-md border border-white/10 rounded-full px-1.5 py-0.5 text-[10px] flex items-center gap-1 shadow-lg",w.includes(a)&&"border-brand/50 bg-brand/10"),children:[e.jsx("span",{children:S}),w.length>1&&e.jsx("span",{className:"opacity-70 font-bold",children:w.length})]},S))})]}),e.jsx(he,{children:i&&e.jsx("div",{className:se("absolute top-8 z-30",W?"right-0":"left-0"),children:e.jsxs(A.div,{initial:{opacity:0,scale:.9,x:W?20:-20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.9,x:W?10:-10},className:"bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl py-1.5 min-w-[120px] overflow-hidden",children:[e.jsx("div",{className:"flex px-1.5 pb-1.5 mb-1.5 border-b border-white/5 overflow-x-auto scrollbar-hide gap-1",children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"].map(S=>e.jsx("button",{onClick:()=>{d(t.id,S),o()},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-lg",children:S},S))}),e.jsxs("button",{onClick:()=>{p(t),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Us,{className:"w-3.5 h-3.5"})," ",v("reply")]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{c(t.id,t.text),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Hs,{className:"w-3.5 h-3.5"})," ",v("edit")]}),e.jsxs("button",{onClick:()=>{u(t.id),o()},className:"w-full text-left px-4 py-2 text-xs text-red-400 hover:bg-red-500/10 flex items-center gap-2",children:[e.jsx(cs,{className:"w-3.5 h-3.5"})," ",v("delete")]})]})]})})})]})})}),Pt=[{id:"1",title:"Funny Cat",url:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif",preview:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"},{id:"2",title:"Excited",url:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif",preview:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif"},{id:"3",title:"Sad",url:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif",preview:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif"},{id:"4",title:"Thumbs Up",url:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif",preview:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif"},{id:"5",title:"Dancing",url:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif",preview:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif"},{id:"6",title:"Mind Blown",url:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif",preview:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif"},{id:"7",title:"Applause",url:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif",preview:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif"},{id:"8",title:"Laughing",url:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif",preview:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif"}];function di({onSelect:t,onClose:a,language:s}){const[r,n]=m.useState(""),[i,o]=m.useState(Pt),[d,p]=m.useState(!1);return m.useEffect(()=>{if(!r){o(Pt);return}const u=setTimeout(()=>{p(!0);const c=Pt.filter(h=>h.title.toLowerCase().includes(r.toLowerCase())),l=c.length>0?c:Pt.slice(0,4);o(l),p(!1)},500);return()=>clearTimeout(u)},[r]),e.jsxs("div",{className:"w-full h-full flex flex-col bg-slate-900 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",value:r,onChange:u=>n(u.target.value),placeholder:s==="ar"?"Ø¨Ø­Ø« Ø¹Ù† GIF...":"Search GIF...",className:"w-full bg-slate-800 text-white rounded-lg pl-9 pr-4 py-2 text-sm border-none focus:ring-1 focus:ring-brand placeholder:text-slate-500",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:d?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 animate-spin text-brand"})}):e.jsxs(e.Fragment,{children:[!r&&e.jsxs("div",{className:"text-xs font-bold text-slate-500 mb-2 px-1 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(nt,{className:"w-3 h-3 text-yellow-500"})," Trending"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(u=>e.jsxs("button",{onClick:()=>t(u),className:"relative aspect-video rounded-lg overflow-hidden border border-white/5 hover:border-brand/50 transition-all group",children:[e.jsx("img",{src:u.preview,alt:u.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]},u.id))})]})}),e.jsx("div",{className:"p-2 border-t border-white/5 flex justify-center",children:e.jsx("span",{className:"text-[10px] text-slate-600 font-bold tracking-widest",children:"POWERED BY GIPHY"})})]})}function ui({repliedMessage:t,onCancel:a}){const s=()=>{var r,n,i;return(r=t.fileType)!=null&&r.startsWith("audio/")?"ðŸŽ¤":(n=t.fileType)!=null&&n.startsWith("image/")?"ðŸ“· Photo":(i=t.fileType)!=null&&i.startsWith("video/")?"ðŸŽ¥ Video":t.fileType?"ðŸ“Ž File":t.text};return e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"bg-slate-800/60 backdrop-blur-md border border-white/10 border-l-4 border-l-indigo-500 px-3 py-2 mb-2 rounded-r-lg shadow-lg relative",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Us,{className:"w-3 h-3 text-indigo-400"}),e.jsx("span",{className:"text-indigo-400 text-xs font-bold",children:t.senderName})]}),e.jsx("p",{className:"text-slate-300 text-sm truncate opacity-90",children:s()})]}),e.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(Se,{className:"w-4 h-4"})})]})})}function mi({onSend:t,onCancel:a}){const[s,r]=m.useState(0),[n,i]=m.useState(new Array(25).fill(0)),o=m.useRef(null),d=m.useRef([]),p=m.useRef(0),u=m.useRef(!1),c=m.useRef(null),l=m.useRef(null),h=m.useRef(null),y=m.useCallback(async()=>{try{if(!await jt.requestMicPermission()){te.error("Microphone access is blocked! ðŸš«"),a();return}const P=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),E=new(window.AudioContext||window.webkitAudioContext);E.state==="suspended"&&await E.resume();const R=E.createMediaStreamSource(P),F=E.createGain();F.gain.value=3;const W=E.createAnalyser();W.fftSize=64;const g=E.createMediaStreamDestination();R.connect(F),F.connect(g),F.connect(W),c.current=E,l.current=W;const f=W.frequencyBinCount,_=new Uint8Array(f);p.current=Date.now(),u.current=!0,r(0);const I=()=>{if(!u.current)return;if(l.current){l.current.getByteFrequencyData(_);const U=[],k=Math.floor(f/25);for(let G=0;G<25;G++)U.push(Math.max(4,_[G*k]||0));i(U)}const j=(Date.now()-p.current)/1e3;r(j),h.current=requestAnimationFrame(I)};let x={audioBitsPerSecond:128e3};const S=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/aac"];for(const j of S)if(MediaRecorder.isTypeSupported(j)){x.mimeType=j;break}const w=new MediaRecorder(g.stream,x);o.current=w,d.current=[],w.ondataavailable=j=>{j.data.size>0&&d.current.push(j.data)},w.onstop=()=>{P.getTracks().forEach(j=>j.stop()),c.current&&c.current.close()},w.start(100),I()}catch(T){console.error("Microphone error:",T),te.error("Unable to access microphone: "+T.message),a()}},[a]),b=m.useCallback(()=>{if(o.current&&u.current){const T=(Date.now()-p.current)/1e3;o.current.onstop=()=>{const P=new Blob(d.current,{type:o.current.mimeType});t(P,T)},o.current.stop(),u.current=!1}},[t]),v=m.useCallback(()=>{o.current&&u.current&&(o.current.onstop=()=>{d.current=[]},o.current.stop(),u.current=!1),a()},[a]);m.useEffect(()=>(y(),()=>{u.current&&o.current&&o.current.stop(),h.current&&cancelAnimationFrame(h.current),c.current&&c.current.close()}),[]);const C=T=>{const P=Math.floor(T/60),E=Math.floor(T%60);return`${P}:${E.toString().padStart(2,"0")}`};return e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mx-auto w-full max-w-[220px] flex items-center justify-between gap-2 px-3 h-12 bg-slate-800/40 rounded-full border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{onClick:v,variant:"ghost",size:"icon",className:"text-slate-400 hover:text-red-400 rounded-full h-9 w-9 transition-colors flex-shrink-0",children:e.jsx(cs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A.div,{animate:{opacity:[1,.5,1]},transition:{repeat:1/0,duration:1.5},className:"w-2.5 h-2.5 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-white font-mono text-xs font-medium min-w-[35px]",children:C(s)})]})]}),e.jsx("div",{className:"flex-1 px-1",children:e.jsx("div",{className:"h-4 flex items-center gap-[1px] overflow-hidden justify-center max-w-[80px] mx-auto opacity-30",children:n.map((T,P)=>e.jsx(A.div,{animate:{height:`${Math.min(100,Math.max(20,T/255*100))}%`},transition:{type:"spring",stiffness:300,damping:20},className:"w-1 bg-red-500/80 rounded-full"},P))})}),e.jsx("div",{className:"flex items-center",children:e.jsx(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:b,className:"w-9 h-9 bg-brand rounded-full flex items-center justify-center text-white shadow-lg shadow-brand/20 hover:bg-brand/80 transition-colors flex-shrink-0",children:e.jsx(Bt,{className:"w-4 h-4 fill-current ml-0.5"})})})]})}const pi=m.memo(({onSendMessage:t,currentUserId:a,replyTo:s,setReplyTo:r,onTyping:n,t:i,language:o,onSendVoiceMessage:d,editingMessage:p,setEditingMessage:u,onEditMessage:c,scrollToBottom:l,isGroup:h,setShowPollCreator:y})=>{const[b,v]=m.useState(!1),[C,T]=m.useState(""),[P,E]=m.useState(null),[R,F]=m.useState(!1),[W,g]=m.useState(!1),[f,_]=m.useState(null),[I,x]=m.useState(!1),[S,w]=m.useState(!1),[j,U]=m.useState(null),k=m.useRef(null),G=m.useRef(null),N=m.useRef(!1),B=m.useRef(null);m.useEffect(()=>{p&&(T(p.text),k.current&&(k.current.value=p.text,k.current.focus()))},[p]);const ee=m.useCallback(M=>{const X=M.target.value,H=X.trim().length>0;v(J=>J!==H?H:J);const L=M.target;L.style.height="auto",L.style.height=`${Math.min(L.scrollHeight,120)}px`,X.length>0?(N.current||(N.current=!0,n(!0)),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{N.current=!1,n(!1)},3e3)):N.current&&(N.current=!1,n(!1),B.current&&clearTimeout(B.current))},[n]),Y=async M=>{var H;M==null||M.preventDefault();const X=((H=k.current)==null?void 0:H.value)||"";if(P){F(!0);try{const L=new FormData;L.append("file",P),L.append("userId",a);const ae=await(await fetch(`https://${ms}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${ps}`},body:L})).json();if(ae.error)throw new Error(ae.error);t(X.trim(),ae.fileUrl,ae.fileType,ae.fileName,s==null?void 0:s.id,f),k.current&&(k.current.value="",k.current.style.height="auto"),v(!1),E(null),r(null),setTimeout(()=>l(),100)}catch(L){te.error("Upload failed: "+L.message)}finally{F(!1)}}else X.trim()&&(p&&c?(c(p.id,X.trim()),u(null)):t(X.trim(),void 0,void 0,void 0,s==null?void 0:s.id,f),k.current&&(k.current.value="",k.current.style.height="auto"),v(!1),r(null),_(null),setTimeout(()=>l(),100))},K=M=>{t(M.title||"GIF",M.url,"image/gif","animation.gif",s==null?void 0:s.id,f),w(!1),r(null),setTimeout(()=>l(),100)};return m.useLayoutEffect(()=>{if(!k.current)return;const M=k.current;M.style.height="auto",M.style.height=`${Math.min(M.scrollHeight,120)}px`,p&&v(!0)},[p]),e.jsxs("div",{className:"p-4 bg-slate-900 border-t border-white/5 relative z-50",children:[e.jsxs(he,{children:[s&&e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3",children:e.jsx(ui,{repliedMessage:s,onCancel:()=>r(null)})}),p&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 p-3 bg-indigo-500/10 border-l-4 border-indigo-500 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i("editing_message")})]}),e.jsx("button",{onClick:()=>{u(null),T(""),k.current&&(k.current.value="")},className:"text-slate-400 hover:text-white",children:e.jsx(Se,{className:"w-4 h-4"})})]}),P&&e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-2 flex items-center gap-3 bg-slate-800/80 rounded-xl p-3 border border-brand/30",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-lg",children:e.jsx(Ft,{className:"w-5 h-5 text-brand"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:P.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(P.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>E(null),className:"p-1 hover:bg-white/10 rounded-full",children:e.jsx(Se,{className:"w-4 h-4 text-slate-400"})})]})]}),e.jsx(he,{children:S&&e.jsxs(A.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:320},exit:{opacity:0,height:0},className:"absolute bottom-full left-0 right-0 z-50 bg-slate-900 border-t border-white/10 shadow-2xl overflow-hidden rounded-t-2xl mx-2 mb-2",children:[e.jsx("div",{className:"flex justify-end p-2 absolute top-0 right-0 z-10",children:e.jsx("button",{onClick:()=>w(!1),className:"bg-black/50 hover:bg-black/70 rounded-full p-1 text-white transition-colors",children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsx(di,{onSelect:K,onClose:()=>w(!1),language:o})]})}),e.jsxs("div",{className:"flex items-end gap-3 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex-1 bg-slate-800 rounded-2xl flex items-end p-1 border border-white/10 shadow-lg focus-within:border-brand/50 focus-within:ring-1 focus-within:ring-brand/20 transition-all",children:W?e.jsx(mi,{onSend:(M,X)=>{d(M,X),g(!1)},onCancel:()=>g(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center self-center px-1",children:[e.jsx("input",{type:"file",ref:G,onChange:M=>{var X;return E(((X=M.target.files)==null?void 0:X[0])||null)},className:"hidden"}),e.jsx("button",{onClick:()=>{var M;return(M=G.current)==null?void 0:M.click()},className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(fa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>w(!S),className:se("p-2.5 rounded-xl transition-all",S?"text-brand bg-brand/10":"text-slate-400 hover:text-brand hover:bg-brand/10"),children:e.jsx(nt,{className:"w-5 h-5"})}),h&&e.jsx("button",{onClick:()=>y(!0),className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(Ws,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>x(!I),className:se("p-2.5 rounded-xl transition-all flex items-center justify-center relative",f?"text-orange-400 bg-orange-500/20":"text-slate-400 hover:text-white"),children:[e.jsx(ha,{className:se("w-5 h-5",f&&"animate-pulse")}),f&&e.jsxs("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:[f,"s"]})]}),e.jsx(he,{children:I&&e.jsx(A.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-0 mb-4 bg-slate-900 border border-white/20 rounded-2xl p-2 shadow-2xl z-[200] min-w-[160px] backdrop-blur-2xl",children:e.jsx("div",{className:"flex flex-col gap-1",children:[{label:o==="ar"?"Ø¥ÙŠÙ‚Ø§Ù":"Off",value:null},{label:o==="ar"?"5 Ø«ÙˆØ§Ù†Ù":"5 Seconds",value:5},{label:o==="ar"?"10 Ø«ÙˆØ§Ù†Ù":"10 Seconds",value:10},{label:o==="ar"?"30 Ø«Ø§Ù†ÙŠØ©":"30 Seconds",value:30},{label:o==="ar"?"Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Minute",value:60},{label:o==="ar"?"Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Hour",value:3600}].map(M=>e.jsxs("button",{onClick:()=>{_(M.value),x(!1)},className:se("w-full text-left px-4 py-2.5 rounded-xl text-sm transition-all flex items-center justify-between",f===M.value?"bg-brand/20 text-brand font-bold":"text-slate-300 hover:bg-white/5"),children:[M.label,f===M.value&&e.jsx(De,{className:"w-4 h-4"})]},M.label))})})})]})]}),e.jsx("textarea",{ref:k,rows:1,placeholder:i("type_message"),defaultValue:C,onChange:ee,inputMode:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"sentences",onKeyDown:M=>{if(M.key==="Enter"&&!M.shiftKey){if(M.preventDefault(),R)return;Y(M)}},className:"flex-1 bg-transparent border-none text-white placeholder:text-slate-500 px-4 py-3 resize-none focus:outline-none max-h-[120px] scrollbar-hide text-[15px] leading-relaxed"})]})}),b||P?e.jsx(A.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:Y,className:"h-[50px] w-[50px] bg-gradient-to-tr from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/25",children:R?e.jsx(ye,{className:"w-5 h-5 animate-spin"}):e.jsx(Bt,{className:"w-5 h-5 fill-current"})}):e.jsx(A.button,{onClick:()=>g(!0),whileHover:{scale:1.1},whileTap:{scale:.9},className:"h-[50px] w-[50px] bg-slate-800 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-slate-700 transition-colors",children:e.jsx(ds,{className:"w-5 h-5"})})]})]})});function fi({url:t,type:a,name:s,onClose:r}){const n=a.startsWith("image/"),i=a.startsWith("video/"),o=a.includes("pdf");return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-200",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-[200px] sm:max-w-md",children:s}),e.jsx("p",{className:"text-gray-400 text-xs",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:t,download:s,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ys,{className:"w-6 h-6"})}),e.jsx("button",{onClick:r,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Se,{className:"w-7 h-7"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 sm:p-10",children:n?e.jsx("img",{src:t,alt:s,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl animate-in zoom-in-95 duration-300"}):i?e.jsx("video",{src:t,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg shadow-2xl"}):o?e.jsx("iframe",{src:t,className:"w-full h-full max-w-5xl bg-white rounded-lg shadow-2xl",title:s}):e.jsxs("div",{className:"bg-[#202c33] p-8 rounded-2xl flex flex-col items-center gap-6 max-w-sm text-center shadow-2xl border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-brand/20 rounded-full flex items-center justify-center",children:e.jsx(Vs,{className:"w-10 h-10 text-brand"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"No Preview Available"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["This file type (",a,") cannot be previewed directly. You can download it to view."]})]}),e.jsx("a",{href:t,download:s,className:"w-full",children:e.jsx(me,{className:"w-full bg-brand hover:bg-brand/80 text-white py-6 text-lg",children:"Download File"})})]})})]})}function hi({partnerId:t,partnerName:a,partnerAvatar:s,isGroup:r,onClose:n,messages:i,onOpenGallery:o,onAudioCall:d,onVideoCall:p,onShowProfile:u,language:c,t:l}){const[h,y]=m.useState(null),[b,v]=m.useState(!0),C=i.filter(T=>{var P,E;return T.fileUrl&&(((P=T.fileType)==null?void 0:P.startsWith("image/"))||((E=T.fileType)==null?void 0:E.startsWith("video/")))});return m.useEffect(()=>{async function T(){if(r){const{data:P,error:E}=await Q.from("groups").select("*").eq("id",t).single();P&&y(P),v(!1)}else{const{data:P,error:E}=await Q.from("profiles").select("*").eq("id",t).single();P&&y(P),v(!1)}}T()},[t,r]),e.jsxs(A.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"absolute top-0 right-0 h-full w-full md:w-[380px] bg-slate-950 border-l border-white/10 z-[1001] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/5 bg-slate-950",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Se,{className:"w-5 h-5"})}),e.jsx("h2",{className:`text-lg font-semibold text-white ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Contact Info"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs(A.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative mb-4 group cursor-pointer",children:[e.jsxs(Le,{className:"w-32 h-32 border-4 border-slate-800 shadow-2xl group-hover:border-indigo-500/50 transition-colors duration-300",children:[e.jsx(He,{src:s||(h==null?void 0:h.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&color=fff`}),e.jsx(Oe,{className:"bg-slate-800 text-3xl font-bold text-indigo-400",children:a.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Js,{className:"w-8 h-8 text-white/80"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-white text-center mb-1",children:a}),e.jsx("p",{className:"text-indigo-400 text-sm font-medium",children:h!=null&&h.username?`@${h.username}`:r?c==="ar"?"Ø¯Ø±Ø¯Ø´Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Chat":c==="ar"?"~Ù…Ø³ØªØ®Ø¯Ù…":"~User"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-8",children:[e.jsxs("button",{onClick:d,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(us,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ØµÙˆØª":"Audio"})]}),e.jsxs("button",{onClick:p,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/10 flex items-center justify-center group-hover:bg-violet-500/20 text-violet-400 transition-colors",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ÙÙŠØ¯ÙŠÙˆ":"Video"})]}),e.jsxs("button",{onClick:u,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center group-hover:bg-emerald-500/20 text-emerald-400 transition-colors",children:e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"Ø§Ù„Ù…Ù„Ù":"Profile"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5",children:[e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-widest font-black mb-4 ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©":"Personal Info"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400 shrink-0",children:e.jsx(Ve,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-100 text-[15px] leading-relaxed break-words",children:(h==null?void 0:h.about)||(c==="ar"?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©":"No bio provided")}),e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-wider mt-1 font-bold ${c==="ar"?"font-arabic":""}`,children:l("about")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-400",children:e.jsx(Ve,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.gender)==="male"?l("male"):(h==null?void 0:h.gender)==="female"?l("female"):c==="ar"?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":"Not specified"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("gender")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400",children:e.jsx($t,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.birth_year)||"----"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("birth_year")})]})]})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(Xs,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm truncate",children:(h==null?void 0:h.email)||(r?c==="ar"?"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Conversation":c==="ar"?"Ù…Ø®ÙÙŠ":"Hidden")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]})]}),(h==null?void 0:h.created_at)&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx($t,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(h.created_at).toLocaleDateString(c==="ar"?"ar-EG":"en-US")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:o,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest font-bold",children:c==="ar"?"Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª":"Media, Links & Docs"}),e.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1 group-hover:text-indigo-400 transition-colors",children:[C.length," ",e.jsx("span",{className:"opacity-50",children:"â€º"})]})]}),C.length>0?e.jsx("div",{className:"grid grid-cols-4 gap-2",children:C.slice(0,4).map((T,P)=>{var E;return e.jsxs("div",{className:"aspect-square rounded-lg bg-slate-800 border border-white/5 overflow-hidden relative group/img",children:[(E=T.fileType)!=null&&E.startsWith("image")?e.jsx("img",{src:T.fileUrl,alt:"Media",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-800",children:e.jsx(yt,{className:"w-5 h-5 text-slate-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover/img:bg-transparent transition-colors"})]},T.id||P)})}):e.jsx("p",{className:"text-slate-600 text-xs italic py-2",children:c==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ³Ø§Ø¦Ø· Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¹Ø¯.":"No shared media yet."})]}),r&&(h==null?void 0:h.group_id)&&e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:()=>{const T=`${window.location.origin}?join=${h.group_id}`;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(T).then(()=>te.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})).catch(()=>te.error(c==="ar"?"ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·":"Failed to copy link"));else try{const P=document.createElement("textarea");P.value=T,document.body.appendChild(P),P.select(),document.execCommand("copy"),document.body.removeChild(P),te.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})}catch{te.error(c==="ar"?"ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ¸Ø©":"Clipboard access denied",{description:c==="ar"?"ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹.":"Please manually copy the link."})}},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white transition-colors",children:c==="ar"?"Ø¯Ø¹ÙˆØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·":"Invite to Group via Link"}),e.jsx("p",{className:"text-slate-500 text-xs",children:c==="ar"?"Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©":"Tap to copy invite link"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(Ot,{className:"w-5 h-5 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"ÙƒØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª":"Mute Notifications"})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(xa,{className:"w-5 h-5 text-slate-400 group-hover:text-yellow-400 transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ù†Ø¬Ù…Ø©":"Starred Messages"})})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(ga,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?`Ø­Ø¸Ø± ${a}`:`Block ${a}`})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(ba,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?"Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Report Contact"})})]})]})]})]})]})}function xi({messages:t,onClose:a}){const[s,r]=m.useState("media"),[n,i]=m.useState(null),{media:o,docs:d,links:p}=m.useMemo(()=>{const c=[],l=[],h=[];return t.forEach(y=>{var C,T,P;y.fileUrl&&((C=y.fileType)!=null&&C.startsWith("image/")||(T=y.fileType)!=null&&T.startsWith("video/"))?c.push(y):y.fileUrl&&l.push(y);const b=/(https?:\/\/[^\s]+)/g,v=(P=y.text)==null?void 0:P.match(b);v&&v.forEach(E=>{h.push({...y,linkUrl:E})})}),{media:c.reverse(),docs:l.reverse(),links:h.reverse()}},[t]),u=[{id:"media",label:"Media"},{id:"docs",label:"Docs"},{id:"links",label:"Links"}];return e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute inset-0 z-[150] bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-900 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Media, Links & Docs"})]}),e.jsx("div",{className:"flex border-b border-white/5 bg-slate-900/50",children:u.map(c=>e.jsxs("button",{onClick:()=>r(c.id),className:se("flex-1 py-3 text-sm font-medium relative transition-colors",s===c.id?"text-indigo-400":"text-slate-400 hover:text-slate-300"),children:[c.label,s===c.id&&e.jsx(A.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500"})]},c.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-950 p-4 custom-scrollbar",children:[s==="media"&&e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-2",children:o.length>0?o.map(c=>{var l;return e.jsx("div",{className:"aspect-square relative group overflow-hidden rounded-lg bg-slate-900 border border-white/5",children:(l=c.fileType)!=null&&l.startsWith("image/")?e.jsx("img",{src:c.fileUrl,alt:c.fileName,className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform duration-300",onClick:()=>i(c.fileUrl)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-slate-800",children:e.jsx(yt,{className:"w-8 h-8 text-slate-400"})})},c.id)}):e.jsxs("div",{className:"col-span-full py-20 text-center text-slate-500",children:[e.jsx(Js,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No media shared"})]})}),s==="docs"&&e.jsx("div",{className:"space-y-2",children:d.length>0?d.map(c=>{var l;return e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400",children:e.jsx(Ft,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:c.fileName}),e.jsxs("p",{className:"text-xs text-slate-500 uppercase",children:[((l=c.fileType)==null?void 0:l.split("/")[1])||"FILE"," â€¢ ",new Date(c.timestamp).toLocaleDateString()]})]}),e.jsx("a",{href:c.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-500 hover:text-white rounded-full hover:bg-white/10 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Ys,{className:"w-4 h-4"})})]},c.id)}):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(Ft,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No documents found"})]})}),s==="links"&&e.jsx("div",{className:"space-y-2",children:p.length>0?p.map((c,l)=>e.jsxs("div",{className:"flex gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400 flex-shrink-0",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("a",{href:c.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:underline text-sm font-medium truncate block",children:c.linkUrl}),c.text!==c.linkUrl&&e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5",children:c.text}),e.jsx("p",{className:"text-[10px] text-slate-600 mt-1",children:new Date(c.timestamp).toLocaleDateString()})]})]},l)):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No links shared"})]})})]}),e.jsx(he,{children:n&&e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200] bg-black/95 backdrop-blur-md flex items-center justify-center p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition-colors",onClick:()=>i(null),children:e.jsx(Se,{className:"w-6 h-6"})}),e.jsx(A.img,{initial:{scale:.9},animate:{scale:1},src:n||"",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:c=>c.stopPropagation()})]})})]})}function gi({onClose:t,onSend:a}){const[s,r]=m.useState(""),[n,i]=m.useState(["",""]),o=()=>{n.length<10&&i([...n,""])},d=(c,l)=>{const h=[...n];h[c]=l,i(h)},p=c=>{n.length>2&&i(n.filter((l,h)=>h!==c))},u=()=>{const c=n.filter(l=>l.trim()!=="");s.trim()&&c.length>=2&&(a(s,c),t())};return e.jsx(A.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-3xl w-full max-w-md shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-gradient-to-r from-brand/10 to-violet-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl text-brand",children:e.jsx(Ws,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white leading-none",children:"Create Poll"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ask your friends anything"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full transition-all",children:e.jsx(Se,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(va,{className:"w-4 h-4 text-brand"}),"Question"]}),e.jsx(je,{value:s,onChange:c=>r(c.target.value),placeholder:"What's on your mind?",dir:"auto",className:"bg-slate-950 border-white/5 focus:border-brand/50 h-12 text-white placeholder:text-slate-600 rounded-xl px-4"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Options"}),n.map((c,l)=>e.jsx(A.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-2 group",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(je,{value:c,onChange:h=>d(l,h.target.value),placeholder:`Option ${l+1}`,dir:"auto",className:"bg-slate-950/50 border-white/5 focus:border-brand/50 h-11 text-white placeholder:text-slate-700 rounded-xl px-4"}),l>=2&&e.jsx("button",{onClick:()=>p(l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Se,{className:"w-4 h-4"})})]})},l)),n.length<10&&e.jsxs("button",{onClick:o,className:"w-full py-3 border-2 border-dashed border-slate-800 rounded-xl text-slate-500 hover:text-brand hover:border-brand/30 transition-all flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(ya,{className:"w-4 h-4"}),"Add Option"]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-950/50 flex gap-3",children:[e.jsx(me,{variant:"ghost",onClick:t,className:"flex-1 text-slate-400 hover:text-white hover:bg-white/5 h-12 rounded-xl font-bold",children:"Cancel"}),e.jsxs(me,{onClick:u,disabled:!s.trim()||n.filter(c=>c.trim()).length<2,className:"flex-1 bg-gradient-to-r from-brand to-violet-600 hover:from-brand/80 hover:to-violet-500 text-white shadow-lg shadow-brand/20 h-12 rounded-xl font-bold gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),"Create Poll"]})]})]})})}function bi({audioUrl:t,duration:a,messageId:s,onPlayNext:r}){const{activeMessageId:n,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:u}=wr(),[c,l]=m.useState(!1),[h,y]=m.useState(()=>s?localStorage.getItem(`vp_played_${s}`)==="true":!0),[b,v]=m.useState(a||0),[C,T]=m.useState(0),[P,E]=m.useState(1),[R,F]=m.useState(!1),[W,g]=m.useState(!1),f=m.useRef(null);m.useRef(null);const _=m.useRef(a||0),I=35,x=m.useMemo(()=>Array.from({length:I},()=>Math.floor(Math.random()*60)+20),[]);m.useEffect(()=>{a&&a>0&&(v(a),_.current=a)},[a]),m.useEffect(()=>{const N=f.current;if(!N)return;const B=()=>T(N.currentTime),ee=()=>{N.duration&&!isNaN(N.duration)&&N.duration!==1/0&&(v(N.duration),_.current=N.duration)};return N.addEventListener("timeupdate",B),N.addEventListener("loadedmetadata",ee),N.addEventListener("durationchange",ee),N.addEventListener("play",()=>l(!0)),N.addEventListener("pause",()=>l(!1)),N.muted=W,()=>{N.removeEventListener("timeupdate",B),N.removeEventListener("loadedmetadata",ee),N.removeEventListener("durationchange",ee)}},[t,W]),m.useEffect(()=>{s&&(n===s?f.current&&f.current.paused&&(f.current.play().catch(()=>{}),h||(y(!0),localStorage.setItem(`vp_played_${s}`,"true"))):f.current&&!f.current.paused&&f.current.pause())},[n,s,h]),m.useEffect(()=>{if(s&&r)return d(s,r),()=>p(s)},[s,r,d,p]);const S=m.useCallback(()=>{l(!1),T(0),f.current&&(f.current.currentTime=0),s&&u(s)},[s,u]);m.useEffect(()=>{const N=f.current;if(N)return N.addEventListener("ended",S),()=>N.removeEventListener("ended",S)},[S]);const w=async N=>{N==null||N.stopPropagation(),!(!f.current||!s)&&(h||(y(!0),localStorage.setItem(`vp_played_${s}`,"true")),c?o(s):i(s))},j=N=>{if(N.stopPropagation(),!f.current||!_.current)return;const B=N.currentTarget.getBoundingClientRect(),ee=N.clientX-B.left,K=Math.min(Math.max(0,ee/B.width),1)*_.current;f.current.currentTime=K,T(K)},U=N=>{if(N.stopPropagation(),!f.current)return;const B=[1,1.5,2],ee=B[(B.indexOf(P)+1)%B.length];E(ee),f.current.playbackRate=ee},k=N=>{const B=Math.floor(N/60),ee=Math.floor(N%60);return`${B}:${ee.toString().padStart(2,"0")}`},G=_.current>0?C/_.current*100:0;return e.jsxs("div",{className:"flex items-center gap-3 w-full py-1 group/player select-none",onMouseEnter:()=>F(!0),onMouseLeave:()=>F(!1),children:[e.jsxs(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:w,className:se("w-10 h-10 rounded-full flex items-center justify-center transition-all bg-white/10 hover:bg-white/20 text-white border border-white/10 shadow-lg relative",c&&"bg-brand hover:bg-brand/80 border-brand",!h&&"ring-2 ring-sky-400 ring-offset-2 ring-offset-slate-900"),children:[c?e.jsx(ja,{className:"w-5 h-5 fill-current"}):e.jsx(wa,{className:"w-5 h-5 fill-current ml-0.5"}),!h&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-sky-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsxs("div",{className:"h-10 flex items-center gap-[3px] cursor-pointer group/wave relative",onClick:j,children:[x.map((N,B)=>{const ee=B/I*100,Y=G>ee;return e.jsx(A.div,{initial:!1,animate:{height:`${N}%`,backgroundColor:Y?h?"#818cf8":"#38bdf8":h?"rgba(255,255,255,0.15)":"rgba(56,189,248,0.2)"},transition:{type:"spring",stiffness:300,damping:20},className:se("flex-1 rounded-full min-h-[4px] transition-shadow duration-300",Y&&(h?"shadow-[0_0_8px_rgba(129,140,248,0.5)]":"shadow-[0_0_10px_rgba(56,189,248,0.6)]"))},B)}),e.jsx("div",{className:"absolute inset-0 z-10 opacity-0 group-hover/wave:opacity-100 bg-gradient-to-r from-transparent via-white/5 to-transparent pointer-events-none transition-opacity duration-300"})]}),e.jsxs("div",{className:"flex justify-between items-center px-0.5 opacity-60 group-hover/player:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"text-[10px] font-mono font-medium text-white/70 flex gap-1",children:[e.jsx("span",{className:"text-white font-bold",children:k(C)}),e.jsxs("span",{children:["/ ",k(b)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>{const N=!W;g(N),f.current&&(f.current.muted=N)},className:"p-1 rounded-md bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/5 transition-all",title:W?"ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª":"ÙƒØªÙ… Ø§Ù„ØµÙˆØª",children:W?e.jsx(Ks,{className:"w-3 h-3"}):e.jsx(Gt,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:U,className:se("text-[10px] font-bold px-1.5 py-0.5 rounded-md transition-all border",P===1?"bg-white/5 text-white/40 border-white/5":"bg-brand text-white border-brand"),children:[P,"x"]})]})]})]}),e.jsx("audio",{ref:f,src:t,hidden:!0})]})}function vi({currentUserId:t,partnerId:a,partnerName:s,partnerAvatar:r,messages:n,isPartnerOnline:i,isPartnerTyping:o,onBack:d,onSendMessage:p,onSendVoiceMessage:u,onDeleteMessage:c,onTyping:l,onRefresh:h,onReact:y,onSendPoll:b,onVote:v,onStartCall:C,onEditMessage:T,smartReplies:P=[],isGroup:E,onJoinGroup:R,onShowProfile:F,onClearChat:W,language:g,t:f}){const{playMessage:_}=wr(),[I,x]=m.useState(null),[S,w]=m.useState(null),[j,U]=m.useState(!1),k=m.useRef(null),[G,N]=m.useState(null),[B,ee]=m.useState(null),[Y,K]=m.useState(!1),[M,X]=m.useState(!1),[H,L]=m.useState(""),[J,ae]=m.useState(!1),[Z,de]=m.useState(!1),[Re,we]=m.useState(!1),lt=J||Z||Re||!!S,Ee=m.useRef(null);m.useRef(!1);const ct=m.useRef(null),Qe=m.useRef(n.length),{wallpaper:Ne,bgOpacity:We}=Cr();m.useEffect(()=>{N(null),ee(null),x(null),L("")},[a]);const xe=(z="auto")=>{k.current&&k.current.scrollIntoView({behavior:z})};m.useLayoutEffect(()=>{n.length>0&&(n[n.length-1].senderId===t||!j)&&xe("smooth"),Qe.current=n.length},[n,t,j,a]),m.useLayoutEffect(()=>{xe("auto"),ct.current=a},[a]);const Ze=()=>{if(!Ee.current)return;const{scrollTop:z,scrollHeight:le,clientHeight:Me}=Ee.current,$e=le-z-Me<200;U(!$e)},dt=m.useCallback(z=>new Date(z).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),[]),oe=m.useCallback(z=>{if(!z){N(null);return}N(le=>le===z?null:z)},[]),ge=m.useCallback(z=>{x({id:z.id,senderName:z.senderId===t?g==="ar"?"Ø£Ù†Øª":"You":s,text:z.text,fileType:z.fileType}),N(null)},[t,g,s]),Ie=m.useCallback((z,le)=>{ee({id:z,text:le}),N(null)},[]),et=m.useCallback(()=>{xe("smooth")},[]),ze=m.useCallback((z,le)=>{var Me,ke,$e;if(!z.fileUrl||!z.fileType)return null;if(z.fileType.startsWith("image/"))return e.jsx(A.div,{whileHover:{scale:1.02},className:"mb-2 overflow-hidden rounded-lg",children:e.jsx("img",{src:z.fileUrl,alt:z.fileName||"Image",className:"max-w-full max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>w({url:z.fileUrl,type:z.fileType,name:z.fileName||"Image"})})});if(z.fileType.startsWith("video/"))return e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-black/20",children:e.jsx("video",{src:z.fileUrl,controls:!0,className:"max-w-full max-h-64"})});if((Me=z.fileType)!=null&&Me.startsWith("audio/")||z.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(z.fileName||"")){const mt=n.findIndex(_e=>_e.id===z.id),Ge=n[mt+1],ft=Ge&&(_e=>{var Ce;return((Ce=_e.fileType)==null?void 0:Ce.startsWith("audio/"))||_e.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(_e.fileName||"")})(Ge);return e.jsx(bi,{audioUrl:z.fileUrl||"",messageId:z.id,onPlayNext:ft?()=>_(Ge.id):void 0,duration:((ke=z.fileName)!=null&&ke.includes("duration=")?parseFloat(z.fileName.split("duration=")[1]):void 0)||(($e=z.fileUrl)!=null&&$e.includes("duration=")?parseFloat(z.fileUrl.split("duration=")[1]):void 0)})}return e.jsxs("div",{className:se("flex items-center gap-3 mb-2 p-3 rounded-xl cursor-pointer hover:opacity-80 transition-all border",le?"bg-brand/20 border-brand/30":"bg-slate-800/60 border-white/10"),onClick:()=>w({url:z.fileUrl,type:z.fileType,name:z.fileName||"File"}),children:[e.jsx("div",{className:se("p-2 rounded-lg",le?"bg-brand/20":"bg-slate-700/50"),children:e.jsx(Ft,{className:se("w-5 h-5",le?"text-brand":"text-slate-400")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:z.fileName}),e.jsx("p",{className:"text-xs opacity-70 uppercase",children:z.fileType.split("/")[1]||"FILE"})]})]})},[n,_]),ut=m.useMemo(()=>{const z=new Map;return n.forEach(le=>z.set(le.id,le)),z},[n]),Fe=m.useMemo(()=>H.trim()?n.filter(z=>z.text.toLowerCase().includes(H.toLowerCase())):n,[n,H]);return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 overflow-hidden relative",children:[e.jsx(he,{children:G&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-20 bg-black/5",onClick:()=>N(null)})}),e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden",children:[e.jsx(A.div,{animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-brand/10 rounded-full blur-[120px]"}),e.jsx(A.div,{animate:{scale:[1,1.3,1],x:[0,-40,0],y:[0,-20,0]},transition:{duration:25,repeat:1/0,ease:"linear",delay:2},className:"absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-violet-600/10 rounded-full blur-[100px]"}),e.jsx("div",{className:se("absolute inset-0 transition-opacity duration-700",Ne==="doodles"&&"premium-doodle opacity-30 mix-blend-overlay",Ne==="stars"&&"wallpaper-stars opacity-40 mix-blend-screen",Ne==="geometric"&&"wallpaper-geometric opacity-20 mix-blend-overlay",Ne==="solid"&&"wallpaper-solid"),style:{opacity:Ne==="solid"?1:We}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-slate-950/50"})]}),e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md px-4 py-3 flex items-center gap-3 sticky top-0 z-50 border-b border-white/5",children:[e.jsx("button",{onClick:d,className:"text-slate-400 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full",children:e.jsx(Ue,{className:"w-6 h-6"})}),e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ae(!0),children:[e.jsxs(Le,{className:"w-10 h-10 border-2 border-slate-800 group-hover:border-brand transition-colors",children:[e.jsx(He,{src:r||`https://ui-avatars.com/api/?name=${encodeURIComponent(s)}&background=random&color=fff`}),e.jsx(Oe,{className:"bg-slate-800 text-brand font-bold",children:(s||"?").charAt(0).toUpperCase()})]}),i&&!E&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-emerald-500 border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>ae(!0),children:[e.jsxs("h2",{className:"text-white font-bold truncate text-lg flex items-center gap-2",children:[s," ",E&&e.jsx("span",{className:"bg-slate-800 text-slate-400 text-[10px] px-1.5 py-0.5 rounded border border-white/5",children:"GROUP"})]}),!E&&e.jsx("div",{className:"text-xs flex items-center gap-1 h-4",children:e.jsx(he,{mode:"wait",children:o?e.jsxs(A.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"flex items-center gap-1.5 text-indigo-400 font-medium",children:[e.jsx("span",{className:"text-[10px]",children:"typing"}),e.jsx("span",{className:"flex gap-0.5",children:[0,1,2].map(z=>e.jsx(A.span,{animate:{y:[0,-2,0]},transition:{repeat:1/0,duration:.5,delay:z*.1},className:"w-1 h-1 bg-indigo-400 rounded-full"},z))})]}):i?e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},className:"text-emerald-500 font-medium",children:"Online"}):e.jsx(A.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-500",children:"Offline"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>X(!M),className:se("p-2 rounded-full transition-colors",M?"text-indigo-400 bg-indigo-500/10":"text-slate-400 hover:text-white hover:bg-white/5"),children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:h,className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Qs,{className:"w-5 h-5"})}),!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>C("audio"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(us,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C("video"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(yt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>K(!Y),className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(ls,{className:"w-5 h-5"})}),e.jsx(he,{children:Y&&e.jsxs(A.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute top-full right-0 mt-2 w-48 bg-slate-900 border border-white/10 rounded-xl shadow-2xl py-1 z-[100] overflow-hidden",children:[e.jsx("button",{onClick:()=>{ae(!0),K(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Contact Info"}),e.jsx("button",{onClick:()=>{W&&W(),K(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Clear Chat"}),e.jsx("div",{className:"h-px bg-white/5 my-1"}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:"Close Chat"})]})})]})]})]}),e.jsx(he,{children:M&&e.jsx(A.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-slate-900/50 backdrop-blur-md border-b border-white/5 px-4 py-2 relative z-40 overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search in conversation...",value:H,onChange:z=>L(z.target.value),className:"w-full bg-slate-950/50 border border-white/5 rounded-xl pl-10 pr-10 py-2 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all font-light"}),H&&e.jsx("button",{onClick:()=>L(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white",children:e.jsx(Se,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{ref:Ee,onScroll:Ze,className:"flex-1 overflow-y-auto overflow-x-hidden p-4 px-6 space-y-4 custom-scrollbar relative message-container-glass",children:[Fe.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-indigo-500/20 to-violet-500/20 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(nt,{className:"w-10 h-10 text-indigo-400"})}),e.jsxs("p",{className:"text-center font-medium",children:[H?"No matches found":"No messages yet.",e.jsx("br",{}),e.jsx("span",{className:"text-sm opacity-60",children:H?"Try searching for something else":"Start the conversation!"})]})]}):Fe.map((z,le)=>e.jsx(ci,{message:z,currentUserId:t,partnerName:s,isGroup:E,isSequential:le>0&&Fe[le-1].senderId===z.senderId,isMenuOpen:G===z.id,onToggleMenu:oe,onReact:y,onReply:ge,onDelete:c,onEdit:Ie,onVote:v,setViewingFile:w,repliedMessage:z.replyToId&&ut.get(z.replyToId)||null,language:g,t:f,formatMessageTime:dt,renderFilePreview:ze,onJoinGroup:R,isAnyOverlayOpen:lt},z.id)),e.jsx("div",{ref:k})]}),j&&e.jsx(A.button,{initial:{scale:0},animate:{scale:1},onClick:()=>xe("smooth"),className:"absolute bottom-24 right-6 bg-indigo-600 text-white p-3 rounded-full shadow-lg z-40 hover:bg-indigo-500 transition-colors",children:e.jsx(Ue,{className:"w-6 h-6 rotate-[-90deg]"})}),e.jsx(he,{children:P.length>0&&!H&&e.jsx(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar relative z-30",children:P.map((z,le)=>e.jsx("button",{onClick:()=>p(z),dir:/[\u0600-\u06FF]/.test(z)?"rtl":"ltr",className:se("whitespace-nowrap bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-300 border border-indigo-500/20 px-4 py-1.5 rounded-full text-xs font-medium transition-all backdrop-blur-md",/[\u0600-\u06FF]/.test(z)?"font-arabic":""),children:z},le))})}),e.jsx(pi,{onSendMessage:p,currentUserId:t,replyTo:I,setReplyTo:x,onTyping:l,t:f,language:g,onSendVoiceMessage:u,editingMessage:B,setEditingMessage:ee,onEditMessage:T,scrollToBottom:et,isGroup:E,setShowPollCreator:we}),S&&e.jsx(fi,{url:S.url,type:S.type,name:S.name,onClose:()=>w(null)}),e.jsx(he,{children:J&&e.jsxs(e.Fragment,{children:[e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#020617] backdrop-blur-md z-[1000]",onClick:()=>ae(!1)}),e.jsx(hi,{partnerId:a,partnerName:s,partnerAvatar:r,isGroup:E,onClose:()=>ae(!1),messages:n,onOpenGallery:()=>{de(!0),ae(!1)},onAudioCall:()=>C("audio"),onVideoCall:()=>C("video"),onShowProfile:()=>{F(a),ae(!1)},language:g,t:f})]})}),e.jsx(he,{children:Z&&e.jsx(xi,{messages:n,onClose:()=>de(!1)})}),e.jsx(he,{children:Re&&e.jsx(gi,{onClose:()=>we(!1),onSend:b})})]})}const yi=m.memo(vi);function ji({callerName:t,type:a,onAccept:s,onReject:r,language:n}){return e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:e.jsxs(A.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-8 shadow-2xl border border-white/10 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full flex items-center justify-center text-4xl text-white font-bold shadow-xl",children:t.charAt(0).toUpperCase()}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-indigo-400 text-sm",children:n==="ar"?a==="video"?"Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø±Ø¯Ø©...":"Ù…ÙƒØ§Ù„Ù…Ø© ØµÙˆØªÙŠØ© ÙˆØ§Ø±Ø¯Ø©...":`Incoming ${a} call...`})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:r,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 active:scale-95 transition-all flex items-center justify-center shadow-lg",children:e.jsx(Zs,{className:"w-7 h-7 text-white"})}),e.jsx("button",{onClick:s,className:"w-16 h-16 rounded-full bg-green-600 hover:bg-green-700 active:scale-95 transition-all flex items-center justify-center shadow-lg animate-pulse",children:e.jsx(us,{className:"w-7 h-7 text-white"})})]})]})})}function wi({onFinish:t,language:a}){return m.useEffect(()=>{const s=setTimeout(()=>{t()},3e3);return()=>clearTimeout(s)},[t]),e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen w-full bg-slate-950 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[20%] left-[10%] w-[60vw] h-[60vw] bg-indigo-600/10 rounded-full blur-[120px] animate-blob"}),e.jsx("div",{className:"absolute bottom-[20%] right-[10%] w-[50vw] h-[50vw] bg-violet-600/10 rounded-full blur-[100px] animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-20"})]}),e.jsxs(A.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"relative z-10 flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx(A.div,{animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 bg-indigo-500 rounded-full blur-2xl"}),e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-[2.5rem] flex items-center justify-center shadow-2xl relative z-10 border border-white/20 transform rotate-3",children:e.jsx(is,{className:"w-16 h-16 text-white fill-white/10",strokeWidth:1.5})}),e.jsx(A.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"absolute -bottom-2 -right-2 w-12 h-12 bg-slate-900 border border-emerald-500/50 rounded-2xl flex items-center justify-center shadow-xl z-20",children:e.jsx(er,{className:"w-6 h-6 text-emerald-400"})})]}),e.jsxs(A.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex flex-col items-center justify-center w-full max-w-md px-4",children:[e.jsx("h1",{className:"text-white text-4xl sm:text-5xl md:text-6xl font-black mb-4 tracking-tighter text-center w-full leading-tight",children:"Chat App"}),e.jsx("p",{className:"text-indigo-400 font-medium text-sm md:text-base mb-10 text-center w-full",children:a==="ar"?"Ø§Ø®ØªØ¨Ø± Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª":"Experience the Future"})]}),e.jsx("div",{className:"w-48 h-1 overflow-hidden bg-slate-900 border border-white/5 rounded-full relative",children:e.jsx(A.div,{initial:{left:"-100%"},animate:{left:"100%"},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 bottom-0 w-1/2 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"})})]}),e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"absolute bottom-10 text-slate-600 text-[10px] uppercase font-bold tracking-[0.4em]",children:"Secure Quantum Encryption v2.4"})]})}function Ni({items:t,initialIndex:a=0,onClose:s,onNext:r,onPrevious:n,onReply:i,onDelete:o,currentUserId:d,language:p}){const[u,c]=m.useState(""),[l,h]=m.useState(!1),[y,b]=m.useState(a),[v,C]=m.useState(0),[T,P]=m.useState(!1),E=m.useRef(null),R=t[y],F=m.useCallback(()=>{y<t.length-1?(b(f=>f+1),C(0)):s()},[y,t.length,s]),W=m.useCallback(()=>{y>0?(b(f=>f-1),C(0)):n&&n()},[y,n]);if(m.useEffect(()=>{if(!R)return;C(0);const f=5e3,_=50,I=_/f*100;return E.current=setInterval(()=>{l||T||C(x=>x>=100?(clearInterval(E.current),F(),100):x+I)},_),()=>{E.current&&clearInterval(E.current)}},[y,R,F,l,T]),!R)return null;const g=d===R.user_id;return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-black flex flex-col md:rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full p-4 z-50 bg-gradient-to-b from-black/60 to-transparent",children:[e.jsx("div",{className:"flex gap-1 mb-4",children:t.map((f,_)=>e.jsx("div",{className:"flex-1 h-1 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-50",style:{width:_<y?"100%":_===y?`${v}%`:"0%"}})},_))}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Le,{className:"w-10 h-10 border border-white/20",children:[e.jsx(He,{src:R.user_avatar}),e.jsx(Oe,{children:R.user_name?R.user_name.charAt(0):"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:R.user_name}),e.jsx("p",{className:"text-[10px] opacity-60",children:new Date(R.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 relative",children:[g&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>P(!T),className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(ls,{className:"w-5 h-5"})}),T&&e.jsx(A.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},className:"absolute right-0 top-full mt-2 w-48 bg-[#1f2c34] rounded-lg shadow-xl border border-white/10 overflow-hidden z-[1020]",children:e.jsxs("button",{onClick:()=>{o&&o(R.id),P(!1)},className:"flex items-center gap-3 w-full px-4 py-3 text-red-500 hover:bg-white/5 transition-colors text-sm",children:[e.jsx(cs,{className:"w-4 h-4"}),p==="ar"?"Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Delete Story"]})})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(Se,{className:"w-6 h-6"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[R.content_type==="text"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center p-10 bg-gradient-to-br from-indigo-600 to-violet-700",children:e.jsx("p",{className:"text-3xl font-bold text-white text-center leading-relaxed",children:R.text})}),R.content_type==="image"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("img",{src:R.content_url,alt:"Status",className:"max-w-full max-h-full object-contain"}),R.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:R.text})]}),R.content_type==="video"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("video",{src:R.content_url,autoPlay:!0,onEnded:F,className:"max-w-full max-h-full"}),R.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:R.text})]}),e.jsxs("div",{className:"absolute inset-0 flex",children:[e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:W}),e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:F})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 z-[1010] bg-gradient-to-t from-black/90 to-transparent",children:e.jsxs("form",{onSubmit:f=>{f.preventDefault(),u.trim()&&i&&(i(u,R.id),c(""))},className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"text",value:u,onChange:f=>c(f.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:p==="ar"?"Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Reply to story...",className:"flex-1 bg-white/10 border border-white/20 rounded-full px-4 py-3 text-white placeholder:text-white/60 focus:outline-none focus:bg-white/20 backdrop-blur-md transition-all text-sm"}),u.trim()&&e.jsx("button",{type:"submit",className:"p-3 bg-brand rounded-full text-white shadow-lg hover:brightness-110 transition-all",children:e.jsx(Bt,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -left-16 items-center",children:e.jsx("button",{onClick:W,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(Na,{className:"w-8 h-8"})})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -right-16 items-center",children:e.jsx("button",{onClick:F,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(tr,{className:"w-8 h-8"})})})]})}let Sr=!0,kr=!0;function gt(t,a,s){const r=t.match(a);return r&&r.length>=s&&parseFloat(r[s],10)}function Ke(t,a,s){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(o,d){if(o!==a)return n.apply(this,arguments);const p=u=>{const c=s(u);c&&(d.handleEvent?d.handleEvent(c):d(c))};return this._eventMap=this._eventMap||{},this._eventMap[a]||(this._eventMap[a]=new Map),this._eventMap[a].set(d,p),n.apply(this,[o,p])};const i=r.removeEventListener;r.removeEventListener=function(o,d){if(o!==a||!this._eventMap||!this._eventMap[a])return i.apply(this,arguments);if(!this._eventMap[a].has(d))return i.apply(this,arguments);const p=this._eventMap[a].get(d);return this._eventMap[a].delete(d),this._eventMap[a].size===0&&delete this._eventMap[a],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,p])},Object.defineProperty(r,"on"+a,{get(){return this["_on"+a]},set(o){this["_on"+a]&&(this.removeEventListener(a,this["_on"+a]),delete this["_on"+a]),o&&this.addEventListener(a,this["_on"+a]=o)},enumerable:!0,configurable:!0})}function Ci(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Sr=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Si(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(kr=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function _r(){if(typeof window=="object"){if(Sr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gs(t,a){kr&&console.warn(t+" is deprecated, please use "+a+" instead.")}function ki(t){const a={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return a.browser="Not a browser.",a;const{navigator:s}=t;if(s.userAgentData&&s.userAgentData.brands){const r=s.userAgentData.brands.find(n=>n.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(s.mozGetUserMedia)a.browser="firefox",a.version=parseInt(gt(s.userAgent,/Firefox\/(\d+)\./,1));else if(s.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)a.browser="chrome",a.version=parseInt(gt(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))a.browser="safari",a.version=parseInt(gt(s.userAgent,/AppleWebKit\/(\d+)\./,1)),a.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,a._safariVersion=gt(s.userAgent,/Version\/(\d+(\.?\d+))/,1);else return a.browser="Not a supported browser.",a;return a}function As(t){return Object.prototype.toString.call(t)==="[object Object]"}function Tr(t){return As(t)?Object.keys(t).reduce(function(a,s){const r=As(t[s]),n=r?Tr(t[s]):t[s],i=r&&!Object.keys(n).length;return n===void 0||i?a:Object.assign(a,{[s]:n})},{}):t}function es(t,a,s){!a||s.has(a.id)||(s.set(a.id,a),Object.keys(a).forEach(r=>{r.endsWith("Id")?es(t,t.get(a[r]),s):r.endsWith("Ids")&&a[r].forEach(n=>{es(t,t.get(n),s)})}))}function Ds(t,a,s){const r=s?"outbound-rtp":"inbound-rtp",n=new Map;if(a===null)return n;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===a.id&&i.push(o)}),i.forEach(o=>{t.forEach(d=>{d.type===r&&d.trackId===o.id&&es(t,d,n)})}),n}const Ls=_r;function Rr(t,a){const s=t&&t.navigator;if(!s.mediaDevices)return;const r=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const c=typeof d[u]=="object"?d[u]:{ideal:d[u]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const l=function(h,y){return h?h+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(c.ideal!==void 0){p.optional=p.optional||[];let h={};typeof c.ideal=="number"?(h[l("min",u)]=c.ideal,p.optional.push(h),h={},h[l("max",u)]=c.ideal,p.optional.push(h)):(h[l("",u)]=c.ideal,p.optional.push(h))}c.exact!==void 0&&typeof c.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[l("",u)]=c.exact):["min","max"].forEach(h=>{c[h]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[l(h,u)]=c[h])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},n=function(d,p){if(a.version>=61)return p(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const u=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])};d=JSON.parse(JSON.stringify(d)),u(d.audio,"autoGainControl","googAutoGainControl"),u(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=r(d.audio)}if(d&&typeof d.video=="object"){let u=d.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const c=a.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete d.video.facingMode;let l;if(u.exact==="environment"||u.ideal==="environment"?l=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(l=["front"]),l)return s.mediaDevices.enumerateDevices().then(h=>{h=h.filter(b=>b.kind==="videoinput");let y=h.find(b=>l.some(v=>b.label.toLowerCase().includes(v)));return!y&&h.length&&l.includes("back")&&(y=h[h.length-1]),y&&(d.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=r(d.video),Ls("chrome: "+JSON.stringify(d)),p(d)})}d.video=r(d.video)}return Ls("chrome: "+JSON.stringify(d)),p(d)},i=function(d){return a.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(d,p,u){n(d,c=>{s.webkitGetUserMedia(c,p,l=>{u&&u(i(l))})})};if(s.getUserMedia=o.bind(s),s.mediaDevices.getUserMedia){const d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(p){return n(p,u=>d(u).then(c=>{if(u.audio&&!c.getAudioTracks().length||u.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(i(c))))}}}function Pr(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Er(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.track.id):i={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.id):i={track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),a.apply(this,arguments)}}else Ke(t,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a))}function Ir(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const a=function(n,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=n.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:n}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,p){let u=n.apply(this,arguments);return u||(u=a(this,d),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){i.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(a(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const d=this._senders.find(p=>p.track===o);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const a=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=a.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Mr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=s.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Ds(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=s.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ke(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>Ds(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let n,i,o;return this.getSenders().forEach(d=>{d.track===r&&(n?o=!0:n=d)}),this.getReceivers().forEach(d=>(d.track===r&&(i?o=!0:i=d),d.track===r)),o||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}function Ar(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,d){if(!d)return a.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=a.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(l=>l.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();s.apply(this,arguments);const p=this.getSenders().filter(u=>d.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(p)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(o);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),n.apply(this,arguments)}}function Dr(t,a){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&a.version>=65)return Ar(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=s.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const l=new t.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}r.apply(this,[c])};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[l.id];if(b)b.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([c]);this._streams[l.id]=v,this._reverseStreams[v.id]=l,this.addStream(v)}return this.getSenders().find(v=>v.track===c)};function i(u,c){let l=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const y=u._reverseStreams[h],b=u._streams[y.id];l=l.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:c.type,sdp:l})}function o(u,c){let l=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const y=u._reverseStreams[h],b=u._streams[y.id];l=l.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:c.type,sdp:l})}["createOffer","createAnswer"].forEach(function(u){const c=t.RTCPeerConnection.prototype[u],l={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[b=>{const v=i(this,b);h[0].apply(null,[v])},b=>{h[1]&&h[1].apply(null,b)},arguments[2]]):c.apply(this,arguments).then(b=>i(this,b))}};t.RTCPeerConnection.prototype[u]=l[u]});const d=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=o(this,arguments[0]),d.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=p.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(v=>c.track===v)&&(h=this._streams[y])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ts(t,a){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const r=t.RTCPeerConnection.prototype[s],n={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=n[s]})}function Lr(t,a){Ke(t,"negotiationneeded",s=>{const r=s.target;if(!((a.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return s})}const Os=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Lr,shimAddTrackRemoveTrack:Dr,shimAddTrackRemoveTrackWithNative:Ar,shimGetSendersWithDtmf:Ir,shimGetUserMedia:Rr,shimMediaStream:Pr,shimOnTrack:Er,shimPeerConnection:ts,shimSenderReceiverGetStats:Mr},Symbol.toStringTag,{value:"Module"}));function Or(t,a){const s=t&&t.navigator,r=t&&t.MediaStreamTrack;if(s.getUserMedia=function(n,i,o){gs("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(n).then(i,o)},!(a.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const n=function(o,d,p){d in o&&!(p in o)&&(o[p]=o[d],delete o[d])},i=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const d=o.apply(this,arguments);return n(d,"mozAutoGainControl","autoGainControl"),n(d,"mozNoiseSuppression","noiseSuppression"),d}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),n(d,"autoGainControl","mozAutoGainControl"),n(d,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[d])}}}}function _i(t,a){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:a}:r.video.mediaSource=a,t.navigator.mediaDevices.getUserMedia(r)})}function zr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ss(t,a){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=o[n]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,d]=arguments;return r.apply(this,[i||null]).then(p=>{if(a.version<53&&!o)try{p.forEach(u=>{u.type=s[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;p.forEach((c,l)=>{p.set(l,Object.assign({},c,{type:s[c.type]||c.type}))})}return p}).then(o,d)}}function Fr(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const a=t.RTCPeerConnection.prototype.getSenders;a&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=a.apply(this,[]);return n.forEach(i=>i._pc=this),n});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=s.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $r(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const a=t.RTCPeerConnection.prototype.getReceivers;a&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=a.apply(this,[]);return r.forEach(n=>n._pc=this),r}),Ke(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Gr(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){gs("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&s.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Br(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function qr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.addTransceiver;a&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=a.apply(this,arguments);if(n){const{sender:o}=i,d=o.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(d).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function Vr(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const a=t.RTCRtpSender.prototype.getParameters;a&&(t.RTCRtpSender.prototype.getParameters=function(){const r=a.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Ur(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}function Hr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}const zs=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:qr,shimCreateAnswer:Hr,shimCreateOffer:Ur,shimGetDisplayMedia:_i,shimGetParameters:Vr,shimGetUserMedia:Or,shimOnTrack:zr,shimPeerConnection:ss,shimRTCDataChannel:Br,shimReceiverGetStats:$r,shimRemoveStream:Gr,shimSenderGetStats:Fr},Symbol.toStringTag,{value:"Module"}));function Wr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>a.call(this,n,r)),r.getVideoTracks().forEach(n=>a.call(this,n,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...n){return n&&n.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),a.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(s);if(r===-1)return;this._localStreams.splice(r,1);const n=s.getTracks();this.getSenders().forEach(i=>{n.includes(i.track)&&this.removeTrack(i)})})}}function Yr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const i=new Event("addstream");i.stream=n,this.dispatchEvent(i)})})}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),a.apply(r,arguments)}}}function Jr(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,s=a.createOffer,r=a.createAnswer,n=a.setLocalDescription,i=a.setRemoteDescription,o=a.addIceCandidate;a.createOffer=function(u,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=s.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h},a.createAnswer=function(u,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h};let d=function(p,u,c){const l=n.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l};a.setLocalDescription=d,d=function(p,u,c){const l=i.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l},a.setRemoteDescription=d,d=function(p,u,c){const l=o.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l},a.addIceCandidate=d}function Xr(t){const a=t&&t.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){const s=a.mediaDevices,r=s.getUserMedia.bind(s);a.mediaDevices.getUserMedia=n=>r(Kr(n))}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=(function(r,n,i){a.mediaDevices.getUserMedia(r).then(n,i)}).bind(a))}function Kr(t){return t&&t.video!==void 0?Object.assign({},t,{video:Tr(t.video)}):t}function Qr(t){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection;t.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let d=r.iceServers[o];d.urls===void 0&&d.url?(gs("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,i.push(d)):i.push(r.iceServers[o])}r.iceServers=i}return new a(r,n)},t.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in a&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return a.generateCertificate}})}function Zr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ea(t){const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return a.apply(this,arguments)}}function ta(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Fs=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ta,shimCallbacksAPI:Jr,shimConstraints:Kr,shimCreateOfferLegacy:ea,shimGetUserMedia:Xr,shimLocalStreamsAPI:Wr,shimRTCIceServerUrls:Qr,shimRemoteStreamsAPI:Yr,shimTrackEventTransceiver:Zr},Symbol.toStringTag,{value:"Module"}));var Wt={exports:{}},$s;function Ti(){return $s||($s=1,(function(t){const a={};a.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},a.localCName=a.generateIdentifier(),a.splitLines=function(s){return s.trim().split(`
`).map(r=>r.trim())},a.splitSections=function(s){return s.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},a.getDescription=function(s){const r=a.splitSections(s);return r&&r[0]},a.getMediaSections=function(s){const r=a.splitSections(s);return r.shift(),r},a.matchPrefix=function(s,r){return a.splitLines(s).filter(n=>n.indexOf(r)===0)},a.parseCandidate=function(s){let r;s.indexOf("a=candidate:")===0?r=s.substring(12).split(" "):r=s.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":n.relatedAddress=r[i+1];break;case"rport":n.relatedPort=parseInt(r[i+1],10);break;case"tcptype":n.tcpType=r[i+1];break;case"ufrag":n.ufrag=r[i+1],n.usernameFragment=r[i+1];break;default:n[r[i]]===void 0&&(n[r[i]]=r[i+1]);break}return n},a.writeCandidate=function(s){const r=[];r.push(s.foundation);const n=s.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(s.protocol.toUpperCase()),r.push(s.priority),r.push(s.address||s.ip),r.push(s.port);const i=s.type;return r.push("typ"),r.push(i),i!=="host"&&s.relatedAddress&&s.relatedPort&&(r.push("raddr"),r.push(s.relatedAddress),r.push("rport"),r.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(r.push("ufrag"),r.push(s.usernameFragment||s.ufrag)),"candidate:"+r.join(" ")},a.parseIceOptions=function(s){return s.substring(14).split(" ")},a.parseRtpMap=function(s){let r=s.substring(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},a.writeRtpMap=function(s){let r=s.payloadType;s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType);const n=s.channels||s.numChannels||1;return"a=rtpmap:"+r+" "+s.name+"/"+s.clockRate+(n!==1?"/"+n:"")+`\r
`},a.parseExtmap=function(s){const r=s.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},a.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},a.parseFmtp=function(s){const r={};let n;const i=s.substring(s.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)n=i[o].trim().split("="),r[n[0].trim()]=n[1];return r},a.writeFmtp=function(s){let r="",n=s.payloadType;if(s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const i=[];Object.keys(s.parameters).forEach(o=>{s.parameters[o]!==void 0?i.push(o+"="+s.parameters[o]):i.push(o)}),r+="a=fmtp:"+n+" "+i.join(";")+`\r
`}return r},a.parseRtcpFb=function(s){const r=s.substring(s.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},a.writeRtcpFb=function(s){let r="",n=s.payloadType;return s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+n+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},a.parseSsrcMedia=function(s){const r=s.indexOf(" "),n={ssrc:parseInt(s.substring(7,r),10)},i=s.indexOf(":",r);return i>-1?(n.attribute=s.substring(r+1,i),n.value=s.substring(i+1)):n.attribute=s.substring(r+1),n},a.parseSsrcGroup=function(s){const r=s.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},a.getMid=function(s){const r=a.matchPrefix(s,"a=mid:")[0];if(r)return r.substring(6)},a.parseFingerprint=function(s){const r=s.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},a.getDtlsParameters=function(s,r){return{role:"auto",fingerprints:a.matchPrefix(s+r,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(s,r){let n="a=setup:"+r+`\r
`;return s.fingerprints.forEach(i=>{n+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),n},a.parseCryptoLine=function(s){const r=s.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},a.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?a.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const r=s.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},a.getCryptoParameters=function(s,r){return a.matchPrefix(s+r,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(s,r){const n=a.matchPrefix(s+r,"a=ice-ufrag:")[0],i=a.matchPrefix(s+r,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},a.writeIceParameters=function(s){let r="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(r+=`a=ice-lite\r
`),r},a.parseRtpParameters=function(s){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=a.splitLines(s)[0].split(" ");r.profile=i[2];for(let d=3;d<i.length;d++){const p=i[d],u=a.matchPrefix(s,"a=rtpmap:"+p+" ")[0];if(u){const c=a.parseRtpMap(u),l=a.matchPrefix(s,"a=fmtp:"+p+" ");switch(c.parameters=l.length?a.parseFmtp(l[0]):{},c.rtcpFeedback=a.matchPrefix(s,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),r.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(c.name.toUpperCase());break}}}a.matchPrefix(s,"a=extmap:").forEach(d=>{r.headerExtensions.push(a.parseExtmap(d))});const o=a.matchPrefix(s,"a=rtcp-fb:* ").map(a.parseRtcpFb);return r.codecs.forEach(d=>{o.forEach(p=>{d.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),r},a.writeRtpDescription=function(s,r){let n="";n+="m="+s+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{n+=a.writeRtpMap(o),n+=a.writeFmtp(o),n+=a.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(n+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{n+=a.writeExtmap(o)}),n},a.parseRtpEncodingParameters=function(s){const r=[],n=a.parseRtpParameters(s),i=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(s,"a=ssrc:").map(h=>a.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),p=d.length>0&&d[0].ssrc;let u;const c=a.matchPrefix(s,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(b=>parseInt(b,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(u=c[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let y={ssrc:p,codecPayloadType:parseInt(h.parameters.apt,10)};p&&u&&(y.rtx={ssrc:u}),r.push(y),i&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:p,mechanism:o?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&p&&r.push({ssrc:p});let l=a.matchPrefix(s,"b=");return l.length&&(l[0].indexOf("b=TIAS:")===0?l=parseInt(l[0].substring(7),10):l[0].indexOf("b=AS:")===0?l=parseInt(l[0].substring(5),10)*1e3*.95-2e3*8:l=void 0,r.forEach(h=>{h.maxBitrate=l})),r},a.parseRtcpParameters=function(s){const r={},n=a.matchPrefix(s,"a=ssrc:").map(d=>a.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const i=a.matchPrefix(s,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=a.matchPrefix(s,"a=rtcp-mux");return r.mux=o.length>0,r},a.writeRtcpParameters=function(s){let r="";return s.reducedSize&&(r+=`a=rtcp-rsize\r
`),s.mux&&(r+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(r+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),r},a.parseMsid=function(s){let r;const n=a.matchPrefix(s,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=a.matchPrefix(s,"a=ssrc:").map(o=>a.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},a.parseSctpDescription=function(s){const r=a.parseMLine(s),n=a.matchPrefix(s,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const o=a.matchPrefix(s,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const d=a.matchPrefix(s,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},a.writeSctpDescription=function(s,r){let n=[];return s.protocol!=="DTLS/SCTP"?n=["m="+s.kind+" 9 "+s.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+s.kind+" 9 "+s.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(s,r,n){let i;const o=r!==void 0?r:2;return s?i=s:i=a.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(s,r){const n=a.splitLines(s);for(let i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substring(2)}return r?a.getDirection(r):"sendrecv"},a.getKind=function(s){return a.splitLines(s)[0].split(" ")[0].substring(2)},a.isRejected=function(s){return s.split(" ",2)[1]==="0"},a.parseMLine=function(s){const n=a.splitLines(s)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},a.parseOLine=function(s){const n=a.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},a.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const r=a.splitLines(s);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},t.exports=a})(Wt)),Wt.exports}var sa=Ti();const at=aa(sa),Ri=Ea({__proto__:null,default:at},[sa]);function It(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const a=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const n=new a(r),i=at.parseCandidate(r.candidate);for(const o in i)o in n||Object.defineProperty(n,o,{value:i[o]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new a(r)},t.RTCIceCandidate.prototype=a.prototype,Ke(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function rs(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ke(t,"icecandidate",a=>{if(a.candidate){const s=at.parseCandidate(a.candidate.candidate);s.type==="relay"&&(a.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return a})}function Mt(t,a){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const s=function(d){if(!d||!d.sdp)return!1;const p=at.splitSections(d.sdp);return p.shift(),p.some(u=>{const c=at.parseMLine(u);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},r=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const u=parseInt(p[1],10);return u!==u?-1:u},n=function(d){let p=65536;return a.browser==="firefox"&&(a.version<57?d===-1?p=16384:p=2147483637:a.version<60?p=a.version===57?65535:65536:p=2147483637),p},i=function(d,p){let u=65536;a.browser==="firefox"&&a.version===57&&(u=65535);const c=at.matchPrefix(d.sdp,"a=max-message-size:");return c.length>0?u=parseInt(c[0].substring(19),10):a.browser==="firefox"&&p!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,a.browser==="chrome"&&a.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const p=r(arguments[0]),u=n(p),c=i(arguments[0],p);let l;u===0&&c===0?l=Number.POSITIVE_INFINITY:u===0||c===0?l=Math.max(u,c):l=Math.min(u,c);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return l}}),this._sctp=h}return o.apply(this,arguments)}}function At(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function a(r,n){const i=r.send;r.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(r.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=s.apply(this,arguments);return a(n,this),n},Ke(t,"datachannel",r=>(a(r.channel,r.target),r))}function as(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const a=t.RTCPeerConnection.prototype;Object.defineProperty(a,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const r=a[s];a[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const i=n.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",n);i.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function ns(t,a){if(!t.RTCPeerConnection||a.browser==="chrome"&&a.version>=71||a.browser==="safari"&&a._safariVersion>=13.1)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return s.apply(this,arguments)}}function Dt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.addIceCandidate;!s||s.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(a.browser==="chrome"&&a.version<78||a.browser==="firefox"&&a.version<68||a.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Lt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.setLocalDescription;!s||s.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return s.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?s.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>s.apply(this,[o]))})}const Pi=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ns,shimAddIceCandidateNullOrEmpty:Dt,shimConnectionState:as,shimMaxMessageSize:Mt,shimParameterlessSetLocalDescription:Lt,shimRTCIceCandidate:It,shimRTCIceCandidateRelayProtocol:rs,shimSendThrowTypeError:At},Symbol.toStringTag,{value:"Module"}));function Ei({window:t}={},a={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=_r,r=ki(t),n={browserDetails:r,commonShim:Pi,extractVersion:gt,disableLog:Ci,disableWarnings:Si,sdp:Ri};switch(r.browser){case"chrome":if(!Os||!ts||!a.shimChrome)return s("Chrome shim is not included in this adapter release."),n;if(r.version===null)return s("Chrome shim can not determine version, not shimming."),n;s("adapter.js shimming chrome."),n.browserShim=Os,Dt(t,r),Lt(t),Rr(t,r),Pr(t),ts(t,r),Er(t),Dr(t,r),Ir(t),Mr(t),Lr(t,r),It(t),rs(t),as(t),Mt(t,r),At(t),ns(t,r);break;case"firefox":if(!zs||!ss||!a.shimFirefox)return s("Firefox shim is not included in this adapter release."),n;s("adapter.js shimming firefox."),n.browserShim=zs,Dt(t,r),Lt(t),Or(t,r),ss(t,r),zr(t),Gr(t),Fr(t),$r(t),Br(t),qr(t),Vr(t),Ur(t),Hr(t),It(t),as(t),Mt(t,r),At(t);break;case"safari":if(!Fs||!a.shimSafari)return s("Safari shim is not included in this adapter release."),n;s("adapter.js shimming safari."),n.browserShim=Fs,Dt(t,r),Lt(t),Qr(t),ea(t),Jr(t),Wr(t),Yr(t),Zr(t),Xr(t),ta(t),It(t),rs(t),Mt(t,r),At(t),ns(t,r);break;default:s("Unsupported browser!");break}return n}Ei({window:typeof window>"u"?void 0:window});function Ii({callId:t,callerId:a,callerName:s,recipientId:r,isIncoming:n,type:i,onEndCall:o,currentUserId:d,sendSignaling:p,incomingOffer:u,remoteAnswer:c,remoteIceCandidates:l}){const[h,y]=m.useState("ringing"),[b,v]=m.useState(0),[C,T]=m.useState(!1),[P,E]=m.useState(i==="audio"),[R,F]=m.useState(!0),[W,g]=m.useState("user"),[f,_]=m.useState(null),[I,x]=m.useState(null),S=m.useRef(null),w=m.useRef(null),j=m.useRef(null),U=m.useRef(null),k={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceCandidatePoolSize:10},G=(H,L,J)=>{const ae=H.split(`
`);let Z=-1;for(let de=0;de<ae.length;de++)if(ae[de].indexOf("m="+L)===0){Z=de;break}if(Z===-1)return H;for(Z++;Z<ae.length&&ae[Z].indexOf("m=")!==0;){if(ae[Z].indexOf("b=AS:")===0)return ae[Z]="b=AS:"+J,ae.join(`
`);Z++}return ae.splice(Z,0,"b=AS:"+J),ae.join(`
`)},N=m.useCallback(()=>{f==null||f.getTracks().forEach(H=>H.stop()),S.current&&(S.current.onicecandidate=null,S.current.ontrack=null,S.current.close(),S.current=null),_(null),x(null)},[f]),B=m.useCallback(()=>{N(),o()},[N,o]);m.useEffect(()=>{let H;return h==="connected"&&(H=setInterval(()=>{v(L=>L+1)},1e3)),()=>clearInterval(H)},[h]);const ee=H=>{const L=Math.floor(H/60),J=H%60;return`${L}:${J.toString().padStart(2,"0")}`};m.useEffect(()=>{(async()=>{try{f==null||f.getTracks().forEach(J=>J.stop());const L=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:i==="video"?{facingMode:W,width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:60}}:!1});if(_(L),S.current){const J=L.getVideoTracks()[0],ae=S.current.getSenders().find(Z=>{var de;return((de=Z.track)==null?void 0:de.kind)==="video"});ae&&J&&ae.replaceTrack(J).catch(Z=>console.error("Replace track failed:",Z))}}catch(L){console.error("getUserMedia failed:",L),te.error("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­"),B()}})()},[i,W]),m.useEffect(()=>{w.current&&f&&(w.current.srcObject=f)},[f]),m.useEffect(()=>f?((async()=>{try{if(!S.current){const L=new RTCPeerConnection(k);S.current=L,L.ontrack=J=>{console.log("Remote track received"),x(J.streams[0]),y("connected")},L.onicecandidate=J=>{J.candidate&&p(n?a:r,"ice-candidate",{id:t,candidate:J.candidate})},L.oniceconnectionstatechange=()=>{(L.iceConnectionState==="disconnected"||L.iceConnectionState==="failed")&&console.log("ICE failed/disconnected")},f.getTracks().forEach(J=>L.addTrack(J,f))}if(n&&u&&S.current.signalingState==="stable"){await S.current.setRemoteDescription(new RTCSessionDescription(u));let L=await S.current.createAnswer();L.sdp=G(L.sdp,"audio",64),i==="video"&&(L.sdp=G(L.sdp,"video",1e3)),await S.current.setLocalDescription(L),p(a,"call-answer",{id:t,answer:L})}else if(!n&&S.current.signalingState==="stable"){let L=await S.current.createOffer();L.sdp=G(L.sdp,"audio",64),i==="video"&&(L.sdp=G(L.sdp,"video",1e3)),await S.current.setLocalDescription(L),p(r,"call-offer",{id:t,callerId:d,callerName:s,type:i,offer:L})}}catch(L){console.error("PC init failed:",L),B()}})(),()=>{}):void 0,[f,t,n,u,i,d,s,p,B,a,r]),m.useEffect(()=>{c&&S.current&&S.current.signalingState==="have-local-offer"&&S.current.setRemoteDescription(new RTCSessionDescription(c)).catch(H=>console.error("Error setting answer:",H))},[c]),m.useEffect(()=>{l&&S.current&&S.current.remoteDescription&&l.forEach(H=>{var L;(L=S.current)==null||L.addIceCandidate(new RTCIceCandidate(H)).catch(J=>console.error("Error adding candidate:",J))})},[l]),m.useEffect(()=>{j.current&&I&&i==="video"?(j.current.srcObject=I,j.current.play().catch(H=>console.warn("Auto-play blocked:",H))):U.current&&I&&i==="audio"&&(U.current.srcObject=I,U.current.play().catch(H=>console.warn("Auto-play blocked:",H)))},[I,i]);const Y=()=>{if(f){const H=f.getAudioTracks()[0];H&&(H.enabled=C,T(!C))}},K=()=>{if(f&&i==="video"){const H=f.getVideoTracks()[0];H&&(H.enabled=P,E(!P))}},M=()=>{F(!R),j.current&&(j.current.muted=!R),U.current&&(U.current.muted=!R)},X=()=>{g(H=>H==="user"?"environment":"user")};return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-[#111b21] flex flex-col items-center justify-center p-4",children:[i==="video"?e.jsx("video",{ref:j,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-6 mb-20",children:[e.jsx(Le,{className:"w-32 h-32 border-4 border-brand/30 shadow-2xl scale-in-center",children:e.jsx(Oe,{className:"bg-[#202c33] text-brand text-4xl font-bold",children:s.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-white text-3xl font-bold mb-2",children:s}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"text-brand font-medium animate-pulse uppercase tracking-widest text-xs",children:h==="ringing"?n?"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©...":"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...":"Ù…ØªØµÙ„"}),h==="connected"&&e.jsx("p",{className:"text-white/60 font-mono text-lg",children:ee(b)})]})]}),e.jsx("audio",{ref:U,autoPlay:!0})]}),i==="video"&&h==="connected"&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-20 bg-black/40 px-4 py-1 rounded-full backdrop-blur-md border border-white/10",children:e.jsx("p",{className:"text-white font-mono",children:ee(b)})}),i==="video"&&f&&e.jsx("div",{className:"absolute top-6 right-6 w-32 md:w-48 aspect-[3/4] rounded-xl overflow-hidden shadow-2xl border-2 border-white/20 z-10",children:e.jsx("video",{ref:w,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover -scale-x-100"})}),e.jsxs("div",{className:"absolute bottom-12 flex items-center gap-6 bg-[#202c33]/90 backdrop-blur-xl p-6 rounded-full border border-white/10 shadow-2xl z-20",children:[e.jsx(me,{onClick:Y,className:`w-14 h-14 rounded-full transition-all ${C?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:C?e.jsx(Ca,{}):e.jsx(ds,{})}),i==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(me,{onClick:K,className:`w-14 h-14 rounded-full transition-all ${P?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:P?e.jsx(Sa,{}):e.jsx(yt,{})}),e.jsx(me,{onClick:X,className:"w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 transition-all",children:e.jsx(Qs,{className:"w-6 h-6"})})]}),e.jsx(me,{onClick:M,className:`w-14 h-14 rounded-full ${R?"bg-gray-700":"bg-red-500"}`,children:R?e.jsx(Gt,{}):e.jsx(Ks,{})}),e.jsx(me,{onClick:B,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center",children:e.jsx(Zs,{className:"w-8 h-8"})})]})]})}function xt({icon:t,title:a,subtitle:s,onClick:r,colorClass:n="bg-brand/10 text-brand",isDestructive:i=!1,trailing:o}){return e.jsxs("button",{onClick:r,className:`w-full flex items-center gap-4 p-4 rounded-xl border border-transparent hover:bg-white/5 transition-all text-left group ${i?"hover:bg-red-500/10":""}`,children:[e.jsx("div",{className:`p-2.5 rounded-xl ${i?"bg-red-500/10 text-red-500":n} transition-transform group-hover:scale-110`,children:e.jsx(t,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base ${i?"text-red-500":"text-white"}`,children:a}),s&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:s})]}),o||e.jsx("div",{className:`text-gray-600 ${i?"text-red-500/50":""}`,children:e.jsx(tr,{className:"w-5 h-5 rtl:rotate-180"})})]})}function Et({title:t,onBack:a,language:s}){return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(Ue,{className:`w-6 h-6 ${s==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent",children:t})]})}function Mi({user:t,onBack:a,onGoToProfile:s,onLogout:r,notificationsEnabled:n,onEnableNotifications:i,micEnabled:o,onEnableMic:d,soundEnabled:p,onToggleSound:u,currentSoundId:c,notificationSounds:l,onSelectSound:h,onTestSound:y,language:b,onLanguageChange:v,t:C}){const[T,P]=m.useState("main"),{accentColor:E,setAccentColor:R,wallpaper:F,setWallpaper:W,bgOpacity:g,setBgOpacity:f}=Cr(),_=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{onClick:s,className:"relative overflow-hidden flex items-center gap-4 bg-gradient-to-br from-[#202c33] to-[#111b21] p-5 rounded-2xl border border-white/5 hover:border-brand/30 transition-all cursor-pointer group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-brand/10 rounded-full blur-3xl -mr-16 -mt-16 transition-opacity group-hover:opacity-100 opacity-50"}),e.jsxs(Le,{className:"w-16 h-16 border-2 border-white/10 group-hover:border-brand/50 transition-colors shadow-lg",children:[e.jsx(He,{src:t.avatar_url}),e.jsx(Oe,{className:"text-xl bg-brand text-white",children:t.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 z-10",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-sm truncate",children:["@",t.username]})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-gray-400 group-hover:bg-brand group-hover:text-white transition-colors",children:e.jsx(Ve,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"px-1 text-xs font-bold text-gray-500 uppercase tracking-wider",children:b==="ar"?"Ø¹Ø§Ù…":"General"}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:[e.jsx(xt,{icon:Ot,title:b==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£ØµÙˆØ§Øª":"Notifications & Sounds",subtitle:b==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª":"Messages, groups, call tones",colorClass:"bg-red-500/10 text-red-400",onClick:()=>P("notifications")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:Bs,title:b==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†":"Privacy & Security",subtitle:b==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©":"App lock, active sessions",colorClass:"bg-emerald-500/10 text-emerald-400",onClick:()=>P("privacy")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:ws,title:b==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",subtitle:b==="ar"?"Ù†Ù…Ø· Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ Ø§Ù„Ø£Ù„ÙˆØ§Ù†":"Wallpaper, theme colors",colorClass:"bg-purple-500/10 text-purple-400",onClick:()=>P("appearance")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:ka,title:b==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",subtitle:b==="ar"?"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"English",colorClass:"bg-blue-500/10 text-blue-400",onClick:()=>P("language")})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:e.jsx(xt,{icon:_a,title:b==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":"Log Out",onClick:r,isDestructive:!0})})}),e.jsx("p",{className:"text-center text-xs text-gray-600 pt-4",children:"Chat App v1.2.0 â€¢ 2024"})]}),I=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n?"bg-brand/20 text-brand":"bg-gray-800 text-gray-500"}`,children:e.jsx(Ot,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨":"Desktop Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:n?"Enabled":"Disabled"})]})]}),e.jsx(me,{onClick:()=>{jt.requestNotificationPermission().then(j=>{j?i():te.error(b==="ar"?"ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications disabled in browser")})},disabled:n,variant:n?"ghost":"outline",children:n?b==="ar"?"Ù…ÙØ¹Ù„":"On":b==="ar"?"ØªÙØ¹ÙŠÙ„":"Turn On"})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${p?"bg-orange-500/20 text-orange-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(Gt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Conversation Tones"}),e.jsx("p",{className:"text-sm text-gray-500",children:b==="ar"?"ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©":"Play sounds for incoming messages"})]})]}),e.jsx("div",{onClick:()=>u(!p),className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${p?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${p?"right-1":"left-1"}`})})]}),p&&e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 space-y-3",children:[e.jsx("p",{className:"text-sm font-bold text-gray-400 uppercase",children:b==="ar"?"Ù†ØºÙ…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±":"Alert Tone"}),l.map(j=>e.jsxs("div",{onClick:()=>h(j.id),className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all border ${c===j.id?"bg-brand/10 border-brand/50 scale-[1.02]":"bg-transparent border-transparent hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${c===j.id?"border-brand":"border-gray-500"}`,children:c===j.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand"})}),e.jsx("span",{className:"text-sm font-medium",children:j.name})]}),e.jsx("button",{onClick:U=>{U.stopPropagation(),new Audio(j.url).play()},className:"p-2 hover:bg-white/10 rounded-full text-brand",children:e.jsx(Gt,{className:"w-4 h-4"})})]},j.id))]})]})]}),x=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ws,{className:"w-5 h-5 text-purple-400"}),e.jsx("h4",{className:"font-medium text-white",children:b==="ar"?"Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"Accent Color"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",children:Object.keys(Zt).map(j=>e.jsx("button",{onClick:()=>R(j),className:`w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-lg ${E===j?"ring-2 ring-white scale-110":"opacity-70 hover:opacity-100 hover:scale-105"}`,style:{backgroundColor:Zt[j].hex},children:E===j&&e.jsx(De,{className:"w-6 h-6 text-white drop-shadow-md"})},j))})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ta,{className:"w-5 h-5 text-amber-400"}),e.jsx("h4",{className:"font-medium text-white",children:b==="ar"?"Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Chat Wallpaper"})]}),e.jsxs("select",{value:F,onChange:j=>W(j.target.value),className:"bg-black/30 text-white text-sm rounded-lg px-3 py-2 outline-none border border-white/10 focus:border-brand",children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"doodles",children:"Doodles"}),e.jsx("option",{value:"stars",children:"Stars Pattern"}),e.jsx("option",{value:"geometric",children:"Geometric"}),e.jsx("option",{value:"solid",children:"Solid Color"})]})]}),F!=="solid"&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:b==="ar"?"Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ù†Ù…Ø·":"Pattern Opacity"}),e.jsxs("span",{className:"text-xs text-brand font-bold",children:[Math.round(g*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,onChange:j=>f(parseFloat(j.target.value)),className:"w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand"})]})]})]})]}),S=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ©":"Privacy & Security",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-emerald-500/20 text-emerald-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(er,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"App Lock"}),e.jsx("p",{className:"text-sm text-gray-500",children:b==="ar"?"ØªØ£Ù…ÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±Ù…Ø² Ù…Ø±ÙˆØ±":"Secure app with passcode"})]})]}),e.jsx("div",{onClick:()=>{const j=localStorage.getItem("chat_app_lock_enabled")==="true";localStorage.setItem("chat_app_lock_enabled",(!j).toString()),P("privacy"),window.dispatchEvent(new Event("storage"))},className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${localStorage.getItem("chat_app_lock_enabled")==="true"?"right-1":"left-1"}`})})]}),localStorage.getItem("chat_app_lock_enabled")==="true"&&e.jsxs("div",{className:"bg-[#202c33]/30 rounded-xl border border-white/5 overflow-hidden animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("span",{className:"text-sm font-medium",children:b==="ar"?"Ø±Ù…Ø² Ø§Ù„Ù…Ø±ÙˆØ±":"Passcode"}),e.jsx(me,{onClick:()=>{if(localStorage.getItem("chat_app_pin"))localStorage.removeItem("chat_app_pin"),localStorage.removeItem("chat_app_biometric"),te.success("Passcode removed"),P("privacy");else{const U=prompt("Enter new 6-digit PIN:");U&&U.length===6&&!isNaN(Number(U))&&(localStorage.setItem("chat_app_pin",U),te.success("Passcode set"),P("privacy"))}},variant:"outline",size:"sm",className:"h-8",children:localStorage.getItem("chat_app_pin")?b==="ar"?"ØªØºÙŠÙŠØ± / Ø­Ø°Ù":"Change / Remove":b==="ar"?"Ø¥Ø¹Ø¯Ø§Ø¯":"Setup"})]}),localStorage.getItem("chat_app_pin")&&e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:b==="ar"?"Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡ / Ø§Ù„Ø¥ØµØ¨Ø¹":"Biometric Unlock"}),e.jsx(me,{onClick:()=>{const j=localStorage.getItem("chat_app_biometric")==="true";localStorage.setItem("chat_app_biometric",(!j).toString()),P("privacy"),te.success(j?"Biometrics disabled":"Biometrics enabled (if supported)")},variant:"ghost",size:"sm",className:localStorage.getItem("chat_app_biometric")==="true"?"text-brand":"text-gray-400",children:localStorage.getItem("chat_app_biometric")==="true"?b==="ar"?"Ù…ÙØ¹Ù„":"Enabled":b==="ar"?"Ù…Ø¹Ø·Ù„":"Disabled"})]})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${o?"bg-blue-500/20 text-blue-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(ds,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Microphone Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:o?"Granted":"Needed for voice notes"})]})]}),e.jsx(me,{onClick:()=>{jt.requestMicPermission().then(j=>{j?d():te.error(b==="ar"?"ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙˆØª":"Microphone access required")})},disabled:o,variant:o?"ghost":"outline",children:o?b==="ar"?"Ù…Ø³Ù…ÙˆØ­":"Allowed":b==="ar"?"Ø³Ù…Ø§Ø­":"Allow"})]})]})]}),w=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5 divide-y divide-white/5",children:[e.jsxs("button",{onClick:()=>{v("en"),P("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium",children:"English"}),b==="en"&&e.jsx(De,{className:"w-5 h-5 text-brand"})]}),e.jsxs("button",{onClick:()=>{v("ar"),P("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium font-arabic",children:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}),b==="ar"&&e.jsx(De,{className:"w-5 h-5 text-brand"})]})]})]});return e.jsxs("div",{className:"flex flex-col h-full bg-[#111b21] text-white",children:[T==="main"&&e.jsxs("div",{className:"p-4 bg-[#202c33]/80 backdrop-blur-md sticky top-0 z-10 flex items-center gap-4 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Ue,{className:`w-6 h-6 ${b==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold",children:C("settings")})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto ${T==="main"?"p-6":"p-6 bg-[#111b21]"}`,children:[T==="main"&&_(),T==="notifications"&&I(),T==="appearance"&&x(),T==="privacy"&&S(),T==="language"&&w()]})]})}function Gs({user:t,onBack:a,onUpdate:s,isPublicView:r,language:n,t:i,onStartChat:o}){var w;const[d,p]=m.useState((t==null?void 0:t.name)||""),[u,c]=m.useState((t==null?void 0:t.birth_year)||""),[l,h]=m.useState((t==null?void 0:t.gender)||""),[y,b]=m.useState((t==null?void 0:t.about)||(r?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")),[v,C]=m.useState(!1),[T,P]=m.useState(!1),[E,R]=m.useState(!1),[F,W]=m.useState(!1),[g,f]=m.useState(!1),_=m.useRef(null),I=m.useRef(null),x=m.useRef(null);if(m.useEffect(()=>{t&&(p(t.name||""),c(t.birth_year||""),h(t.gender||""),b(t.about||(r?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")))},[t,r,n]),m.useEffect(()=>{T&&_.current&&_.current.focus()},[T]),m.useEffect(()=>{E&&I.current&&I.current.focus()},[E]),m.useEffect(()=>{F&&x.current&&x.current.focus()},[F]),!t)return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 items-center justify-center p-8 text-center space-y-4",children:[e.jsx(ye,{className:"w-12 h-12 text-brand animate-spin"}),e.jsx("p",{className:"text-slate-400 font-medium",children:n==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...":"Loading profile..."}),e.jsx("button",{onClick:a,className:"text-brand hover:underline",children:n==="ar"?"Ø±Ø¬ÙˆØ¹":"Go Back"})]});const S=async()=>{if(!d.trim())return te.error(n==="ar"?"Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹":"Name cannot be empty");C(!0);try{const{error:j}=await Q.from("profiles").update({name:d.trim(),about:y.trim(),birth_year:u?parseInt(u.toString()):null,gender:l||null}).eq("id",t.id);if(j)throw j;te.success(i("profileUpdatedSuccessfully")),s&&s({...t,name:d.trim(),about:y.trim(),birth_year:u?parseInt(u.toString()):null,gender:l||null}),P(!1),R(!1),W(!1),f(!1)}catch(j){console.error("Error updating profile:",j),te.error(n==="ar"?"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ":"Failed to update profile")}finally{C(!1)}};return e.jsxs(A.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col h-full bg-slate-950 w-full relative overflow-hidden z-[500]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-brand/10 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-violet-500/5 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950 border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Ue,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${n==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-white text-xl font-bold ${n==="ar"?"font-arabic":""}`,children:i(r?"partnerProfile":"profile")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[e.jsxs("div",{className:`relative group ${r?"":"cursor-pointer"}`,children:[e.jsxs(Le,{className:"w-40 h-40 border-4 border-slate-900 shadow-2xl group-hover:border-brand/50 transition-colors duration-500",children:[e.jsx(He,{src:t==null?void 0:t.avatar_url,className:"object-cover"}),e.jsx(Oe,{className:"bg-slate-800 text-4xl font-bold text-brand",children:(w=t==null?void 0:t.name)==null?void 0:w.charAt(0).toUpperCase()})]}),!r&&e.jsxs("div",{className:"absolute inset-0 bg-black/40 rounded-full flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-sm",children:[e.jsx(sr,{className:"w-8 h-8 text-white mb-2"}),e.jsx("span",{className:"text-xs text-white font-medium",children:n==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©":"Change Photo"})]})]}),r&&o&&e.jsxs(me,{onClick:o,className:"bg-brand hover:bg-brand/80 text-white rounded-full px-8 shadow-lg shadow-brand/20 mt-6",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),n==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©":"Send Message"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand text-xs font-bold uppercase tracking-wider",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("name")})]}),!T&&!r&&e.jsx("button",{onClick:()=>P(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(St,{className:"w-4 h-4"})})]}),T?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(je,{ref:_,value:d,onChange:j=>p(j.target.value),className:"bg-slate-950/50 border-white/10 text-lg font-medium text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ":"Enter your name"}),e.jsx(me,{size:"icon",onClick:S,disabled:v,className:"bg-brand hover:bg-brand/80",children:v?e.jsx(ye,{className:"w-4 h-4 animate-spin"}):e.jsx(Vt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-white text-lg font-medium pl-1",children:d})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Yt,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("about")})]}),!E&&!r&&e.jsx("button",{onClick:()=>R(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(St,{className:"w-4 h-4"})})]}),E?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(je,{ref:I,value:y,onChange:j=>b(j.target.value),className:"bg-slate-950/50 border-white/10 text-base text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¶Ù Ù†Ø¨Ø°Ø©":"Add a bio"}),e.jsx(me,{size:"icon",onClick:S,disabled:v,className:"bg-brand hover:bg-brand/80",children:v?e.jsx(ye,{className:"w-4 h-4 animate-spin"}):e.jsx(Vt,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-slate-300 text-base pl-1",children:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("birth_year")})]}),!F&&!r&&e.jsx("button",{onClick:()=>W(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(St,{className:"w-3 h-3"})})]}),F?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{ref:x,type:"number",value:u,onChange:j=>c(j.target.value),className:"bg-slate-950/50 border-white/10 text-sm text-white h-8",placeholder:"YYYY"}),e.jsx(me,{size:"icon",onClick:S,className:"h-8 w-8 bg-brand hover:bg-brand/80",children:e.jsx(Vt,{className:"w-3 h-3"})})]}):e.jsx("p",{className:"text-white text-base pl-1",children:u||(n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified")})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("gender")})]}),!g&&!r&&e.jsx("button",{onClick:()=>f(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(St,{className:"w-3 h-3"})})]}),g?e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:l,onChange:j=>{h(j.target.value),setTimeout(()=>S(),100)},className:"bg-slate-950 text-white text-sm border-white/10 rounded-md p-1 flex-1 outline-none ring-1 ring-white/10",children:[e.jsx("option",{value:"",children:n==="ar"?"Ø§Ø®ØªØ§Ø±":"Select"}),e.jsx("option",{value:"male",children:i("male")}),e.jsx("option",{value:"female",children:i("female")})]})}):e.jsx("p",{className:"text-white text-base pl-1",children:l==="male"?i("male"):l==="female"?i("female"):n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Xs,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]}),e.jsx("p",{className:"text-slate-300 font-mono text-sm truncate",children:t.email||"Hidden"})]}),e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]}),e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(t.created_at||Date.now()).toLocaleDateString()})]})]})]})]})})]})}function Ai({onBack:t,currentUserId:a,language:s,t:r}){const[n,i]=m.useState(""),[o,d]=m.useState("user"),[p,u]=m.useState(null),[c,l]=m.useState(!1),[h,y]=m.useState(!1),[b,v]=m.useState(!1),C=async()=>{if(!n.trim())return;const E=n.trim().toLowerCase().replace(o==="user"?"@":"#","");l(!0),y(!1),u(null),await new Promise(R=>setTimeout(R,600));try{if(o==="user"){const{data:R}=await Q.from("profiles").select("id, display_name, username").eq("username",E).maybeSingle();if(R){if(R.id===a){y(!0);return}const{data:F}=await Q.from("conversation_participants").select("conversation_id").eq("user_id",R.id),W=(F==null?void 0:F.map(_=>_.conversation_id))||[];let g=!1;if(W.length>0){const{data:_}=await Q.from("conversation_participants").select("conversation_id").eq("user_id",a).in("conversation_id",W).maybeSingle();g=!!_}const{data:f}=await Q.from("chat_requests").select("status, sender_id").or(`and(sender_id.eq.${a},receiver_id.eq.${R.id}),and(sender_id.eq.${R.id},receiver_id.eq.${a})`).maybeSingle();u({id:R.id,identifier:R.username,name:R.display_name||R.username,hasChat:g,requestStatus:f==null?void 0:f.status,requestSenderId:f==null?void 0:f.sender_id})}else y(!0)}else{const{data:R}=await Q.from("groups").select("id, name, group_id, description").eq("group_id",E).maybeSingle();if(R){const{data:F}=await Q.from("group_members").select("id").eq("group_id",R.id).eq("user_id",a).maybeSingle();u({id:R.id,identifier:R.group_id,name:R.name,description:R.description,isMember:!!F})}else y(!0)}}catch(R){console.error("Search error:",R),y(!0)}finally{l(!1)}},T=async()=>{if(!(!p||b)){v(!0);try{const{error:E}=await Q.from("chat_requests").upsert({sender_id:a,receiver_id:p.id,status:"pending"},{onConflict:"sender_id,receiver_id"});if(E)throw E;te.success(s==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!":"Request sent successfully!"),u(R=>R?{...R,requestStatus:"pending",requestSenderId:a}:null)}catch(E){te.error(E.message||(s==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨":"Failed to send request"))}finally{v(!1)}}},P=async()=>{if(!(!p||b)){v(!0);try{const{error:E}=await Q.from("group_members").insert({group_id:p.id,user_id:a,role:"member"});if(E)throw E;te.success(s==="ar"?"ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Joined group successfully!"),u(R=>R?{...R,isMember:!0}:null)}catch(E){console.error("Join group error:",E),te.error(s==="ar"?"ÙØ´Ù„ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to join group")}finally{v(!1)}}};return e.jsxs("div",{className:"flex flex-col h-[100dvh] bg-slate-950 text-white overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-indigo-900/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3 relative z-10 border-b border-white/5 bg-slate-900/50 backdrop-blur-sm",children:[e.jsx(A.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t,className:"text-slate-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/5",children:e.jsx(Ue,{className:`w-6 h-6 ${s==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 ${s==="ar"?"font-arabic":""}`,children:r("newChat")})]}),e.jsxs("div",{className:"flex border-b border-white/5 relative z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{d("user"),u(null),y(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="user"?"text-brand":"text-slate-500 hover:text-slate-300"} ${s==="ar"?"font-arabic":""}`,children:[s==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…":"Find User",o==="user"&&e.jsx(A.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]}),e.jsxs("button",{type:"button",onClick:()=>{d("group"),u(null),y(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="group"?"text-brand":"text-slate-500 hover:text-slate-300"} ${s==="ar"?"font-arabic":""}`,children:[s==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©":"Find Group",o==="group"&&e.jsx(A.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]})]}),e.jsx("div",{className:"flex-1 px-4 py-8 overflow-y-auto relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(A.p,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 mb-6 text-center text-sm",children:o==="user"?s==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù… (Ù…Ø«Ù„Ø§Ù‹ elgin@)":"Search for users by their username (e.g. @elgin)":s==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù…Ø«Ù„Ø§Ù‹ #developers)":"Search for groups by their Group ID (e.g. #developers)"}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),C()},className:"flex gap-2 mb-8 relative z-50",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand font-bold pointer-events-none text-lg",children:o==="user"?"@":"#"}),e.jsx(je,{type:"text",inputMode:"search",autoComplete:"off",autoCorrect:"off",spellCheck:"false",placeholder:o==="user"?s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"username":s==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"group-id",value:n,onChange:E=>{i(E.target.value),y(!1),u(null)},className:"pl-8 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-600 h-12 text-lg font-medium transition-all"})]}),e.jsx(A.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:c||!n.trim(),className:"bg-brand hover:bg-brand/80 disabled:opacity-50 text-white h-12 w-12 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-brand/20",children:e.jsx(vt,{className:"w-6 h-6 pointer-events-none"})})]}),c&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 py-8 gap-2",children:[e.jsx(ye,{className:"w-8 h-8 animate-spin text-brand"}),e.jsx("span",{className:"text-xs animate-pulse",children:s==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©...":"Searching the network..."})]}),h&&e.jsxs(A.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900/50 border border-white/5 rounded-2xl p-6 text-center",children:[e.jsxs("p",{className:"text-slate-300 font-medium text-lg",children:[o==="user"?s==="ar"?"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"User":s==="ar"?"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Group"," ",s==="ar"?"ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯":"not found"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:s==="ar"?"ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù‘Ù ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.":"Check the ID and try again."})]}),e.jsx(he,{children:p&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand via-purple-500 to-brand"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-xl font-bold",children:p.name}),e.jsxs("p",{className:"text-brand text-sm font-medium bg-brand/10 px-2 py-0.5 rounded-md w-fit mt-1",children:[o==="user"?"@":"#",p.identifier]}),p.description&&e.jsx("p",{className:"text-slate-400 text-sm mt-2 leading-relaxed",children:p.description})]}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20 rotate-3",children:o==="user"?e.jsx(Ve,{className:"w-7 h-7"}):e.jsx(bt,{className:"w-7 h-7"})})]}),o==="user"?p.hasChat?e.jsx("div",{className:"bg-brand/10 text-brand border border-brand/20 rounded-xl py-3 text-center text-sm font-medium",children:s==="ar"?"Ù„Ø¯ÙŠÙƒ Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"You already have a chat with this user"}):p.requestStatus==="pending"?e.jsx("div",{className:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded-xl py-3 text-center text-sm font-medium",children:p.requestSenderId===a?s==="ar"?"Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...":"Request Pending...":s==="ar"?"Ø£Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ Ø·Ù„Ø¨Ø§Ù‹!":"Sent you a request!"}):e.jsx(me,{onClick:T,disabled:b,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:b?e.jsx(ye,{className:"w-5 h-5 animate-spin"}):s==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¯Ø±Ø¯Ø´Ø©":"Send Chat Request"}):p.isMember?e.jsx("div",{className:"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-xl py-3 text-center text-sm font-medium",children:s==="ar"?"Ø£Ù†Øª Ø¹Ø¶Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"You are already a member"}):e.jsx(me,{onClick:P,disabled:b,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:b?e.jsx(ye,{className:"w-5 h-5 animate-spin"}):s==="ar"?"Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Join Group"})]})})]})})]})}function Di({onBack:t,currentUserId:a,language:s,t:r}){const[n,i]=m.useState(""),[o,d]=m.useState(""),[p,u]=m.useState(""),[c,l]=m.useState(!1),[h,y]=m.useState(null),b=async()=>{if(!n.trim()||!o.trim()){te.error(s==="ar"?"ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©":"Please fill in required fields",{description:s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.":"Group Name and Unique ID are required."});return}l(!0);try{const{data:v,error:C}=await Q.from("groups").insert({name:n.trim(),group_id:o.trim().toLowerCase(),description:p.trim(),created_by:a}).select().single();if(C)throw C;const{error:T}=await Q.from("group_members").insert({group_id:v.id,user_id:a,role:"admin"});if(T)throw T;te.success(s==="ar"?"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Group Created Successfully!",{description:s==="ar"?`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ${n.trim()}`:`Welcome to ${n.trim()}`}),t()}catch(v){console.error("Error creating group:",v),v.code==="23505"?te.error(s==="ar"?"Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø£Ø®ÙˆØ° Ø¨Ø§Ù„ÙØ¹Ù„":"Group ID already taken",{description:s==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø±Ù‘Ù ÙØ±ÙŠØ¯ Ø¢Ø®Ø±.":"Please choose a different unique ID."}):te.error(s==="ar"?"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to create group",{description:v.message||(s==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.":"Please try again later.")})}finally{l(!1)}};return e.jsxs(A.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"flex flex-col h-full bg-slate-950 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-32 -left-32 w-64 h-64 bg-violet-500/10 rounded-full blur-3xl animate-pulse"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950/80 backdrop-blur-md border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(Ue,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${s==="ar"?"rotate-180":""}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:`text-white text-xl font-bold flex items-center gap-2 ${s==="ar"?"font-arabic":""}`,children:[r("createGroup"),e.jsx(nt,{className:"w-4 h-4 text-indigo-400"})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:s==="ar"?"Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³ Ù…Ø¹Ø§Ù‹":"Bring people together"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(A.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-32 h-32 bg-gradient-to-tr from-slate-800 to-slate-700 rounded-full flex items-center justify-center cursor-pointer relative group border-4 border-slate-950 shadow-2xl",children:[e.jsx(sr,{className:"w-10 h-10 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-medium",children:s==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©":"Change Icon"})}),e.jsx("div",{className:"absolute -inset-1 rounded-full border border-indigo-500/30 opacity-0 group-hover:opacity-100 transition-opacity scale-110"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:s==="ar"?"Ø§Ø¶ØºØ· Ù„ØªØ¹ÙŠÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Tap to set group icon"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:se("text-sm font-medium transition-colors ml-1",h==="name"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:[r("name")," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="name"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(bt,{className:se("w-5 h-5 transition-colors",h==="name"?"text-indigo-400":"text-slate-500")}),e.jsx(je,{type:"text",placeholder:s==="ar"?"Ù…Ø«Ù„Ø§Ù‹: Ø±Ø­Ù„Ø© Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹":"e.g. Weekend Trip Squad",value:n,onChange:v=>i(v.target.value),onFocus:()=>y("name"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:se("text-sm font-medium transition-colors ml-1",h==="id"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:[s==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯":"Unique ID"," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="id"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ra,{className:se("w-5 h-5 transition-colors",h==="id"?"text-indigo-400":"text-slate-500")}),e.jsx(je,{type:"text",placeholder:s==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ù…Ø¬Ù…ÙˆØ¹Ø©-ÙØ±ÙŠØ¯":"unique-group-handle",value:o,onChange:v=>d(v.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-")),onFocus:()=>y("id"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 ml-1",children:[s==="ar"?"ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¹Ø¨Ø±":"Users can join via"," ",e.jsxs("span",{className:"font-mono text-indigo-400 bg-indigo-500/10 px-1 rounded",children:["#",o||(s==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù":"handle")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:se("text-sm font-medium transition-colors ml-1",h==="desc"?"text-indigo-400":"text-slate-400",s==="ar"?"font-arabic":""),children:r("about")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:se("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="desc"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Pa,{className:se("w-5 h-5 transition-colors",h==="desc"?"text-indigo-400":"text-slate-500")}),e.jsx(je,{type:"text",placeholder:s==="ar"?"Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¯ÙˆØ± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ":"What's this group about?",value:p,onChange:v=>u(v.target.value),onFocus:()=>y("desc"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]})]}),e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(me,{onClick:b,disabled:c||!n.trim()||!o.trim(),className:"w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white h-14 text-lg font-semibold rounded-xl shadow-lg shadow-indigo-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5 mr-2 animate-spin"}),s==="ar"?"Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©...":"Creating Group..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-5 h-5 mr-2"}),s==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Create Group"]})})})]})})]})}function Li(){const[t,a]=m.useState(()=>localStorage.getItem("chat_app_language")||"en"),[s,r]=m.useState(()=>localStorage.getItem("chat_app_theme")==="dark"),[n,i]=m.useState(()=>localStorage.getItem("chat_app_view")||"chatList");m.useEffect(()=>{localStorage.setItem("chat_app_view",n)},[n]);const[o,d]=m.useState(!1),[p,u]=m.useState(()=>localStorage.getItem("chat_app_sound_enabled")!=="false"),[c,l]=m.useState(!1),[h,y]=m.useState(!1),[b,v]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||qe[0].id),[C,T]=m.useState([]),[P,E]=m.useState([]),[R,F]=m.useState(null),[W,g]=m.useState(null),f=m.useRef(null),_=m.useRef(null),I=m.useRef(null);console.log("ðŸ”— Initializing hooks...");const{currentUser:x,isLoading:S,logout:w}=un();console.log("ðŸ‘¤ Auth State:",{currentUser:x==null?void 0:x.id,authLoading:S});const{chats:j,isLoading:U,selectedChat:k,messages:G,loadChats:N,loadMessages:B,handleSelectChat:ee,handleSendMessage:Y,handleDeleteMessage:K,handlePinChat:M,handleSendPoll:X,handleIncomingMessage:H,handleIncomingUpdate:L,sendMessageToChat:J}=mn(x),ae=m.useCallback($=>{_.current=$,ee($)},[ee]);m.useEffect(()=>{_.current=k},[k]);const{activeCall:Z,handleStartCall:de,handleAcceptCall:Re,handleRejectCall:we,handleIncomingCall:lt,handleCallAnswer:Ee,handleIceCandidate:ct,handleCallEnded:Qe}=pn({currentUser:x,soundEnabled:p}),Ne=m.useMemo(()=>x?{id:x.id,name:x.name||x.username,username:x.username}:null,[x]),{onlineUsers:We,typingUsers:xe,sendTypingIndicator:Ze,sendSignalingMessage:dt}=fn({currentUser:Ne,selectedChatRef:_,onNewMessage:H,onUpdateMessage:L,onReloadChats:m.useCallback(()=>{x&&N(x.id)},[x,N]),soundEnabled:p,onIncomingCall:lt,onCallAnswer:Ee,onIceCandidate:ct,onCallEnded:Qe}),oe=m.useCallback($=>La[t][$]||$,[t]);m.useEffect(()=>{const $=setTimeout(()=>d(!1),2500);return()=>clearTimeout($)},[]),m.useEffect(()=>{s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("chat_app_theme",s?"dark":"light")},[s]),m.useEffect(()=>{"Notification"in window&&y(Notification.permission==="granted"),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"microphone"}).then($=>{l($.state==="granted"),$.onchange=()=>l($.state==="granted")}).catch(()=>{})},[]),m.useEffect(()=>{const $=()=>{document.removeEventListener("click",$)};return document.addEventListener("click",$),()=>document.removeEventListener("click",$)},[]),m.useEffect(()=>{const $=qe.find(O=>O.id===b)||qe[0];f.current=new Audio($.url),localStorage.setItem("chat_app_sound_id",b)},[b]),m.useEffect(()=>{localStorage.setItem("chat_app_sound_enabled",String(p))},[p]);const ge=m.useCallback(async()=>{if(!x)return;const{data:$}=await Q.from("chat_requests").select("*, profiles:sender_id(username, display_name, avatar_url)").eq("receiver_id",x.id).eq("status","pending");$&&T(O=>JSON.stringify(O)!==JSON.stringify($)?$:O)},[x==null?void 0:x.id]),Ie=m.useCallback(async()=>{if(!x)return;const{data:$}=await Q.from("statuses").select("*, profiles:user_id(id, display_name, avatar_url)").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});$&&E(O=>JSON.stringify(O)!==JSON.stringify($)?$:O)},[x==null?void 0:x.id]);m.useEffect(()=>{if(x){console.log("ðŸ”„ Running global data fetch for user:",x.id),ge(),Ie();const $=Q.channel(`app - global - ${x.id} `).on("postgres_changes",{event:"*",schema:"public",table:"chat_requests",filter:`receiver_id = eq.${x.id} `},ge).on("postgres_changes",{event:"*",schema:"public",table:"statuses"},Ie).subscribe(O=>console.log("ðŸ“¡ Global channel status:",O));return()=>{console.log("ðŸ”Œ Cleaning up global channel"),Q.removeChannel($)}}},[x==null?void 0:x.id,ge,Ie]);const et=m.useCallback(($,O)=>{Ze($,O)},[Ze]),ze=m.useCallback(()=>{},[]),ut=m.useCallback(()=>{},[]),Fe=m.useCallback(()=>{},[]),z=m.useCallback(()=>{i("chatList")},[]),le=m.useCallback($=>{_.current&&K($,_.current.isGroup)},[K]),Me=m.useCallback(()=>{_.current&&B(_.current.id,_.current.isGroup)},[B]),ke=m.useCallback($=>{_.current&&et($,_.current.partnerId)},[et]),$e=m.useCallback(()=>{te.info(t==="ar"?"Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Coming Soon: Clear Chat")},[t]),mt=async($,O)=>{if(!x)return;let ne=null;const ce=P.find(ie=>ie.id===O);if(ce&&(ne=ce.user_id),!ne&&R&&R.items){const ie=R.items.find(fe=>fe.id===O);ie&&(ne=ie.user_id)}if(!ne){te.error("Could not find status owner");return}const ue=j.find(ie=>ie.partnerId===ne),Ye=`Replied to story: ${$} `;ue?(await J(ue,Ye),te.success(t==="ar"?"ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­":"Reply sent"),F(null)):te.error("You must have a chat with this user to reply")},Ge=async $=>{var ce;const O=(ce=$.target.files)==null?void 0:ce[0];if(!O||!x)return;if(!O.type.startsWith("image/")&&!O.type.startsWith("video/")){te.error(t==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ":"Please select an image or video");return}const ne=te.custom(ue=>e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-4 w-[300px] shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ye,{className:"w-5 h-5 animate-spin text-brand"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Uploading story..."})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx(A.div,{initial:{width:"0%"},animate:{width:"90%"},transition:{duration:2,ease:"easeInOut"},className:"h-full bg-brand"})})]}),{duration:1/0});try{const ue=new FormData;ue.append("file",O),ue.append("userId",x.id);const ie=await(await fetch(`https://${ms}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${ps}`},body:ue})).json();if(ie.error)throw new Error(ie.error);const fe=new Date;fe.setDate(fe.getDate()+1);const tt=ie.fileType.startsWith("video/")?"video":"image",{error:be}=await Q.from("statuses").insert({user_id:x.id,content_url:ie.fileUrl,content_type:tt,text:"",expires_at:fe.toISOString()});if(be)throw be;te.dismiss(ne),te.custom(()=>e.jsxs("div",{className:"bg-green-500/10 border border-green-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 rounded-full p-1",children:e.jsx(De,{className:"w-4 h-4 text-black"})}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­":"Story uploaded successfully"})]}),{duration:3e3}),Ie()}catch(ue){console.error("Story upload error:",ue),te.dismiss(ne),te.custom(()=>e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹":"Upload failed"})]}),{duration:4e3})}finally{I.current&&(I.current.value="")}},pt=$=>{k&&de(k.partnerId,k.partnerName,$)},ft=async($,O)=>{if(x)try{await Q.from("chat_requests").update({status:"accepted"}).eq("id",$);const{data:ne}=await Q.from("conversations").insert({}).select().single();ne&&(await Q.from("conversation_participants").insert([{conversation_id:ne.id,user_id:x.id},{conversation_id:ne.id,user_id:O}]),te.success("Request accepted"),ge(),N(x.id))}catch{te.error("Failed to accept")}},_e=async $=>{await Q.from("chat_requests").update({status:"rejected"}).eq("id",$),te.success("Request rejected"),ge()},Ce=async $=>{if(x)try{const{error:O}=await Q.from("statuses").delete().eq("id",$).eq("user_id",x.id);if(O)throw O;te.success(t==="ar"?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Story deleted"),F(null),Ie()}catch(O){console.error("Error deleting status:",O),te.error(t==="ar"?"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Failed to delete story")}},qt=async($,O)=>{if(i($),typeof O=="string"){g(null);const{data:ne}=await Q.from("profiles").select("*").eq("id",O).single();ne&&g(ne)}else g(O||null)},Nt=async()=>{const $=await jt.requestNotificationPermission(oe);y($),$&&te.success(oe("notifications")+" "+oe("success"))},Ct=async()=>{const $=await jt.requestMicPermission();l($),$?te.success("Microphone enabled"):te.error("Microphone access denied")};return S||o?e.jsx("div",{className:"w-full h-screen bg-[#111b21] flex flex-col items-center justify-center",children:e.jsx(wi,{onFinish:()=>d(!1),language:t})}):x?e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"h-screen bg-[#111b21] flex items-center justify-center",children:e.jsx(ye,{className:"w-8 h-8 animate-spin text-green-500"})}),children:e.jsx(ni,{children:e.jsxs("div",{className:"flex h-screen bg-[#111b21] relative overflow-hidden font-outfit text-white",children:[e.jsx(ks,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx("input",{type:"file",ref:I,className:"hidden",accept:"image/*,video/*",onChange:Ge}),Z&&Z.status==="ringing"&&Z.callerId!==x.id&&e.jsx(ji,{callerName:Z.callerName,type:Z.type,onAccept:Re,onReject:we,language:t}),Z&&(Z.status==="connected"||Z.status==="connecting"||Z.status==="ringing"&&Z.callerId===x.id)&&e.jsx(Ii,{callId:Z.id,isIncoming:Z.callerId!==x.id,callerName:Z.callerId===x.id?Z.recipientId:Z.callerName,type:Z.type,onEndCall:we,currentUserId:x.id,callerId:Z.callerId,recipientId:Z.recipientId,sendSignaling:dt,incomingOffer:Z.offer,remoteAnswer:Z.answer,remoteIceCandidates:Z.iceCandidates||[]}),e.jsx(he,{children:R&&e.jsx(A.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[1000] bg-black",children:e.jsx(Ni,{items:R.items,initialIndex:R.index,onClose:()=>F(null),onReply:mt,onDelete:Ce,currentUserId:x.id,language:t})})}),e.jsxs("div",{className:`flex w-full h-full ${n==="chatList"?"":"md:flex"}`,children:[e.jsx("div",{className:`${n==="chatList"?"flex":"hidden md:flex"} w-full md:w-[400px] flex-col h-full border-r border-white/5`,children:e.jsx(ai,{chats:j,currentUser:x,onlineUsers:We,onSelectChat:($,O)=>{const ne=j.find(ce=>ce.partnerId===$);ne&&(ae(ne),i("chatWindow"))},onNewChat:()=>i("newChat"),onCreateGroup:()=>i("createGroup"),onLogout:w,onSettings:()=>i("settings"),onAcceptRequest:ft,onRejectRequest:_e,pendingRequests:C,typingUsers:xe,onPinChat:M,statuses:P,onViewStatus:($,O)=>F({items:$,index:O}),onAddStatus:()=>{var $;return($=I.current)==null?void 0:$.click()},language:t,t:oe,onEnableNotifications:Nt,notificationsEnabled:h,isLoading:U})}),e.jsxs("div",{className:`${n!=="chatList"?"flex":"hidden md:flex"} flex-1 flex-col h-full bg-[#0b141a]`,children:[n==="chatList"&&e.jsx("div",{className:"hidden md:flex items-center justify-center h-full text-gray-500",children:e.jsx("p",{children:"Select a chat to start messaging"})}),n==="chatWindow"&&k&&e.jsx(yi,{currentUserId:x.id,partnerId:k.partnerId,partnerName:k.partnerName,partnerAvatar:k.partnerAvatar,messages:G,isPartnerOnline:We.has(k.partnerId),isPartnerTyping:xe[k.partnerId],onBack:z,onSendMessage:Y,onSendVoiceMessage:ze,onDeleteMessage:le,onTyping:ke,onRefresh:Me,onReact:ut,onSendPoll:X,onVote:Fe,onStartCall:pt,isGroup:k.isGroup,onShowProfile:$=>qt("partnerProfile",$),onClearChat:$e,language:t,t:oe}),n==="settings"&&e.jsx(Mi,{user:x,onBack:()=>i("chatList"),onGoToProfile:()=>i("profile"),onLogout:w,notificationsEnabled:h,onEnableNotifications:Nt,micEnabled:c,onEnableMic:Ct,soundEnabled:p,onToggleSound:u,currentSoundId:b,notificationSounds:qe,onSelectSound:v,onTestSound:()=>{var $;return($=f.current)==null?void 0:$.play()},language:t,onLanguageChange:a,t:oe}),n==="newChat"&&e.jsx(Ai,{onBack:()=>i("chatList"),currentUserId:x.id,language:t,t:oe}),n==="createGroup"&&e.jsx(Di,{onBack:()=>{N(x.id),i("chatList")},currentUserId:x.id,language:t,t:oe}),n==="profile"&&e.jsx(Gs,{user:x,onBack:()=>i("settings"),onUpdate:()=>{},language:t,t:oe}),n==="partnerProfile"&&e.jsx(Gs,{user:W,isPublicView:!0,onBack:()=>i("chatWindow"),onStartChat:()=>{i("chatWindow")},language:t,t:oe})]})]})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx(Xn,{onLoginSuccess:()=>{},language:t,t:oe})]})}console.log("ðŸš€ main.tsx execution started");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/firebase-messaging-sw.js").then(t=>{console.log("âœ… ServiceWorker registration successful with scope: ",t.scope)},t=>{console.log("âŒ ServiceWorker registration failed: ",t)})});console.log("ðŸ—ï¸ Creating root and rendering App...");Ma.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(ii,{children:e.jsx(Li,{})})}));console.log("ðŸ main.tsx end of file reached");
