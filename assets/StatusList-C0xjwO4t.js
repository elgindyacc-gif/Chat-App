import{r as c,j as e,A as C,I as b,B as k,L as I,p as A,b as F,s as L,t as j}from"./index-D7he1i6_.js";import{A as R,b as T,a as _}from"./avatar-CAwhaa4I.js";import{P as D,I as O,S as B}from"./send-BeB6MeHC.js";import{X as E}from"./x-JNGtBUds.js";function M({currentUser:a,onBack:g,language:l,t:P,onStatusAdded:v,statuses:w}){const[N,r]=c.useState(!1),[i,d]=c.useState(""),[s,h]=c.useState(null),[m,f]=c.useState(!1),p=c.useRef(null),y=t=>{var n;const o=(n=t.target.files)==null?void 0:n[0];o&&(h(o),r(!0))},S=async()=>{if(!(!i.trim()&&!s)){f(!0);try{let t="",o="text";if(s){const x=new FormData;x.append("file",s),x.append("userId",a.id);const u=await(await fetch(`https://${A}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${F}`},body:x})).json();if(u.error)throw new Error(u.error);t=u.fileUrl,o=s.type.startsWith("video/")?"video":"image"}const{error:n}=await L.from("statuses").insert([{user_id:a.id,content_type:o,content_url:t||null,text:i.trim()||null,expires_at:new Date(Date.now()+1440*60*1e3).toISOString()}]);if(n)throw n;j.success("Status updated!"),v(),r(!1),d(""),h(null)}catch(t){j.error("Failed to update status: "+t.message)}finally{f(!1)}}};return e.jsxs("div",{className:"flex flex-col h-full bg-[#111b21] relative",children:[e.jsxs("div",{className:"bg-[#202c33] p-4 flex items-center gap-4 border-b border-gray-800",children:[e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-white",children:e.jsx(C,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-white text-lg font-bold",children:"Status"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 p-2 hover:bg-[#202c33] rounded-xl transition-colors",children:[e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>r(!0),children:[e.jsxs(R,{className:"w-14 h-14 border-2 border-gray-700",children:[e.jsx(T,{src:a.avatar_url}),e.jsx(_,{children:a.name[0]})]}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-[#00a884] rounded-full p-1 border-2 border-[#111b21]",children:e.jsx(D,{className:"w-3 h-3 text-white"})})]}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>r(!0),children:[e.jsx("h3",{className:"text-white font-bold",children:l==="ar"?"حالتِي":"My Status"}),e.jsx("p",{className:"text-gray-400 text-sm",children:l==="ar"?"انقر لإضافة تحديث":"Tap to add status update"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"file",ref:p,onChange:y,accept:"image/*,video/*",className:"hidden"}),e.jsx("button",{onClick:()=>{var t;return(t=p.current)==null?void 0:t.click()},className:"p-2 text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(O,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"text-gray-500 text-sm font-bold uppercase",children:"Recent updates"}),w.filter(t=>t.id!=="1"&&t.user_id!==a.id).length===0&&e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No recent updates"})]}),N&&e.jsxs("div",{className:"absolute inset-0 z-50 bg-[#111b21] flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>r(!1),className:"text-white",children:e.jsx(E,{className:"w-6 h-6"})}),e.jsx("h3",{className:"text-white font-bold",children:l==="ar"?"حالة جديدة":"New Status"}),e.jsx("div",{})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-black relative",children:s?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-6",children:[s.type.startsWith("video/")?e.jsx("video",{src:URL.createObjectURL(s),className:"max-h-[60%] rounded-xl shadow-2xl",controls:!0}):e.jsx("img",{src:URL.createObjectURL(s),className:"max-h-[60%] rounded-xl shadow-2xl object-contain"}),e.jsx("div",{className:"w-full max-w-md bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/10 shadow-2xl",children:e.jsx(b,{value:i,onChange:t=>d(t.target.value),placeholder:l==="ar"?"إضافة شرح...":"Add a caption...",className:"bg-transparent border-none text-white placeholder:text-white/50 focus-visible:ring-0 text-lg",autoFocus:!0})})]}):e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-8 bg-gradient-to-br from-indigo-600 to-violet-700",children:e.jsx(b,{value:i,onChange:t=>d(t.target.value),placeholder:l==="ar"?"اكتب حالة...":"Type a status...",className:"bg-transparent border-none text-center text-3xl font-bold text-white placeholder:text-white/50 focus-visible:ring-0 leading-relaxed",autoFocus:!0})})}),e.jsx("div",{className:"p-4 bg-[#202c33] flex justify-end",children:e.jsx(k,{onClick:S,disabled:m||!i.trim()&&!s,className:"bg-indigo-500 hover:bg-indigo-600 rounded-full w-14 h-14 p-0 flex items-center justify-center shadow-lg transition-transform active:scale-90",children:m?e.jsx(I,{className:"w-6 h-6 animate-spin"}):e.jsx(B,{className:"w-6 h-6 ml-1"})})})]})]})}export{M as StatusList};
