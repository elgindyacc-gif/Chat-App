import{a as sa,R as L,r as m,j as e,u as vr,b as yr,c as jr,m as D,A as xe,g as aa}from"./vendor-C2tG_28P.js";import{c as na}from"./supabase-2A4keVzc.js";import{R as ia,S as oa,M as lr,U as Ue,b as nt,L as Br,c as je,A as la,d as ca,P as cr,u as da,e as qr,f as bt,g as Xt,h as ua,C as ma,i as vt,B as Ot,j as Le,X as ke,E as Vr,k as dr,l as zt,m as pa,n as Ur,o as Hr,T as ur,p as Vt,F as Ft,q as fa,r as Wr,s as ha,t as mr,D as Yr,I as Jr,v as pr,V as yt,w as $t,x as Xr,y as xa,z as ga,G as ba,H as He,J as va,K as ya,N as ja,O as wa,Q as Kr,W as Gt,Y as Qr,Z as Zr,$ as es,a0 as Na,a1 as ts,a2 as Ca,a3 as Sa,a4 as wr,a5 as ka,a6 as _a,a7 as Ta,a8 as rs,a9 as St,aa as Ht,ab as Ra,ac as Pa}from"./ui-wo5GeGEf.js";function Ea(t,a){for(var r=0;r<a.length;r++){const s=a[r];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(s,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var kt={},Nr;function Ia(){if(Nr)return kt;Nr=1;var t=sa();return kt.createRoot=t.createRoot,kt.hydrateRoot=t.hydrateRoot,kt}var Ma=Ia();const Bt="umgfxbipblzpgpejlnzg",qt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtZ2Z4YmlwYmx6cGdwZWpsbnpnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1ODY5MDIsImV4cCI6MjA4MjE2MjkwMn0.fkNxfMwxqGR5EUALb5C3QxQvSMXsDyRyHf8tltWpm2Y",Aa=`https://${Bt}.supabase.co`,Da=qt,X=na(Aa,Da,{auth:{persistSession:!0,autoRefreshToken:!0},realtime:{params:{eventsPerSecond:10}}}),La={en:{loginTitle:"Welcome Back",loginSubtitle:"Sign in to continue",emailPlaceholder:"Email address",passwordPlaceholder:"Password",loginButton:"Sign In",signupLink:"Create an account",chatsTitle:"Chats",searchPlaceholder:"Search conversations...",newChatButton:"New Chat",typeMessage:"Type a message...",online:"Online",offline:"Last seen",typing:"typing...",settings:"Settings",profile:"Profile",language:"Language",logout:"Log Out",notifications:"Notifications",sounds:"Sounds",privacy:"Privacy",help:"Help",theme:"Theme",account:"Account",blocked:"Blocked Users",general:"General",darkMode:"Dark Mode",lightMode:"Light Mode",systemMode:"System",save:"Save",cancel:"Cancel",edit:"Edit",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy",info:"Info",members:"Members",media:"Media",files:"Files",links:"Links",voice:"Voice",video:"Video",call:"Call",mute:"Mute",unmute:"Unmute",camera:"Camera",screenShare:"Screen Share",endCall:"End Call",accept:"Accept",reject:"Reject",calling:"Calling...",ringing:"Ringing...",connecting:"Connecting...",reconnecting:"Reconnecting...",ended:"Call Ended",missed:"Missed Call",incoming:"Incoming Call",outgoing:"Outgoing Call",today:"Today",yesterday:"Yesterday",justNow:"Just now",sent:"Sent",delivered:"Delivered",read:"Read",failed:"Failed",uploading:"Uploading...",downloading:"Downloading...",success:"Success",error:"Error",retry:"Retry",loading:"Loading...",noChats:"No chats yet",startChat:"Start a conversation",createGroup:"Create Group",groupName:"Group Name",addMembers:"Add Members",create:"Create",groupCreated:"Group created successfully",userJoined:"User joined",userLeft:"User left",admin:"Admin",kick:"Remote",promote:"Promote",demote:"Demote",leaveGroup:"Leave Group",deleteGroup:"Delete Group",areYouSure:"Are you sure?",cannotUndo:"This action cannot be undone.",yes:"Yes",no:"No",ok:"OK"},ar:{loginTitle:"Ù…Ø±Ø­Ø¨Ø§Ù‹",loginSubtitle:"Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©",emailPlaceholder:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",passwordPlaceholder:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",loginButton:"Ø¯Ø®ÙˆÙ„",signupLink:"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",chatsTitle:"Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª",searchPlaceholder:"Ø¨Ø­Ø«...",newChatButton:"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",typeMessage:"Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...",online:"Ù…ØªØµÙ„",offline:"Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±",typing:"ÙŠÙƒØªØ¨...",settings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",profile:"Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",language:"Ø§Ù„Ù„ØºØ©",logout:"ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬",notifications:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",sounds:"Ø§Ù„Ø£ØµÙˆØ§Øª",privacy:"Ø§Ù„Ø®ØµÙˆØµÙŠØ©",help:"Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©",theme:"Ø§Ù„Ù…Ø¸Ù‡Ø±",account:"Ø§Ù„Ø­Ø³Ø§Ø¨",blocked:"Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†",general:"Ø¹Ø§Ù…",darkMode:"Ø¯Ø§ÙƒÙ†",lightMode:"ÙØ§ØªØ­",systemMode:"Ø§Ù„Ù†Ø¸Ø§Ù…",save:"Ø­ÙØ¸",cancel:"Ø¥Ù„ØºØ§Ø¡",edit:"ØªØ¹Ø¯ÙŠÙ„",delete:"Ø­Ø°Ù",reply:"Ø±Ø¯",forward:"ØªØ­ÙˆÙŠÙ„",copy:"Ù†Ø³Ø®",info:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",members:"Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡",media:"Ø§Ù„ÙˆØ³Ø§Ø¦Ø·",files:"Ø§Ù„Ù…Ù„ÙØ§Øª",links:"Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",voice:"ØµÙˆØªÙŠ",video:"ÙÙŠØ¯ÙŠÙˆ",call:"Ø§ØªØµØ§Ù„",mute:"ÙƒØªÙ…",unmute:"ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª",camera:"ÙƒØ§Ù…ÙŠØ±Ø§",screenShare:"Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©",endCall:"Ø¥Ù†Ù‡Ø§Ø¡",accept:"Ø±Ø¯",reject:"Ø±ÙØ¶",calling:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...",ringing:"ÙŠØ±Ù†...",connecting:"ÙŠØªØµÙ„...",reconnecting:"ÙŠØ¹ÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„...",ended:"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø©",missed:"Ù…ÙƒØ§Ù„Ù…Ø© ÙØ§Ø¦ØªØ©",incoming:"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©",outgoing:"Ù…ÙƒØ§Ù„Ù…Ø© ØµØ§Ø¯Ø±Ø©",today:"Ø§Ù„ÙŠÙˆÙ…",yesterday:"Ø£Ù…Ø³",justNow:"Ø§Ù„Ø¢Ù†",sent:"ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„",delivered:"ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„",read:"ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©",failed:"ÙØ´Ù„",uploading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...",downloading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",success:"ØªÙ… Ø¨Ù†Ø¬Ø§Ø­",error:"Ø®Ø·Ø£",retry:"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",loading:"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...",noChats:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª",startChat:"Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©",createGroup:"Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø©",groupName:"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",addMembers:"Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ø¶Ø§Ø¡",create:"Ø¥Ù†Ø´Ø§Ø¡",groupCreated:"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",userJoined:"Ø§Ù†Ø¶Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",userLeft:"ØºØ§Ø¯Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",admin:"Ù…Ø´Ø±Ù",kick:"Ø·Ø±Ø¯",promote:"ØªØ±Ù‚ÙŠØ©",demote:"ØªØ®ÙÙŠØ¶",leaveGroup:"Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",deleteGroup:"Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©",areYouSure:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ",cannotUndo:"Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.",yes:"Ù†Ø¹Ù…",no:"Ù„Ø§",ok:"Ø­Ø³Ù†Ø§Ù‹"}};function Oa(t){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",a.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const za=t=>{switch(t){case"success":return Ga;case"info":return qa;case"warning":return Ba;case"error":return Va;default:return null}},Fa=Array(12).fill(0),$a=({visible:t,className:a})=>L.createElement("div",{className:["sonner-loading-wrapper",a].filter(Boolean).join(" "),"data-visible":t},L.createElement("div",{className:"sonner-spinner"},Fa.map((r,s)=>L.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),Ga=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ba=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),qa=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Va=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},L.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ua=L.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},L.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),L.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ha=()=>{const[t,a]=L.useState(document.hidden);return L.useEffect(()=>{const r=()=>{a(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),t};let Kt=1;class Wa{constructor(){this.subscribe=a=>(this.subscribers.push(a),()=>{const r=this.subscribers.indexOf(a);this.subscribers.splice(r,1)}),this.publish=a=>{this.subscribers.forEach(r=>r(a))},this.addToast=a=>{this.publish(a),this.toasts=[...this.toasts,a]},this.create=a=>{var r;const{message:s,...n}=a,i=typeof(a==null?void 0:a.id)=="number"||((r=a.id)==null?void 0:r.length)>0?a.id:Kt++,o=this.toasts.find(p=>p.id===i),d=a.dismissible===void 0?!0:a.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(p=>p.id===i?(this.publish({...p,...a,id:i,title:s}),{...p,...a,id:i,dismissible:d,title:s}):p):this.addToast({title:s,...n,dismissible:d,id:i}),i},this.dismiss=a=>(a?(this.dismissedToasts.add(a),requestAnimationFrame(()=>this.subscribers.forEach(r=>r({id:a,dismiss:!0})))):this.toasts.forEach(r=>{this.subscribers.forEach(s=>s({id:r.id,dismiss:!0}))}),a),this.message=(a,r)=>this.create({...r,message:a}),this.error=(a,r)=>this.create({...r,message:a,type:"error"}),this.success=(a,r)=>this.create({...r,type:"success",message:a}),this.info=(a,r)=>this.create({...r,type:"info",message:a}),this.warning=(a,r)=>this.create({...r,type:"warning",message:a}),this.loading=(a,r)=>this.create({...r,type:"loading",message:a}),this.promise=(a,r)=>{if(!r)return;let s;r.loading!==void 0&&(s=this.create({...r,promise:a,type:"loading",message:r.loading,description:typeof r.description!="function"?r.description:void 0}));const n=Promise.resolve(a instanceof Function?a():a);let i=s!==void 0,o;const d=n.then(async u=>{if(o=["resolve",u],L.isValidElement(u))i=!1,this.create({id:s,type:"default",message:u});else if(Ja(u)&&!u.ok){i=!1;const l=typeof r.error=="function"?await r.error(`HTTP error! status: ${u.status}`):r.error,h=typeof r.description=="function"?await r.description(`HTTP error! status: ${u.status}`):r.description,b=typeof l=="object"&&!L.isValidElement(l)?l:{message:l};this.create({id:s,type:"error",description:h,...b})}else if(u instanceof Error){i=!1;const l=typeof r.error=="function"?await r.error(u):r.error,h=typeof r.description=="function"?await r.description(u):r.description,b=typeof l=="object"&&!L.isValidElement(l)?l:{message:l};this.create({id:s,type:"error",description:h,...b})}else if(r.success!==void 0){i=!1;const l=typeof r.success=="function"?await r.success(u):r.success,h=typeof r.description=="function"?await r.description(u):r.description,b=typeof l=="object"&&!L.isValidElement(l)?l:{message:l};this.create({id:s,type:"success",description:h,...b})}}).catch(async u=>{if(o=["reject",u],r.error!==void 0){i=!1;const c=typeof r.error=="function"?await r.error(u):r.error,l=typeof r.description=="function"?await r.description(u):r.description,y=typeof c=="object"&&!L.isValidElement(c)?c:{message:c};this.create({id:s,type:"error",description:l,...y})}}).finally(()=>{i&&(this.dismiss(s),s=void 0),r.finally==null||r.finally.call(r)}),p=()=>new Promise((u,c)=>d.then(()=>o[0]==="reject"?c(o[1]):u(o[1])).catch(c));return typeof s!="string"&&typeof s!="number"?{unwrap:p}:Object.assign(s,{unwrap:p})},this.custom=(a,r)=>{const s=(r==null?void 0:r.id)||Kt++;return this.create({jsx:a(s),id:s,...r}),s},this.getActiveToasts=()=>this.toasts.filter(a=>!this.dismissedToasts.has(a.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const ye=new Wa,Ya=(t,a)=>{const r=(a==null?void 0:a.id)||Kt++;return ye.addToast({title:t,...a,id:r}),r},Ja=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",Xa=Ya,Ka=()=>ye.toasts,Qa=()=>ye.getActiveToasts(),Z=Object.assign(Xa,{success:ye.success,info:ye.info,warning:ye.warning,error:ye.error,custom:ye.custom,message:ye.message,promise:ye.promise,dismiss:ye.dismiss,loading:ye.loading},{getHistory:Ka,getToasts:Qa});Oa("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function _t(t){return t.label!==void 0}const Za=3,en="24px",tn="16px",Cr=4e3,rn=356,sn=14,an=45,nn=200;function Ee(...t){return t.filter(Boolean).join(" ")}function on(t){const[a,r]=t.split("-"),s=[];return a&&s.push(a),r&&s.push(r),s}const ln=t=>{var a,r,s,n,i,o,d,p,u;const{invert:c,toast:l,unstyled:h,interacting:y,setHeights:b,visibleToasts:v,heights:C,index:T,toasts:P,expanded:E,removeToast:R,defaultRichColors:G,closeButton:W,style:g,cancelButtonStyle:f,actionButtonStyle:k,className:I="",descriptionClassName:x="",duration:S,position:j,gap:N,expandByDefault:F,classNames:_,icons:B,closeButtonAriaLabel:w="Close toast"}=t,[U,te]=L.useState(null),[Y,Q]=L.useState(null),[M,K]=L.useState(!1),[H,O]=L.useState(!1),[J,ne]=L.useState(!1),[ee,pe]=L.useState(!1),[Pe,Ne]=L.useState(!1),[lt,Ie]=L.useState(0),[ct,Qe]=L.useState(0),Ce=L.useRef(l.duration||S||Cr),Ye=L.useRef(null),ge=L.useRef(null),Ze=T===0,dt=T+1<=v,ce=l.type,be=l.dismissible!==!1,Me=l.className||"",et=l.descriptionClassName||"",Fe=L.useMemo(()=>C.findIndex(A=>A.toastId===l.id)||0,[C,l.id]),ut=L.useMemo(()=>{var A;return(A=l.closeButton)!=null?A:W},[l.closeButton,W]),$e=L.useMemo(()=>l.duration||S||Cr,[l.duration,S]),$=L.useRef(0),ue=L.useRef(0),Ae=L.useRef(0),_e=L.useRef(null),[Ge,mt]=j.split("-"),Be=L.useMemo(()=>C.reduce((A,se,le)=>le>=Fe?A:A+se.height,0),[C,Fe]),pt=Ha(),ft=l.invert||c,Te=ce==="loading";ue.current=L.useMemo(()=>Fe*N+Be,[Fe,Be]),L.useEffect(()=>{Ce.current=$e},[$e]),L.useEffect(()=>{K(!0)},[]),L.useEffect(()=>{const A=ge.current;if(A){const se=A.getBoundingClientRect().height;return Qe(se),b(le=>[{toastId:l.id,height:se,position:l.position},...le]),()=>b(le=>le.filter(ie=>ie.toastId!==l.id))}},[b,l.id]),L.useLayoutEffect(()=>{if(!M)return;const A=ge.current,se=A.style.height;A.style.height="auto";const le=A.getBoundingClientRect().height;A.style.height=se,Qe(le),b(ie=>ie.find(oe=>oe.toastId===l.id)?ie.map(oe=>oe.toastId===l.id?{...oe,height:le}:oe):[{toastId:l.id,height:le,position:l.position},...ie])},[M,l.title,l.description,b,l.id]);const Se=L.useCallback(()=>{O(!0),Ie(ue.current),b(A=>A.filter(se=>se.toastId!==l.id)),setTimeout(()=>{R(l)},nn)},[l,R,b,ue]);L.useEffect(()=>{if(l.promise&&ce==="loading"||l.duration===1/0||l.type==="loading")return;let A;return E||y||pt?(()=>{if(Ae.current<$.current){const ie=new Date().getTime()-$.current;Ce.current=Ce.current-ie}Ae.current=new Date().getTime()})():(()=>{Ce.current!==1/0&&($.current=new Date().getTime(),A=setTimeout(()=>{l.onAutoClose==null||l.onAutoClose.call(l,l),Se()},Ce.current))})(),()=>clearTimeout(A)},[E,y,l,ce,pt,Se]),L.useEffect(()=>{l.delete&&Se()},[Se,l.delete]);function Ut(){var A;if(B!=null&&B.loading){var se;return L.createElement("div",{className:Ee(_==null?void 0:_.loader,l==null||(se=l.classNames)==null?void 0:se.loader,"sonner-loader"),"data-visible":ce==="loading"},B.loading)}return L.createElement($a,{className:Ee(_==null?void 0:_.loader,l==null||(A=l.classNames)==null?void 0:A.loader),visible:ce==="loading"})}const Nt=l.icon||(B==null?void 0:B[ce])||za(ce);var Ct,z;return L.createElement("li",{tabIndex:0,ref:ge,className:Ee(I,Me,_==null?void 0:_.toast,l==null||(a=l.classNames)==null?void 0:a.toast,_==null?void 0:_.default,_==null?void 0:_[ce],l==null||(r=l.classNames)==null?void 0:r[ce]),"data-sonner-toast":"","data-rich-colors":(Ct=l.richColors)!=null?Ct:G,"data-styled":!(l.jsx||l.unstyled||h),"data-mounted":M,"data-promise":!!l.promise,"data-swiped":Pe,"data-removed":H,"data-visible":dt,"data-y-position":Ge,"data-x-position":mt,"data-index":T,"data-front":Ze,"data-swiping":J,"data-dismissible":be,"data-type":ce,"data-invert":ft,"data-swipe-out":ee,"data-swipe-direction":Y,"data-expanded":!!(E||F&&M),style:{"--index":T,"--toasts-before":T,"--z-index":P.length-T,"--offset":`${H?lt:ue.current}px`,"--initial-height":F?"auto":`${ct}px`,...g,...l.style},onDragEnd:()=>{ne(!1),te(null),_e.current=null},onPointerDown:A=>{Te||!be||(Ye.current=new Date,Ie(ue.current),A.target.setPointerCapture(A.pointerId),A.target.tagName!=="BUTTON"&&(ne(!0),_e.current={x:A.clientX,y:A.clientY}))},onPointerUp:()=>{var A,se,le;if(ee||!be)return;_e.current=null;const ie=Number(((A=ge.current)==null?void 0:A.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),de=Number(((se=ge.current)==null?void 0:se.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),oe=new Date().getTime()-((le=Ye.current)==null?void 0:le.getTime()),me=U==="x"?ie:de,tt=Math.abs(me)/oe;if(Math.abs(me)>=an||tt>.11){Ie(ue.current),l.onDismiss==null||l.onDismiss.call(l,l),Q(U==="x"?ie>0?"right":"left":de>0?"down":"up"),Se(),pe(!0);return}else{var ve,Re;(ve=ge.current)==null||ve.style.setProperty("--swipe-amount-x","0px"),(Re=ge.current)==null||Re.style.setProperty("--swipe-amount-y","0px")}Ne(!1),ne(!1),te(null)},onPointerMove:A=>{var se,le,ie;if(!_e.current||!be||((se=window.getSelection())==null?void 0:se.toString().length)>0)return;const oe=A.clientY-_e.current.y,me=A.clientX-_e.current.x;var tt;const ve=(tt=t.swipeDirections)!=null?tt:on(j);!U&&(Math.abs(me)>1||Math.abs(oe)>1)&&te(Math.abs(me)>Math.abs(oe)?"x":"y");let Re={x:0,y:0};const br=Je=>1/(1.5+Math.abs(Je)/20);if(U==="y"){if(ve.includes("top")||ve.includes("bottom"))if(ve.includes("top")&&oe<0||ve.includes("bottom")&&oe>0)Re.y=oe;else{const Je=oe*br(oe);Re.y=Math.abs(Je)<Math.abs(oe)?Je:oe}}else if(U==="x"&&(ve.includes("left")||ve.includes("right")))if(ve.includes("left")&&me<0||ve.includes("right")&&me>0)Re.x=me;else{const Je=me*br(me);Re.x=Math.abs(Je)<Math.abs(me)?Je:me}(Math.abs(Re.x)>0||Math.abs(Re.y)>0)&&Ne(!0),(le=ge.current)==null||le.style.setProperty("--swipe-amount-x",`${Re.x}px`),(ie=ge.current)==null||ie.style.setProperty("--swipe-amount-y",`${Re.y}px`)}},ut&&!l.jsx&&ce!=="loading"?L.createElement("button",{"aria-label":w,"data-disabled":Te,"data-close-button":!0,onClick:Te||!be?()=>{}:()=>{Se(),l.onDismiss==null||l.onDismiss.call(l,l)},className:Ee(_==null?void 0:_.closeButton,l==null||(s=l.classNames)==null?void 0:s.closeButton)},(z=B==null?void 0:B.close)!=null?z:Ua):null,(ce||l.icon||l.promise)&&l.icon!==null&&((B==null?void 0:B[ce])!==null||l.icon)?L.createElement("div",{"data-icon":"",className:Ee(_==null?void 0:_.icon,l==null||(n=l.classNames)==null?void 0:n.icon)},l.promise||l.type==="loading"&&!l.icon?l.icon||Ut():null,l.type!=="loading"?Nt:null):null,L.createElement("div",{"data-content":"",className:Ee(_==null?void 0:_.content,l==null||(i=l.classNames)==null?void 0:i.content)},L.createElement("div",{"data-title":"",className:Ee(_==null?void 0:_.title,l==null||(o=l.classNames)==null?void 0:o.title)},l.jsx?l.jsx:typeof l.title=="function"?l.title():l.title),l.description?L.createElement("div",{"data-description":"",className:Ee(x,et,_==null?void 0:_.description,l==null||(d=l.classNames)==null?void 0:d.description)},typeof l.description=="function"?l.description():l.description):null),L.isValidElement(l.cancel)?l.cancel:l.cancel&&_t(l.cancel)?L.createElement("button",{"data-button":!0,"data-cancel":!0,style:l.cancelButtonStyle||f,onClick:A=>{_t(l.cancel)&&be&&(l.cancel.onClick==null||l.cancel.onClick.call(l.cancel,A),Se())},className:Ee(_==null?void 0:_.cancelButton,l==null||(p=l.classNames)==null?void 0:p.cancelButton)},l.cancel.label):null,L.isValidElement(l.action)?l.action:l.action&&_t(l.action)?L.createElement("button",{"data-button":!0,"data-action":!0,style:l.actionButtonStyle||k,onClick:A=>{_t(l.action)&&(l.action.onClick==null||l.action.onClick.call(l.action,A),!A.defaultPrevented&&Se())},className:Ee(_==null?void 0:_.actionButton,l==null||(u=l.classNames)==null?void 0:u.actionButton)},l.action.label):null)};function Sr(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function cn(t,a){const r={};return[t,a].forEach((s,n)=>{const i=n===1,o=i?"--mobile-offset":"--offset",d=i?tn:en;function p(u){["top","right","bottom","left"].forEach(c=>{r[`${o}-${c}`]=typeof u=="number"?`${u}px`:u})}typeof s=="number"||typeof s=="string"?p(s):typeof s=="object"?["top","right","bottom","left"].forEach(u=>{s[u]===void 0?r[`${o}-${u}`]=d:r[`${o}-${u}`]=typeof s[u]=="number"?`${s[u]}px`:s[u]}):p(d)}),r}const kr=L.forwardRef(function(a,r){const{invert:s,position:n="bottom-right",hotkey:i=["altKey","KeyT"],expand:o,closeButton:d,className:p,offset:u,mobileOffset:c,theme:l="light",richColors:h,duration:y,style:b,visibleToasts:v=Za,toastOptions:C,dir:T=Sr(),gap:P=sn,icons:E,containerAriaLabel:R="Notifications"}=a,[G,W]=L.useState([]),g=L.useMemo(()=>Array.from(new Set([n].concat(G.filter(Y=>Y.position).map(Y=>Y.position)))),[G,n]),[f,k]=L.useState([]),[I,x]=L.useState(!1),[S,j]=L.useState(!1),[N,F]=L.useState(l!=="system"?l:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),_=L.useRef(null),B=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),w=L.useRef(null),U=L.useRef(!1),te=L.useCallback(Y=>{W(Q=>{var M;return(M=Q.find(K=>K.id===Y.id))!=null&&M.delete||ye.dismiss(Y.id),Q.filter(({id:K})=>K!==Y.id)})},[]);return L.useEffect(()=>ye.subscribe(Y=>{if(Y.dismiss){requestAnimationFrame(()=>{W(Q=>Q.map(M=>M.id===Y.id?{...M,delete:!0}:M))});return}setTimeout(()=>{ia.flushSync(()=>{W(Q=>{const M=Q.findIndex(K=>K.id===Y.id);return M!==-1?[...Q.slice(0,M),{...Q[M],...Y},...Q.slice(M+1)]:[Y,...Q]})})})}),[G]),L.useEffect(()=>{if(l!=="system"){F(l);return}if(l==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?F("dark"):F("light")),typeof window>"u")return;const Y=window.matchMedia("(prefers-color-scheme: dark)");try{Y.addEventListener("change",({matches:Q})=>{F(Q?"dark":"light")})}catch{Y.addListener(({matches:M})=>{try{F(M?"dark":"light")}catch(K){console.error(K)}})}},[l]),L.useEffect(()=>{G.length<=1&&x(!1)},[G]),L.useEffect(()=>{const Y=Q=>{var M;if(i.every(O=>Q[O]||Q.code===O)){var H;x(!0),(H=_.current)==null||H.focus()}Q.code==="Escape"&&(document.activeElement===_.current||(M=_.current)!=null&&M.contains(document.activeElement))&&x(!1)};return document.addEventListener("keydown",Y),()=>document.removeEventListener("keydown",Y)},[i]),L.useEffect(()=>{if(_.current)return()=>{w.current&&(w.current.focus({preventScroll:!0}),w.current=null,U.current=!1)}},[_.current]),L.createElement("section",{ref:r,"aria-label":`${R} ${B}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},g.map((Y,Q)=>{var M;const[K,H]=Y.split("-");return G.length?L.createElement("ol",{key:Y,dir:T==="auto"?Sr():T,tabIndex:-1,ref:_,className:p,"data-sonner-toaster":!0,"data-sonner-theme":N,"data-y-position":K,"data-lifted":I&&G.length>1&&!o,"data-x-position":H,style:{"--front-toast-height":`${((M=f[0])==null?void 0:M.height)||0}px`,"--width":`${rn}px`,"--gap":`${P}px`,...b,...cn(u,c)},onBlur:O=>{U.current&&!O.currentTarget.contains(O.relatedTarget)&&(U.current=!1,w.current&&(w.current.focus({preventScroll:!0}),w.current=null))},onFocus:O=>{O.target instanceof HTMLElement&&O.target.dataset.dismissible==="false"||U.current||(U.current=!0,w.current=O.relatedTarget)},onMouseEnter:()=>x(!0),onMouseMove:()=>x(!0),onMouseLeave:()=>{S||x(!1)},onDragEnd:()=>x(!1),onPointerDown:O=>{O.target instanceof HTMLElement&&O.target.dataset.dismissible==="false"||j(!0)},onPointerUp:()=>j(!1)},G.filter(O=>!O.position&&Q===0||O.position===Y).map((O,J)=>{var ne,ee;return L.createElement(ln,{key:O.id,icons:E,index:J,toast:O,defaultRichColors:h,duration:(ne=C==null?void 0:C.duration)!=null?ne:y,className:C==null?void 0:C.className,descriptionClassName:C==null?void 0:C.descriptionClassName,invert:s,visibleToasts:v,closeButton:(ee=C==null?void 0:C.closeButton)!=null?ee:d,interacting:S,position:Y,style:C==null?void 0:C.style,unstyled:C==null?void 0:C.unstyled,classNames:C==null?void 0:C.classNames,cancelButtonStyle:C==null?void 0:C.cancelButtonStyle,actionButtonStyle:C==null?void 0:C.actionButtonStyle,closeButtonAriaLabel:C==null?void 0:C.closeButtonAriaLabel,removeToast:te,toasts:G.filter(pe=>pe.position==O.position),heights:f.filter(pe=>pe.position==O.position),setHeights:k,expandByDefault:o,gap:P,expanded:I,swipeDirections:a.swipeDirections})})):null}))}),st=t=>{const a="/Chat-App/",r=a.startsWith("/")?a:`/${a}`,s=r.endsWith("/")?r:`${r}/`,n=t.startsWith("/")?t.substring(1):t;return`${s}${n}`},Ve=[{id:"whistle",name:"Whistle Chime",url:st("sounds/whistle.mp3")},{id:"bell",name:"Success Bell",url:st("sounds/bell.mp3")},{id:"note",name:"Electronic Note",url:st("sounds/note.mp3")},{id:"digital",name:"Digital Alert",url:st("sounds/digital.mp3")}];class dn{async getCameraPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"camera"})).state}catch{return"unknown"}}async requestCameraPermission(){try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(r=>r.stop()),!0}catch(a){return console.error("Camera permission denied",a),!1}}async getMicPermission(){if(!navigator.permissions||!navigator.permissions.query)return"unknown";try{return(await navigator.permissions.query({name:"microphone"})).state}catch{return"unknown"}}async requestMicPermission(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(r=>r.stop()),!0}catch(a){return console.error("Mic permission denied",a),!1}}async getNotificationPermission(){return"Notification"in window?Notification.permission:"denied"}async requestNotificationPermission(a){return"Notification"in window?await Notification.requestPermission()==="granted":(a&&Z.error("Notifications not supported"),!1)}isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}isPWA(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}vibrate(a=200){"vibrate"in navigator&&navigator.vibrate(a)}}const jt=new dn;function un(){const[t,a]=m.useState(null),[r,s]=m.useState(!0),[n,i]=m.useState("login"),o=m.useRef(null),d=m.useRef(!1),p=m.useRef(!1);m.useEffect(()=>{r||(p.current=!0)},[r]);const u=async l=>{var h;if(d.current)return null;if(o.current===l&&t)return s(!1),t;d.current=!0,console.log("ðŸ“¥ Fetching profile for:",l);try{const{data:y,error:b}=await X.from("profiles").select("*").eq("id",l).single();if(b)return console.error("âŒ Profile fetch error:",b),(b.code==="PGRST116"||(h=b.message)!=null&&h.includes("406"))&&(console.warn("Profile missing for user. Logging out to clear stale session."),await X.auth.signOut(),a(null),o.current=null),null;console.log("âœ… Profile fetched successfully");const v={id:y.id,username:y.username,name:y.display_name||y.username,avatar_url:y.avatar_url};return o.current=l,(!t||t.id!==v.id||t.username!==v.username||t.name!==v.name||t.avatar_url!==v.avatar_url)&&(console.log("ðŸ‘¤ Updating currentUser state (reference change)"),a(v)),y.display_name||i("signup"),v}finally{d.current=!1,s(!1)}},c=async()=>{await X.auth.signOut(),a(null),localStorage.removeItem("chat_app_view"),localStorage.removeItem("chat_app_selected_chat")};return m.useEffect(()=>{console.log("ðŸ”Œ useAuth effect started");let l=!0;const h=setTimeout(()=>{l&&!p.current&&(console.warn("âš ï¸ Auth check timed out, forcing load completion"),s(!1))},12e3);console.log("ðŸ” Checking initial session..."),X.auth.getSession().then(({data:{session:b}})=>{console.log("ðŸ“„ Session result:",b?"Found":"Not Found"),l&&(b?u(b.user.id):s(!1))}).catch(b=>{console.error("âŒ Session check failed:",b),l&&s(!1)});const{data:{subscription:y}}=X.auth.onAuthStateChange((b,v)=>{console.log("ðŸ”„ Auth state changed:",b),l&&(v?u(v.user.id):(a(null),i("login"),s(!1)))});return()=>{l=!1,clearTimeout(h),y.unsubscribe()}},[]),{currentUser:t,setCurrentUser:a,isLoading:r,setIsLoading:s,loginStep:n,setLoginStep:i,fetchProfile:u,logout:c}}function mn(t){const[a,r]=m.useState([]),[s,n]=m.useState(!1),[i,o]=m.useState(null),[d,p]=m.useState([]),u=m.useRef(null),c=m.useRef(0);m.useEffect(()=>{u.current=i},[i]);const l=m.useCallback(async g=>{if(g){console.log("ðŸ“¨ loadChats started for:",g),n(!0);try{const{data:f,error:k}=await X.from("conversation_participants").select(`
          conversation_id,
          conversations (
              id,
              last_message_text,
              last_message_at
          )
        `).eq("user_id",g);if(k)throw k;const I=f.map(_=>_.conversation_id);let x=[],S={};if(I.length>0){const{data:_,error:B}=await X.from("conversation_participants").select(`
            conversation_id,
            user_id,
            profiles (id, display_name, avatar_url)
          `).in("conversation_id",I).neq("user_id",g);if(B)throw B;x=_||[];const{data:w}=await X.from("messages").select("conversation_id").eq("is_read",!1).neq("sender_id",g).in("conversation_id",I);w==null||w.forEach(U=>{S[U.conversation_id]=(S[U.conversation_id]||0)+1})}const j=f.map(_=>{var U,te;const B=x.find(Y=>Y.conversation_id===_.conversation_id),w=B!=null&&B.profiles&&!Array.isArray(B.profiles)?B.profiles.display_name:"Unknown User";return{id:_.conversation_id,partnerId:(B==null?void 0:B.user_id)||"unknown",partnerName:w,partnerAvatar:B!=null&&B.profiles&&!Array.isArray(B.profiles)?B.profiles.avatar_url:void 0,lastMessage:((U=_.conversations)==null?void 0:U.last_message_text)||"",lastMessageTime:((te=_.conversations)==null?void 0:te.last_message_at)||"",unreadCount:S[_.conversation_id]||0,isGroup:!1}});let N=[];try{const{data:_,error:B}=await X.from("group_members").select(`
              group_id,
              groups (id, name, updated_at)
            `).eq("user_id",g);if(!B&&_&&_.length>0){const w=_.map(Q=>Q.group_id),{data:U}=await X.from("group_messages").select("group_id").eq("is_read",!1).neq("sender_id",g).in("group_id",w),te={};U==null||U.forEach(Q=>{te[Q.group_id]=(te[Q.group_id]||0)+1});const{data:Y}=await X.from("group_messages").select("group_id, text, created_at").in("group_id",w).order("created_at",{ascending:!1});N=_.map(Q=>{const M=Q.groups,K=Y==null?void 0:Y.find(H=>H.group_id===M.id);return{id:M.id,partnerId:M.id,partnerName:M.name,partnerAvatar:void 0,lastMessage:(K==null?void 0:K.text)||"No messages yet",lastMessageTime:(K==null?void 0:K.created_at)||M.updated_at,unreadCount:te[M.id]||0,isGroup:!0}})}}catch(_){console.warn("Group fetch error:",_)}const F=[...j,...N].sort((_,B)=>{const w=new Date(_.lastMessageTime).getTime();return new Date(B.lastMessageTime).getTime()-w});r(F),c.current=F.reduce((_,B)=>_+B.unreadCount,0)}catch(f){console.error("Error loading chats:",f),f.code==="42P17"&&Z.error("Database Error: Recursive policy detected. Please run the SQL fix.")}finally{n(!1)}}},[]),h=async(g,f,k=!1)=>{k?await X.from("group_messages").update({is_read:!0}).eq("group_id",g).neq("sender_id",f).eq("is_read",!1):await X.from("messages").update({is_read:!0}).eq("conversation_id",g).neq("sender_id",f).eq("is_read",!1)},y=m.useCallback(async(g,f=!1)=>{var S,j;if(g!==((S=u.current)==null?void 0:S.id)||!g)return;let k,I;if(f){const N=await X.from("group_messages").select("*").eq("group_id",g).order("created_at",{ascending:!1}).limit(50);k=N.data?N.data.reverse():[],I=N.error}else{const N=await X.from("messages").select("*").eq("conversation_id",g).order("created_at",{ascending:!1}).limit(50);k=N.data?N.data.reverse():[],I=N.error}if(I){console.error("Error loading messages:",I);return}if(g!==((j=u.current)==null?void 0:j.id))return;const x=(k||[]).map(N=>({id:N.id,senderId:N.sender_id,text:N.text,fileUrl:N.file_url,fileType:N.file_type,fileName:N.file_name,timestamp:N.created_at,isRead:N.is_read||!1,replyToId:N.reply_to_id,reactions:N.reactions||{},poll:N.poll}));p(N=>{const F=N.filter(w=>w.isOptimistic),_=new Set(x.map(w=>w.id)),B=F.filter(w=>!_.has(w.id));return[...x,...B]}),t&&t.id&&h(g,t.id,f)},[t==null?void 0:t.id]);m.useEffect(()=>{t!=null&&t.id?(console.log("ðŸš€ useChats auto-loading for:",t.id),l(t.id).then(()=>{const g=localStorage.getItem("chat_app_selected_chat");if(g&&!u.current)try{const f=JSON.parse(g);console.log("ðŸ•¯ï¸ Restoring saved chat:",f.id),o(f),y(f.id,f.isGroup)}catch(f){console.error("Failed to parse saved chat",f)}})):(console.log("Emptying chats as no user is present"),r([]))},[t==null?void 0:t.id,l,y]);const b=m.useCallback(g=>{o(g),r(f=>f.map(k=>k.id===g.id?{...k,unreadCount:0}:k)),y(g.id,g.isGroup),localStorage.setItem("chat_app_selected_chat",JSON.stringify(g)),t!=null&&t.id&&h(g.id,t.id,g.isGroup)},[y,t]),v=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){const f=Math.random()*16|0;return(g==="x"?f:f&3|8).toString(16)}),C=m.useCallback(async(g,f)=>{p(k=>k.filter(I=>I.id!==g));try{const k=f?"group_messages":"messages";await X.from(k).delete().eq("id",g)}catch(k){console.error("Error deleting message:",k)}},[]),T=m.useCallback(async(g,f,k,I,x,S,j)=>{var _,B,w;if(!t)return;const N=v(),F={id:N,senderId:t.id,text:f,fileUrl:k,fileType:I,fileName:x,timestamp:new Date().toISOString(),isRead:!1,isOptimistic:!0,replyToId:S};((_=u.current)==null?void 0:_.id)===g.id&&p(U=>[...U,F]);try{let U,te;if(g.isGroup){const Y=await X.from("group_messages").insert({id:N,group_id:g.id,sender_id:t.id,text:f,file_url:k,file_type:I,file_name:x,reply_to_id:S}).select().single();U=Y.data,te=Y.error}else{const Y=await X.from("messages").insert({id:N,conversation_id:g.id,sender_id:t.id,text:f,file_url:k,file_type:I,file_name:x,reply_to_id:S}).select().single();U=Y.data,te=Y.error}if(te)throw te;U&&(((B=u.current)==null?void 0:B.id)===g.id&&p(Y=>Y.map(Q=>Q.id===N?{...Q,isOptimistic:!1}:Q)),j&&j>0&&setTimeout(()=>C(N,g.isGroup),j*1e3),g.isGroup||await X.from("conversations").update({last_message_text:f,last_message_at:new Date().toISOString()}).eq("id",g.id))}catch(U){console.error("Error sending message:",U),((w=u.current)==null?void 0:w.id)===g.id&&p(te=>te.filter(Y=>Y.id!==N)),Z.error("Failed to send message")}},[t,C]),P=m.useCallback(async(g,f,k,I,x,S)=>{u.current&&await T(u.current,g,f,k,I,x,S)},[T]),E=async(g,f)=>{if(t){r(k=>k.map(I=>I.id===g?{...I,isPinned:f}:I));try{f?await X.from("pinned_conversations").insert({user_id:t.id,conversation_id:g}):await X.from("pinned_conversations").delete().eq("user_id",t.id).eq("conversation_id",g)}catch(k){console.error("Error pinning chat:",k)}}},R=m.useCallback(async(g,f)=>{if(!t||!u.current)return;const k=u.current,I={question:g,options:f,votes:{}},x=k.isGroup?"group_messages":"messages",S=k.isGroup?"group_id":"conversation_id",j={id:Math.random().toString(36).substring(7),senderId:t.id,text:`Poll: ${g}`,timestamp:new Date().toISOString(),isRead:!1,poll:I};p(N=>[...N,j]);try{const{error:N}=await X.from(x).insert({[S]:k.id,sender_id:t.id,text:`Poll: ${g}`,poll:I});if(N)throw N}catch(N){console.error("Poll error:",N)}},[t]),G=m.useCallback((g,f,k)=>{console.log("ðŸ“© useChats: Incoming message received:",g.id,"for chatId:",k),p(I=>{if(I.find(j=>j.id===g.id))return console.log("â™»ï¸ useChats: Message already exists, skipping."),I;const x=u.current,S=k||(f?g.group_id:g.conversation_id);return console.log("ðŸ§ useChats: Matching...",{msgChatId:S,currentChatId:x==null?void 0:x.id}),t&&g.senderId!==t.id&&x&&S===x.id&&(console.log("ðŸ‘ï¸ useChats: Auto-marking as read"),h(x.id,t.id,f)),x&&S===x.id?(console.log("âœ¨ useChats: Appending message to state"),[...I,g]):(console.log("â­ï¸ useChats: Message not for current chat, ignoring append."),I)})},[t,h]),W=m.useCallback(g=>{p(f=>f.map(k=>k.id===g.id?g:k))},[]);return{chats:a,setChats:r,isLoading:s,selectedChat:i,setSelectedChat:o,messages:d,setMessages:p,loadChats:l,loadMessages:y,handleSelectChat:b,selectedChatRef:u,markMessagesAsRead:h,handleSendMessage:P,handleDeleteMessage:C,handlePinChat:E,handleSendPoll:R,handleIncomingMessage:G,handleIncomingUpdate:W,sendMessageToChat:T}}function pn({currentUser:t,soundEnabled:a}){const[r,s]=m.useState(null),n=m.useRef(null),i=m.useRef(null),o=m.useRef(null);m.useEffect(()=>{o.current=r},[r]),m.useEffect(()=>(n.current=new Audio(st("sounds/ringtone.mp3")),n.current.loop=!0,n.current.load(),()=>{var v;(v=n.current)==null||v.pause()}),[]);const d=m.useCallback((v,C,T)=>{(i.current||X.channel("chat-realtime-global")).send({type:"broadcast",event:C,payload:{...T,recipientId:v}})},[]),p=async(v,C,T)=>{if(!t)return;const E={id:Math.random().toString(36).substring(7),callerId:t.id,callerName:t.name||t.username,recipientId:v,type:T,status:"ringing"};s(E)},u=async()=>{var v;r&&(s(C=>C?{...C,status:"connecting"}:null),(v=n.current)==null||v.pause())},c=m.useCallback(()=>{var C;const v=o.current;v&&(d(v.callerId,"call-ended",{id:v.id}),s(null),(C=n.current)==null||C.pause(),n.current&&(n.current.currentTime=0))},[d]),l=m.useCallback(v=>{if(v.recipientId===t.id){if(o.current){d(v.callerId,"call-ended",{id:v.id,reason:"busy"});return}a&&n.current&&n.current.play().catch(console.error),s({id:v.id,callerId:v.callerId,callerName:v.callerName,recipientId:v.recipientId,type:v.type,status:"ringing",offer:v.offer,iceCandidates:[]})}},[t==null?void 0:t.id,a,d]),h=m.useCallback(v=>{var C;v.recipientId===t.id&&(s(T=>T&&T.id===v.id?{...T,status:"connected",answer:v.answer}:T),(C=n.current)==null||C.pause())},[t==null?void 0:t.id]),y=m.useCallback(v=>{v.recipientId===t.id&&s(C=>C&&C.id===v.id?{...C,iceCandidates:[...C.iceCandidates||[],v.candidate]}:C)},[t==null?void 0:t.id]),b=m.useCallback(v=>{var C;s(T=>T&&T.id===v.id?(Z.info("Call ended"),null):T),(C=n.current)==null||C.pause(),n.current&&(n.current.currentTime=0)},[]);return{activeCall:r,setActiveCall:s,handleStartCall:p,handleAcceptCall:u,handleRejectCall:c,sendSignalingMessage:d,handleIncomingCall:l,handleCallAnswer:h,handleIceCandidate:y,handleCallEnded:b}}function fn({currentUser:t,selectedChatRef:a,onNewMessage:r,onUpdateMessage:s,onReloadChats:n,soundEnabled:i,onIncomingCall:o,onCallAnswer:d,onIceCandidate:p,onCallEnded:u}){const[c,l]=m.useState(new Set),[h,y]=m.useState({}),b=m.useRef(null),v=m.useRef(null),C=m.useRef(null),T=m.useRef(r),P=m.useRef(s),E=m.useRef(n);m.useEffect(()=>{T.current=r,P.current=s,E.current=n},[r,s,n]);const[R,G]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||Ve[0].id);m.useEffect(()=>{localStorage.setItem("chat_app_sound_id",R);const x=Ve.find(S=>S.id===R)||Ve[0];b.current=new Audio(x.url),b.current.load(),v.current=new Audio(st("sounds/ringtone.mp3")),v.current.loop=!0,v.current.load()},[R]);const W=()=>{b.current&&i&&(b.current.currentTime=0,b.current.play().catch(x=>console.log("Sound play failed:",x)))};m.useEffect(()=>{if(!t)return;const x="chat-realtime-global";console.log(`ðŸ”Œ Subscribing to GLOBAL channel: ${x}`);const S=X.channel(x);return C.current=S,S.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},j=>{console.log("ðŸ“¥ [DEBUG] Postgres INSERT messages:",j),g(j.new,!1)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},j=>{console.log("ðŸ“¥ [DEBUG] Postgres INSERT group_messages:",j),g(j.new,!0)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},j=>{f(j.new,!1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"group_messages"},j=>{f(j.new,!0)}).on("postgres_changes",{event:"*",schema:"public",table:"conversations"},j=>{console.log("ðŸ”„ Conversation updated, reloading chats..."),E.current()}).on("postgres_changes",{event:"*",schema:"public",table:"group_members"},()=>E.current()).on("presence",{event:"sync"},()=>{const j=S.presenceState(),N=new Set;Object.values(j).forEach(F=>{F.forEach(_=>N.add(_.user_id))}),l(N),console.log("ðŸ‘¥ Online Users updated:",Array.from(N))}).on("broadcast",{event:"typing"},({payload:j})=>{j.partner_id===t.id&&y(N=>({...N,[j.user_id]:j.isTyping}))}).on("broadcast",{event:"call-offer"},({payload:j})=>{j.recipientId===t.id&&o&&(i&&v.current&&v.current.play().catch(console.error),o(j))}).on("broadcast",{event:"call-answer"},({payload:j})=>{var N;j.recipientId===t.id&&d&&(d(j),(N=v.current)==null||N.pause())}).on("broadcast",{event:"ice-candidate"},({payload:j})=>{j.recipientId===t.id&&p&&p(j)}).on("broadcast",{event:"call-ended"},({payload:j})=>{var N;(j.recipientId===t.id||j.callerId===t.id)&&(u&&u(j),(N=v.current)==null||N.pause(),v.current&&(v.current.currentTime=0))}).subscribe(async j=>{console.log(`ðŸ“¡ Subscription status for ${x}:`,j),j==="SUBSCRIBED"&&await S.track({user_id:t.id,online_at:new Date().toISOString()}),j==="CHANNEL_ERROR"&&(console.error("ðŸš· Realtime subscription error. Retrying in 5s..."),setTimeout(()=>E.current(),5e3))}),()=>{var j;console.log(`ðŸ”Œ Unsubscribing from ${x}`),S.unsubscribe(),(j=v.current)==null||j.pause()}},[t==null?void 0:t.id,i]);const g=(x,S)=>{const j=a.current;console.log("ðŸ“© Raw Realtime Message:",x),console.log("ðŸ’¬ Current Chat in Ref:",j==null?void 0:j.id,"isGroup:",j==null?void 0:j.isGroup);const N={id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read||!1,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},F=x.group_id||x.conversation_id,_=!!j&&j.id===F;console.log(`ðŸ” Comparison Result: ${_?"âœ… MATCH":"âŒ NO MATCH"} (MsgChat: ${F} vs Current: ${j==null?void 0:j.id})`),_?(console.log("âœ… [MATCH] Updating UI for current chat:",F),T.current(N,S,F)):console.log("âŒ [MISMATCH] Message for chat:",F,"Current:",j==null?void 0:j.id),x.sender_id!==(t==null?void 0:t.id)&&W(),E.current()},f=(x,S)=>{const j=a.current;(S?(j==null?void 0:j.isGroup)&&j.id===x.group_id:!(j!=null&&j.isGroup)&&(j==null?void 0:j.id)===x.conversation_id)&&P.current({id:x.id,senderId:x.sender_id,text:x.text,fileUrl:x.file_url,fileType:x.file_type,fileName:x.file_name,timestamp:x.created_at,isRead:x.is_read,replyToId:x.reply_to_id,reactions:x.reactions||{},poll:x.poll},S)};return{onlineUsers:c,typingUsers:h,sendTypingIndicator:(x,S)=>{var j;(j=C.current)==null||j.send({type:"broadcast",event:"typing",payload:{user_id:t==null?void 0:t.id,partner_id:S,isTyping:x}})},sendSignalingMessage:(x,S,j)=>{C.current&&C.current.send({type:"broadcast",event:S,payload:{...j,recipientId:x}})},notificationSounds:Ve,currentSoundId:R,setCurrentSoundId:G,ringtoneSoundRef:v}}function ss(t){var a,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(a=0;a<n;a++)t[a]&&(r=ss(t[a]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function fr(){for(var t,a,r=0,s="",n=arguments.length;r<n;r++)(t=arguments[r])&&(a=ss(t))&&(s&&(s+=" "),s+=a);return s}const _r=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Tr=fr,hn=(t,a)=>r=>{var s;if((a==null?void 0:a.variants)==null)return Tr(t,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:n,defaultVariants:i}=a,o=Object.keys(n).map(u=>{const c=r==null?void 0:r[u],l=i==null?void 0:i[u];if(c===null)return null;const h=_r(c)||_r(l);return n[u][h]}),d=r&&Object.entries(r).reduce((u,c)=>{let[l,h]=c;return h===void 0||(u[l]=h),u},{}),p=a==null||(s=a.compoundVariants)===null||s===void 0?void 0:s.reduce((u,c)=>{let{class:l,className:h,...y}=c;return Object.entries(y).every(b=>{let[v,C]=b;return Array.isArray(C)?C.includes({...i,...d}[v]):{...i,...d}[v]===C})?[...u,l,h]:u},[]);return Tr(t,o,p,r==null?void 0:r.class,r==null?void 0:r.className)},hr="-",xn=t=>{const a=bn(t),{conflictingClassGroups:r,conflictingClassGroupModifiers:s}=t;return{getClassGroupId:o=>{const d=o.split(hr);return d[0]===""&&d.length!==1&&d.shift(),as(d,a)||gn(o)},getConflictingClassGroupIds:(o,d)=>{const p=r[o]||[];return d&&s[o]?[...p,...s[o]]:p}}},as=(t,a)=>{var o;if(t.length===0)return a.classGroupId;const r=t[0],s=a.nextPart.get(r),n=s?as(t.slice(1),s):void 0;if(n)return n;if(a.validators.length===0)return;const i=t.join(hr);return(o=a.validators.find(({validator:d})=>d(i)))==null?void 0:o.classGroupId},Rr=/^\[(.+)\]$/,gn=t=>{if(Rr.test(t)){const a=Rr.exec(t)[1],r=a==null?void 0:a.substring(0,a.indexOf(":"));if(r)return"arbitrary.."+r}},bn=t=>{const{theme:a,classGroups:r}=t,s={nextPart:new Map,validators:[]};for(const n in r)Qt(r[n],s,n,a);return s},Qt=(t,a,r,s)=>{t.forEach(n=>{if(typeof n=="string"){const i=n===""?a:Pr(a,n);i.classGroupId=r;return}if(typeof n=="function"){if(vn(n)){Qt(n(s),a,r,s);return}a.validators.push({validator:n,classGroupId:r});return}Object.entries(n).forEach(([i,o])=>{Qt(o,Pr(a,i),r,s)})})},Pr=(t,a)=>{let r=t;return a.split(hr).forEach(s=>{r.nextPart.has(s)||r.nextPart.set(s,{nextPart:new Map,validators:[]}),r=r.nextPart.get(s)}),r},vn=t=>t.isThemeGetter,yn=t=>{if(t<1)return{get:()=>{},set:()=>{}};let a=0,r=new Map,s=new Map;const n=(i,o)=>{r.set(i,o),a++,a>t&&(a=0,s=r,r=new Map)};return{get(i){let o=r.get(i);if(o!==void 0)return o;if((o=s.get(i))!==void 0)return n(i,o),o},set(i,o){r.has(i)?r.set(i,o):n(i,o)}}},Zt="!",er=":",jn=er.length,wn=t=>{const{prefix:a,experimentalParseClassName:r}=t;let s=n=>{const i=[];let o=0,d=0,p=0,u;for(let b=0;b<n.length;b++){let v=n[b];if(o===0&&d===0){if(v===er){i.push(n.slice(p,b)),p=b+jn;continue}if(v==="/"){u=b;continue}}v==="["?o++:v==="]"?o--:v==="("?d++:v===")"&&d--}const c=i.length===0?n:n.substring(p),l=Nn(c),h=l!==c,y=u&&u>p?u-p:void 0;return{modifiers:i,hasImportantModifier:h,baseClassName:l,maybePostfixModifierPosition:y}};if(a){const n=a+er,i=s;s=o=>o.startsWith(n)?i(o.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:o,maybePostfixModifierPosition:void 0}}if(r){const n=s;s=i=>r({className:i,parseClassName:n})}return s},Nn=t=>t.endsWith(Zt)?t.substring(0,t.length-1):t.startsWith(Zt)?t.substring(1):t,Cn=t=>{const a=Object.fromEntries(t.orderSensitiveModifiers.map(s=>[s,!0]));return s=>{if(s.length<=1)return s;const n=[];let i=[];return s.forEach(o=>{o[0]==="["||a[o]?(n.push(...i.sort(),o),i=[]):i.push(o)}),n.push(...i.sort()),n}},Sn=t=>({cache:yn(t.cacheSize),parseClassName:wn(t),sortModifiers:Cn(t),...xn(t)}),kn=/\s+/,_n=(t,a)=>{const{parseClassName:r,getClassGroupId:s,getConflictingClassGroupIds:n,sortModifiers:i}=a,o=[],d=t.trim().split(kn);let p="";for(let u=d.length-1;u>=0;u-=1){const c=d[u],{isExternal:l,modifiers:h,hasImportantModifier:y,baseClassName:b,maybePostfixModifierPosition:v}=r(c);if(l){p=c+(p.length>0?" "+p:p);continue}let C=!!v,T=s(C?b.substring(0,v):b);if(!T){if(!C){p=c+(p.length>0?" "+p:p);continue}if(T=s(b),!T){p=c+(p.length>0?" "+p:p);continue}C=!1}const P=i(h).join(":"),E=y?P+Zt:P,R=E+T;if(o.includes(R))continue;o.push(R);const G=n(T,C);for(let W=0;W<G.length;++W){const g=G[W];o.push(E+g)}p=c+(p.length>0?" "+p:p)}return p};function Tn(){let t=0,a,r,s="";for(;t<arguments.length;)(a=arguments[t++])&&(r=ns(a))&&(s&&(s+=" "),s+=r);return s}const ns=t=>{if(typeof t=="string")return t;let a,r="";for(let s=0;s<t.length;s++)t[s]&&(a=ns(t[s]))&&(r&&(r+=" "),r+=a);return r};function Rn(t,...a){let r,s,n,i=o;function o(p){const u=a.reduce((c,l)=>l(c),t());return r=Sn(u),s=r.cache.get,n=r.cache.set,i=d,d(p)}function d(p){const u=s(p);if(u)return u;const c=_n(p,r);return n(p,c),c}return function(){return i(Tn.apply(null,arguments))}}const he=t=>{const a=r=>r[t]||[];return a.isThemeGetter=!0,a},is=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,os=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Pn=/^\d+\/\d+$/,En=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,In=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Mn=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,An=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Dn=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rt=t=>Pn.test(t),ae=t=>!!t&&!Number.isNaN(Number(t)),qe=t=>!!t&&Number.isInteger(Number(t)),Wt=t=>t.endsWith("%")&&ae(t.slice(0,-1)),De=t=>En.test(t),Ln=()=>!0,On=t=>In.test(t)&&!Mn.test(t),ls=()=>!1,zn=t=>An.test(t),Fn=t=>Dn.test(t),$n=t=>!q(t)&&!V(t),Gn=t=>it(t,us,ls),q=t=>is.test(t),Xe=t=>it(t,ms,On),Yt=t=>it(t,Hn,ae),Er=t=>it(t,cs,ls),Bn=t=>it(t,ds,Fn),Tt=t=>it(t,ps,zn),V=t=>os.test(t),ht=t=>ot(t,ms),qn=t=>ot(t,Wn),Ir=t=>ot(t,cs),Vn=t=>ot(t,us),Un=t=>ot(t,ds),Rt=t=>ot(t,ps,!0),it=(t,a,r)=>{const s=is.exec(t);return s?s[1]?a(s[1]):r(s[2]):!1},ot=(t,a,r=!1)=>{const s=os.exec(t);return s?s[1]?a(s[1]):r:!1},cs=t=>t==="position"||t==="percentage",ds=t=>t==="image"||t==="url",us=t=>t==="length"||t==="size"||t==="bg-size",ms=t=>t==="length",Hn=t=>t==="number",Wn=t=>t==="family-name",ps=t=>t==="shadow",Yn=()=>{const t=he("color"),a=he("font"),r=he("text"),s=he("font-weight"),n=he("tracking"),i=he("leading"),o=he("breakpoint"),d=he("container"),p=he("spacing"),u=he("radius"),c=he("shadow"),l=he("inset-shadow"),h=he("text-shadow"),y=he("drop-shadow"),b=he("blur"),v=he("perspective"),C=he("aspect"),T=he("ease"),P=he("animate"),E=()=>["auto","avoid","all","avoid-page","page","left","right","column"],R=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],G=()=>[...R(),V,q],W=()=>["auto","hidden","clip","visible","scroll"],g=()=>["auto","contain","none"],f=()=>[V,q,p],k=()=>[rt,"full","auto",...f()],I=()=>[qe,"none","subgrid",V,q],x=()=>["auto",{span:["full",qe,V,q]},qe,V,q],S=()=>[qe,"auto",V,q],j=()=>["auto","min","max","fr",V,q],N=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],F=()=>["start","end","center","stretch","center-safe","end-safe"],_=()=>["auto",...f()],B=()=>[rt,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...f()],w=()=>[t,V,q],U=()=>[...R(),Ir,Er,{position:[V,q]}],te=()=>["no-repeat",{repeat:["","x","y","space","round"]}],Y=()=>["auto","cover","contain",Vn,Gn,{size:[V,q]}],Q=()=>[Wt,ht,Xe],M=()=>["","none","full",u,V,q],K=()=>["",ae,ht,Xe],H=()=>["solid","dashed","dotted","double"],O=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>[ae,Wt,Ir,Er],ne=()=>["","none",b,V,q],ee=()=>["none",ae,V,q],pe=()=>["none",ae,V,q],Pe=()=>[ae,V,q],Ne=()=>[rt,"full",...f()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[De],breakpoint:[De],color:[Ln],container:[De],"drop-shadow":[De],ease:["in","out","in-out"],font:[$n],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[De],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[De],shadow:[De],spacing:["px",ae],text:[De],"text-shadow":[De],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",rt,q,V,C]}],container:["container"],columns:[{columns:[ae,q,V,d]}],"break-after":[{"break-after":E()}],"break-before":[{"break-before":E()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:G()}],overflow:[{overflow:W()}],"overflow-x":[{"overflow-x":W()}],"overflow-y":[{"overflow-y":W()}],overscroll:[{overscroll:g()}],"overscroll-x":[{"overscroll-x":g()}],"overscroll-y":[{"overscroll-y":g()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:k()}],"inset-x":[{"inset-x":k()}],"inset-y":[{"inset-y":k()}],start:[{start:k()}],end:[{end:k()}],top:[{top:k()}],right:[{right:k()}],bottom:[{bottom:k()}],left:[{left:k()}],visibility:["visible","invisible","collapse"],z:[{z:[qe,"auto",V,q]}],basis:[{basis:[rt,"full","auto",d,...f()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[ae,rt,"auto","initial","none",q]}],grow:[{grow:["",ae,V,q]}],shrink:[{shrink:["",ae,V,q]}],order:[{order:[qe,"first","last","none",V,q]}],"grid-cols":[{"grid-cols":I()}],"col-start-end":[{col:x()}],"col-start":[{"col-start":S()}],"col-end":[{"col-end":S()}],"grid-rows":[{"grid-rows":I()}],"row-start-end":[{row:x()}],"row-start":[{"row-start":S()}],"row-end":[{"row-end":S()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":j()}],"auto-rows":[{"auto-rows":j()}],gap:[{gap:f()}],"gap-x":[{"gap-x":f()}],"gap-y":[{"gap-y":f()}],"justify-content":[{justify:[...N(),"normal"]}],"justify-items":[{"justify-items":[...F(),"normal"]}],"justify-self":[{"justify-self":["auto",...F()]}],"align-content":[{content:["normal",...N()]}],"align-items":[{items:[...F(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...F(),{baseline:["","last"]}]}],"place-content":[{"place-content":N()}],"place-items":[{"place-items":[...F(),"baseline"]}],"place-self":[{"place-self":["auto",...F()]}],p:[{p:f()}],px:[{px:f()}],py:[{py:f()}],ps:[{ps:f()}],pe:[{pe:f()}],pt:[{pt:f()}],pr:[{pr:f()}],pb:[{pb:f()}],pl:[{pl:f()}],m:[{m:_()}],mx:[{mx:_()}],my:[{my:_()}],ms:[{ms:_()}],me:[{me:_()}],mt:[{mt:_()}],mr:[{mr:_()}],mb:[{mb:_()}],ml:[{ml:_()}],"space-x":[{"space-x":f()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":f()}],"space-y-reverse":["space-y-reverse"],size:[{size:B()}],w:[{w:[d,"screen",...B()]}],"min-w":[{"min-w":[d,"screen","none",...B()]}],"max-w":[{"max-w":[d,"screen","none","prose",{screen:[o]},...B()]}],h:[{h:["screen",...B()]}],"min-h":[{"min-h":["screen","none",...B()]}],"max-h":[{"max-h":["screen",...B()]}],"font-size":[{text:["base",r,ht,Xe]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,V,Yt]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Wt,q]}],"font-family":[{font:[qn,q,a]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,V,q]}],"line-clamp":[{"line-clamp":[ae,"none",V,Yt]}],leading:[{leading:[i,...f()]}],"list-image":[{"list-image":["none",V,q]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",V,q]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:w()}],"text-color":[{text:w()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:[ae,"from-font","auto",V,Xe]}],"text-decoration-color":[{decoration:w()}],"underline-offset":[{"underline-offset":[ae,"auto",V,q]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:f()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",V,q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",V,q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:U()}],"bg-repeat":[{bg:te()}],"bg-size":[{bg:Y()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},qe,V,q],radial:["",V,q],conic:[qe,V,q]},Un,Bn]}],"bg-color":[{bg:w()}],"gradient-from-pos":[{from:Q()}],"gradient-via-pos":[{via:Q()}],"gradient-to-pos":[{to:Q()}],"gradient-from":[{from:w()}],"gradient-via":[{via:w()}],"gradient-to":[{to:w()}],rounded:[{rounded:M()}],"rounded-s":[{"rounded-s":M()}],"rounded-e":[{"rounded-e":M()}],"rounded-t":[{"rounded-t":M()}],"rounded-r":[{"rounded-r":M()}],"rounded-b":[{"rounded-b":M()}],"rounded-l":[{"rounded-l":M()}],"rounded-ss":[{"rounded-ss":M()}],"rounded-se":[{"rounded-se":M()}],"rounded-ee":[{"rounded-ee":M()}],"rounded-es":[{"rounded-es":M()}],"rounded-tl":[{"rounded-tl":M()}],"rounded-tr":[{"rounded-tr":M()}],"rounded-br":[{"rounded-br":M()}],"rounded-bl":[{"rounded-bl":M()}],"border-w":[{border:K()}],"border-w-x":[{"border-x":K()}],"border-w-y":[{"border-y":K()}],"border-w-s":[{"border-s":K()}],"border-w-e":[{"border-e":K()}],"border-w-t":[{"border-t":K()}],"border-w-r":[{"border-r":K()}],"border-w-b":[{"border-b":K()}],"border-w-l":[{"border-l":K()}],"divide-x":[{"divide-x":K()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":K()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...H(),"hidden","none"]}],"divide-style":[{divide:[...H(),"hidden","none"]}],"border-color":[{border:w()}],"border-color-x":[{"border-x":w()}],"border-color-y":[{"border-y":w()}],"border-color-s":[{"border-s":w()}],"border-color-e":[{"border-e":w()}],"border-color-t":[{"border-t":w()}],"border-color-r":[{"border-r":w()}],"border-color-b":[{"border-b":w()}],"border-color-l":[{"border-l":w()}],"divide-color":[{divide:w()}],"outline-style":[{outline:[...H(),"none","hidden"]}],"outline-offset":[{"outline-offset":[ae,V,q]}],"outline-w":[{outline:["",ae,ht,Xe]}],"outline-color":[{outline:w()}],shadow:[{shadow:["","none",c,Rt,Tt]}],"shadow-color":[{shadow:w()}],"inset-shadow":[{"inset-shadow":["none",l,Rt,Tt]}],"inset-shadow-color":[{"inset-shadow":w()}],"ring-w":[{ring:K()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:w()}],"ring-offset-w":[{"ring-offset":[ae,Xe]}],"ring-offset-color":[{"ring-offset":w()}],"inset-ring-w":[{"inset-ring":K()}],"inset-ring-color":[{"inset-ring":w()}],"text-shadow":[{"text-shadow":["none",h,Rt,Tt]}],"text-shadow-color":[{"text-shadow":w()}],opacity:[{opacity:[ae,V,q]}],"mix-blend":[{"mix-blend":[...O(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":O()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[ae]}],"mask-image-linear-from-pos":[{"mask-linear-from":J()}],"mask-image-linear-to-pos":[{"mask-linear-to":J()}],"mask-image-linear-from-color":[{"mask-linear-from":w()}],"mask-image-linear-to-color":[{"mask-linear-to":w()}],"mask-image-t-from-pos":[{"mask-t-from":J()}],"mask-image-t-to-pos":[{"mask-t-to":J()}],"mask-image-t-from-color":[{"mask-t-from":w()}],"mask-image-t-to-color":[{"mask-t-to":w()}],"mask-image-r-from-pos":[{"mask-r-from":J()}],"mask-image-r-to-pos":[{"mask-r-to":J()}],"mask-image-r-from-color":[{"mask-r-from":w()}],"mask-image-r-to-color":[{"mask-r-to":w()}],"mask-image-b-from-pos":[{"mask-b-from":J()}],"mask-image-b-to-pos":[{"mask-b-to":J()}],"mask-image-b-from-color":[{"mask-b-from":w()}],"mask-image-b-to-color":[{"mask-b-to":w()}],"mask-image-l-from-pos":[{"mask-l-from":J()}],"mask-image-l-to-pos":[{"mask-l-to":J()}],"mask-image-l-from-color":[{"mask-l-from":w()}],"mask-image-l-to-color":[{"mask-l-to":w()}],"mask-image-x-from-pos":[{"mask-x-from":J()}],"mask-image-x-to-pos":[{"mask-x-to":J()}],"mask-image-x-from-color":[{"mask-x-from":w()}],"mask-image-x-to-color":[{"mask-x-to":w()}],"mask-image-y-from-pos":[{"mask-y-from":J()}],"mask-image-y-to-pos":[{"mask-y-to":J()}],"mask-image-y-from-color":[{"mask-y-from":w()}],"mask-image-y-to-color":[{"mask-y-to":w()}],"mask-image-radial":[{"mask-radial":[V,q]}],"mask-image-radial-from-pos":[{"mask-radial-from":J()}],"mask-image-radial-to-pos":[{"mask-radial-to":J()}],"mask-image-radial-from-color":[{"mask-radial-from":w()}],"mask-image-radial-to-color":[{"mask-radial-to":w()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":R()}],"mask-image-conic-pos":[{"mask-conic":[ae]}],"mask-image-conic-from-pos":[{"mask-conic-from":J()}],"mask-image-conic-to-pos":[{"mask-conic-to":J()}],"mask-image-conic-from-color":[{"mask-conic-from":w()}],"mask-image-conic-to-color":[{"mask-conic-to":w()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:U()}],"mask-repeat":[{mask:te()}],"mask-size":[{mask:Y()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",V,q]}],filter:[{filter:["","none",V,q]}],blur:[{blur:ne()}],brightness:[{brightness:[ae,V,q]}],contrast:[{contrast:[ae,V,q]}],"drop-shadow":[{"drop-shadow":["","none",y,Rt,Tt]}],"drop-shadow-color":[{"drop-shadow":w()}],grayscale:[{grayscale:["",ae,V,q]}],"hue-rotate":[{"hue-rotate":[ae,V,q]}],invert:[{invert:["",ae,V,q]}],saturate:[{saturate:[ae,V,q]}],sepia:[{sepia:["",ae,V,q]}],"backdrop-filter":[{"backdrop-filter":["","none",V,q]}],"backdrop-blur":[{"backdrop-blur":ne()}],"backdrop-brightness":[{"backdrop-brightness":[ae,V,q]}],"backdrop-contrast":[{"backdrop-contrast":[ae,V,q]}],"backdrop-grayscale":[{"backdrop-grayscale":["",ae,V,q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[ae,V,q]}],"backdrop-invert":[{"backdrop-invert":["",ae,V,q]}],"backdrop-opacity":[{"backdrop-opacity":[ae,V,q]}],"backdrop-saturate":[{"backdrop-saturate":[ae,V,q]}],"backdrop-sepia":[{"backdrop-sepia":["",ae,V,q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":f()}],"border-spacing-x":[{"border-spacing-x":f()}],"border-spacing-y":[{"border-spacing-y":f()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",V,q]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[ae,"initial",V,q]}],ease:[{ease:["linear","initial",T,V,q]}],delay:[{delay:[ae,V,q]}],animate:[{animate:["none",P,V,q]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[v,V,q]}],"perspective-origin":[{"perspective-origin":G()}],rotate:[{rotate:ee()}],"rotate-x":[{"rotate-x":ee()}],"rotate-y":[{"rotate-y":ee()}],"rotate-z":[{"rotate-z":ee()}],scale:[{scale:pe()}],"scale-x":[{"scale-x":pe()}],"scale-y":[{"scale-y":pe()}],"scale-z":[{"scale-z":pe()}],"scale-3d":["scale-3d"],skew:[{skew:Pe()}],"skew-x":[{"skew-x":Pe()}],"skew-y":[{"skew-y":Pe()}],transform:[{transform:[V,q,"","none","gpu","cpu"]}],"transform-origin":[{origin:G()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ne()}],"translate-x":[{"translate-x":Ne()}],"translate-y":[{"translate-y":Ne()}],"translate-z":[{"translate-z":Ne()}],"translate-none":["translate-none"],accent:[{accent:w()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:w()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",V,q]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":f()}],"scroll-mx":[{"scroll-mx":f()}],"scroll-my":[{"scroll-my":f()}],"scroll-ms":[{"scroll-ms":f()}],"scroll-me":[{"scroll-me":f()}],"scroll-mt":[{"scroll-mt":f()}],"scroll-mr":[{"scroll-mr":f()}],"scroll-mb":[{"scroll-mb":f()}],"scroll-ml":[{"scroll-ml":f()}],"scroll-p":[{"scroll-p":f()}],"scroll-px":[{"scroll-px":f()}],"scroll-py":[{"scroll-py":f()}],"scroll-ps":[{"scroll-ps":f()}],"scroll-pe":[{"scroll-pe":f()}],"scroll-pt":[{"scroll-pt":f()}],"scroll-pr":[{"scroll-pr":f()}],"scroll-pb":[{"scroll-pb":f()}],"scroll-pl":[{"scroll-pl":f()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",V,q]}],fill:[{fill:["none",...w()]}],"stroke-w":[{stroke:[ae,ht,Xe,Yt]}],stroke:[{stroke:["none",...w()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},fs=Rn(Yn);function wt(...t){return fs(fr(t))}const Jn=hn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function fe({className:t,variant:a,size:r,asChild:s=!1,...n}){const i=s?oa:"button";return e.jsx(i,{"data-slot":"button",className:wt(Jn({variant:a,size:r,className:t})),...n})}const we=m.forwardRef(({className:t,type:a,...r},s)=>e.jsx("input",{ref:s,type:a,"data-slot":"input",className:wt("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r}));we.displayName="Input";function Xn({onLoginSuccess:t,initialStep:a="login",onNavigateToRegister:r,language:s,t:n}){const[i,o]=m.useState(""),[d,p]=m.useState(""),[u,c]=m.useState(""),[l,h]=m.useState(a==="signup"),[y,b]=m.useState(!1),[v,C]=m.useState(null),T=vr(0),P=vr(0),E=yr(T,{stiffness:500,damping:50}),R=yr(P,{stiffness:500,damping:50});function G({currentTarget:I,clientX:x,clientY:S}){const{left:j,top:N,width:F,height:_}=I.getBoundingClientRect();T.set((x-j)/F-.5),P.set((S-N)/_-.5)}const W=jr(R,[-.5,.5],[10,-10]),g=jr(E,[-.5,.5],[-10,10]);m.useEffect(()=>{const I=localStorage.getItem("chat_app_username"),x=localStorage.getItem("chat_app_pin");I&&x&&(o(I),p(x))},[]);const f=I=>`${I.trim().toLowerCase().replace(/\s+/g,"_")}@app.local`,k=async I=>{if(I.preventDefault(),!(!i.trim()||!d.trim())&&!(l&&!u.trim())){b(!0),C(null);try{const x=f(i);if(await new Promise(S=>setTimeout(S,800)),l){const{error:S}=await X.auth.signUp({email:x,password:d,options:{data:{username:i.trim().toLowerCase(),display_name:u.trim(),pin:d}}});if(S)throw S}else{let{error:S}=await X.auth.signInWithPassword({email:x,password:d});if(S){const j=`${i.trim().toLowerCase().replace(/\s+/g,"_")}@chatapp.local`,{error:N}=await X.auth.signInWithPassword({email:j,password:d});if(N)throw new Error(s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø±Ù…Ø² PIN ØºÙŠØ± ØµØ­ÙŠØ­":"Invalid username or PIN");S=null}localStorage.setItem("chat_app_username",i.trim()),localStorage.setItem("chat_app_pin",d)}t()}catch(x){C(x.message)}finally{b(!1)}}};return e.jsxs("div",{className:"h-screen w-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center relative group",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx(D.div,{animate:{x:[0,30,0],y:[0,-50,0],scale:[1,1.1,1]},transition:{duration:10,repeat:1/0,ease:"easeInOut"},className:"absolute -top-[10%] -left-[5%] w-[60vw] h-[60vw] bg-indigo-600/15 rounded-full blur-[120px] mix-blend-screen"}),e.jsx(D.div,{animate:{x:[0,-30,0],y:[0,50,0],scale:[1,1.2,1]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:1},className:"absolute top-[30%] -right-[5%] w-[50vw] h-[50vw] bg-violet-600/15 rounded-full blur-[100px] mix-blend-screen"}),e.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 pointer-events-none mix-blend-multiply"})]}),e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none",children:Array.from({length:20}).map((I,x)=>e.jsx(D.div,{initial:{opacity:0,scale:0},animate:{opacity:[0,.3,0],scale:[0,1,0],x:["0%",`${Math.random()*100}%`],y:["0%",`${Math.random()*100}%`]},transition:{duration:Math.random()*10+10,repeat:1/0,ease:"linear"},className:"absolute w-1 h-1 bg-indigo-400 rounded-full blur-[1px]",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},x))}),e.jsxs(D.div,{onMouseMove:G,style:{rotateX:W,rotateY:g,transformStyle:"preserve-3d"},initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},transition:{duration:.8,ease:[.16,1,.3,1]},className:"w-full max-w-md relative perspective-1000 z-10 mx-4",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-[2.5rem] blur-2xl opacity-50 group-hover:opacity-100 transition duration-1000 group-hover:duration-200"}),e.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900/40 border border-white/10 shadow-[0_0_50px_-12px_rgba(0,0,0,0.5)] rounded-[2rem] p-8 overflow-hidden transform-gpu ring-1 ring-white/10",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-indigo-500/5 via-transparent to-violet-500/5 pointer-events-none"}),e.jsx("div",{className:"absolute -top-[150%] -left-[50%] w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none animate-[shimmer_10s_infinite_linear]"}),e.jsxs("div",{className:"flex flex-col items-center mb-10 relative z-10",children:[e.jsxs(D.div,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,type:"spring"},className:"relative group/logo",children:[e.jsxs("div",{className:"w-20 h-20 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-indigo-500/40 mb-5 transform rotate-3 hover:rotate-0 transition-all duration-500",children:[e.jsx(lr,{className:"w-10 h-10 text-white fill-white/10"}),e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-2xl opacity-0 group-hover/logo:opacity-100 transition-opacity"})]}),e.jsx(D.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:3},className:"absolute -top-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-slate-900 shadow-[0_0_15px_rgba(52,211,153,0.8)]"})]}),e.jsx(D.h1,{initial:{opacity:0,filter:"blur(10px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{delay:.5},className:`text-4xl font-extrabold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-slate-400 font-outfit ${s==="ar"?"font-arabic":""}`,children:l?s==="ar"?"Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§":"Join the Flow":s==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ":"Welcome"}),e.jsx(D.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:`text-slate-400 text-sm mt-3 font-medium text-center max-w-[250px] ${s==="ar"?"font-arabic":""}`,children:l?s==="ar"?"Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø¢Ù†":"Establish your decentralized identity":s==="ar"?"ÙˆØµÙˆÙ„ Ø¢Ù…Ù† Ù„Ù…Ø­Ø§Ø¯Ø«Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©":"Secure access to your private conversations"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-5 relative z-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors animate-pulse-slow`,children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx(we,{type:"text",value:i,onChange:I=>o(I.target.value),placeholder:s==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"Username",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${s==="ar"?"font-arabic text-right":""}`,disabled:y})]}),e.jsx(xe,{mode:"popLayout",children:l&&e.jsxs(D.div,{initial:{opacity:0,height:0,y:-20},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-20},className:"group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(nt,{className:"w-5 h-5"})}),e.jsx(we,{type:"text",value:u,onChange:I=>c(I.target.value),placeholder:s==="ar"?"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±":"Display Name",className:`pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 text-lg font-medium ${s==="ar"?"font-arabic text-right":""}`,disabled:y})]})}),e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:`absolute inset-y-0 ${s==="ar"?"right-0 pr-4":"left-0 pl-4"} flex items-center pointer-events-none text-slate-500 group-focus-within:text-indigo-400 transition-colors`,children:e.jsx(Br,{className:"w-5 h-5"})}),e.jsx(we,{type:"password",inputMode:"numeric",className:"pl-12 h-14 bg-slate-950/40 border-white/5 hover:border-white/10 focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 rounded-2xl text-white placeholder:text-slate-600 transition-all duration-500 tracking-[0.5em] font-mono text-xl",maxLength:6,placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",value:d,onChange:I=>p(I.target.value),disabled:y})]})]}),e.jsx(xe,{children:v&&e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 flex items-center gap-3 backdrop-blur-md",children:[e.jsx("div",{className:`w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8)] ${s==="ar"?"ml-3":""}`}),e.jsx("span",{className:`text-red-400 text-sm font-medium leading-tight ${s==="ar"?"font-arabic":""}`,children:v})]})}),e.jsx(D.div,{initial:!1,animate:y?{scale:.98}:{scale:1},children:e.jsxs(fe,{type:"submit",disabled:y,className:"w-full h-14 bg-gradient-to-r from-indigo-600 via-indigo-500 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-bold text-lg rounded-2xl shadow-2xl shadow-indigo-600/30 border-0 relative overflow-hidden group/btn",children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 -translate-x-full group-hover/btn:translate-x-0 transition-transform duration-500"}),e.jsx("span",{className:"relative flex items-center justify-center gap-3",children:y?e.jsx(je,{className:"w-6 h-6 animate-spin"}):e.jsxs(e.Fragment,{children:[l?s==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠ":"Sign Up Free":s==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„":"Authenticate",e.jsx(la,{className:`w-5 h-5 group-hover/btn:translate-x-2 transition-transform duration-300 ${s==="ar"?"rotate-180 group-hover/btn:-translate-x-2":""}`})]})})]})}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("button",{type:"button",onClick:()=>{h(!l),C(null)},className:"text-slate-400 hover:text-white text-sm transition-all duration-300 group/link",children:l?e.jsxs("span",{className:s==="ar"?"font-arabic":"",children:[s==="ar"?"Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ":"Existing user? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:s==="ar"?"Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ":"Log in"})]}):e.jsxs("span",{className:s==="ar"?"font-arabic":"",children:[s==="ar"?"Ù‡ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ ":"New identity? ",e.jsx("span",{className:"text-indigo-400 font-bold group-hover/link:underline decoration-violet-500 underline-offset-4",children:s==="ar"?"Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†":"Sign up"})]})})})]})]}),e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"mt-8 flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-slate-700",children:[e.jsx("div",{className:"h-px w-8 bg-current"}),e.jsx("p",{className:`text-[10px] uppercase tracking-[0.3em] font-black ${s==="ar"?"font-arabic":""}`,children:s==="ar"?"Ù‚Ù†Ø§Ø© Ù…Ø´ÙØ±Ø©":"Encrypted Channel"}),e.jsx("div",{className:"h-px w-8 bg-current"})]}),e.jsx("div",{className:"flex gap-2",children:[1,2,3].map(I=>e.jsx("div",{className:"w-1 h-1 bg-slate-800 rounded-full"},I))})]})]})]})}var xr="Avatar",[Kn]=ca(xr),[Qn,hs]=Kn(xr),xs=m.forwardRef((t,a)=>{const{__scopeAvatar:r,...s}=t,[n,i]=m.useState("idle");return e.jsx(Qn,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(cr.span,{...s,ref:a})})});xs.displayName=xr;var gs="AvatarImage",bs=m.forwardRef((t,a)=>{const{__scopeAvatar:r,src:s,onLoadingStatusChange:n=()=>{},...i}=t,o=hs(gs,r),d=Zn(s,i.referrerPolicy),p=da(u=>{n(u),o.onImageLoadingStatusChange(u)});return qr(()=>{d!=="idle"&&p(d)},[d,p]),d==="loaded"?e.jsx(cr.img,{...i,ref:a,src:s}):null});bs.displayName=gs;var vs="AvatarFallback",ys=m.forwardRef((t,a)=>{const{__scopeAvatar:r,delayMs:s,...n}=t,i=hs(vs,r),[o,d]=m.useState(s===void 0);return m.useEffect(()=>{if(s!==void 0){const p=window.setTimeout(()=>d(!0),s);return()=>window.clearTimeout(p)}},[s]),o&&i.imageLoadingStatus!=="loaded"?e.jsx(cr.span,{...n,ref:a}):null});ys.displayName=vs;function Zn(t,a){const[r,s]=m.useState("idle");return qr(()=>{if(!t){s("error");return}let n=!0;const i=new window.Image,o=d=>()=>{n&&s(d)};return s("loading"),i.onload=o("loaded"),i.onerror=o("error"),i.src=t,a&&(i.referrerPolicy=a),()=>{n=!1}},[t,a]),r}var ei=xs,ti=bs,ri=ys;function Oe({className:t,...a}){return e.jsx(ei,{"data-slot":"avatar",className:wt("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...a})}function We({className:t,...a}){return e.jsx(ti,{"data-slot":"avatar-image",className:wt("aspect-square size-full",t),...a})}function ze({className:t,...a}){return e.jsx(ri,{"data-slot":"avatar-fallback",className:wt("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}function re(...t){return fs(fr(t))}function Mr({user:t,hasStatus:a,isAllSeen:r,statusCount:s,onClick:n,size:i="md"}){const o={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-20 h-20"}[i];return e.jsxs("div",{className:re("relative flex-shrink-0 cursor-pointer transition-transform active:scale-95",o),onClick:n,children:[a&&e.jsx("svg",{className:"absolute inset-0 w-full h-full -rotate-90 pointer-events-none",children:e.jsx("circle",{cx:"50%",cy:"50%",r:"48%",fill:"none",stroke:r?"rgba(255,255,255,0.2)":"var(--brand-color)",strokeWidth:"2",strokeDasharray:s>1?"10 2":"0",className:"transition-all duration-500"})}),e.jsx("div",{className:re("p-[3px] w-full h-full rounded-full"),children:e.jsxs(Oe,{className:"w-full h-full border border-slate-900 shadow-inner",children:[e.jsx(We,{src:t.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-slate-300",children:t.name?t.name.charAt(0).toUpperCase():"?"})]})}),!r&&a&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-950 rounded-full ring-1 ring-white/20"})]})}function si({chats:t,currentUser:a,onlineUsers:r,onSelectChat:s,onNewChat:n,onCreateGroup:i,onLogout:o,onAcceptRequest:d,onRejectRequest:p,pendingRequests:u,typingUsers:c,onSettings:l,onPinChat:h,statuses:y=[],onViewStatus:b,onAddStatus:v,language:C,t:T,isLoading:P}){const[E,R]=m.useState(""),G=m.useMemo(()=>t.filter(g=>g.partnerName.toLowerCase().includes(E.toLowerCase())||g.lastMessage.toLowerCase().includes(E.toLowerCase())).sort((g,f)=>g.isPinned&&!f.isPinned?-1:!g.isPinned&&f.isPinned?1:new Date(f.lastMessageTime).getTime()-new Date(g.lastMessageTime).getTime()),[t,E]),W=g=>{if(!g)return"";const f=new Date(g),I=new Date().getTime()-f.getTime(),x=Math.floor(I/(1e3*60*60*24));return x===0?f.toLocaleTimeString(C==="ar"?"ar-EG":"en-US",{hour:"2-digit",minute:"2-digit"}):x===1?C==="ar"?"Ø£Ù…Ø³":"Yesterday":x<7?f.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{weekday:"short"}):f.toLocaleDateString(C==="ar"?"ar-EG":"en-US",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950/95 backdrop-blur-md border-r border-white/5 w-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-brand/10 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"p-4 relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs(D.h1,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:`text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 flex items-center gap-2 ${C==="ar"?"font-arabic":""}`,children:[T("chats")," ",e.jsx("span",{className:"text-xs bg-brand/20 text-brand px-2 py-0.5 rounded-full border border-brand/30",children:t.length})]}),e.jsx("div",{className:"flex items-center gap-2",children:[{icon:bt,onClick:i,title:T("createGroup")},{icon:Xt,onClick:n,title:T("newChat")},{icon:ua,onClick:l,title:T("settings")}].map((g,f)=>e.jsx(D.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:f*.1},whileHover:{scale:1.1,backgroundColor:"rgba(255, 255, 255, 0.1)"},whileTap:{scale:.9},onClick:g.onClick,title:g.title,className:re("p-2 rounded-full transition-colors text-slate-400 hover:text-white"),children:e.jsx(g.icon,{className:"w-5 h-5"})},f))})]}),e.jsxs(D.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"flex items-center gap-4 mb-6 p-3 bg-white/5 rounded-2xl border border-white/5 hover:border-indigo-500/30 transition-colors group",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Oe,{className:"w-12 h-12 border-2 border-brand/20 group-hover:border-brand transition-colors",children:[e.jsx(We,{src:a.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name)}&background=6366f1&color=fff`}),e.jsx(ze,{className:"bg-brand text-white",children:a.name.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-brand border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-bold truncate text-base",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-brand text-xs font-medium truncate bg-brand/10 px-2 py-0.5 rounded-md",children:["@",a.username]}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`@${a.username}`),Z.success(C==="ar"?"ØªÙ… Ù†Ø³Ø® Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!":"Username copied!")},className:"text-slate-500 hover:text-white transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ma,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex gap-4 overflow-x-auto py-2 no-scrollbar mb-4 relative z-10",children:[e.jsxs(D.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] group",onClick:v,children:[e.jsx(Mr,{user:{id:a.id,name:a.name,avatar_url:a.avatar_url},hasStatus:!1,isAllSeen:!1,statusCount:0,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-500 font-medium",children:C==="ar"?"Ø­Ø§Ù„ØªÙÙŠ":"My Status"})]}),Object.entries(y.reduce((g,f)=>{const k=f.user_id;return g[k]||(g[k]=[]),g[k].push(f),g},{})).map(([g,f])=>{var k,I,x;return e.jsxs(D.div,{whileHover:{scale:1.05},className:"flex flex-col items-center gap-1 min-w-[64px] cursor-pointer",onClick:()=>{const S=f.map(j=>{var N,F;return{id:j.id,user_id:j.user_id,user_name:((N=j.profiles)==null?void 0:N.display_name)||"User",user_avatar:(F=j.profiles)==null?void 0:F.avatar_url,content_type:j.content_type,content_url:j.content_url,text:j.text,created_at:j.created_at}});b==null||b(S,0)},children:[e.jsx(Mr,{user:{id:g,name:((k=f[0].profiles)==null?void 0:k.display_name)||"User",avatar_url:(I=f[0].profiles)==null?void 0:I.avatar_url},hasStatus:!0,isAllSeen:!1,statusCount:f.length,size:"md"}),e.jsx("span",{className:"text-[10px] text-slate-300 font-medium truncate w-14 text-center",children:((x=f[0].profiles)==null?void 0:x.display_name)||"User"})]},g)})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(vt,{className:"w-4 h-4 text-slate-500 group-focus-within:text-indigo-400 transition-colors"})}),e.jsx(we,{type:"text",placeholder:T("search"),value:E,onChange:g=>R(g.target.value),className:"pl-10 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-500 h-10 transition-all font-light"})]})]}),e.jsx(xe,{children:u.length>0&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-indigo-900/20 to-violet-900/20 border border-indigo-500/20 rounded-xl p-3 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Ot,{className:"w-3 h-3 animate-bounce"}),e.jsx("span",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©":"New Requests"})]}),e.jsx("div",{className:"space-y-2",children:u.map(g=>{var f;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-slate-900/50 p-2 rounded-lg",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate",children:e.jsxs("span",{className:"text-indigo-400",children:["@",(f=g.profiles)==null?void 0:f.username]})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>d(g.id,g.sender_id),className:"p-1.5 bg-brand/20 text-brand hover:bg-brand hover:text-white rounded-md transition-colors",children:e.jsx(Le,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>p(g.id),className:"p-1.5 bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white rounded-md transition-colors",children:e.jsx(ke,{className:"w-3 h-3"})})]})]},g.id)})})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-2 space-y-1",children:P?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx(je,{className:"w-8 h-8 animate-spin text-brand mb-2"}),e.jsx("p",{className:C==="ar"?"font-arabic":"",children:C==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª...":"Loading chats..."})]}):G.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-48 text-slate-500 text-center p-4",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-4",children:e.jsx(lr,{className:"w-8 h-8 opacity-20"})}),e.jsx("p",{className:`font-medium text-slate-400 ${C==="ar"?"font-arabic":""}`,children:T("no_chats")}),e.jsx("p",{className:"text-xs mt-1 text-slate-600",children:C==="ar"?"Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¬Ø¯Ø¯.":"Start exploring to find new friends."})]}):G.map((g,f)=>{var k,I;return e.jsxs(D.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:f*.05},onClick:()=>s(g.partnerId,g.partnerName),className:"group relative flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 cursor-pointer transition-all border border-transparent hover:border-white/5 active:scale-[0.98]",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs(Oe,{className:"w-12 h-12 border border-white/10 group-hover:border-brand/50 transition-colors",children:[e.jsx(We,{src:g.partnerAvatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(g.partnerName)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-slate-300",children:g.partnerName.charAt(0).toUpperCase()})]}),!g.isGroup&&r.has(g.partnerId)&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3.5 h-3.5 bg-brand border-2 border-slate-950 rounded-full ring-2 ring-slate-950 animate-pulse"}),g.isGroup&&e.jsx("span",{className:"absolute -bottom-1 -right-1 bg-slate-800 p-1 rounded-full border border-slate-700",children:e.jsx(bt,{className:"w-3 h-3 text-brand"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[e.jsx("h3",{className:re("font-semibold truncate transition-colors text-base",g.unreadCount>0?"text-white":"text-slate-300 group-hover:text-white"),children:g.partnerName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),h(g.id,!g.isPinned)},className:re("p-1 rounded-md transition-all",g.isPinned?"text-indigo-400 opacity-100":"text-slate-600 opacity-0 group-hover:opacity-100 hover:text-white hover:bg-white/10"),children:e.jsx(nt,{className:re("w-3.5 h-3.5",g.isPinned&&"fill-indigo-400")})}),e.jsx("span",{className:re("text-[10px] flex-shrink-0 font-medium",g.unreadCount>0?"text-indigo-400":"text-slate-500"),children:W(g.lastMessageTime)})]})]}),e.jsxs("div",{className:"flex justify-between items-center h-5",children:[e.jsx("div",{className:"flex-1 min-w-0 pr-2",children:c[g.partnerId]?e.jsxs("p",{className:"text-brand text-xs font-bold flex items-center gap-1",children:[C==="ar"?"ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†":"typing",e.jsxs("span",{className:"flex gap-0.5 pt-1",children:[e.jsx(D.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:0},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(D.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.2},className:"w-1 h-1 bg-brand rounded-full"}),e.jsx(D.span,{animate:{y:[0,-3,0]},transition:{repeat:1/0,duration:.6,delay:.4},className:"w-1 h-1 bg-brand rounded-full"})]})]}):e.jsx("p",{className:re("text-sm truncate",g.unreadCount>0?"text-slate-100 font-medium":"text-slate-500 group-hover:text-slate-400"),children:(k=g.lastMessage)!=null&&k.includes("Voice Message")||(I=g.lastMessage)!=null&&I.includes("Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©")?"ðŸŽ¤":g.lastMessage||e.jsx("span",{className:"italic text-slate-600",children:C==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„":"No messages yet"})})}),g.unreadCount>0&&e.jsx(D.div,{initial:{scale:0},animate:{scale:1},className:"bg-brand text-white text-[10px] font-bold rounded-full min-w-[20px] h-[20px] flex items-center justify-center px-1.5 shadow-lg shadow-brand/40",children:g.unreadCount})]})]})]},g.id)})})]})}const ai=m.memo(si),js=m.createContext(void 0),ni=({children:t})=>{const[a,r]=m.useState(null),s=m.useRef(new Map),n=m.useRef(null);typeof window<"u"&&!n.current&&(n.current=new Audio("/sounds/digital.mp3"));const i=m.useCallback(c=>{r(c)},[]),o=m.useCallback(c=>{r(l=>l===c?null:l)},[]),d=m.useCallback((c,l)=>{s.current.set(c,l)},[]),p=m.useCallback(c=>{s.current.delete(c)},[]),u=m.useCallback(c=>{r(null);const l=s.current.get(c);l&&(n.current&&(n.current.volume=1,n.current.play().catch(()=>{})),setTimeout(()=>{l()},500))},[]);return e.jsx(js.Provider,{value:{activeMessageId:a,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:u},children:t})},ws=()=>{const t=m.useContext(js);if(!t)throw new Error("useVoicePlayback must be used within a VoicePlaybackProvider");return t},Ns=m.createContext(void 0),tr={indigo:{name:"Royal Indigo",class:"indigo",hex:"#6366f1"},emerald:{name:"Forest Emerald",class:"emerald",hex:"#10b981"},rose:{name:"Velvet Rose",class:"rose",hex:"#f43f5e"},amber:{name:"Golden Amber",class:"amber",hex:"#f59e0b"},cyan:{name:"Ocean Cyan",class:"cyan",hex:"#06b6d4"},violet:{name:"Electric Violet",class:"violet",hex:"#8b5cf6"}};function ii({children:t}){const[a,r]=m.useState(()=>localStorage.getItem("chat_theme_color")||"indigo"),[s,n]=m.useState(()=>localStorage.getItem("chat_wallpaper")||"doodles"),[i,o]=m.useState(()=>Number(localStorage.getItem("chat_bg_opacity"))||.05);return m.useEffect(()=>{localStorage.setItem("chat_theme_color",a);const d=tr[a];document.documentElement.style.setProperty("--brand-color",d.hex)},[a]),m.useEffect(()=>{localStorage.setItem("chat_wallpaper",s)},[s]),m.useEffect(()=>{localStorage.setItem("chat_bg_opacity",String(i)),document.documentElement.style.setProperty("--bg-opacity",String(i))},[i]),e.jsx(Ns.Provider,{value:{accentColor:a,setAccentColor:r,wallpaper:s,setWallpaper:n,bgOpacity:i,setBgOpacity:o},children:t})}function Cs(){const t=m.useContext(Ns);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t}const oi=m.memo(({question:t,options:a,votes:r,currentUserId:s,onVote:n,isSent:i})=>{const o=Object.keys(r).length,d=r[s],p=u=>{const c=Object.values(r).filter(h=>h===u).length,l=o===0?0:c/o*100;return{count:c,percent:l}};return e.jsxs("div",{className:"flex flex-col gap-4 min-w-[240px] max-w-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl",children:e.jsx(bt,{className:"w-5 h-5 text-brand"})}),e.jsx("h3",{className:"text-lg font-bold text-white leading-tight",dir:"auto",children:t})]}),e.jsx("div",{className:"space-y-2",children:a.map((u,c)=>{const{count:l,percent:h}=p(c),y=d===c,b=/[\u0600-\u06FF]/.test(u);return e.jsxs("button",{onClick:()=>n(c),className:"w-full text-left group relative outline-none",dir:b?"rtl":"ltr",children:[e.jsxs("div",{className:re("relative z-10 flex items-center justify-between p-3 rounded-xl border transition-all duration-300",y?"bg-brand/30 border-brand/50 shadow-lg shadow-brand/10":"bg-white/5 border-white/5 hover:border-white/10"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:re("w-5 h-5 rounded-full border flex items-center justify-center transition-colors",y?"bg-white border-white":"border-white/20 group-hover:border-white/40"),children:y&&e.jsx(Le,{className:"w-3 h-3 text-brand stroke-[4px]"})}),e.jsx("span",{className:re("font-medium truncate",y?"text-white":"text-slate-200"),dir:"auto",children:u})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0 ml-2",children:e.jsx("span",{className:"text-xs font-bold text-slate-400",children:l})})]}),e.jsx("div",{className:"absolute inset-0 rounded-xl overflow-hidden pointer-events-none",children:e.jsx(D.div,{initial:{width:0},animate:{width:`${h}%`},transition:{type:"spring",stiffness:100,damping:20},className:re("h-full opacity-10 transition-colors",y?"bg-white":"bg-brand")})})]},c)})}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("p",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:[o," ",o===1?"Vote":"Votes"]}),e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-wider",children:d!==void 0?"Voted":"Not voted"})]})]})});function li({url:t,language:a}){const[r,s]=m.useState(null),[n,i]=m.useState(!0),[o,d]=m.useState(!1);return m.useEffect(()=>{let p=!0;return t&&(async()=>{i(!0),d(!1);try{const c=new URL(t).hostname;await new Promise(l=>setTimeout(l,1e3)),t.includes("google")||t.includes("youtube")?s({title:c==="www.youtube.com"?"YouTube Video":"Google Search",description:"Enjoy the videos and music you love, upload original content, and share it all with friends, family, and the world on YouTube.",siteName:c,image:c==="www.youtube.com"?"https://www.youtube.com/img/desktop/yt_1200.png":void 0}):s({title:c,siteName:c})}catch(c){console.error("Link preview failed:",c),d(!0)}finally{p&&i(!1)}})(),()=>{p=!1}},[t]),o||!r?null:e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"block mt-2 mb-1 max-w-sm rounded-xl overflow-hidden bg-slate-800/50 border border-white/10 hover:bg-slate-800 transition-colors group",dir:a==="ar"?"rtl":"ltr",children:n?e.jsx("div",{className:"h-24 flex items-center justify-center",children:e.jsx(je,{className:"w-5 h-5 animate-spin text-slate-500"})}):e.jsxs(e.Fragment,{children:[r.image&&e.jsx("div",{className:"w-full h-32 overflow-hidden relative bg-slate-900 border-b border-white/5",children:e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-200 line-clamp-1 mb-1",children:r.title}),r.description&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-2 mb-2",children:r.description}),e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-slate-500 uppercase tracking-wider font-medium",children:[e.jsx(Vr,{className:"w-3 h-3"}),e.jsx("span",{children:r.siteName})]})]})]})})}const ci=m.memo(({message:t,currentUserId:a,partnerName:r,isGroup:s,isSequential:n,isMenuOpen:i,onToggleMenu:o,onReact:d,onReply:p,onDelete:u,onEdit:c,onVote:l,setViewingFile:h,repliedMessage:y,language:b,t:v,formatMessageTime:C,renderFilePreview:T,onJoinGroup:P,isAnyOverlayOpen:E})=>{var k,I,x;const R=t.senderId===a,G=b==="ar",W=R&&!G||!R&&G,g=(k=t.text)==null?void 0:k.match(/(https?:\/\/[^\s]+)/),f=g?g[0]:null;return e.jsx("div",{id:`msg-${t.id}`,className:re("flex w-full mb-6",R?"justify-end":"justify-start",i&&"z-[130] relative"),children:e.jsxs("div",{className:re("relative max-w-[80%] group",R?"items-end":"items-start"),children:[s&&!R&&!n&&e.jsx("p",{className:"text-[10px] font-bold mb-1 text-brand ml-1",children:"~User"}),!E&&e.jsx("div",{className:re("absolute top-0 z-10 transition-all duration-200",W?"left-0 -translate-x-full pr-1":"right-0 translate-x-full pl-1","opacity-100"),children:e.jsx("button",{onClick:S=>{S.stopPropagation(),o(t.id)},className:re("p-1 rounded-full transition-all bg-slate-900/50 backdrop-blur-sm shadow-sm border border-white/5",i?"text-brand bg-slate-800":"text-slate-400 hover:text-white"),children:e.jsx(dr,{className:"w-3.5 h-3.5"})})}),e.jsxs("div",{className:re("px-4 py-2.5 shadow-lg relative transition-all duration-300 select-none",R?"bg-gradient-to-br from-brand via-brand to-violet-600 text-white rounded-[20px] rounded-br-[4px] shadow-brand/20":"bg-slate-800/60 backdrop-blur-md text-slate-100 border border-white/10 rounded-[20px] rounded-bl-[4px] shadow-black/20",i&&"ring-2 ring-brand ring-offset-2 ring-offset-[#0b141a]"),children:[t.replyToId&&y&&e.jsxs("div",{onClick:S=>{S.stopPropagation();const j=document.getElementById(`msg-${y.id}`);j&&(j.scrollIntoView({behavior:"smooth",block:"center"}),j.classList.add("ring-2","ring-yellow-400","ring-offset-2"),setTimeout(()=>{j.classList.remove("ring-2","ring-yellow-400","ring-offset-2")},2e3))},className:re("mb-2 p-2 rounded-lg border-l-4 cursor-pointer hover:bg-white/5 transition-colors",R?"bg-white/10 border-white/30":"bg-slate-700/50 border-brand"),children:[e.jsx("p",{className:"text-[10px] font-semibold mb-0.5 opacity-80",children:y.senderId===a?b==="ar"?"Ø£Ù†Øª":"You":r}),e.jsx("p",{className:"text-xs opacity-70 line-clamp-2",children:y.text||((I=y.fileType)!=null&&I.startsWith("image/")?b==="ar"?"ðŸ“· ØµÙˆØ±Ø©":"ðŸ“· Photo":b==="ar"?"ðŸ“Ž Ù…Ù„Ù":"ðŸ“Ž File")})]}),T(t,R),t.poll?e.jsx(oi,{question:t.poll.question,options:t.poll.options,votes:t.poll.votes,onVote:S=>l(t.id,S),currentUserId:a,isSent:R}):!(((x=t.fileType)!=null&&x.startsWith("audio/")||t.fileType==="audio")&&(t.text==="ðŸŽ¤"||t.text==="ðŸŽ¤ Voice Message"||t.text==="Voice Message"))&&e.jsx("p",{className:"text-[15px] leading-relaxed break-words whitespace-pre-wrap",children:t.text.split(/(\bhttps?:\/\/[^\s]+)/g).map((S,j)=>{if(S.match(/^https?:\/\//)){try{const N=new URL(S);if(N.searchParams.has("join"))return e.jsxs("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 font-bold underline decoration-brand decoration-2 text-brand/80 hover:text-white transition-colors bg-brand/10 px-1 rounded mx-0.5",onClick:F=>{if(F.preventDefault(),P){const _=N.searchParams.get("join");_&&P(_)}},children:[e.jsx(zt,{className:"w-3 h-3"}),"Join Group"]},j)}catch{}return e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"underline text-blue-400 hover:text-blue-300 break-all",children:S},j)}return S})}),!t.poll&&!t.fileType&&f&&e.jsx(li,{url:f,language:b}),e.jsxs("div",{className:re("flex items-center gap-1.5 mt-1 opacity-60 text-[10px]",R?"justify-end":"justify-start"),children:[e.jsx("span",{children:C(t.timestamp)}),R&&(t.isRead?e.jsx(pa,{className:"w-3 h-3 text-sky-400"}):e.jsx(Le,{className:"w-3 h-3"}))]}),t.reactions&&Object.keys(t.reactions).length>0&&e.jsx("div",{className:re("absolute -bottom-3 flex flex-wrap gap-1 z-10",R?"right-2":"left-2"),children:Object.entries(t.reactions).map(([S,j])=>e.jsxs(D.button,{initial:{scale:0},animate:{scale:1},onClick:N=>{N.stopPropagation(),d(t.id,S)},className:re("bg-slate-900/90 backdrop-blur-md border border-white/10 rounded-full px-1.5 py-0.5 text-[10px] flex items-center gap-1 shadow-lg",j.includes(a)&&"border-brand/50 bg-brand/10"),children:[e.jsx("span",{children:S}),j.length>1&&e.jsx("span",{className:"opacity-70 font-bold",children:j.length})]},S))})]}),e.jsx(xe,{children:i&&e.jsx("div",{className:re("absolute top-8 z-30",W?"right-0":"left-0"),children:e.jsxs(D.div,{initial:{opacity:0,scale:.9,x:W?20:-20},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.9,x:W?10:-10},className:"bg-slate-900/95 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl py-1.5 min-w-[120px] overflow-hidden",children:[e.jsx("div",{className:"flex px-1.5 pb-1.5 mb-1.5 border-b border-white/5 overflow-x-auto scrollbar-hide gap-1",children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ”¥"].map(S=>e.jsx("button",{onClick:()=>{d(t.id,S),o()},className:"p-1.5 hover:bg-white/10 rounded-lg transition-colors text-lg",children:S},S))}),e.jsxs("button",{onClick:()=>{p(t),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Ur,{className:"w-3.5 h-3.5"})," ",v("reply")]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{c(t.id,t.text),o()},className:"w-full text-left px-4 py-2 text-xs text-slate-300 hover:bg-white/5 flex items-center gap-2",children:[e.jsx(Hr,{className:"w-3.5 h-3.5"})," ",v("edit")]}),e.jsxs("button",{onClick:()=>{u(t.id),o()},className:"w-full text-left px-4 py-2 text-xs text-red-400 hover:bg-red-500/10 flex items-center gap-2",children:[e.jsx(ur,{className:"w-3.5 h-3.5"})," ",v("delete")]})]})]})})})]})})}),Pt=[{id:"1",title:"Funny Cat",url:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif",preview:"https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif"},{id:"2",title:"Excited",url:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif",preview:"https://media.giphy.com/media/oF5oUYTOhvFnO/giphy.gif"},{id:"3",title:"Sad",url:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif",preview:"https://media.giphy.com/media/AppsVc28eYkfS/giphy.gif"},{id:"4",title:"Thumbs Up",url:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif",preview:"https://media.giphy.com/media/111ebonMs90YLu/giphy.gif"},{id:"5",title:"Dancing",url:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif",preview:"https://media.giphy.com/media/blSTtZehjAZ8I/giphy.gif"},{id:"6",title:"Mind Blown",url:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif",preview:"https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif"},{id:"7",title:"Applause",url:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif",preview:"https://media.giphy.com/media/Anyd8oskpTJuq9OVn1/giphy.gif"},{id:"8",title:"Laughing",url:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif",preview:"https://media.giphy.com/media/ZqlvCTNHpqrio/giphy.gif"}];function di({onSelect:t,onClose:a,language:r}){const[s,n]=m.useState(""),[i,o]=m.useState(Pt),[d,p]=m.useState(!1);return m.useEffect(()=>{if(!s){o(Pt);return}const u=setTimeout(()=>{p(!0);const c=Pt.filter(h=>h.title.toLowerCase().includes(s.toLowerCase())),l=c.length>0?c:Pt.slice(0,4);o(l),p(!1)},500);return()=>clearTimeout(u)},[s]),e.jsxs("div",{className:"w-full h-full flex flex-col bg-slate-900 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-white/5 relative",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",value:s,onChange:u=>n(u.target.value),placeholder:r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† GIF...":"Search GIF...",className:"w-full bg-slate-800 text-white rounded-lg pl-9 pr-4 py-2 text-sm border-none focus:ring-1 focus:ring-brand placeholder:text-slate-500",autoFocus:!0})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:d?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(je,{className:"w-6 h-6 animate-spin text-brand"})}):e.jsxs(e.Fragment,{children:[!s&&e.jsxs("div",{className:"text-xs font-bold text-slate-500 mb-2 px-1 uppercase tracking-wider flex items-center gap-1",children:[e.jsx(nt,{className:"w-3 h-3 text-yellow-500"})," Trending"]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.map(u=>e.jsxs("button",{onClick:()=>t(u),className:"relative aspect-video rounded-lg overflow-hidden border border-white/5 hover:border-brand/50 transition-all group",children:[e.jsx("img",{src:u.preview,alt:u.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"})]},u.id))})]})}),e.jsx("div",{className:"p-2 border-t border-white/5 flex justify-center",children:e.jsx("span",{className:"text-[10px] text-slate-600 font-bold tracking-widest",children:"POWERED BY GIPHY"})})]})}function ui({repliedMessage:t,onCancel:a}){const r=()=>{var s,n,i;return(s=t.fileType)!=null&&s.startsWith("audio/")?"ðŸŽ¤":(n=t.fileType)!=null&&n.startsWith("image/")?"ðŸ“· Photo":(i=t.fileType)!=null&&i.startsWith("video/")?"ðŸŽ¥ Video":t.fileType?"ðŸ“Ž File":t.text};return e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"bg-slate-800/60 backdrop-blur-md border border-white/10 border-l-4 border-l-indigo-500 px-3 py-2 mb-2 rounded-r-lg shadow-lg relative",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ur,{className:"w-3 h-3 text-indigo-400"}),e.jsx("span",{className:"text-indigo-400 text-xs font-bold",children:t.senderName})]}),e.jsx("p",{className:"text-slate-300 text-sm truncate opacity-90",children:r()})]}),e.jsx("button",{onClick:a,className:"p-1 text-slate-400 hover:text-white hover:bg-white/10 rounded-full transition-colors flex-shrink-0",children:e.jsx(ke,{className:"w-4 h-4"})})]})})}function mi({onSend:t,onCancel:a}){const[r,s]=m.useState(0),[n,i]=m.useState(new Array(25).fill(0)),o=m.useRef(null),d=m.useRef([]),p=m.useRef(0),u=m.useRef(!1),c=m.useRef(null),l=m.useRef(null),h=m.useRef(null),y=m.useCallback(async()=>{try{if(!await jt.requestMicPermission()){Z.error("Microphone access is blocked! ðŸš«"),a();return}const P=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),E=new(window.AudioContext||window.webkitAudioContext);E.state==="suspended"&&await E.resume();const R=E.createMediaStreamSource(P),G=E.createGain();G.gain.value=3;const W=E.createAnalyser();W.fftSize=64;const g=E.createMediaStreamDestination();R.connect(G),G.connect(g),G.connect(W),c.current=E,l.current=W;const f=W.frequencyBinCount,k=new Uint8Array(f);p.current=Date.now(),u.current=!0,s(0);const I=()=>{if(!u.current)return;if(l.current){l.current.getByteFrequencyData(k);const _=[],B=Math.floor(f/25);for(let w=0;w<25;w++)_.push(Math.max(4,k[w*B]||0));i(_)}const F=(Date.now()-p.current)/1e3;s(F),h.current=requestAnimationFrame(I)};let x={audioBitsPerSecond:128e3};const S=["audio/webm;codecs=opus","audio/webm","audio/mp4","audio/mpeg","audio/aac"];let j="";for(const F of S)if(MediaRecorder.isTypeSupported(F)){x.mimeType=F,j=F;break}console.log("ðŸŽ™ï¸ [DEBUG] Selected mimeType:",j);const N=new MediaRecorder(g.stream,x);o.current=N,d.current=[],N.ondataavailable=F=>{F.data.size>0&&d.current.push(F.data)},N.onstop=()=>{P.getTracks().forEach(F=>F.stop()),c.current&&c.current.close()},N.start(100),I()}catch(T){console.error("Microphone error:",T),Z.error("Unable to access microphone: "+T.message),a()}},[a]),b=m.useCallback(()=>{if(o.current&&u.current){u.current=!1;const T=(Date.now()-p.current)/1e3;o.current.onstop=()=>{var E;const P=new Blob(d.current,{type:((E=o.current)==null?void 0:E.mimeType)||"audio/webm"});console.log("ðŸŽ™ï¸ [DEBUG] Voice Blob created:",P.type,P.size),P.size>0?t(P,T):Z.error("Recording failed: Empty audio data")},o.current.stop()}},[t]),v=m.useCallback(()=>{o.current&&u.current&&(o.current.onstop=()=>{d.current=[]},o.current.stop(),u.current=!1),a()},[a]);m.useEffect(()=>(y(),()=>{u.current&&o.current&&o.current.stop(),h.current&&cancelAnimationFrame(h.current),c.current&&c.current.close()}),[]);const C=T=>{const P=Math.floor(T/60),E=Math.floor(T%60);return`${P}:${E.toString().padStart(2,"0")}`};return e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mx-auto w-full max-w-[220px] flex items-center justify-between gap-2 px-3 h-12 bg-slate-800/40 rounded-full border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{onClick:v,variant:"ghost",size:"icon",className:"text-slate-400 hover:text-red-400 rounded-full h-9 w-9 transition-colors flex-shrink-0",children:e.jsx(ur,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D.div,{animate:{opacity:[1,.5,1]},transition:{repeat:1/0,duration:1.5},className:"w-2.5 h-2.5 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.5)]"}),e.jsx("span",{className:"text-white font-mono text-xs font-medium min-w-[35px]",children:C(r)})]})]}),e.jsx("div",{className:"flex-1 px-1",children:e.jsx("div",{className:"h-4 flex items-center gap-[1px] overflow-hidden justify-center max-w-[80px] mx-auto opacity-30",children:n.map((T,P)=>e.jsx(D.div,{animate:{height:`${Math.min(100,Math.max(20,T/255*100))}%`},transition:{type:"spring",stiffness:300,damping:20},className:"w-1 bg-red-500/80 rounded-full"},P))})}),e.jsx("div",{className:"flex items-center",children:e.jsx(D.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:b,className:"w-9 h-9 bg-brand rounded-full flex items-center justify-center text-white shadow-lg shadow-brand/20 hover:bg-brand/80 transition-colors flex-shrink-0",children:e.jsx(Vt,{className:"w-4 h-4 fill-current ml-0.5"})})})]})}const pi=m.memo(({onSendMessage:t,currentUserId:a,replyTo:r,setReplyTo:s,onTyping:n,t:i,language:o,onSendVoiceMessage:d,editingMessage:p,setEditingMessage:u,onEditMessage:c,scrollToBottom:l,isGroup:h,setShowPollCreator:y})=>{const[b,v]=m.useState(!1),[C,T]=m.useState(""),[P,E]=m.useState(null),[R,G]=m.useState(!1),[W,g]=m.useState(!1),[f,k]=m.useState(null),[I,x]=m.useState(!1),[S,j]=m.useState(!1),[N,F]=m.useState(null),_=m.useRef(null),B=m.useRef(null),w=m.useRef(!1),U=m.useRef(null);m.useEffect(()=>{p&&(T(p.text),_.current&&(_.current.value=p.text,_.current.focus()))},[p]);const te=m.useCallback(M=>{const K=M.target.value,H=K.trim().length>0;v(J=>J!==H?H:J);const O=M.target;O.style.height="auto",O.style.height=`${Math.min(O.scrollHeight,120)}px`,K.length>0?(w.current||(w.current=!0,n(!0)),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{w.current=!1,n(!1)},3e3)):w.current&&(w.current=!1,n(!1),U.current&&clearTimeout(U.current))},[n]),Y=async M=>{var H;M==null||M.preventDefault();const K=((H=_.current)==null?void 0:H.value)||"";if(P){G(!0);try{const O=new FormData;O.append("file",P),O.append("userId",a);const ne=await(await fetch(`https://${Bt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${qt}`},body:O})).json();if(ne.error)throw new Error(ne.error);t(K.trim(),ne.fileUrl,ne.fileType,ne.fileName,r==null?void 0:r.id,f),_.current&&(_.current.value="",_.current.style.height="auto"),v(!1),E(null),s(null),setTimeout(()=>l(),100)}catch(O){Z.error("Upload failed: "+O.message)}finally{G(!1)}}else K.trim()&&(p&&c?(c(p.id,K.trim()),u(null)):t(K.trim(),void 0,void 0,void 0,r==null?void 0:r.id,f),_.current&&(_.current.value="",_.current.style.height="auto"),v(!1),s(null),k(null),setTimeout(()=>l(),100))},Q=M=>{t(M.title||"GIF",M.url,"image/gif","animation.gif",r==null?void 0:r.id,f),j(!1),s(null),setTimeout(()=>l(),100)};return m.useLayoutEffect(()=>{if(!_.current)return;const M=_.current;M.style.height="auto",M.style.height=`${Math.min(M.scrollHeight,120)}px`,p&&v(!0)},[p]),e.jsxs("div",{className:"p-4 bg-slate-900 border-t border-white/5 relative z-50",children:[e.jsxs(xe,{children:[r&&e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3",children:e.jsx(ui,{repliedMessage:r,onCancel:()=>s(null)})}),p&&e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 p-3 bg-indigo-500/10 border-l-4 border-indigo-500 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand",children:[e.jsx(Hr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:i("editing_message")})]}),e.jsx("button",{onClick:()=>{u(null),T(""),_.current&&(_.current.value="")},className:"text-slate-400 hover:text-white",children:e.jsx(ke,{className:"w-4 h-4"})})]}),P&&e.jsxs(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mb-2 flex items-center gap-3 bg-slate-800/80 rounded-xl p-3 border border-brand/30",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-lg",children:e.jsx(Ft,{className:"w-5 h-5 text-brand"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:P.name}),e.jsxs("p",{className:"text-xs text-slate-400",children:[(P.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>E(null),className:"p-1 hover:bg-white/10 rounded-full",children:e.jsx(ke,{className:"w-4 h-4 text-slate-400"})})]})]}),e.jsx(xe,{children:S&&e.jsxs(D.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:320},exit:{opacity:0,height:0},className:"absolute bottom-full left-0 right-0 z-50 bg-slate-900 border-t border-white/10 shadow-2xl overflow-hidden rounded-t-2xl mx-2 mb-2",children:[e.jsx("div",{className:"flex justify-end p-2 absolute top-0 right-0 z-10",children:e.jsx("button",{onClick:()=>j(!1),className:"bg-black/50 hover:bg-black/70 rounded-full p-1 text-white transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})}),e.jsx(di,{onSelect:Q,onClose:()=>j(!1),language:o})]})}),e.jsxs("div",{className:"flex items-end gap-3 max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex-1 bg-slate-800 rounded-2xl flex items-end p-1 border border-white/10 shadow-lg focus-within:border-brand/50 focus-within:ring-1 focus-within:ring-brand/20 transition-all",children:W?e.jsx(mi,{onSend:(M,K)=>{d(M,K),g(!1)},onCancel:()=>g(!1)}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center self-center px-1",children:[e.jsx("input",{type:"file",ref:B,onChange:M=>{var K;return E(((K=M.target.files)==null?void 0:K[0])||null)},className:"hidden"}),e.jsx("button",{onClick:()=>{var M;return(M=B.current)==null?void 0:M.click()},className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(fa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>j(!S),className:re("p-2.5 rounded-xl transition-all",S?"text-brand bg-brand/10":"text-slate-400 hover:text-brand hover:bg-brand/10"),children:e.jsx(nt,{className:"w-5 h-5"})}),h&&e.jsx("button",{onClick:()=>y(!0),className:"p-2.5 text-slate-400 hover:text-brand hover:bg-brand/10 rounded-xl transition-all",children:e.jsx(Wr,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsxs(D.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>x(!I),className:re("p-2.5 rounded-xl transition-all flex items-center justify-center relative",f?"text-orange-400 bg-orange-500/20":"text-slate-400 hover:text-white"),children:[e.jsx(ha,{className:re("w-5 h-5",f&&"animate-pulse")}),f&&e.jsxs("span",{className:"absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full",children:[f,"s"]})]}),e.jsx(xe,{children:I&&e.jsx(D.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.9},className:"absolute bottom-full left-0 mb-4 bg-slate-900 border border-white/20 rounded-2xl p-2 shadow-2xl z-[200] min-w-[160px] backdrop-blur-2xl",children:e.jsx("div",{className:"flex flex-col gap-1",children:[{label:o==="ar"?"Ø¥ÙŠÙ‚Ø§Ù":"Off",value:null},{label:o==="ar"?"5 Ø«ÙˆØ§Ù†Ù":"5 Seconds",value:5},{label:o==="ar"?"10 Ø«ÙˆØ§Ù†Ù":"10 Seconds",value:10},{label:o==="ar"?"30 Ø«Ø§Ù†ÙŠØ©":"30 Seconds",value:30},{label:o==="ar"?"Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Minute",value:60},{label:o==="ar"?"Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©":"1 Hour",value:3600}].map(M=>e.jsxs("button",{onClick:()=>{k(M.value),x(!1)},className:re("w-full text-left px-4 py-2.5 rounded-xl text-sm transition-all flex items-center justify-between",f===M.value?"bg-brand/20 text-brand font-bold":"text-slate-300 hover:bg-white/5"),children:[M.label,f===M.value&&e.jsx(Le,{className:"w-4 h-4"})]},M.label))})})})]})]}),e.jsx("textarea",{ref:_,rows:1,placeholder:i("type_message"),defaultValue:C,onChange:te,inputMode:"text",autoComplete:"off",autoCorrect:"off",autoCapitalize:"sentences",onKeyDown:M=>{if(M.key==="Enter"&&!M.shiftKey){if(M.preventDefault(),R)return;Y(M)}},className:"flex-1 bg-transparent border-none text-white placeholder:text-slate-500 px-4 py-3 resize-none focus:outline-none max-h-[120px] scrollbar-hide text-[15px] leading-relaxed"})]})}),b||P?e.jsx(D.button,{whileHover:{scale:1.1,rotate:-10},whileTap:{scale:.9},onClick:Y,className:"h-[50px] w-[50px] bg-gradient-to-tr from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/25",children:R?e.jsx(je,{className:"w-5 h-5 animate-spin"}):e.jsx(Vt,{className:"w-5 h-5 fill-current"})}):e.jsx(D.button,{onClick:()=>g(!0),whileHover:{scale:1.1},whileTap:{scale:.9},className:"h-[50px] w-[50px] bg-slate-800 text-white rounded-2xl flex items-center justify-center shadow-lg hover:bg-slate-700 transition-colors",children:e.jsx(mr,{className:"w-5 h-5"})})]})]})});function fi({url:t,type:a,name:r,onClose:s}){const n=a.startsWith("image/"),i=a.startsWith("video/"),o=a.includes("pdf");return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black/95 flex flex-col items-center justify-center animate-in fade-in duration-200",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between bg-gradient-to-b from-black/50 to-transparent",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-[200px] sm:max-w-md",children:r}),e.jsx("p",{className:"text-gray-400 text-xs",children:a})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:t,download:r,className:"p-2 text-gray-400 hover:text-white transition-colors",children:e.jsx(Yr,{className:"w-6 h-6"})}),e.jsx("button",{onClick:s,className:"p-2 text-white hover:bg-white/10 rounded-full transition-colors",children:e.jsx(ke,{className:"w-7 h-7"})})]})]}),e.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 sm:p-10",children:n?e.jsx("img",{src:t,alt:r,className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl animate-in zoom-in-95 duration-300"}):i?e.jsx("video",{src:t,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg shadow-2xl"}):o?e.jsx("iframe",{src:t,className:"w-full h-full max-w-5xl bg-white rounded-lg shadow-2xl",title:r}):e.jsxs("div",{className:"bg-[#202c33] p-8 rounded-2xl flex flex-col items-center gap-6 max-w-sm text-center shadow-2xl border border-gray-800",children:[e.jsx("div",{className:"w-20 h-20 bg-brand/20 rounded-full flex items-center justify-center",children:e.jsx(Vr,{className:"w-10 h-10 text-brand"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-xl font-bold mb-2",children:"No Preview Available"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["This file type (",a,") cannot be previewed directly. You can download it to view."]})]}),e.jsx("a",{href:t,download:r,className:"w-full",children:e.jsx(fe,{className:"w-full bg-brand hover:bg-brand/80 text-white py-6 text-lg",children:"Download File"})})]})})]})}function hi({partnerId:t,partnerName:a,partnerAvatar:r,isGroup:s,onClose:n,messages:i,onOpenGallery:o,onAudioCall:d,onVideoCall:p,onShowProfile:u,language:c,t:l}){const[h,y]=m.useState(null),[b,v]=m.useState(!0),C=i.filter(T=>{var P,E;return T.fileUrl&&(((P=T.fileType)==null?void 0:P.startsWith("image/"))||((E=T.fileType)==null?void 0:E.startsWith("video/")))});return m.useEffect(()=>{async function T(){if(s){const{data:P,error:E}=await X.from("groups").select("*").eq("id",t).single();P&&y(P),v(!1)}else{const{data:P,error:E}=await X.from("profiles").select("*").eq("id",t).single();P&&y(P),v(!1)}}T()},[t,s]),e.jsxs(D.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"absolute top-0 right-0 h-full w-full md:w-[380px] bg-slate-950 border-l border-white/10 z-[1001] shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-white/5 bg-slate-950",children:[e.jsx("button",{onClick:n,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx("h2",{className:`text-lg font-semibold text-white ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Contact Info"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-8 custom-scrollbar",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsxs(D.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"relative mb-4 group cursor-pointer",children:[e.jsxs(Oe,{className:"w-32 h-32 border-4 border-slate-800 shadow-2xl group-hover:border-indigo-500/50 transition-colors duration-300",children:[e.jsx(We,{src:r||(h==null?void 0:h.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-3xl font-bold text-indigo-400",children:a.charAt(0).toUpperCase()})]}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Jr,{className:"w-8 h-8 text-white/80"})})]}),e.jsx("h3",{className:"text-2xl font-bold text-white text-center mb-1",children:a}),e.jsx("p",{className:"text-indigo-400 text-sm font-medium",children:h!=null&&h.username?`@${h.username}`:s?c==="ar"?"Ø¯Ø±Ø¯Ø´Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Chat":c==="ar"?"~Ù…Ø³ØªØ®Ø¯Ù…":"~User"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-8",children:[e.jsxs("button",{onClick:d,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(pr,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ØµÙˆØª":"Audio"})]}),e.jsxs("button",{onClick:p,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/10 flex items-center justify-center group-hover:bg-violet-500/20 text-violet-400 transition-colors",children:e.jsx(yt,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"ÙÙŠØ¯ÙŠÙˆ":"Video"})]}),e.jsxs("button",{onClick:u,className:"flex flex-col items-center gap-2 p-3 rounded-xl bg-slate-800/50 hover:bg-slate-800 border border-white/5 transition-all group",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center group-hover:bg-emerald-500/20 text-emerald-400 transition-colors",children:e.jsx(Ue,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xs text-slate-400 group-hover:text-white",children:c==="ar"?"Ø§Ù„Ù…Ù„Ù":"Profile"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5",children:[e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-widest font-black mb-4 ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©":"Personal Info"}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400 shrink-0",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-100 text-[15px] leading-relaxed break-words",children:(h==null?void 0:h.about)||(c==="ar"?"Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©":"No bio provided")}),e.jsx("p",{className:`text-slate-500 text-[10px] uppercase tracking-wider mt-1 font-bold ${c==="ar"?"font-arabic":""}`,children:l("about")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-violet-500/10 flex items-center justify-center text-violet-400",children:e.jsx(Ue,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.gender)==="male"?l("male"):(h==null?void 0:h.gender)==="female"?l("female"):c==="ar"?"ØºÙŠØ± Ù…Ø­Ø¯Ø¯":"Not specified"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("gender")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400",children:e.jsx($t,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200 text-sm font-medium",children:(h==null?void 0:h.birth_year)||"----"}),e.jsx("p",{className:`text-slate-600 text-[9px] uppercase font-bold ${c==="ar"?"font-arabic":""}`,children:l("birth_year")})]})]})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx(Xr,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm truncate",children:(h==null?void 0:h.email)||(s?c==="ar"?"Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©":"Group Conversation":c==="ar"?"Ù…Ø®ÙÙŠ":"Hidden")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]})]}),(h==null?void 0:h.created_at)&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-500/10 flex items-center justify-center text-slate-400 shrink-0",children:e.jsx($t,{className:"w-4 h-4"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(h.created_at).toLocaleDateString(c==="ar"?"ar-EG":"en-US")}),e.jsx("p",{className:`text-slate-600 text-[10px] uppercase mt-0.5 font-bold ${c==="ar"?"font-arabic":""}`,children:c==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:o,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-slate-500 text-xs uppercase tracking-widest font-bold",children:c==="ar"?"Ø§Ù„ÙˆØ³Ø§Ø¦Ø· ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª":"Media, Links & Docs"}),e.jsxs("span",{className:"text-xs text-slate-400 flex items-center gap-1 group-hover:text-indigo-400 transition-colors",children:[C.length," ",e.jsx("span",{className:"opacity-50",children:"â€º"})]})]}),C.length>0?e.jsx("div",{className:"grid grid-cols-4 gap-2",children:C.slice(0,4).map((T,P)=>{var E;return e.jsxs("div",{className:"aspect-square rounded-lg bg-slate-800 border border-white/5 overflow-hidden relative group/img",children:[(E=T.fileType)!=null&&E.startsWith("image")?e.jsx("img",{src:T.fileUrl,alt:"Media",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-800",children:e.jsx(yt,{className:"w-5 h-5 text-slate-400"})}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover/img:bg-transparent transition-colors"})]},T.id||P)})}):e.jsx("p",{className:"text-slate-600 text-xs italic py-2",children:c==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ³Ø§Ø¦Ø· Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø¹Ø¯.":"No shared media yet."})]}),s&&(h==null?void 0:h.group_id)&&e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-4 border border-white/5 hover:bg-slate-800/50 transition-colors cursor-pointer group",onClick:()=>{const T=`${window.location.origin}?join=${h.group_id}`;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(T).then(()=>Z.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})).catch(()=>Z.error(c==="ar"?"ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·":"Failed to copy link"));else try{const P=document.createElement("textarea");P.value=T,document.body.appendChild(P),P.select(),document.execCommand("copy"),document.body.removeChild(P),Z.success(c==="ar"?"ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!":"Invite link copied!",{description:c==="ar"?"Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.":"Share this link to invite others."})}catch{Z.error(c==="ar"?"ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ¸Ø©":"Clipboard access denied",{description:c==="ar"?"ÙŠØ±Ø¬Ù‰ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹.":"Please manually copy the link."})}},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-500/10 flex items-center justify-center group-hover:bg-indigo-500/20 text-indigo-400 transition-colors",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white transition-colors",children:c==="ar"?"Ø¯Ø¹ÙˆØ© Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø·":"Invite to Group via Link"}),e.jsx("p",{className:"text-slate-500 text-xs",children:c==="ar"?"Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©":"Tap to copy invite link"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(Ot,{className:"w-5 h-5 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"ÙƒØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª":"Mute Notifications"})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-slate-800/50 transition-colors text-left group",children:[e.jsx(xa,{className:"w-5 h-5 text-slate-400 group-hover:text-yellow-400 transition-colors"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-slate-300 text-sm group-hover:text-white",children:c==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ù†Ø¬Ù…Ø©":"Starred Messages"})})]}),e.jsx("div",{className:"h-px bg-white/5 my-2"}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(ga,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?`Ø­Ø¸Ø± ${a}`:`Block ${a}`})})]}),e.jsxs("button",{className:"w-full flex items-center gap-4 p-4 rounded-xl hover:bg-red-500/10 transition-colors text-left group text-red-400",children:[e.jsx(ba,{className:"w-5 h-5"}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("p",{className:"text-sm font-medium",children:c==="ar"?"Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„":"Report Contact"})})]})]})]})]})]})}function xi({messages:t,onClose:a}){const[r,s]=m.useState("media"),[n,i]=m.useState(null),{media:o,docs:d,links:p}=m.useMemo(()=>{const c=[],l=[],h=[];return t.forEach(y=>{var C,T,P;y.fileUrl&&((C=y.fileType)!=null&&C.startsWith("image/")||(T=y.fileType)!=null&&T.startsWith("video/"))?c.push(y):y.fileUrl&&l.push(y);const b=/(https?:\/\/[^\s]+)/g,v=(P=y.text)==null?void 0:P.match(b);v&&v.forEach(E=>{h.push({...y,linkUrl:E})})}),{media:c.reverse(),docs:l.reverse(),links:h.reverse()}},[t]),u=[{id:"media",label:"Media"},{id:"docs",label:"Docs"},{id:"links",label:"Links"}];return e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"absolute inset-0 z-[150] bg-slate-950 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-slate-900 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(He,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Media, Links & Docs"})]}),e.jsx("div",{className:"flex border-b border-white/5 bg-slate-900/50",children:u.map(c=>e.jsxs("button",{onClick:()=>s(c.id),className:re("flex-1 py-3 text-sm font-medium relative transition-colors",r===c.id?"text-indigo-400":"text-slate-400 hover:text-slate-300"),children:[c.label,r===c.id&&e.jsx(D.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-500"})]},c.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-950 p-4 custom-scrollbar",children:[r==="media"&&e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-5 gap-2",children:o.length>0?o.map(c=>{var l;return e.jsx("div",{className:"aspect-square relative group overflow-hidden rounded-lg bg-slate-900 border border-white/5",children:(l=c.fileType)!=null&&l.startsWith("image/")?e.jsx("img",{src:c.fileUrl,alt:c.fileName,className:"w-full h-full object-cover cursor-pointer hover:scale-105 transition-transform duration-300",onClick:()=>i(c.fileUrl)}):e.jsx("div",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-slate-800",children:e.jsx(yt,{className:"w-8 h-8 text-slate-400"})})},c.id)}):e.jsxs("div",{className:"col-span-full py-20 text-center text-slate-500",children:[e.jsx(Jr,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No media shared"})]})}),r==="docs"&&e.jsx("div",{className:"space-y-2",children:d.length>0?d.map(c=>{var l;return e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors group",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400",children:e.jsx(Ft,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-200 truncate",children:c.fileName}),e.jsxs("p",{className:"text-xs text-slate-500 uppercase",children:[((l=c.fileType)==null?void 0:l.split("/")[1])||"FILE"," â€¢ ",new Date(c.timestamp).toLocaleDateString()]})]}),e.jsx("a",{href:c.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-slate-500 hover:text-white rounded-full hover:bg-white/10 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx(Yr,{className:"w-4 h-4"})})]},c.id)}):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(Ft,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No documents found"})]})}),r==="links"&&e.jsx("div",{className:"space-y-2",children:p.length>0?p.map((c,l)=>e.jsxs("div",{className:"flex gap-4 p-3 rounded-xl bg-slate-900/50 border border-white/5 hover:bg-slate-800 transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-400 flex-shrink-0",children:e.jsx(zt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0 overflow-hidden",children:[e.jsx("a",{href:c.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:underline text-sm font-medium truncate block",children:c.linkUrl}),c.text!==c.linkUrl&&e.jsx("p",{className:"text-xs text-slate-400 truncate mt-0.5",children:c.text}),e.jsx("p",{className:"text-[10px] text-slate-600 mt-1",children:new Date(c.timestamp).toLocaleDateString()})]})]},l)):e.jsxs("div",{className:"py-20 text-center text-slate-500",children:[e.jsx(zt,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No links shared"})]})})]}),e.jsx(xe,{children:n&&e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[200] bg-black/95 backdrop-blur-md flex items-center justify-center p-4",onClick:()=>i(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 bg-white/10 rounded-full text-white hover:bg-white/20 transition-colors",onClick:()=>i(null),children:e.jsx(ke,{className:"w-6 h-6"})}),e.jsx(D.img,{initial:{scale:.9},animate:{scale:1},src:n||"",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:c=>c.stopPropagation()})]})})]})}function gi({onClose:t,onSend:a}){const[r,s]=m.useState(""),[n,i]=m.useState(["",""]),o=()=>{n.length<10&&i([...n,""])},d=(c,l)=>{const h=[...n];h[c]=l,i(h)},p=c=>{n.length>2&&i(n.filter((l,h)=>h!==c))},u=()=>{const c=n.filter(l=>l.trim()!=="");r.trim()&&c.length>=2&&(a(r,c),t())};return e.jsx(D.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-3xl w-full max-w-md shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-center bg-gradient-to-r from-brand/10 to-violet-500/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand/20 rounded-xl text-brand",children:e.jsx(Wr,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white leading-none",children:"Create Poll"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ask your friends anything"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full transition-all",children:e.jsx(ke,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 max-h-[70vh] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(va,{className:"w-4 h-4 text-brand"}),"Question"]}),e.jsx(we,{value:r,onChange:c=>s(c.target.value),placeholder:"What's on your mind?",dir:"auto",className:"bg-slate-950 border-white/5 focus:border-brand/50 h-12 text-white placeholder:text-slate-600 rounded-xl px-4"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-300",children:"Options"}),n.map((c,l)=>e.jsx(D.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-2 group",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(we,{value:c,onChange:h=>d(l,h.target.value),placeholder:`Option ${l+1}`,dir:"auto",className:"bg-slate-950/50 border-white/5 focus:border-brand/50 h-11 text-white placeholder:text-slate-700 rounded-xl px-4"}),l>=2&&e.jsx("button",{onClick:()=>p(l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ke,{className:"w-4 h-4"})})]})},l)),n.length<10&&e.jsxs("button",{onClick:o,className:"w-full py-3 border-2 border-dashed border-slate-800 rounded-xl text-slate-500 hover:text-brand hover:border-brand/30 transition-all flex items-center justify-center gap-2 text-sm font-medium",children:[e.jsx(ya,{className:"w-4 h-4"}),"Add Option"]})]})]}),e.jsxs("div",{className:"p-6 bg-slate-950/50 flex gap-3",children:[e.jsx(fe,{variant:"ghost",onClick:t,className:"flex-1 text-slate-400 hover:text-white hover:bg-white/5 h-12 rounded-xl font-bold",children:"Cancel"}),e.jsxs(fe,{onClick:u,disabled:!r.trim()||n.filter(c=>c.trim()).length<2,className:"flex-1 bg-gradient-to-r from-brand to-violet-600 hover:from-brand/80 hover:to-violet-500 text-white shadow-lg shadow-brand/20 h-12 rounded-xl font-bold gap-2",children:[e.jsx(Vt,{className:"w-4 h-4"}),"Create Poll"]})]})]})})}function bi({audioUrl:t,duration:a,messageId:r,onPlayNext:s}){const{activeMessageId:n,playMessage:i,pauseMessage:o,registerMessage:d,unregisterMessage:p,notifyEnded:u}=ws(),[c,l]=m.useState(!1),[h,y]=m.useState(()=>r?localStorage.getItem(`vp_played_${r}`)==="true":!0),[b,v]=m.useState(a||0),[C,T]=m.useState(0),[P,E]=m.useState(1),[R,G]=m.useState(!1),[W,g]=m.useState(!1),f=m.useRef(null);m.useRef(null);const k=m.useRef(a||0),I=35,x=m.useMemo(()=>Array.from({length:I},()=>Math.floor(Math.random()*60)+20),[]);m.useEffect(()=>{a&&a>0&&(v(a),k.current=a)},[a]),m.useEffect(()=>{const w=f.current;if(!w)return;const U=()=>T(w.currentTime),te=()=>{w.duration&&!isNaN(w.duration)&&w.duration!==1/0&&(v(w.duration),k.current=w.duration)};return w.addEventListener("timeupdate",U),w.addEventListener("loadedmetadata",te),w.addEventListener("durationchange",te),w.addEventListener("play",()=>l(!0)),w.addEventListener("pause",()=>l(!1)),w.muted=W,()=>{w.removeEventListener("timeupdate",U),w.removeEventListener("loadedmetadata",te),w.removeEventListener("durationchange",te)}},[t,W]),m.useEffect(()=>{r&&(n===r?f.current&&f.current.paused&&(f.current.play().catch(()=>{}),h||(y(!0),localStorage.setItem(`vp_played_${r}`,"true"))):f.current&&!f.current.paused&&f.current.pause())},[n,r,h]),m.useEffect(()=>{if(r&&s)return d(r,s),()=>p(r)},[r,s,d,p]);const S=m.useCallback(()=>{l(!1),T(0),f.current&&(f.current.currentTime=0),r&&u(r)},[r,u]);m.useEffect(()=>{const w=f.current;if(w)return w.addEventListener("ended",S),()=>w.removeEventListener("ended",S)},[S]);const j=async w=>{w==null||w.stopPropagation(),!(!f.current||!r)&&(h||(y(!0),localStorage.setItem(`vp_played_${r}`,"true")),c?o(r):i(r))},N=w=>{if(w.stopPropagation(),!f.current||!k.current)return;const U=w.currentTarget.getBoundingClientRect(),te=w.clientX-U.left,Q=Math.min(Math.max(0,te/U.width),1)*k.current;f.current.currentTime=Q,T(Q)},F=w=>{if(w.stopPropagation(),!f.current)return;const U=[1,1.5,2],te=U[(U.indexOf(P)+1)%U.length];E(te),f.current.playbackRate=te},_=w=>{const U=Math.floor(w/60),te=Math.floor(w%60);return`${U}:${te.toString().padStart(2,"0")}`},B=k.current>0?C/k.current*100:0;return e.jsxs("div",{className:"flex items-center gap-3 w-full py-1 group/player select-none",onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1),children:[e.jsxs(D.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:j,className:re("w-10 h-10 rounded-full flex items-center justify-center transition-all bg-white/10 hover:bg-white/20 text-white border border-white/10 shadow-lg relative",c&&"bg-brand hover:bg-brand/80 border-brand",!h&&"ring-2 ring-sky-400 ring-offset-2 ring-offset-slate-900"),children:[c?e.jsx(ja,{className:"w-5 h-5 fill-current"}):e.jsx(wa,{className:"w-5 h-5 fill-current ml-0.5"}),!h&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-sky-500 rounded-full border-2 border-slate-900 animate-pulse"})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[e.jsxs("div",{className:"h-10 flex items-center gap-[3px] cursor-pointer group/wave relative",onClick:N,children:[x.map((w,U)=>{const te=U/I*100,Y=B>te;return e.jsx(D.div,{initial:!1,animate:{height:`${w}%`,backgroundColor:Y?h?"#818cf8":"#38bdf8":h?"rgba(255,255,255,0.15)":"rgba(56,189,248,0.2)"},transition:{type:"spring",stiffness:300,damping:20},className:re("flex-1 rounded-full min-h-[4px] transition-shadow duration-300",Y&&(h?"shadow-[0_0_8px_rgba(129,140,248,0.5)]":"shadow-[0_0_10px_rgba(56,189,248,0.6)]"))},U)}),e.jsx("div",{className:"absolute inset-0 z-10 opacity-0 group-hover/wave:opacity-100 bg-gradient-to-r from-transparent via-white/5 to-transparent pointer-events-none transition-opacity duration-300"})]}),e.jsxs("div",{className:"flex justify-between items-center px-0.5 opacity-60 group-hover/player:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"text-[10px] font-mono font-medium text-white/70 flex gap-1",children:[e.jsx("span",{className:"text-white font-bold",children:_(C)}),e.jsxs("span",{children:["/ ",_(b)]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>{const w=!W;g(w),f.current&&(f.current.muted=w)},className:"p-1 rounded-md bg-white/5 hover:bg-white/10 text-white/70 hover:text-white border border-white/5 transition-all",title:W?"ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª":"ÙƒØªÙ… Ø§Ù„ØµÙˆØª",children:W?e.jsx(Kr,{className:"w-3 h-3"}):e.jsx(Gt,{className:"w-3 h-3"})}),e.jsxs("button",{onClick:F,className:re("text-[10px] font-bold px-1.5 py-0.5 rounded-md transition-all border",P===1?"bg-white/5 text-white/40 border-white/5":"bg-brand text-white border-brand"),children:[P,"x"]})]})]})]}),e.jsx("audio",{ref:f,src:t,hidden:!0})]})}function vi({currentUserId:t,partnerId:a,partnerName:r,partnerAvatar:s,messages:n,isPartnerOnline:i,isPartnerTyping:o,onBack:d,onSendMessage:p,onSendVoiceMessage:u,onDeleteMessage:c,onTyping:l,onRefresh:h,onReact:y,onSendPoll:b,onVote:v,onStartCall:C,onEditMessage:T,smartReplies:P=[],isGroup:E,onJoinGroup:R,onShowProfile:G,onClearChat:W,language:g,t:f}){const{playMessage:k}=ws(),[I,x]=m.useState(null),[S,j]=m.useState(null),[N,F]=m.useState(!1),_=m.useRef(null),[B,w]=m.useState(null),[U,te]=m.useState(null),[Y,Q]=m.useState(!1),[M,K]=m.useState(!1),[H,O]=m.useState(""),[J,ne]=m.useState(!1),[ee,pe]=m.useState(!1),[Pe,Ne]=m.useState(!1),lt=J||ee||Pe||!!S,Ie=m.useRef(null);m.useRef(!1);const ct=m.useRef(null),Qe=m.useRef(n.length),{wallpaper:Ce,bgOpacity:Ye}=Cs();m.useEffect(()=>{w(null),te(null),x(null),O("")},[a]);const ge=($="auto")=>{_.current&&_.current.scrollIntoView({behavior:$})};m.useLayoutEffect(()=>{n.length>0&&(n[n.length-1].senderId===t||!N)&&ge("smooth"),Qe.current=n.length},[n,t,N,a]),m.useLayoutEffect(()=>{ge("auto"),ct.current=a},[a]);const Ze=()=>{if(!Ie.current)return;const{scrollTop:$,scrollHeight:ue,clientHeight:Ae}=Ie.current,Ge=ue-$-Ae<200;F(!Ge)},dt=m.useCallback($=>new Date($).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),[]),ce=m.useCallback($=>{if(!$){w(null);return}w(ue=>ue===$?null:$)},[]),be=m.useCallback($=>{x({id:$.id,senderName:$.senderId===t?g==="ar"?"Ø£Ù†Øª":"You":r,text:$.text,fileType:$.fileType}),w(null)},[t,g,r]),Me=m.useCallback(($,ue)=>{te({id:$,text:ue}),w(null)},[]),et=m.useCallback(()=>{ge("smooth")},[]),Fe=m.useCallback(($,ue)=>{var Ae,_e,Ge;if(!$.fileUrl||!$.fileType)return null;if($.fileType.startsWith("image/"))return e.jsx(D.div,{whileHover:{scale:1.02},className:"mb-2 overflow-hidden rounded-lg",children:e.jsx("img",{src:$.fileUrl,alt:$.fileName||"Image",className:"max-w-full max-h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>j({url:$.fileUrl,type:$.fileType,name:$.fileName||"Image"})})});if($.fileType.startsWith("video/"))return e.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-black/20",children:e.jsx("video",{src:$.fileUrl,controls:!0,className:"max-w-full max-h-64"})});if((Ae=$.fileType)!=null&&Ae.startsWith("audio/")||$.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test($.fileName||"")){const mt=n.findIndex(Te=>Te.id===$.id),Be=n[mt+1],ft=Be&&(Te=>{var Se;return((Se=Te.fileType)==null?void 0:Se.startsWith("audio/"))||Te.fileType==="audio"||/\.(mp3|wav|ogg|webm|m4a|aac)$/i.test(Te.fileName||"")})(Be);return e.jsx(bi,{audioUrl:$.fileUrl||"",messageId:$.id,onPlayNext:ft?()=>k(Be.id):void 0,duration:((_e=$.fileName)!=null&&_e.includes("duration=")?parseFloat($.fileName.split("duration=")[1]):void 0)||((Ge=$.fileUrl)!=null&&Ge.includes("duration=")?parseFloat($.fileUrl.split("duration=")[1]):void 0)})}return e.jsxs("div",{className:re("flex items-center gap-3 mb-2 p-3 rounded-xl cursor-pointer hover:opacity-80 transition-all border",ue?"bg-brand/20 border-brand/30":"bg-slate-800/60 border-white/10"),onClick:()=>j({url:$.fileUrl,type:$.fileType,name:$.fileName||"File"}),children:[e.jsx("div",{className:re("p-2 rounded-lg",ue?"bg-brand/20":"bg-slate-700/50"),children:e.jsx(Ft,{className:re("w-5 h-5",ue?"text-brand":"text-slate-400")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:$.fileName}),e.jsx("p",{className:"text-xs opacity-70 uppercase",children:$.fileType.split("/")[1]||"FILE"})]})]})},[n,k]),ut=m.useMemo(()=>{const $=new Map;return n.forEach(ue=>$.set(ue.id,ue)),$},[n]),$e=m.useMemo(()=>H.trim()?n.filter($=>$.text.toLowerCase().includes(H.toLowerCase())):n,[n,H]);return e.jsxs("div",{className:"flex flex-col h-full bg-[#0b141a] overflow-hidden relative",children:[e.jsx(xe,{children:B&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-20 bg-black/20 backdrop-blur-sm",onClick:()=>w(null)})}),e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none overflow-hidden",children:[e.jsx(D.div,{animate:{scale:[1,1.2,1],x:[0,50,0],y:[0,30,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute top-[-10%] right-[-5%] w-[600px] h-[600px] bg-brand/15 rounded-full blur-[120px]"}),e.jsx(D.div,{animate:{scale:[1,1.3,1],x:[0,-40,0],y:[0,-20,0]},transition:{duration:25,repeat:1/0,ease:"linear",delay:2},className:"absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-violet-600/15 rounded-full blur-[100px]"}),e.jsx("div",{className:re("absolute inset-0 transition-opacity duration-700",Ce==="doodles"&&"premium-doodle opacity-30 mix-blend-overlay",Ce==="stars"&&"wallpaper-stars opacity-40 mix-blend-screen",Ce==="geometric"&&"wallpaper-geometric opacity-20 mix-blend-overlay",Ce==="solid"&&"wallpaper-solid"),style:{opacity:Ce==="solid"?1:Ye}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-slate-950/50"})]}),e.jsxs("div",{className:"bg-[#0b141a]/60 backdrop-blur-xl px-4 py-3 flex items-center gap-3 sticky top-0 z-50 border-b border-white/5 shadow-lg",children:[e.jsx("button",{onClick:d,className:"text-slate-400 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full",children:e.jsx(He,{className:"w-6 h-6"})}),e.jsxs("div",{className:"relative group cursor-pointer",onClick:()=>ne(!0),children:[e.jsxs(Oe,{className:"w-10 h-10 border-2 border-slate-800 group-hover:border-brand transition-colors",children:[e.jsx(We,{src:s||`https://ui-avatars.com/api/?name=${encodeURIComponent(r)}&background=random&color=fff`}),e.jsx(ze,{className:"bg-slate-800 text-brand font-bold",children:(r||"?").charAt(0).toUpperCase()})]}),i&&!E&&e.jsx("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-emerald-500 border-2 border-slate-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>ne(!0),children:[e.jsxs("h2",{className:"text-white font-bold truncate text-lg flex items-center gap-2",children:[r," ",E&&e.jsx("span",{className:"bg-slate-800 text-slate-400 text-[10px] px-1.5 py-0.5 rounded border border-white/5",children:"GROUP"})]}),!E&&e.jsx("div",{className:"text-xs flex items-center gap-1 h-4",children:e.jsx(xe,{mode:"wait",children:o?e.jsxs(D.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},className:"flex items-center gap-1.5 text-indigo-400 font-medium",children:[e.jsx("span",{className:"text-[10px]",children:"typing"}),e.jsx("span",{className:"flex gap-0.5",children:[0,1,2].map($=>e.jsx(D.span,{animate:{y:[0,-2,0]},transition:{repeat:1/0,duration:.5,delay:$*.1},className:"w-1 h-1 bg-indigo-400 rounded-full"},$))})]}):i?e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},className:"text-emerald-500 font-medium",children:"Online"}):e.jsx(D.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-500",children:"Offline"})})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>K(!M),className:re("p-2 rounded-full transition-colors",M?"text-indigo-400 bg-indigo-500/10":"text-slate-400 hover:text-white hover:bg-white/5"),children:e.jsx(vt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:h,className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(Qr,{className:"w-5 h-5"})}),!E&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>C("audio"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(pr,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C("video"),className:"p-2 text-slate-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-full transition-colors",children:e.jsx(yt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>Q(!Y),className:"p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors",children:e.jsx(dr,{className:"w-5 h-5"})}),e.jsx(xe,{children:Y&&e.jsxs(D.div,{initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},className:"absolute top-full right-0 mt-2 w-48 bg-slate-900 border border-white/10 rounded-xl shadow-2xl py-1 z-[100] overflow-hidden",children:[e.jsx("button",{onClick:()=>{ne(!0),Q(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Contact Info"}),e.jsx("button",{onClick:()=>{W&&W(),Q(!1)},className:"w-full text-left px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5 transition-colors",children:"Clear Chat"}),e.jsx("div",{className:"h-px bg-white/5 my-1"}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-2.5 text-sm text-red-400 hover:bg-red-500/10 transition-colors",children:"Close Chat"})]})})]})]})]}),e.jsx(xe,{children:M&&e.jsx(D.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-slate-900/50 backdrop-blur-md border-b border-white/5 px-4 py-2 relative z-40 overflow-hidden",children:e.jsxs("div",{className:"relative",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Search in conversation...",value:H,onChange:$=>O($.target.value),className:"w-full bg-slate-950/50 border border-white/5 rounded-xl pl-10 pr-10 py-2 text-sm text-white focus:outline-none focus:border-indigo-500/50 transition-all font-light"}),H&&e.jsx("button",{onClick:()=>O(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-white",children:e.jsx(ke,{className:"w-4 h-4"})})]})})}),e.jsxs("div",{ref:Ie,onScroll:Ze,className:"flex-1 overflow-y-auto overflow-x-hidden p-4 px-6 space-y-4 custom-scrollbar relative message-container-glass",children:[$e.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-tr from-indigo-500/20 to-violet-500/20 rounded-full flex items-center justify-center animate-pulse",children:e.jsx(nt,{className:"w-10 h-10 text-indigo-400"})}),e.jsxs("p",{className:"text-center font-medium",children:[H?"No matches found":"No messages yet.",e.jsx("br",{}),e.jsx("span",{className:"text-sm opacity-60",children:H?"Try searching for something else":"Start the conversation!"})]})]}):$e.map(($,ue)=>e.jsx(ci,{message:$,currentUserId:t,partnerName:r,isGroup:E,isSequential:ue>0&&$e[ue-1].senderId===$.senderId,isMenuOpen:B===$.id,onToggleMenu:ce,onReact:y,onReply:be,onDelete:c,onEdit:Me,onVote:v,setViewingFile:j,repliedMessage:$.replyToId&&ut.get($.replyToId)||null,language:g,t:f,formatMessageTime:dt,renderFilePreview:Fe,onJoinGroup:R,isAnyOverlayOpen:lt},$.id)),e.jsx("div",{ref:_})]}),N&&e.jsx(D.button,{initial:{scale:0},animate:{scale:1},onClick:()=>ge("smooth"),className:"absolute bottom-24 right-6 bg-indigo-600 text-white p-3 rounded-full shadow-lg z-40 hover:bg-indigo-500 transition-colors",children:e.jsx(He,{className:"w-6 h-6 rotate-[-90deg]"})}),e.jsx(xe,{children:P.length>0&&!H&&e.jsx(D.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"px-4 py-2 flex gap-2 overflow-x-auto no-scrollbar relative z-30",children:P.map(($,ue)=>e.jsx("button",{onClick:()=>p($),dir:/[\u0600-\u06FF]/.test($)?"rtl":"ltr",className:re("whitespace-nowrap bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-300 border border-indigo-500/20 px-4 py-1.5 rounded-full text-xs font-medium transition-all backdrop-blur-md",/[\u0600-\u06FF]/.test($)?"font-arabic":""),children:$},ue))})}),e.jsx(pi,{onSendMessage:p,currentUserId:t,replyTo:I,setReplyTo:x,onTyping:l,t:f,language:g,onSendVoiceMessage:u,editingMessage:U,setEditingMessage:te,onEditMessage:T,scrollToBottom:et,isGroup:E,setShowPollCreator:Ne}),S&&e.jsx(fi,{url:S.url,type:S.type,name:S.name,onClose:()=>j(null)}),e.jsx(xe,{children:J&&e.jsxs(e.Fragment,{children:[e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-[#020617] backdrop-blur-md z-[1000]",onClick:()=>ne(!1)}),e.jsx(hi,{partnerId:a,partnerName:r,partnerAvatar:s,isGroup:E,onClose:()=>ne(!1),messages:n,onOpenGallery:()=>{pe(!0),ne(!1)},onAudioCall:()=>C("audio"),onVideoCall:()=>C("video"),onShowProfile:()=>{G(a),ne(!1)},language:g,t:f})]})}),e.jsx(xe,{children:ee&&e.jsx(xi,{messages:n,onClose:()=>pe(!1)})}),e.jsx(xe,{children:Pe&&e.jsx(gi,{onClose:()=>Ne(!1),onSend:b})})]})}const yi=m.memo(vi);function ji({callerName:t,type:a,onAccept:r,onReject:s,language:n}){return e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:e.jsxs(D.div,{initial:{scale:.8,y:20},animate:{scale:1,y:0},className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-3xl p-8 shadow-2xl border border-white/10 max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-full flex items-center justify-center text-4xl text-white font-bold shadow-xl",children:t.charAt(0).toUpperCase()}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:t}),e.jsx("p",{className:"text-indigo-400 text-sm",children:n==="ar"?a==="video"?"Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø±Ø¯Ø©...":"Ù…ÙƒØ§Ù„Ù…Ø© ØµÙˆØªÙŠØ© ÙˆØ§Ø±Ø¯Ø©...":`Incoming ${a} call...`})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:s,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 active:scale-95 transition-all flex items-center justify-center shadow-lg",children:e.jsx(Zr,{className:"w-7 h-7 text-white"})}),e.jsx("button",{onClick:r,className:"w-16 h-16 rounded-full bg-green-600 hover:bg-green-700 active:scale-95 transition-all flex items-center justify-center shadow-lg animate-pulse",children:e.jsx(pr,{className:"w-7 h-7 text-white"})})]})]})})}function wi({onFinish:t,language:a}){return m.useEffect(()=>{const r=setTimeout(()=>{t()},3e3);return()=>clearTimeout(r)},[t]),e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen w-full bg-slate-950 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-[20%] left-[10%] w-[60vw] h-[60vw] bg-indigo-600/10 rounded-full blur-[120px] animate-blob"}),e.jsx("div",{className:"absolute bottom-[20%] right-[10%] w-[50vw] h-[50vw] bg-violet-600/10 rounded-full blur-[100px] animate-blob animation-delay-2000"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-20"})]}),e.jsxs(D.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"relative z-10 flex flex-col items-center",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx(D.div,{animate:{scale:[1,1.2,1],opacity:[.3,.6,.3]},transition:{duration:2,repeat:1/0},className:"absolute inset-0 bg-indigo-500 rounded-full blur-2xl"}),e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-[2.5rem] flex items-center justify-center shadow-2xl relative z-10 border border-white/20 transform rotate-3",children:e.jsx(lr,{className:"w-16 h-16 text-white fill-white/10",strokeWidth:1.5})}),e.jsx(D.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.5},className:"absolute -bottom-2 -right-2 w-12 h-12 bg-slate-900 border border-emerald-500/50 rounded-2xl flex items-center justify-center shadow-xl z-20",children:e.jsx(es,{className:"w-6 h-6 text-emerald-400"})})]}),e.jsxs(D.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6},className:"flex flex-col items-center justify-center w-full max-w-md px-4",children:[e.jsx("h1",{className:"text-white text-4xl sm:text-5xl md:text-6xl font-black mb-4 tracking-tighter text-center w-full leading-tight",children:"Chat App"}),e.jsx("p",{className:"text-indigo-400 font-medium text-sm md:text-base mb-10 text-center w-full",children:a==="ar"?"Ø§Ø®ØªØ¨Ø± Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª":"Experience the Future"})]}),e.jsx("div",{className:"w-48 h-1 overflow-hidden bg-slate-900 border border-white/5 rounded-full relative",children:e.jsx(D.div,{initial:{left:"-100%"},animate:{left:"100%"},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"},className:"absolute top-0 bottom-0 w-1/2 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"})})]}),e.jsx(D.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"absolute bottom-10 text-slate-600 text-[10px] uppercase font-bold tracking-[0.4em]",children:"Secure Quantum Encryption v2.4"})]})}function Ni({items:t,initialIndex:a=0,onClose:r,onNext:s,onPrevious:n,onReply:i,onDelete:o,currentUserId:d,language:p}){const[u,c]=m.useState(""),[l,h]=m.useState(!1),[y,b]=m.useState(a),[v,C]=m.useState(0),[T,P]=m.useState(!1),E=m.useRef(null),R=t[y],G=m.useCallback(()=>{y<t.length-1?(b(f=>f+1),C(0)):r()},[y,t.length,r]),W=m.useCallback(()=>{y>0?(b(f=>f-1),C(0)):n&&n()},[y,n]);if(m.useEffect(()=>{if(!R)return;C(0);const f=5e3,k=50,I=k/f*100;return E.current=setInterval(()=>{l||T||C(x=>x>=100?(clearInterval(E.current),G(),100):x+I)},k),()=>{E.current&&clearInterval(E.current)}},[y,R,G,l,T]),!R)return null;const g=d===R.user_id;return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-black flex flex-col md:rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full p-4 z-50 bg-gradient-to-b from-black/60 to-transparent",children:[e.jsx("div",{className:"flex gap-1 mb-4",children:t.map((f,k)=>e.jsx("div",{className:"flex-1 h-1 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white transition-all duration-50",style:{width:k<y?"100%":k===y?`${v}%`:"0%"}})},k))}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Oe,{className:"w-10 h-10 border border-white/20",children:[e.jsx(We,{src:R.user_avatar}),e.jsx(ze,{children:R.user_name?R.user_name.charAt(0):"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm",children:R.user_name}),e.jsx("p",{className:"text-[10px] opacity-60",children:new Date(R.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 relative",children:[g&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>P(!T),className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(dr,{className:"w-5 h-5"})}),T&&e.jsx(D.div,{initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},className:"absolute right-0 top-full mt-2 w-48 bg-[#1f2c34] rounded-lg shadow-xl border border-white/10 overflow-hidden z-[1020]",children:e.jsxs("button",{onClick:()=>{o&&o(R.id),P(!1)},className:"flex items-center gap-3 w-full px-4 py-3 text-red-500 hover:bg-white/5 transition-colors text-sm",children:[e.jsx(ur,{className:"w-4 h-4"}),p==="ar"?"Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Delete Story"]})})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(ke,{className:"w-6 h-6"})})]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center justify-center relative",children:[R.content_type==="text"&&e.jsx("div",{className:"w-full h-full flex items-center justify-center p-10 bg-gradient-to-br from-indigo-600 to-violet-700",children:e.jsx("p",{className:"text-3xl font-bold text-white text-center leading-relaxed",children:R.text})}),R.content_type==="image"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("img",{src:R.content_url,alt:"Status",className:"max-w-full max-h-full object-contain"}),R.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:R.text})]}),R.content_type==="video"&&e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative",children:[e.jsx("video",{src:R.content_url,autoPlay:!0,onEnded:G,className:"max-w-full max-h-full"}),R.text&&e.jsx("div",{className:"absolute bottom-10 left-0 w-full px-6 py-4 bg-gradient-to-t from-black/80 to-transparent text-white text-center text-lg font-medium",children:R.text})]}),e.jsxs("div",{className:"absolute inset-0 flex",children:[e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:W}),e.jsx("div",{className:"flex-1 h-full cursor-pointer",onClick:G})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full p-4 z-[1010] bg-gradient-to-t from-black/90 to-transparent",children:e.jsxs("form",{onSubmit:f=>{f.preventDefault(),u.trim()&&i&&(i(u,R.id),c(""))},className:"flex items-center gap-2 max-w-lg mx-auto",children:[e.jsx("input",{type:"text",value:u,onChange:f=>c(f.target.value),onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:p==="ar"?"Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Reply to story...",className:"flex-1 bg-white/10 border border-white/20 rounded-full px-4 py-3 text-white placeholder:text-white/60 focus:outline-none focus:bg-white/20 backdrop-blur-md transition-all text-sm"}),u.trim()&&e.jsx("button",{type:"submit",className:"p-3 bg-brand rounded-full text-white shadow-lg hover:brightness-110 transition-all",children:e.jsx(Vt,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -left-16 items-center",children:e.jsx("button",{onClick:W,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(Na,{className:"w-8 h-8"})})}),e.jsx("div",{className:"hidden md:flex absolute inset-y-0 -right-16 items-center",children:e.jsx("button",{onClick:G,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md border border-white/10",children:e.jsx(ts,{className:"w-8 h-8"})})})]})}let Ss=!0,ks=!0;function gt(t,a,r){const s=t.match(a);return s&&s.length>=r&&parseFloat(s[r],10)}function Ke(t,a,r){if(!t.RTCPeerConnection)return;const s=t.RTCPeerConnection.prototype,n=s.addEventListener;s.addEventListener=function(o,d){if(o!==a)return n.apply(this,arguments);const p=u=>{const c=r(u);c&&(d.handleEvent?d.handleEvent(c):d(c))};return this._eventMap=this._eventMap||{},this._eventMap[a]||(this._eventMap[a]=new Map),this._eventMap[a].set(d,p),n.apply(this,[o,p])};const i=s.removeEventListener;s.removeEventListener=function(o,d){if(o!==a||!this._eventMap||!this._eventMap[a])return i.apply(this,arguments);if(!this._eventMap[a].has(d))return i.apply(this,arguments);const p=this._eventMap[a].get(d);return this._eventMap[a].delete(d),this._eventMap[a].size===0&&delete this._eventMap[a],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,p])},Object.defineProperty(s,"on"+a,{get(){return this["_on"+a]},set(o){this["_on"+a]&&(this.removeEventListener(a,this["_on"+a]),delete this["_on"+a]),o&&this.addEventListener(a,this["_on"+a]=o)},enumerable:!0,configurable:!0})}function Ci(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ss=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Si(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(ks=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function _s(){if(typeof window=="object"){if(Ss)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function gr(t,a){ks&&console.warn(t+" is deprecated, please use "+a+" instead.")}function ki(t){const a={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return a.browser="Not a browser.",a;const{navigator:r}=t;if(r.userAgentData&&r.userAgentData.brands){const s=r.userAgentData.brands.find(n=>n.brand==="Chromium");if(s)return{browser:"chrome",version:parseInt(s.version,10)}}if(r.mozGetUserMedia)a.browser="firefox",a.version=parseInt(gt(r.userAgent,/Firefox\/(\d+)\./,1));else if(r.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)a.browser="chrome",a.version=parseInt(gt(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))a.browser="safari",a.version=parseInt(gt(r.userAgent,/AppleWebKit\/(\d+)\./,1)),a.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,a._safariVersion=gt(r.userAgent,/Version\/(\d+(\.?\d+))/,1);else return a.browser="Not a supported browser.",a;return a}function Ar(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ts(t){return Ar(t)?Object.keys(t).reduce(function(a,r){const s=Ar(t[r]),n=s?Ts(t[r]):t[r],i=s&&!Object.keys(n).length;return n===void 0||i?a:Object.assign(a,{[r]:n})},{}):t}function rr(t,a,r){!a||r.has(a.id)||(r.set(a.id,a),Object.keys(a).forEach(s=>{s.endsWith("Id")?rr(t,t.get(a[s]),r):s.endsWith("Ids")&&a[s].forEach(n=>{rr(t,t.get(n),r)})}))}function Dr(t,a,r){const s=r?"outbound-rtp":"inbound-rtp",n=new Map;if(a===null)return n;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===a.id&&i.push(o)}),i.forEach(o=>{t.forEach(d=>{d.type===s&&d.trackId===o.id&&rr(t,d,n)})}),n}const Lr=_s;function Rs(t,a){const r=t&&t.navigator;if(!r.mediaDevices)return;const s=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const p={};return Object.keys(d).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const c=typeof d[u]=="object"?d[u]:{ideal:d[u]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const l=function(h,y){return h?h+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(c.ideal!==void 0){p.optional=p.optional||[];let h={};typeof c.ideal=="number"?(h[l("min",u)]=c.ideal,p.optional.push(h),h={},h[l("max",u)]=c.ideal,p.optional.push(h)):(h[l("",u)]=c.ideal,p.optional.push(h))}c.exact!==void 0&&typeof c.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[l("",u)]=c.exact):["min","max"].forEach(h=>{c[h]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[l(h,u)]=c[h])})}),d.advanced&&(p.optional=(p.optional||[]).concat(d.advanced)),p},n=function(d,p){if(a.version>=61)return p(d);if(d=JSON.parse(JSON.stringify(d)),d&&typeof d.audio=="object"){const u=function(c,l,h){l in c&&!(h in c)&&(c[h]=c[l],delete c[l])};d=JSON.parse(JSON.stringify(d)),u(d.audio,"autoGainControl","googAutoGainControl"),u(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=s(d.audio)}if(d&&typeof d.video=="object"){let u=d.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const c=a.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete d.video.facingMode;let l;if(u.exact==="environment"||u.ideal==="environment"?l=["back","rear"]:(u.exact==="user"||u.ideal==="user")&&(l=["front"]),l)return r.mediaDevices.enumerateDevices().then(h=>{h=h.filter(b=>b.kind==="videoinput");let y=h.find(b=>l.some(v=>b.label.toLowerCase().includes(v)));return!y&&h.length&&l.includes("back")&&(y=h[h.length-1]),y&&(d.video.deviceId=u.exact?{exact:y.deviceId}:{ideal:y.deviceId}),d.video=s(d.video),Lr("chrome: "+JSON.stringify(d)),p(d)})}d.video=s(d.video)}return Lr("chrome: "+JSON.stringify(d)),p(d)},i=function(d){return a.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(d,p,u){n(d,c=>{r.webkitGetUserMedia(c,p,l=>{u&&u(i(l))})})};if(r.getUserMedia=o.bind(r),r.mediaDevices.getUserMedia){const d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(p){return n(p,u=>d(u).then(c=>{if(u.audio&&!c.getAudioTracks().length||u.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(i(c))))}}}function Ps(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Es(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.track.id):i={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[s.stream],this.dispatchEvent(o)}),s.stream.getTracks().forEach(n=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(d=>d.track&&d.track.id===n.id):i={track:n};const o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[s.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),a.apply(this,arguments)}}else Ke(t,"track",a=>(a.transceiver||Object.defineProperty(a,"transceiver",{value:{receiver:a.receiver}}),a))}function Is(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const a=function(n,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=n.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:n}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,p){let u=n.apply(this,arguments);return u||(u=a(this,d),this._senders.push(u)),u};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){i.apply(this,arguments);const p=this._senders.indexOf(d);p!==-1&&this._senders.splice(p,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(a(this,o))})};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(o=>{const d=this._senders.find(p=>p.track===o);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const a=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=a.apply(this,[]);return s.forEach(n=>n._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ms(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=s.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Dr(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),Ke(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(i=>Dr(i,n.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let n,i,o;return this.getSenders().forEach(d=>{d.track===s&&(n?o=!0:n=d)}),this.getReceivers().forEach(d=>(d.track===s&&(i?o=!0:i=d),d.track===s)),o||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}function As(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,d){if(!d)return a.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=a.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(p)===-1&&this._shimmedLocalStreams[d.id].push(p):this._shimmedLocalStreams[d.id]=[d,p],p};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(u=>{if(this.getSenders().find(l=>l.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();r.apply(this,arguments);const p=this.getSenders().filter(u=>d.indexOf(u)===-1);this._shimmedLocalStreams[o.id]=[o].concat(p)};const s=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],s.apply(this,arguments)};const n=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const p=this._shimmedLocalStreams[d].indexOf(o);p!==-1&&this._shimmedLocalStreams[d].splice(p,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),n.apply(this,arguments)}}function Ds(t,a){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&a.version>=65)return As(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=r.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(l=>this._reverseStreams[l.id])};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(l=>{if(this.getSenders().find(y=>y.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const l=new t.MediaStream(c.getTracks());this._streams[c.id]=l,this._reverseStreams[l.id]=c,c=l}s.apply(this,[c])};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(v=>v===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[l.id];if(b)b.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([c]);this._streams[l.id]=v,this._reverseStreams[v.id]=l,this.addStream(v)}return this.getSenders().find(v=>v.track===c)};function i(u,c){let l=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const y=u._reverseStreams[h],b=u._streams[y.id];l=l.replace(new RegExp(b.id,"g"),y.id)}),new RTCSessionDescription({type:c.type,sdp:l})}function o(u,c){let l=c.sdp;return Object.keys(u._reverseStreams||[]).forEach(h=>{const y=u._reverseStreams[h],b=u._streams[y.id];l=l.replace(new RegExp(y.id,"g"),b.id)}),new RTCSessionDescription({type:c.type,sdp:l})}["createOffer","createAnswer"].forEach(function(u){const c=t.RTCPeerConnection.prototype[u],l={[u](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[b=>{const v=i(this,b);h[0].apply(null,[v])},b=>{h[1]&&h[1].apply(null,b)},arguments[2]]):c.apply(this,arguments).then(b=>i(this,b))}};t.RTCPeerConnection.prototype[u]=l[u]});const d=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?d.apply(this,arguments):(arguments[0]=o(this,arguments[0]),d.apply(this,arguments))};const p=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const u=p.get.apply(this);return u.type===""?u:i(this,u)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(v=>c.track===v)&&(h=this._streams[y])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function sr(t,a){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],n={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=n[r]})}function Ls(t,a){Ke(t,"negotiationneeded",r=>{const s=r.target;if(!((a.version<72||s.getConfiguration&&s.getConfiguration().sdpSemantics==="plan-b")&&s.signalingState!=="stable"))return r})}const Or=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Ls,shimAddTrackRemoveTrack:Ds,shimAddTrackRemoveTrackWithNative:As,shimGetSendersWithDtmf:Is,shimGetUserMedia:Rs,shimMediaStream:Ps,shimOnTrack:Es,shimPeerConnection:sr,shimSenderReceiverGetStats:Ms},Symbol.toStringTag,{value:"Module"}));function Os(t,a){const r=t&&t.navigator,s=t&&t.MediaStreamTrack;if(r.getUserMedia=function(n,i,o){gr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(n).then(i,o)},!(a.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const n=function(o,d,p){d in o&&!(p in o)&&(o[p]=o[d],delete o[d])},i=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},s&&s.prototype.getSettings){const o=s.prototype.getSettings;s.prototype.getSettings=function(){const d=o.apply(this,arguments);return n(d,"mozAutoGainControl","autoGainControl"),n(d,"mozNoiseSuppression","noiseSuppression"),d}}if(s&&s.prototype.applyConstraints){const o=s.prototype.applyConstraints;s.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),n(d,"autoGainControl","mozAutoGainControl"),n(d,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[d])}}}}function _i(t,a){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!(s&&s.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return s.video===!0?s.video={mediaSource:a}:s.video.mediaSource=a,t.navigator.mediaDevices.getUserMedia(s)})}function zs(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ar(t,a){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),a.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=o[n]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,d]=arguments;return s.apply(this,[i||null]).then(p=>{if(a.version<53&&!o)try{p.forEach(u=>{u.type=r[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;p.forEach((c,l)=>{p.set(l,Object.assign({},c,{type:r[c.type]||c.type}))})}return p}).then(o,d)}}function Fs(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const a=t.RTCPeerConnection.prototype.getSenders;a&&(t.RTCPeerConnection.prototype.getSenders=function(){const n=a.apply(this,[]);return n.forEach(i=>i._pc=this),n});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const n=r.apply(this,arguments);return n._pc=this,n}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $s(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const a=t.RTCPeerConnection.prototype.getReceivers;a&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=a.apply(this,[]);return s.forEach(n=>n._pc=this),s}),Ke(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Gs(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){gr("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&r.getTracks().includes(s.track)&&this.removeTrack(s)})})}function Bs(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function qs(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.addTransceiver;a&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const n=s.length>0;n&&s.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=a.apply(this,arguments);if(n){const{sender:o}=i,d=o.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=s,o.sendEncodings=s,this.setParametersPromises.push(o.setParameters(d).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function Vs(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const a=t.RTCRtpSender.prototype.getParameters;a&&(t.RTCRtpSender.prototype.getParameters=function(){const s=a.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function Us(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}function Hs(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const a=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>a.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):a.apply(this,arguments)}}const zr=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:qs,shimCreateAnswer:Hs,shimCreateOffer:Us,shimGetDisplayMedia:_i,shimGetParameters:Vs,shimGetUserMedia:Os,shimOnTrack:zs,shimPeerConnection:ar,shimRTCDataChannel:Bs,shimReceiverGetStats:$s,shimRemoveStream:Gs,shimSenderGetStats:Fs},Symbol.toStringTag,{value:"Module"}));function Ws(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(n=>a.call(this,n,s)),s.getVideoTracks().forEach(n=>a.call(this,n,s))},t.RTCPeerConnection.prototype.addTrack=function(s,...n){return n&&n.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),a.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const n=r.getTracks();this.getSenders().forEach(i=>{n.includes(i.track)&&this.removeTrack(i)})})}}function Ys(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const i=new Event("addstream");i.stream=n,this.dispatchEvent(i)})})}});const a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(i)>=0)return;s._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,s.dispatchEvent(o)})}),a.apply(s,arguments)}}}function Js(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,r=a.createOffer,s=a.createAnswer,n=a.setLocalDescription,i=a.setRemoteDescription,o=a.addIceCandidate;a.createOffer=function(u,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h},a.createAnswer=function(u,c){const l=arguments.length>=2?arguments[2]:arguments[0],h=s.apply(this,[l]);return c?(h.then(u,c),Promise.resolve()):h};let d=function(p,u,c){const l=n.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l};a.setLocalDescription=d,d=function(p,u,c){const l=i.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l},a.setRemoteDescription=d,d=function(p,u,c){const l=o.apply(this,[p]);return c?(l.then(u,c),Promise.resolve()):l},a.addIceCandidate=d}function Xs(t){const a=t&&t.navigator;if(a.mediaDevices&&a.mediaDevices.getUserMedia){const r=a.mediaDevices,s=r.getUserMedia.bind(r);a.mediaDevices.getUserMedia=n=>s(Ks(n))}!a.getUserMedia&&a.mediaDevices&&a.mediaDevices.getUserMedia&&(a.getUserMedia=(function(s,n,i){a.mediaDevices.getUserMedia(s).then(n,i)}).bind(a))}function Ks(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ts(t.video)}):t}function Qs(t){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection;t.RTCPeerConnection=function(s,n){if(s&&s.iceServers){const i=[];for(let o=0;o<s.iceServers.length;o++){let d=s.iceServers[o];d.urls===void 0&&d.url?(gr("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,i.push(d)):i.push(s.iceServers[o])}s.iceServers=i}return new a(s,n)},t.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in a&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return a.generateCertificate}})}function Zs(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ea(t){const a=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){typeof s.offerToReceiveAudio<"u"&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):s.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof s.offerToReceiveVideo<"u"&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):s.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return a.apply(this,arguments)}}function ta(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const Fr=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ta,shimCallbacksAPI:Js,shimConstraints:Ks,shimCreateOfferLegacy:ea,shimGetUserMedia:Xs,shimLocalStreamsAPI:Ws,shimRTCIceServerUrls:Qs,shimRemoteStreamsAPI:Ys,shimTrackEventTransceiver:Zs},Symbol.toStringTag,{value:"Module"}));var Jt={exports:{}},$r;function Ti(){return $r||($r=1,(function(t){const a={};a.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},a.localCName=a.generateIdentifier(),a.splitLines=function(r){return r.trim().split(`
`).map(s=>s.trim())},a.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},a.getDescription=function(r){const s=a.splitSections(r);return s&&s[0]},a.getMediaSections=function(r){const s=a.splitSections(r);return s.shift(),s},a.matchPrefix=function(r,s){return a.splitLines(r).filter(n=>n.indexOf(s)===0)},a.parseCandidate=function(r){let s;r.indexOf("a=candidate:")===0?s=r.substring(12).split(" "):s=r.substring(10).split(" ");const n={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let i=8;i<s.length;i+=2)switch(s[i]){case"raddr":n.relatedAddress=s[i+1];break;case"rport":n.relatedPort=parseInt(s[i+1],10);break;case"tcptype":n.tcpType=s[i+1];break;case"ufrag":n.ufrag=s[i+1],n.usernameFragment=s[i+1];break;default:n[s[i]]===void 0&&(n[s[i]]=s[i+1]);break}return n},a.writeCandidate=function(r){const s=[];s.push(r.foundation);const n=r.component;n==="rtp"?s.push(1):n==="rtcp"?s.push(2):s.push(n),s.push(r.protocol.toUpperCase()),s.push(r.priority),s.push(r.address||r.ip),s.push(r.port);const i=r.type;return s.push("typ"),s.push(i),i!=="host"&&r.relatedAddress&&r.relatedPort&&(s.push("raddr"),s.push(r.relatedAddress),s.push("rport"),s.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(s.push("ufrag"),s.push(r.usernameFragment||r.ufrag)),"candidate:"+s.join(" ")},a.parseIceOptions=function(r){return r.substring(14).split(" ")},a.parseRtpMap=function(r){let s=r.substring(9).split(" ");const n={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),n.name=s[0],n.clockRate=parseInt(s[1],10),n.channels=s.length===3?parseInt(s[2],10):1,n.numChannels=n.channels,n},a.writeRtpMap=function(r){let s=r.payloadType;r.preferredPayloadType!==void 0&&(s=r.preferredPayloadType);const n=r.channels||r.numChannels||1;return"a=rtpmap:"+s+" "+r.name+"/"+r.clockRate+(n!==1?"/"+n:"")+`\r
`},a.parseExtmap=function(r){const s=r.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},a.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},a.parseFmtp=function(r){const s={};let n;const i=r.substring(r.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)n=i[o].trim().split("="),s[n[0].trim()]=n[1];return s},a.writeFmtp=function(r){let s="",n=r.payloadType;if(r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){const i=[];Object.keys(r.parameters).forEach(o=>{r.parameters[o]!==void 0?i.push(o+"="+r.parameters[o]):i.push(o)}),s+="a=fmtp:"+n+" "+i.join(";")+`\r
`}return s},a.parseRtcpFb=function(r){const s=r.substring(r.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},a.writeRtcpFb=function(r){let s="",n=r.payloadType;return r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(i=>{s+="a=rtcp-fb:"+n+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),s},a.parseSsrcMedia=function(r){const s=r.indexOf(" "),n={ssrc:parseInt(r.substring(7,s),10)},i=r.indexOf(":",s);return i>-1?(n.attribute=r.substring(s+1,i),n.value=r.substring(i+1)):n.attribute=r.substring(s+1),n},a.parseSsrcGroup=function(r){const s=r.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(n=>parseInt(n,10))}},a.getMid=function(r){const s=a.matchPrefix(r,"a=mid:")[0];if(s)return s.substring(6)},a.parseFingerprint=function(r){const s=r.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},a.getDtlsParameters=function(r,s){return{role:"auto",fingerprints:a.matchPrefix(r+s,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(r,s){let n="a=setup:"+s+`\r
`;return r.fingerprints.forEach(i=>{n+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),n},a.parseCryptoLine=function(r){const s=r.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},a.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?a.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;const s=r.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},a.getCryptoParameters=function(r,s){return a.matchPrefix(r+s,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(r,s){const n=a.matchPrefix(r+s,"a=ice-ufrag:")[0],i=a.matchPrefix(r+s,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substring(12),password:i.substring(10)}:null},a.writeIceParameters=function(r){let s="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(s+=`a=ice-lite\r
`),s},a.parseRtpParameters=function(r){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=a.splitLines(r)[0].split(" ");s.profile=i[2];for(let d=3;d<i.length;d++){const p=i[d],u=a.matchPrefix(r,"a=rtpmap:"+p+" ")[0];if(u){const c=a.parseRtpMap(u),l=a.matchPrefix(r,"a=fmtp:"+p+" ");switch(c.parameters=l.length?a.parseFmtp(l[0]):{},c.rtcpFeedback=a.matchPrefix(r,"a=rtcp-fb:"+p+" ").map(a.parseRtcpFb),s.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(c.name.toUpperCase());break}}}a.matchPrefix(r,"a=extmap:").forEach(d=>{s.headerExtensions.push(a.parseExtmap(d))});const o=a.matchPrefix(r,"a=rtcp-fb:* ").map(a.parseRtcpFb);return s.codecs.forEach(d=>{o.forEach(p=>{d.rtcpFeedback.find(c=>c.type===p.type&&c.parameter===p.parameter)||d.rtcpFeedback.push(p)})}),s},a.writeRtpDescription=function(r,s){let n="";n+="m="+r+" ",n+=s.codecs.length>0?"9":"0",n+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=s.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(o=>{n+=a.writeRtpMap(o),n+=a.writeFmtp(o),n+=a.writeRtcpFb(o)});let i=0;return s.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(n+="a=maxptime:"+i+`\r
`),s.headerExtensions&&s.headerExtensions.forEach(o=>{n+=a.writeExtmap(o)}),n},a.parseRtpEncodingParameters=function(r){const s=[],n=a.parseRtpParameters(r),i=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(r,"a=ssrc:").map(h=>a.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),p=d.length>0&&d[0].ssrc;let u;const c=a.matchPrefix(r,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(b=>parseInt(b,10)));c.length>0&&c[0].length>1&&c[0][0]===p&&(u=c[0][1]),n.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let y={ssrc:p,codecPayloadType:parseInt(h.parameters.apt,10)};p&&u&&(y.rtx={ssrc:u}),s.push(y),i&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:p,mechanism:o?"red+ulpfec":"red"},s.push(y))}}),s.length===0&&p&&s.push({ssrc:p});let l=a.matchPrefix(r,"b=");return l.length&&(l[0].indexOf("b=TIAS:")===0?l=parseInt(l[0].substring(7),10):l[0].indexOf("b=AS:")===0?l=parseInt(l[0].substring(5),10)*1e3*.95-2e3*8:l=void 0,s.forEach(h=>{h.maxBitrate=l})),s},a.parseRtcpParameters=function(r){const s={},n=a.matchPrefix(r,"a=ssrc:").map(d=>a.parseSsrcMedia(d)).filter(d=>d.attribute==="cname")[0];n&&(s.cname=n.value,s.ssrc=n.ssrc);const i=a.matchPrefix(r,"a=rtcp-rsize");s.reducedSize=i.length>0,s.compound=i.length===0;const o=a.matchPrefix(r,"a=rtcp-mux");return s.mux=o.length>0,s},a.writeRtcpParameters=function(r){let s="";return r.reducedSize&&(s+=`a=rtcp-rsize\r
`),r.mux&&(s+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(s+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),s},a.parseMsid=function(r){let s;const n=a.matchPrefix(r,"a=msid:");if(n.length===1)return s=n[0].substring(7).split(" "),{stream:s[0],track:s[1]};const i=a.matchPrefix(r,"a=ssrc:").map(o=>a.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return s=i[0].value.split(" "),{stream:s[0],track:s[1]}},a.parseSctpDescription=function(r){const s=a.parseMLine(r),n=a.matchPrefix(r,"a=max-message-size:");let i;n.length>0&&(i=parseInt(n[0].substring(19),10)),isNaN(i)&&(i=65536);const o=a.matchPrefix(r,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:s.fmt,maxMessageSize:i};const d=a.matchPrefix(r,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},a.writeSctpDescription=function(r,s){let n=[];return r.protocol!=="DTLS/SCTP"?n=["m="+r.kind+" 9 "+r.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:n=["m="+r.kind+" 9 "+r.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&n.push("a=max-message-size:"+s.maxMessageSize+`\r
`),n.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(r,s,n){let i;const o=s!==void 0?s:2;return r?i=r:i=a.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(r,s){const n=a.splitLines(r);for(let i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substring(2)}return s?a.getDirection(s):"sendrecv"},a.getKind=function(r){return a.splitLines(r)[0].split(" ")[0].substring(2)},a.isRejected=function(r){return r.split(" ",2)[1]==="0"},a.parseMLine=function(r){const n=a.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},a.parseOLine=function(r){const n=a.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},a.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;const s=a.splitLines(r);for(let n=0;n<s.length;n++)if(s[n].length<2||s[n].charAt(1)!=="=")return!1;return!0},t.exports=a})(Jt)),Jt.exports}var ra=Ti();const at=aa(ra),Ri=Ea({__proto__:null,default:at},[ra]);function It(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const a=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&(s=JSON.parse(JSON.stringify(s)),s.candidate=s.candidate.substring(2)),s.candidate&&s.candidate.length){const n=new a(s),i=at.parseCandidate(s.candidate);for(const o in i)o in n||Object.defineProperty(n,o,{value:i[o]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new a(s)},t.RTCIceCandidate.prototype=a.prototype,Ke(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function nr(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Ke(t,"icecandidate",a=>{if(a.candidate){const r=at.parseCandidate(a.candidate.candidate);r.type==="relay"&&(a.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return a})}function Mt(t,a){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(d){if(!d||!d.sdp)return!1;const p=at.splitSections(d.sdp);return p.shift(),p.some(u=>{const c=at.parseMLine(u);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},s=function(d){const p=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;const u=parseInt(p[1],10);return u!==u?-1:u},n=function(d){let p=65536;return a.browser==="firefox"&&(a.version<57?d===-1?p=16384:p=2147483637:a.version<60?p=a.version===57?65535:65536:p=2147483637),p},i=function(d,p){let u=65536;a.browser==="firefox"&&a.version===57&&(u=65535);const c=at.matchPrefix(d.sdp,"a=max-message-size:");return c.length>0?u=parseInt(c[0].substring(19),10):a.browser==="firefox"&&p!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,a.browser==="chrome"&&a.version>=76){const{sdpSemantics:p}=this.getConfiguration();p==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const p=s(arguments[0]),u=n(p),c=i(arguments[0],p);let l;u===0&&c===0?l=Number.POSITIVE_INFINITY:u===0||c===0?l=Math.max(u,c):l=Math.min(u,c);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return l}}),this._sctp=h}return o.apply(this,arguments)}}function At(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function a(s,n){const i=s.send;s.send=function(){const d=arguments[0],p=d.length||d.size||d.byteLength;if(s.readyState==="open"&&n.sctp&&p>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(s,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const n=r.apply(this,arguments);return a(n,this),n},Ke(t,"datachannel",s=>(a(s.channel,s.target),s))}function ir(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const a=t.RTCPeerConnection.prototype;Object.defineProperty(a,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(a,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const s=a[r];a[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const i=n.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",n);i.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function or(t,a){if(!t.RTCPeerConnection||a.browser==="chrome"&&a.version>=71||a.browser==="safari"&&a._safariVersion>=13.1)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&n instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function Dt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(a.browser==="chrome"&&a.version<78||a.browser==="firefox"&&a.version<68||a.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Lt(t,a){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.setLocalDescription;!r||r.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>r.apply(this,[o]))})}const Pi=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:or,shimAddIceCandidateNullOrEmpty:Dt,shimConnectionState:ir,shimMaxMessageSize:Mt,shimParameterlessSetLocalDescription:Lt,shimRTCIceCandidate:It,shimRTCIceCandidateRelayProtocol:nr,shimSendThrowTypeError:At},Symbol.toStringTag,{value:"Module"}));function Ei({window:t}={},a={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=_s,s=ki(t),n={browserDetails:s,commonShim:Pi,extractVersion:gt,disableLog:Ci,disableWarnings:Si,sdp:Ri};switch(s.browser){case"chrome":if(!Or||!sr||!a.shimChrome)return r("Chrome shim is not included in this adapter release."),n;if(s.version===null)return r("Chrome shim can not determine version, not shimming."),n;r("adapter.js shimming chrome."),n.browserShim=Or,Dt(t,s),Lt(t),Rs(t,s),Ps(t),sr(t,s),Es(t),Ds(t,s),Is(t),Ms(t),Ls(t,s),It(t),nr(t),ir(t),Mt(t,s),At(t),or(t,s);break;case"firefox":if(!zr||!ar||!a.shimFirefox)return r("Firefox shim is not included in this adapter release."),n;r("adapter.js shimming firefox."),n.browserShim=zr,Dt(t,s),Lt(t),Os(t,s),ar(t,s),zs(t),Gs(t),Fs(t),$s(t),Bs(t),qs(t),Vs(t),Us(t),Hs(t),It(t),ir(t),Mt(t,s),At(t);break;case"safari":if(!Fr||!a.shimSafari)return r("Safari shim is not included in this adapter release."),n;r("adapter.js shimming safari."),n.browserShim=Fr,Dt(t,s),Lt(t),Qs(t),ea(t),Js(t),Ws(t),Ys(t),Zs(t),Xs(t),ta(t),It(t),nr(t),Mt(t,s),At(t),or(t,s);break;default:r("Unsupported browser!");break}return n}Ei({window:typeof window>"u"?void 0:window});function Ii({callId:t,callerId:a,callerName:r,recipientId:s,isIncoming:n,type:i,onEndCall:o,currentUserId:d,sendSignaling:p,incomingOffer:u,remoteAnswer:c,remoteIceCandidates:l}){const[h,y]=m.useState("ringing"),[b,v]=m.useState(0),[C,T]=m.useState(!1),[P,E]=m.useState(i==="audio"),[R,G]=m.useState(!0),[W,g]=m.useState("user"),[f,k]=m.useState(null),[I,x]=m.useState(null),S=m.useRef(null),j=m.useRef(null),N=m.useRef(null),F=m.useRef(null),_={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}],iceCandidatePoolSize:10},B=(H,O,J)=>{const ne=H.split(`
`);let ee=-1;for(let pe=0;pe<ne.length;pe++)if(ne[pe].indexOf("m="+O)===0){ee=pe;break}if(ee===-1)return H;for(ee++;ee<ne.length&&ne[ee].indexOf("m=")!==0;){if(ne[ee].indexOf("b=AS:")===0)return ne[ee]="b=AS:"+J,ne.join(`
`);ee++}return ne.splice(ee,0,"b=AS:"+J),ne.join(`
`)},w=m.useCallback(()=>{f==null||f.getTracks().forEach(H=>H.stop()),S.current&&(S.current.onicecandidate=null,S.current.ontrack=null,S.current.close(),S.current=null),k(null),x(null)},[f]),U=m.useCallback(()=>{w(),o()},[w,o]);m.useEffect(()=>{let H;return h==="connected"&&(H=setInterval(()=>{v(O=>O+1)},1e3)),()=>clearInterval(H)},[h]);const te=H=>{const O=Math.floor(H/60),J=H%60;return`${O}:${J.toString().padStart(2,"0")}`};m.useEffect(()=>{(async()=>{try{f==null||f.getTracks().forEach(J=>J.stop());const O=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:i==="video"?{facingMode:W,width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:60}}:!1});if(k(O),S.current){const J=O.getVideoTracks()[0],ne=S.current.getSenders().find(ee=>{var pe;return((pe=ee.track)==null?void 0:pe.kind)==="video"});ne&&J&&ne.replaceTrack(J).catch(ee=>console.error("Replace track failed:",ee))}}catch(O){console.error("getUserMedia failed:",O),Z.error("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…Ø§ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©")}})()},[i,W,t]),m.useEffect(()=>{j.current&&f&&(j.current.srcObject=f)},[f]),m.useEffect(()=>f?((async()=>{try{if(!S.current){const O=new RTCPeerConnection(_);S.current=O,O.ontrack=J=>{console.log("Remote track received"),x(J.streams[0]),y("connected")},O.onicecandidate=J=>{J.candidate&&p(n?a:s,"ice-candidate",{id:t,candidate:J.candidate})},O.oniceconnectionstatechange=()=>{(O.iceConnectionState==="disconnected"||O.iceConnectionState==="failed")&&console.log("ICE failed/disconnected")},f.getTracks().forEach(J=>O.addTrack(J,f))}if(n&&u&&S.current.signalingState==="stable"){await S.current.setRemoteDescription(new RTCSessionDescription(u));let O=await S.current.createAnswer();O.sdp=B(O.sdp,"audio",64),i==="video"&&(O.sdp=B(O.sdp,"video",1e3)),await S.current.setLocalDescription(O),p(a,"call-answer",{id:t,answer:O})}else if(!n&&S.current.signalingState==="stable"){let O=await S.current.createOffer();O.sdp=B(O.sdp,"audio",64),i==="video"&&(O.sdp=B(O.sdp,"video",1e3)),await S.current.setLocalDescription(O),p(s,"call-offer",{id:t,callerId:d,callerName:r,type:i,offer:O})}}catch(O){console.error("PC init failed:",O),U()}})(),()=>{}):void 0,[f,t,n,u,i,d,r,p,U,a,s]),m.useEffect(()=>{c&&S.current&&S.current.signalingState==="have-local-offer"&&S.current.setRemoteDescription(new RTCSessionDescription(c)).catch(H=>console.error("Error setting answer:",H))},[c]),m.useEffect(()=>{l&&S.current&&S.current.remoteDescription&&l.forEach(H=>{var O;(O=S.current)==null||O.addIceCandidate(new RTCIceCandidate(H)).catch(J=>console.error("Error adding candidate:",J))})},[l]),m.useEffect(()=>{N.current&&I&&i==="video"?(N.current.srcObject=I,N.current.play().catch(H=>console.warn("Auto-play blocked:",H))):F.current&&I&&i==="audio"&&(F.current.srcObject=I,F.current.play().catch(H=>console.warn("Auto-play blocked:",H)))},[I,i]);const Y=()=>{if(f){const H=f.getAudioTracks()[0];H&&(H.enabled=C,T(!C))}},Q=()=>{if(f&&i==="video"){const H=f.getVideoTracks()[0];H&&(H.enabled=P,E(!P))}},M=()=>{G(!R),N.current&&(N.current.muted=!R),F.current&&(F.current.muted=!R)},K=()=>{g(H=>H==="user"?"environment":"user")};return e.jsxs("div",{className:"fixed inset-0 z-[1000] bg-[#111b21] flex flex-col items-center justify-center p-4",children:[i==="video"?e.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}):e.jsxs("div",{className:"flex flex-col items-center gap-6 mb-20",children:[e.jsx(Oe,{className:"w-32 h-32 border-4 border-brand/30 shadow-2xl scale-in-center",children:e.jsx(ze,{className:"bg-[#202c33] text-brand text-4xl font-bold",children:r.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-white text-3xl font-bold mb-2",children:r}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("p",{className:"text-brand font-medium animate-pulse uppercase tracking-widest text-xs",children:h==="ringing"?n?"Ù…ÙƒØ§Ù„Ù…Ø© ÙˆØ§Ø±Ø¯Ø©...":"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...":"Ù…ØªØµÙ„"}),h==="connected"&&e.jsx("p",{className:"text-white/60 font-mono text-lg",children:te(b)})]})]}),e.jsx("audio",{ref:F,autoPlay:!0})]}),i==="video"&&h==="connected"&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-20 bg-black/40 px-4 py-1 rounded-full backdrop-blur-md border border-white/10",children:e.jsx("p",{className:"text-white font-mono",children:te(b)})}),i==="video"&&f&&e.jsx("div",{className:"absolute top-6 right-6 w-32 md:w-48 aspect-[3/4] rounded-xl overflow-hidden shadow-2xl border-2 border-white/20 z-10",children:e.jsx("video",{ref:j,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover -scale-x-100"})}),e.jsxs("div",{className:"absolute bottom-12 flex items-center gap-6 bg-[#202c33]/90 backdrop-blur-xl p-6 rounded-full border border-white/10 shadow-2xl z-20",children:[e.jsx(fe,{onClick:Y,className:`w-14 h-14 rounded-full transition-all ${C?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:C?e.jsx(Ca,{}):e.jsx(mr,{})}),i==="video"&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{onClick:Q,className:`w-14 h-14 rounded-full transition-all ${P?"bg-red-500 hover:bg-red-600":"bg-gray-700 hover:bg-gray-600"}`,children:P?e.jsx(Sa,{}):e.jsx(yt,{})}),e.jsx(fe,{onClick:K,className:"w-14 h-14 rounded-full bg-gray-700 hover:bg-gray-600 transition-all",children:e.jsx(Qr,{className:"w-6 h-6"})})]}),e.jsx(fe,{onClick:M,className:`w-14 h-14 rounded-full ${R?"bg-gray-700":"bg-red-500"}`,children:R?e.jsx(Gt,{}):e.jsx(Kr,{})}),e.jsx(fe,{onClick:U,className:"w-16 h-16 rounded-full bg-red-600 hover:bg-red-700 flex items-center justify-center",children:e.jsx(Zr,{className:"w-8 h-8"})})]})]})}function xt({icon:t,title:a,subtitle:r,onClick:s,colorClass:n="bg-brand/10 text-brand",isDestructive:i=!1,trailing:o}){return e.jsxs("button",{onClick:s,className:`w-full flex items-center gap-4 p-4 rounded-xl border border-transparent hover:bg-white/5 transition-all text-left group ${i?"hover:bg-red-500/10":""}`,children:[e.jsx("div",{className:`p-2.5 rounded-xl ${i?"bg-red-500/10 text-red-500":n} transition-transform group-hover:scale-110`,children:e.jsx(t,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium text-base ${i?"text-red-500":"text-white"}`,children:a}),r&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:r})]}),o||e.jsx("div",{className:`text-gray-600 ${i?"text-red-500/50":""}`,children:e.jsx(ts,{className:"w-5 h-5 rtl:rotate-180"})})]})}function Et({title:t,onBack:a,language:r}){return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 rounded-full hover:bg-white/10 text-gray-400 hover:text-white transition-colors",children:e.jsx(He,{className:`w-6 h-6 ${r==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-white to-white/60 bg-clip-text text-transparent",children:t})]})}function Mi({user:t,onBack:a,onGoToProfile:r,onLogout:s,notificationsEnabled:n,onEnableNotifications:i,micEnabled:o,onEnableMic:d,soundEnabled:p,onToggleSound:u,currentSoundId:c,notificationSounds:l,onSelectSound:h,onTestSound:y,language:b,onLanguageChange:v,t:C}){const[T,P]=m.useState("main"),{accentColor:E,setAccentColor:R,wallpaper:G,setWallpaper:W,bgOpacity:g,setBgOpacity:f}=Cs(),k=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[e.jsxs("div",{onClick:r,className:"relative overflow-hidden flex items-center gap-4 bg-gradient-to-br from-[#202c33] to-[#111b21] p-5 rounded-2xl border border-white/5 hover:border-brand/30 transition-all cursor-pointer group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-brand/10 rounded-full blur-3xl -mr-16 -mt-16 transition-opacity group-hover:opacity-100 opacity-50"}),e.jsxs(Oe,{className:"w-16 h-16 border-2 border-white/10 group-hover:border-brand/50 transition-colors shadow-lg",children:[e.jsx(We,{src:t.avatar_url}),e.jsx(ze,{className:"text-xl bg-brand text-white",children:t.name.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"flex-1 min-w-0 z-10",children:[e.jsx("h4",{className:"text-white font-bold text-lg truncate",children:t.name}),e.jsxs("p",{className:"text-gray-400 text-sm truncate",children:["@",t.username]})]}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-gray-400 group-hover:bg-brand group-hover:text-white transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"px-1 text-xs font-bold text-gray-500 uppercase tracking-wider",children:b==="ar"?"Ø¹Ø§Ù…":"General"}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:[e.jsx(xt,{icon:Ot,title:b==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø£ØµÙˆØ§Øª":"Notifications & Sounds",subtitle:b==="ar"?"Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª":"Messages, groups, call tones",colorClass:"bg-red-500/10 text-red-400",onClick:()=>P("notifications")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:Br,title:b==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†":"Privacy & Security",subtitle:b==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©":"App lock, active sessions",colorClass:"bg-emerald-500/10 text-emerald-400",onClick:()=>P("privacy")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:wr,title:b==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",subtitle:b==="ar"?"Ù†Ù…Ø· Ø§Ù„Ø®Ù„ÙÙŠØ©ØŒ Ø§Ù„Ø£Ù„ÙˆØ§Ù†":"Wallpaper, theme colors",colorClass:"bg-purple-500/10 text-purple-400",onClick:()=>P("appearance")}),e.jsx("div",{className:"h-px bg-white/5 mx-16"}),e.jsx(xt,{icon:ka,title:b==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",subtitle:b==="ar"?"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":"English",colorClass:"bg-blue-500/10 text-blue-400",onClick:()=>P("language")})]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5",children:e.jsx(xt,{icon:_a,title:b==="ar"?"ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬":"Log Out",onClick:s,isDestructive:!0})})}),e.jsx("p",{className:"text-center text-xs text-gray-600 pt-4",children:"Chat App v1.2.0 â€¢ 2024"})]}),I=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${n?"bg-brand/20 text-brand":"bg-gray-800 text-gray-500"}`,children:e.jsx(Ot,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨":"Desktop Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:n?"Enabled":"Disabled"})]})]}),e.jsx(fe,{onClick:()=>{jt.requestNotificationPermission().then(N=>{N?i():Z.error(b==="ar"?"ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª":"Notifications disabled in browser")})},disabled:n,variant:n?"ghost":"outline",children:n?b==="ar"?"Ù…ÙØ¹Ù„":"On":b==="ar"?"ØªÙØ¹ÙŠÙ„":"Turn On"})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${p?"bg-orange-500/20 text-orange-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(Gt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø£ØµÙˆØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Conversation Tones"}),e.jsx("p",{className:"text-sm text-gray-500",children:b==="ar"?"ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©":"Play sounds for incoming messages"})]})]}),e.jsx("div",{onClick:()=>u(!p),className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${p?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${p?"right-1":"left-1"}`})})]}),p&&e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl p-4 border border-white/5 space-y-3",children:[e.jsx("p",{className:"text-sm font-bold text-gray-400 uppercase",children:b==="ar"?"Ù†ØºÙ…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±":"Alert Tone"}),l.map(N=>e.jsxs("div",{onClick:()=>h(N.id),className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all border ${c===N.id?"bg-brand/10 border-brand/50 scale-[1.02]":"bg-transparent border-transparent hover:bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${c===N.id?"border-brand":"border-gray-500"}`,children:c===N.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand"})}),e.jsx("span",{className:"text-sm font-medium",children:N.name})]}),e.jsx("button",{onClick:F=>{F.stopPropagation(),new Audio(N.url).play()},className:"p-2 hover:bg-white/10 rounded-full text-brand",children:e.jsx(Gt,{className:"w-4 h-4"})})]},N.id))]})]})]}),x=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ù…Ø¸Ù‡Ø±":"Appearance",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(wr,{className:"w-5 h-5 text-purple-400"}),e.jsx("h4",{className:"font-medium text-white",children:b==="ar"?"Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"Accent Color"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-2 scrollbar-hide",children:Object.keys(tr).map(N=>e.jsx("button",{onClick:()=>R(N),className:`w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-lg ${E===N?"ring-2 ring-white scale-110":"opacity-70 hover:opacity-100 hover:scale-105"}`,style:{backgroundColor:tr[N].hex},children:E===N&&e.jsx(Le,{className:"w-6 h-6 text-white drop-shadow-md"})},N))})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl border border-white/5 p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ta,{className:"w-5 h-5 text-amber-400"}),e.jsx("h4",{className:"font-medium text-white",children:b==="ar"?"Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Chat Wallpaper"})]}),e.jsxs("select",{value:G,onChange:N=>W(N.target.value),className:"bg-black/30 text-white text-sm rounded-lg px-3 py-2 outline-none border border-white/10 focus:border-brand",children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"doodles",children:"Doodles"}),e.jsx("option",{value:"stars",children:"Stars Pattern"}),e.jsx("option",{value:"geometric",children:"Geometric"}),e.jsx("option",{value:"solid",children:"Solid Color"})]})]}),G!=="solid"&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:b==="ar"?"Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ù†Ù…Ø·":"Pattern Opacity"}),e.jsxs("span",{className:"text-xs text-brand font-bold",children:[Math.round(g*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:g,onChange:N=>f(parseFloat(N.target.value)),className:"w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-brand"})]})]})]})]}),S=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ø®ØµÙˆØµÙŠØ©":"Privacy & Security",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-emerald-500/20 text-emerald-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(es,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ù‚ÙÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚":"App Lock"}),e.jsx("p",{className:"text-sm text-gray-500",children:b==="ar"?"ØªØ£Ù…ÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø±Ù…Ø² Ù…Ø±ÙˆØ±":"Secure app with passcode"})]})]}),e.jsx("div",{onClick:()=>{const N=localStorage.getItem("chat_app_lock_enabled")==="true";localStorage.setItem("chat_app_lock_enabled",(!N).toString()),P("privacy"),window.dispatchEvent(new Event("storage"))},className:`w-12 h-7 rounded-full relative cursor-pointer shadow-inner transition-colors ${localStorage.getItem("chat_app_lock_enabled")==="true"?"bg-brand":"bg-white/10"}`,children:e.jsx("div",{className:`absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-all ${localStorage.getItem("chat_app_lock_enabled")==="true"?"right-1":"left-1"}`})})]}),localStorage.getItem("chat_app_lock_enabled")==="true"&&e.jsxs("div",{className:"bg-[#202c33]/30 rounded-xl border border-white/5 overflow-hidden animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between border-b border-white/5",children:[e.jsx("span",{className:"text-sm font-medium",children:b==="ar"?"Ø±Ù…Ø² Ø§Ù„Ù…Ø±ÙˆØ±":"Passcode"}),e.jsx(fe,{onClick:()=>{if(localStorage.getItem("chat_app_pin"))localStorage.removeItem("chat_app_pin"),localStorage.removeItem("chat_app_biometric"),Z.success("Passcode removed"),P("privacy");else{const F=prompt("Enter new 6-digit PIN:");F&&F.length===6&&!isNaN(Number(F))&&(localStorage.setItem("chat_app_pin",F),Z.success("Passcode set"),P("privacy"))}},variant:"outline",size:"sm",className:"h-8",children:localStorage.getItem("chat_app_pin")?b==="ar"?"ØªØºÙŠÙŠØ± / Ø­Ø°Ù":"Change / Remove":b==="ar"?"Ø¥Ø¹Ø¯Ø§Ø¯":"Setup"})]}),localStorage.getItem("chat_app_pin")&&e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:b==="ar"?"Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡ / Ø§Ù„Ø¥ØµØ¨Ø¹":"Biometric Unlock"}),e.jsx(fe,{onClick:()=>{const N=localStorage.getItem("chat_app_biometric")==="true";localStorage.setItem("chat_app_biometric",(!N).toString()),P("privacy"),Z.success(N?"Biometrics disabled":"Biometrics enabled (if supported)")},variant:"ghost",size:"sm",className:localStorage.getItem("chat_app_biometric")==="true"?"text-brand":"text-gray-400",children:localStorage.getItem("chat_app_biometric")==="true"?b==="ar"?"Ù…ÙØ¹Ù„":"Enabled":b==="ar"?"Ù…Ø¹Ø·Ù„":"Disabled"})]})]}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-xl p-4 border border-white/5 flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl ${o?"bg-blue-500/20 text-blue-400":"bg-gray-800 text-gray-500"}`,children:e.jsx(mr,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:b==="ar"?"Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†":"Microphone Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:o?"Granted":"Needed for voice notes"})]})]}),e.jsx(fe,{onClick:()=>{jt.requestMicPermission().then(N=>{N?d():Z.error(b==="ar"?"ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØµÙˆØª":"Microphone access required")})},disabled:o,variant:o?"ghost":"outline",children:o?b==="ar"?"Ù…Ø³Ù…ÙˆØ­":"Allowed":b==="ar"?"Ø³Ù…Ø§Ø­":"Allow"})]})]})]}),j=()=>e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsx(Et,{title:b==="ar"?"Ø§Ù„Ù„ØºØ©":"Language",onBack:()=>P("main"),language:b}),e.jsxs("div",{className:"bg-[#202c33]/50 rounded-2xl overflow-hidden border border-white/5 divide-y divide-white/5",children:[e.jsxs("button",{onClick:()=>{v("en"),P("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium",children:"English"}),b==="en"&&e.jsx(Le,{className:"w-5 h-5 text-brand"})]}),e.jsxs("button",{onClick:()=>{v("ar"),P("main")},className:"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors",children:[e.jsx("span",{className:"text-white font-medium font-arabic",children:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}),b==="ar"&&e.jsx(Le,{className:"w-5 h-5 text-brand"})]})]})]});return e.jsxs("div",{className:"flex flex-col h-full bg-[#111b21] text-white",children:[T==="main"&&e.jsxs("div",{className:"p-4 bg-[#202c33]/80 backdrop-blur-md sticky top-0 z-10 flex items-center gap-4 border-b border-white/5",children:[e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(He,{className:`w-6 h-6 ${b==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:"text-xl font-bold",children:C("settings")})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto ${T==="main"?"p-6":"p-6 bg-[#111b21]"}`,children:[T==="main"&&k(),T==="notifications"&&I(),T==="appearance"&&x(),T==="privacy"&&S(),T==="language"&&j()]})]})}function Gr({user:t,onBack:a,onUpdate:r,isPublicView:s,language:n,t:i,onStartChat:o}){var j;const[d,p]=m.useState((t==null?void 0:t.name)||""),[u,c]=m.useState((t==null?void 0:t.birth_year)||""),[l,h]=m.useState((t==null?void 0:t.gender)||""),[y,b]=m.useState((t==null?void 0:t.about)||(s?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")),[v,C]=m.useState(!1),[T,P]=m.useState(!1),[E,R]=m.useState(!1),[G,W]=m.useState(!1),[g,f]=m.useState(!1),k=m.useRef(null),I=m.useRef(null),x=m.useRef(null);if(m.useEffect(()=>{t&&(p(t.name||""),c(t.birth_year||""),h(t.gender||""),b(t.about||(s?n==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©":"No bio provided":n==="ar"?"Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ø£Ø³ØªØ®Ø¯Ù… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.":"Hey there! I am using Chat App.")))},[t,s,n]),m.useEffect(()=>{T&&k.current&&k.current.focus()},[T]),m.useEffect(()=>{E&&I.current&&I.current.focus()},[E]),m.useEffect(()=>{G&&x.current&&x.current.focus()},[G]),!t)return e.jsxs("div",{className:"flex flex-col h-full bg-slate-950 items-center justify-center p-8 text-center space-y-4",children:[e.jsx(je,{className:"w-12 h-12 text-brand animate-spin"}),e.jsx("p",{className:"text-slate-400 font-medium",children:n==="ar"?"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...":"Loading profile..."}),e.jsx("button",{onClick:a,className:"text-brand hover:underline",children:n==="ar"?"Ø±Ø¬ÙˆØ¹":"Go Back"})]});const S=async()=>{if(!d.trim())return Z.error(n==="ar"?"Ø§Ù„Ø§Ø³Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹":"Name cannot be empty");C(!0);try{const{error:N}=await X.from("profiles").update({name:d.trim(),about:y.trim(),birth_year:u?parseInt(u.toString()):null,gender:l||null}).eq("id",t.id);if(N)throw N;Z.success(i("profileUpdatedSuccessfully")),r&&r({...t,name:d.trim(),about:y.trim(),birth_year:u?parseInt(u.toString()):null,gender:l||null}),P(!1),R(!1),W(!1),f(!1)}catch(N){console.error("Error updating profile:",N),Z.error(n==="ar"?"ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ":"Failed to update profile")}finally{C(!1)}};return e.jsxs(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col h-full bg-slate-950 w-full relative overflow-hidden z-[500]",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-brand/10 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-violet-500/5 rounded-full blur-[100px] animate-pulse"}),e.jsx("div",{className:"absolute inset-0 premium-doodle opacity-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950 border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:a,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(He,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${n==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-white text-xl font-bold ${n==="ar"?"font-arabic":""}`,children:i(s?"partnerProfile":"profile")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[e.jsxs("div",{className:`relative group ${s?"":"cursor-pointer"}`,children:[e.jsxs(Oe,{className:"w-40 h-40 border-4 border-slate-900 shadow-2xl group-hover:border-brand/50 transition-colors duration-500",children:[e.jsx(We,{src:t==null?void 0:t.avatar_url,className:"object-cover"}),e.jsx(ze,{className:"bg-slate-800 text-4xl font-bold text-brand",children:(j=t==null?void 0:t.name)==null?void 0:j.charAt(0).toUpperCase()})]}),!s&&e.jsxs("div",{className:"absolute inset-0 bg-black/40 rounded-full flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-sm",children:[e.jsx(rs,{className:"w-8 h-8 text-white mb-2"}),e.jsx("span",{className:"text-xs text-white font-medium",children:n==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©":"Change Photo"})]})]}),s&&o&&e.jsxs(fe,{onClick:o,className:"bg-brand hover:bg-brand/80 text-white rounded-full px-8 shadow-lg shadow-brand/20 mt-6",children:[e.jsx(Xt,{className:"w-4 h-4 mr-2"}),n==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©":"Send Message"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brand text-xs font-bold uppercase tracking-wider",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("name")})]}),!T&&!s&&e.jsx("button",{onClick:()=>P(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(St,{className:"w-4 h-4"})})]}),T?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(we,{ref:k,value:d,onChange:N=>p(N.target.value),className:"bg-slate-950/50 border-white/10 text-lg font-medium text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ":"Enter your name"}),e.jsx(fe,{size:"icon",onClick:S,disabled:v,className:"bg-brand hover:bg-brand/80",children:v?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(Ht,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-white text-lg font-medium pl-1",children:d})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 md:p-6 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Xt,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("about")})]}),!E&&!s&&e.jsx("button",{onClick:()=>R(!0),className:"p-2 text-slate-500 hover:text-brand transition-colors",children:e.jsx(St,{className:"w-4 h-4"})})]}),E?e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(we,{ref:I,value:y,onChange:N=>b(N.target.value),className:"bg-slate-950/50 border-white/10 text-base text-white focus:ring-brand/50 focus:border-brand/50",placeholder:n==="ar"?"Ø£Ø¶Ù Ù†Ø¨Ø°Ø©":"Add a bio"}),e.jsx(fe,{size:"icon",onClick:S,disabled:v,className:"bg-brand hover:bg-brand/80",children:v?e.jsx(je,{className:"w-4 h-4 animate-spin"}):e.jsx(Ht,{className:"w-4 h-4"})})]}):e.jsx("p",{className:"text-slate-300 text-base pl-1",children:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("birth_year")})]}),!G&&!s&&e.jsx("button",{onClick:()=>W(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(St,{className:"w-3 h-3"})})]}),G?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(we,{ref:x,type:"number",value:u,onChange:N=>c(N.target.value),className:"bg-slate-950/50 border-white/10 text-sm text-white h-8",placeholder:"YYYY"}),e.jsx(fe,{size:"icon",onClick:S,className:"h-8 w-8 bg-brand hover:bg-brand/80",children:e.jsx(Ht,{className:"w-3 h-3"})})]}):e.jsx("p",{className:"text-white text-base pl-1",children:u||(n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified")})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-white/5 rounded-2xl p-4 hover:bg-slate-900/60 transition-colors group",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs font-bold uppercase tracking-wider group-hover:text-brand transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4"}),e.jsx("span",{className:n==="ar"?"font-arabic":"",children:i("gender")})]}),!g&&!s&&e.jsx("button",{onClick:()=>f(!0),className:"p-1 text-slate-500 hover:text-brand",children:e.jsx(St,{className:"w-3 h-3"})})]}),g?e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:l,onChange:N=>{h(N.target.value),setTimeout(()=>S(),100)},className:"bg-slate-950 text-white text-sm border-white/10 rounded-md p-1 flex-1 outline-none ring-1 ring-white/10",children:[e.jsx("option",{value:"",children:n==="ar"?"Ø§Ø®ØªØ§Ø±":"Select"}),e.jsx("option",{value:"male",children:i("male")}),e.jsx("option",{value:"female",children:i("female")})]})}):e.jsx("p",{className:"text-white text-base pl-1",children:l==="male"?i("male"):l==="female"?i("female"):n==="ar"?"Ù„Ù… ÙŠØ­Ø¯Ø¯":"Not specified"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx(Xr,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ":"Email"})]}),e.jsx("p",{className:"text-slate-300 font-mono text-sm truncate",children:t.email||"Hidden"})]}),e.jsxs("div",{className:"bg-slate-900/20 border border-white/5 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 text-xs font-bold uppercase tracking-wider mb-2",children:[e.jsx($t,{className:"w-4 h-4"}),e.jsx("span",{children:n==="ar"?"Ø§Ù†Ø¶Ù… ÙÙŠ":"Joined"})]}),e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(t.created_at||Date.now()).toLocaleDateString()})]})]})]})]})})]})}function Ai({onBack:t,currentUserId:a,language:r,t:s}){const[n,i]=m.useState(""),[o,d]=m.useState("user"),[p,u]=m.useState(null),[c,l]=m.useState(!1),[h,y]=m.useState(!1),[b,v]=m.useState(!1),C=async()=>{if(!n.trim())return;const E=n.trim().toLowerCase().replace(o==="user"?"@":"#","");l(!0),y(!1),u(null),await new Promise(R=>setTimeout(R,600));try{if(o==="user"){const{data:R}=await X.from("profiles").select("id, display_name, username").eq("username",E).maybeSingle();if(R){if(R.id===a){y(!0);return}const{data:G}=await X.from("conversation_participants").select("conversation_id").eq("user_id",R.id),W=(G==null?void 0:G.map(k=>k.conversation_id))||[];let g=!1;if(W.length>0){const{data:k}=await X.from("conversation_participants").select("conversation_id").eq("user_id",a).in("conversation_id",W).maybeSingle();g=!!k}const{data:f}=await X.from("chat_requests").select("status, sender_id").or(`and(sender_id.eq.${a},receiver_id.eq.${R.id}),and(sender_id.eq.${R.id},receiver_id.eq.${a})`).maybeSingle();u({id:R.id,identifier:R.username,name:R.display_name||R.username,hasChat:g,requestStatus:f==null?void 0:f.status,requestSenderId:f==null?void 0:f.sender_id})}else y(!0)}else{const{data:R}=await X.from("groups").select("id, name, group_id, description").eq("group_id",E).maybeSingle();if(R){const{data:G}=await X.from("group_members").select("id").eq("group_id",R.id).eq("user_id",a).maybeSingle();u({id:R.id,identifier:R.group_id,name:R.name,description:R.description,isMember:!!G})}else y(!0)}}catch(R){console.error("Search error:",R),y(!0)}finally{l(!1)}},T=async()=>{if(!(!p||b)){v(!0);try{const{error:E}=await X.from("chat_requests").upsert({sender_id:a,receiver_id:p.id,status:"pending"},{onConflict:"sender_id,receiver_id"});if(E)throw E;Z.success(r==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!":"Request sent successfully!"),u(R=>R?{...R,requestStatus:"pending",requestSenderId:a}:null)}catch(E){Z.error(E.message||(r==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨":"Failed to send request"))}finally{v(!1)}}},P=async()=>{if(!(!p||b)){v(!0);try{const{error:E}=await X.from("group_members").insert({group_id:p.id,user_id:a,role:"member"});if(E)throw E;Z.success(r==="ar"?"ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Joined group successfully!"),u(R=>R?{...R,isMember:!0}:null)}catch(E){console.error("Join group error:",E),Z.error(r==="ar"?"ÙØ´Ù„ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to join group")}finally{v(!1)}}};return e.jsxs("div",{className:"flex flex-col h-[100dvh] bg-slate-950 text-white overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-full h-full bg-gradient-to-bl from-indigo-900/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3 relative z-10 border-b border-white/5 bg-slate-900/50 backdrop-blur-sm",children:[e.jsx(D.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:t,className:"text-slate-400 hover:text-white transition-colors p-1 rounded-full hover:bg-white/5",children:e.jsx(He,{className:`w-6 h-6 ${r==="ar"?"rotate-180":""}`})}),e.jsx("h2",{className:`text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 ${r==="ar"?"font-arabic":""}`,children:s("newChat")})]}),e.jsxs("div",{className:"flex border-b border-white/5 relative z-10",children:[e.jsxs("button",{type:"button",onClick:()=>{d("user"),u(null),y(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="user"?"text-brand":"text-slate-500 hover:text-slate-300"} ${r==="ar"?"font-arabic":""}`,children:[r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…":"Find User",o==="user"&&e.jsx(D.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]}),e.jsxs("button",{type:"button",onClick:()=>{d("group"),u(null),y(!1),i("")},className:`flex-1 py-4 text-sm font-bold transition-all relative ${o==="group"?"text-brand":"text-slate-500 hover:text-slate-300"} ${r==="ar"?"font-arabic":""}`,children:[r==="ar"?"Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©":"Find Group",o==="group"&&e.jsx(D.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-brand shadow-[0_0_10px_rgba(var(--brand-rgb),0.5)]"})]})]}),e.jsx("div",{className:"flex-1 px-4 py-8 overflow-y-auto relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(D.p,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 mb-6 text-center text-sm",children:o==="user"?r==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡Ù… (Ù…Ø«Ù„Ø§Ù‹ elgin@)":"Search for users by their username (e.g. @elgin)":r==="ar"?"Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù…Ø«Ù„Ø§Ù‹ #developers)":"Search for groups by their Group ID (e.g. #developers)"}),e.jsxs("form",{onSubmit:E=>{E.preventDefault(),C()},className:"flex gap-2 mb-8 relative z-50",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand font-bold pointer-events-none text-lg",children:o==="user"?"@":"#"}),e.jsx(we,{type:"text",inputMode:"search",autoComplete:"off",autoCorrect:"off",spellCheck:"false",placeholder:o==="user"?r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"username":r==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"group-id",value:n,onChange:E=>{i(E.target.value),y(!1),u(null)},className:"pl-8 bg-slate-900/50 border-white/5 focus:border-brand/50 focus:ring-1 focus:ring-brand/50 rounded-xl text-white placeholder:text-slate-600 h-12 text-lg font-medium transition-all"})]}),e.jsx(D.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:c||!n.trim(),className:"bg-brand hover:bg-brand/80 disabled:opacity-50 text-white h-12 w-12 rounded-xl flex items-center justify-center transition-all shadow-lg shadow-brand/20",children:e.jsx(vt,{className:"w-6 h-6 pointer-events-none"})})]}),c&&e.jsxs("div",{className:"flex flex-col items-center justify-center text-slate-400 py-8 gap-2",children:[e.jsx(je,{className:"w-8 h-8 animate-spin text-brand"}),e.jsx("span",{className:"text-xs animate-pulse",children:r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©...":"Searching the network..."})]}),h&&e.jsxs(D.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-slate-900/50 border border-white/5 rounded-2xl p-6 text-center",children:[e.jsxs("p",{className:"text-slate-300 font-medium text-lg",children:[o==="user"?r==="ar"?"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"User":r==="ar"?"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Group"," ",r==="ar"?"ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯":"not found"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:r==="ar"?"ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ù‘Ù ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.":"Check the ID and try again."})]}),e.jsx(xe,{children:p&&e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},className:"bg-slate-900/80 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand via-purple-500 to-brand"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-xl font-bold",children:p.name}),e.jsxs("p",{className:"text-brand text-sm font-medium bg-brand/10 px-2 py-0.5 rounded-md w-fit mt-1",children:[o==="user"?"@":"#",p.identifier]}),p.description&&e.jsx("p",{className:"text-slate-400 text-sm mt-2 leading-relaxed",children:p.description})]}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-brand to-violet-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20 rotate-3",children:o==="user"?e.jsx(Ue,{className:"w-7 h-7"}):e.jsx(bt,{className:"w-7 h-7"})})]}),o==="user"?p.hasChat?e.jsx("div",{className:"bg-brand/10 text-brand border border-brand/20 rounded-xl py-3 text-center text-sm font-medium",children:r==="ar"?"Ù„Ø¯ÙŠÙƒ Ø¯Ø±Ø¯Ø´Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…":"You already have a chat with this user"}):p.requestStatus==="pending"?e.jsx("div",{className:"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded-xl py-3 text-center text-sm font-medium",children:p.requestSenderId===a?r==="ar"?"Ø§Ù„Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...":"Request Pending...":r==="ar"?"Ø£Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ Ø·Ù„Ø¨Ø§Ù‹!":"Sent you a request!"}):e.jsx(fe,{onClick:T,disabled:b,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:b?e.jsx(je,{className:"w-5 h-5 animate-spin"}):r==="ar"?"Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¯Ø±Ø¯Ø´Ø©":"Send Chat Request"}):p.isMember?e.jsx("div",{className:"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-xl py-3 text-center text-sm font-medium",children:r==="ar"?"Ø£Ù†Øª Ø¹Ø¶Ùˆ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"You are already a member"}):e.jsx(fe,{onClick:P,disabled:b,className:"w-full h-12 bg-brand hover:bg-brand/80 text-white font-bold rounded-xl shadow-lg shadow-brand/25 transition-all text-base",children:b?e.jsx(je,{className:"w-5 h-5 animate-spin"}):r==="ar"?"Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Join Group"})]})})]})})]})}function Di({onBack:t,currentUserId:a,language:r,t:s}){const[n,i]=m.useState(""),[o,d]=m.useState(""),[p,u]=m.useState(""),[c,l]=m.useState(!1),[h,y]=m.useState(null),b=async()=>{if(!n.trim()||!o.trim()){Z.error(r==="ar"?"ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©":"Please fill in required fields",{description:r==="ar"?"Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.":"Group Name and Unique ID are required."});return}l(!0);try{const{data:v,error:C}=await X.from("groups").insert({name:n.trim(),group_id:o.trim().toLowerCase(),description:p.trim(),created_by:a}).select().single();if(C)throw C;const{error:T}=await X.from("group_members").insert({group_id:v.id,user_id:a,role:"admin"});if(T)throw T;Z.success(r==="ar"?"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­!":"Group Created Successfully!",{description:r==="ar"?`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ${n.trim()}`:`Welcome to ${n.trim()}`}),t()}catch(v){console.error("Error creating group:",v),v.code==="23505"?Z.error(r==="ar"?"Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ø£Ø®ÙˆØ° Ø¨Ø§Ù„ÙØ¹Ù„":"Group ID already taken",{description:r==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹Ø±Ù‘Ù ÙØ±ÙŠØ¯ Ø¢Ø®Ø±.":"Please choose a different unique ID."}):Z.error(r==="ar"?"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Failed to create group",{description:v.message||(r==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.":"Please try again later.")})}finally{l(!1)}};return e.jsxs(D.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:50},className:"flex flex-col h-full bg-slate-950 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/10 via-slate-950 to-violet-900/10 pointer-events-none"}),e.jsx("div",{className:"absolute -top-32 -right-32 w-64 h-64 bg-indigo-500/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-32 -left-32 w-64 h-64 bg-violet-500/10 rounded-full blur-3xl animate-pulse"}),e.jsxs("div",{className:"relative z-10 px-4 py-4 flex items-center gap-4 bg-slate-950/80 backdrop-blur-md border-b border-white/5 sticky top-0",children:[e.jsx("button",{onClick:t,className:"p-2 -ml-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-colors group",children:e.jsx(He,{className:`w-6 h-6 group-hover:-translate-x-1 transition-transform ${r==="ar"?"rotate-180":""}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:`text-white text-xl font-bold flex items-center gap-2 ${r==="ar"?"font-arabic":""}`,children:[s("createGroup"),e.jsx(nt,{className:"w-4 h-4 text-indigo-400"})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:r==="ar"?"Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ø§Ø³ Ù…Ø¹Ø§Ù‹":"Bring people together"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative z-10",children:e.jsxs("div",{className:"max-w-md mx-auto px-6 py-8 space-y-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(D.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"w-32 h-32 bg-gradient-to-tr from-slate-800 to-slate-700 rounded-full flex items-center justify-center cursor-pointer relative group border-4 border-slate-950 shadow-2xl",children:[e.jsx(rs,{className:"w-10 h-10 text-slate-400 group-hover:text-white transition-colors"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-white text-xs font-medium",children:r==="ar"?"ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©":"Change Icon"})}),e.jsx("div",{className:"absolute -inset-1 rounded-full border border-indigo-500/30 opacity-0 group-hover:opacity-100 transition-opacity scale-110"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:r==="ar"?"Ø§Ø¶ØºØ· Ù„ØªØ¹ÙŠÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Tap to set group icon"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:re("text-sm font-medium transition-colors ml-1",h==="name"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:[s("name")," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:re("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="name"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(bt,{className:re("w-5 h-5 transition-colors",h==="name"?"text-indigo-400":"text-slate-500")}),e.jsx(we,{type:"text",placeholder:r==="ar"?"Ù…Ø«Ù„Ø§Ù‹: Ø±Ø­Ù„Ø© Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹":"e.g. Weekend Trip Squad",value:n,onChange:v=>i(v.target.value),onFocus:()=>y("name"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:re("text-sm font-medium transition-colors ml-1",h==="id"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:[r==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù Ø§Ù„ÙØ±ÙŠØ¯":"Unique ID"," ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:re("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="id"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Ra,{className:re("w-5 h-5 transition-colors",h==="id"?"text-indigo-400":"text-slate-500")}),e.jsx(we,{type:"text",placeholder:r==="ar"?"Ù…Ø¹Ø±Ù‘Ù-Ù…Ø¬Ù…ÙˆØ¹Ø©-ÙØ±ÙŠØ¯":"unique-group-handle",value:o,onChange:v=>d(v.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"-")),onFocus:()=>y("id"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 ml-1",children:[r==="ar"?"ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¹Ø¨Ø±":"Users can join via"," ",e.jsxs("span",{className:"font-mono text-indigo-400 bg-indigo-500/10 px-1 rounded",children:["#",o||(r==="ar"?"Ø§Ù„Ù…Ø¹Ø±Ù‘Ù":"handle")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:re("text-sm font-medium transition-colors ml-1",h==="desc"?"text-indigo-400":"text-slate-400",r==="ar"?"font-arabic":""),children:s("about")}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:re("absolute inset-0 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-xl blur transition-opacity duration-300",h==="desc"?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"relative bg-slate-900/80 border border-white/10 rounded-xl flex items-center px-4 transition-colors group-hover:border-white/20 focus-within:border-indigo-500/50",children:[e.jsx(Pa,{className:re("w-5 h-5 transition-colors",h==="desc"?"text-indigo-400":"text-slate-500")}),e.jsx(we,{type:"text",placeholder:r==="ar"?"Ø¹Ù† Ù…Ø§Ø°Ø§ ØªØ¯ÙˆØ± Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŸ":"What's this group about?",value:p,onChange:v=>u(v.target.value),onFocus:()=>y("desc"),onBlur:()=>y(null),className:"bg-transparent border-none text-white placeholder:text-slate-600 h-14 focus-visible:ring-0 focus-visible:ring-offset-0"})]})]})]})]}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(fe,{onClick:b,disabled:c||!n.trim()||!o.trim(),className:"w-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white h-14 text-lg font-semibold rounded-xl shadow-lg shadow-indigo-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:c?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-5 h-5 mr-2 animate-spin"}),r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©...":"Creating Group..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"w-5 h-5 mr-2"}),r==="ar"?"Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©":"Create Group"]})})})]})})]})}function Li(){const[t,a]=m.useState(()=>localStorage.getItem("chat_app_language")||"en"),[r,s]=m.useState(()=>localStorage.getItem("chat_app_theme")==="dark"),[n,i]=m.useState(()=>localStorage.getItem("chat_app_view")||"chatList");m.useEffect(()=>{localStorage.setItem("chat_app_view",n)},[n]);const[o,d]=m.useState(!1),[p,u]=m.useState(()=>localStorage.getItem("chat_app_sound_enabled")!=="false"),[c,l]=m.useState(!1),[h,y]=m.useState(!1),[b,v]=m.useState(()=>localStorage.getItem("chat_app_sound_id")||Ve[0].id),[C,T]=m.useState([]),[P,E]=m.useState([]),[R,G]=m.useState(null),[W,g]=m.useState(null),f=m.useRef(null),k=m.useRef(null),I=m.useRef(null);console.log("ðŸ”— Initializing hooks...");const{currentUser:x,isLoading:S,logout:j}=un();console.log("ðŸ‘¤ Auth State:",{currentUser:x==null?void 0:x.id,authLoading:S});const{chats:N,isLoading:F,selectedChat:_,messages:B,loadChats:w,loadMessages:U,handleSelectChat:te,handleSendMessage:Y,handleDeleteMessage:Q,handlePinChat:M,handleSendPoll:K,handleIncomingMessage:H,handleIncomingUpdate:O,sendMessageToChat:J}=mn(x),ne=m.useCallback(z=>{k.current=z,te(z)},[te]);m.useEffect(()=>{k.current=_},[_]);const{activeCall:ee,handleStartCall:pe,handleAcceptCall:Pe,handleRejectCall:Ne,handleIncomingCall:lt,handleCallAnswer:Ie,handleIceCandidate:ct,handleCallEnded:Qe}=pn({currentUser:x,soundEnabled:p}),Ce=m.useMemo(()=>x?{id:x.id,name:x.name||x.username,username:x.username}:null,[x]),{onlineUsers:Ye,typingUsers:ge,sendTypingIndicator:Ze,sendSignalingMessage:dt}=fn({currentUser:Ce,selectedChatRef:k,onNewMessage:H,onUpdateMessage:O,onReloadChats:m.useCallback(()=>{x&&w(x.id)},[x,w]),soundEnabled:p,onIncomingCall:lt,onCallAnswer:Ie,onIceCandidate:ct,onCallEnded:Qe}),ce=m.useCallback(z=>La[t][z]||z,[t]);m.useEffect(()=>{const z=setTimeout(()=>d(!1),2500);return()=>clearTimeout(z)},[]),m.useEffect(()=>{r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("chat_app_theme",r?"dark":"light")},[r]),m.useEffect(()=>{"Notification"in window&&y(Notification.permission==="granted"),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"microphone"}).then(z=>{l(z.state==="granted"),z.onchange=()=>l(z.state==="granted")}).catch(()=>{})},[]),m.useEffect(()=>{const z=()=>{document.removeEventListener("click",z)};return document.addEventListener("click",z),()=>document.removeEventListener("click",z)},[]),m.useEffect(()=>{const z=Ve.find(A=>A.id===b)||Ve[0];f.current=new Audio(z.url),localStorage.setItem("chat_app_sound_id",b)},[b]),m.useEffect(()=>{localStorage.setItem("chat_app_sound_enabled",String(p))},[p]);const be=m.useCallback(async()=>{if(!x)return;const{data:z}=await X.from("chat_requests").select("*, profiles:sender_id(username, display_name, avatar_url)").eq("receiver_id",x.id).eq("status","pending");z&&T(A=>JSON.stringify(A)!==JSON.stringify(z)?z:A)},[x==null?void 0:x.id]),Me=m.useCallback(async()=>{if(!x)return;const{data:z}=await X.from("statuses").select("*, profiles:user_id(id, display_name, avatar_url)").gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});z&&E(A=>JSON.stringify(A)!==JSON.stringify(z)?z:A)},[x==null?void 0:x.id]);m.useEffect(()=>{if(x){console.log("ðŸ”„ Running global data fetch for user:",x.id),be(),Me();const z=X.channel(`app - global - ${x.id} `).on("postgres_changes",{event:"*",schema:"public",table:"chat_requests",filter:`receiver_id = eq.${x.id} `},be).on("postgres_changes",{event:"*",schema:"public",table:"statuses"},Me).subscribe(A=>console.log("ðŸ“¡ Global channel status:",A));return()=>{console.log("ðŸ”Œ Cleaning up global channel"),X.removeChannel(z)}}},[x==null?void 0:x.id,be,Me]);const et=m.useCallback((z,A)=>{Ze(z,A)},[Ze]),Fe=m.useCallback(async(z,A)=>{if(!k.current||!x)return;const se=k.current;try{const le=`voice_${Date.now()}.webm`,ie=new File([z],le,{type:z.type}),de=new FormData;de.append("file",ie),de.append("userId",x.id);const me=await(await fetch(`https://${Bt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${qt}`},body:de})).json();if(me.error)throw new Error(me.error);await J(se,"ðŸŽ¤ Voice Message",me.fileUrl,"audio",le),Z.success(t==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØµÙˆØªÙŠØ©":"Voice message sent")}catch(le){console.error("Voice send error:",le),Z.error(t==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØª":"Failed to send voice")}},[x,t,J]),ut=m.useCallback(async(z,A)=>{if(!x||!k.current)return;const le=k.current.isGroup?"group_messages":"messages";try{const{data:ie}=await X.from(le).select("reactions").eq("id",z).single(),de=(ie==null?void 0:ie.reactions)||{},oe=de[A]||[];oe.includes(x.id)?(de[A]=oe.filter(me=>me!==x.id),de[A].length===0&&delete de[A]):de[A]=[...oe,x.id],await X.from(le).update({reactions:de}).eq("id",z)}catch(ie){console.error("Reaction error:",ie)}},[x]),$e=m.useCallback(async(z,A)=>{if(!x||!k.current)return;const le=k.current.isGroup?"group_messages":"messages";try{const{data:ie}=await X.from(le).select("poll").eq("id",z).single();if(!(ie!=null&&ie.poll))return;const de={...ie.poll};de.votes=de.votes||{},Object.keys(de.votes).forEach(oe=>{de.votes[oe]=(de.votes[oe]||[]).filter(me=>me!==x.id)}),de.votes[A]=[...de.votes[A]||[],x.id],await X.from(le).update({poll:de}).eq("id",z)}catch(ie){console.error("Vote error:",ie)}},[x]),$=m.useCallback(()=>{i("chatList")},[]),ue=m.useCallback(z=>{k.current&&Q(z,k.current.isGroup)},[Q]),Ae=m.useCallback(()=>{k.current&&U(k.current.id,k.current.isGroup)},[U]),_e=m.useCallback(z=>{k.current&&et(z,k.current.partnerId)},[et]),Ge=m.useCallback(()=>{Z.info(t==="ar"?"Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©":"Coming Soon: Clear Chat")},[t]),mt=async(z,A)=>{if(!x)return;let se=null;const le=P.find(oe=>oe.id===A);if(le&&(se=le.user_id),!se&&R&&R.items){const oe=R.items.find(me=>me.id===A);oe&&(se=oe.user_id)}if(!se){Z.error("Could not find status owner");return}const ie=N.find(oe=>oe.partnerId===se),de=`Replied to story: ${z} `;ie?(await J(ie,de),Z.success(t==="ar"?"ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­":"Reply sent"),G(null)):Z.error("You must have a chat with this user to reply")},Be=async z=>{var le;const A=(le=z.target.files)==null?void 0:le[0];if(!A||!x)return;if(!A.type.startsWith("image/")&&!A.type.startsWith("video/")){Z.error(t==="ar"?"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ":"Please select an image or video");return}const se=Z.custom(ie=>e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-2xl p-4 w-[300px] shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(je,{className:"w-5 h-5 animate-spin text-brand"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ø³ØªÙˆØ±ÙŠ...":"Uploading story..."})]}),e.jsx("div",{className:"h-1.5 bg-white/10 rounded-full overflow-hidden",children:e.jsx(D.div,{initial:{width:"0%"},animate:{width:"90%"},transition:{duration:2,ease:"easeInOut"},className:"h-full bg-brand"})})]}),{duration:1/0});try{const ie=new FormData;ie.append("file",A),ie.append("userId",x.id);const oe=await(await fetch(`https://${Bt}.supabase.co/functions/v1/make-server-f2fe46ac/upload`,{method:"POST",headers:{Authorization:`Bearer ${qt}`},body:ie})).json();if(oe.error)throw new Error(oe.error);const me=new Date;me.setDate(me.getDate()+1);const tt=oe.fileType.startsWith("video/")?"video":"image",{error:ve}=await X.from("statuses").insert({user_id:x.id,content_url:oe.fileUrl,content_type:tt,text:"",expires_at:me.toISOString()});if(ve)throw ve;Z.dismiss(se),Z.custom(()=>e.jsxs("div",{className:"bg-green-500/10 border border-green-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-500 rounded-full p-1",children:e.jsx(Le,{className:"w-4 h-4 text-black"})}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­":"Story uploaded successfully"})]}),{duration:3e3}),Me()}catch(ie){console.error("Story upload error:",ie),Z.dismiss(se),Z.custom(()=>e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 rounded-2xl p-4 w-[300px] shadow-2xl flex items-center gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-white text-sm font-medium",children:t==="ar"?"ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹":"Upload failed"})]}),{duration:4e3})}finally{I.current&&(I.current.value="")}},pt=z=>{_&&pe(_.partnerId,_.partnerName,z)},ft=async(z,A)=>{if(x)try{await X.from("chat_requests").update({status:"accepted"}).eq("id",z);const{data:se}=await X.from("conversations").insert({}).select().single();se&&(await X.from("conversation_participants").insert([{conversation_id:se.id,user_id:x.id},{conversation_id:se.id,user_id:A}]),Z.success("Request accepted"),be(),w(x.id))}catch{Z.error("Failed to accept")}},Te=async z=>{await X.from("chat_requests").update({status:"rejected"}).eq("id",z),Z.success("Request rejected"),be()},Se=async z=>{if(x)try{const{error:A}=await X.from("statuses").delete().eq("id",z).eq("user_id",x.id);if(A)throw A;Z.success(t==="ar"?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Story deleted"),G(null),Me()}catch(A){console.error("Error deleting status:",A),Z.error(t==="ar"?"ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø³ØªÙˆØ±ÙŠ":"Failed to delete story")}},Ut=async(z,A)=>{if(i(z),typeof A=="string"){g(null);const{data:se}=await X.from("profiles").select("*").eq("id",A).single();se&&g(se)}else g(A||null)},Nt=async()=>{const z=await jt.requestNotificationPermission(ce);y(z),z&&Z.success(ce("notifications")+" "+ce("success"))},Ct=async()=>{const z=await jt.requestMicPermission();l(z),z?Z.success("Microphone enabled"):Z.error("Microphone access denied")};return S||o?e.jsx("div",{className:"w-full h-screen bg-[#111b21] flex flex-col items-center justify-center",children:e.jsx(wi,{onFinish:()=>d(!1),language:t})}):x?e.jsx(m.Suspense,{fallback:e.jsx("div",{className:"h-screen bg-[#111b21] flex items-center justify-center",children:e.jsx(je,{className:"w-8 h-8 animate-spin text-green-500"})}),children:e.jsx(ni,{children:e.jsxs("div",{className:"flex h-screen bg-[#111b21] relative overflow-hidden font-outfit text-white",children:[e.jsx(kr,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx("input",{type:"file",ref:I,className:"hidden",accept:"image/*,video/*",onChange:Be}),ee&&ee.status==="ringing"&&ee.callerId!==x.id&&e.jsx(ji,{callerName:ee.callerName,type:ee.type,onAccept:Pe,onReject:Ne,language:t}),ee&&(ee.status==="connected"||ee.status==="connecting"||ee.status==="ringing"&&ee.callerId===x.id)&&e.jsx(Ii,{callId:ee.id,isIncoming:ee.callerId!==x.id,callerName:ee.callerId===x.id?ee.recipientId:ee.callerName,type:ee.type,onEndCall:Ne,currentUserId:x.id,callerId:ee.callerId,recipientId:ee.recipientId,sendSignaling:dt,incomingOffer:ee.offer,remoteAnswer:ee.answer,remoteIceCandidates:ee.iceCandidates||[]}),e.jsx(xe,{children:R&&e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[1000] bg-black",children:e.jsx(Ni,{items:R.items,initialIndex:R.index,onClose:()=>G(null),onReply:mt,onDelete:Se,currentUserId:x.id,language:t})})}),e.jsxs("div",{className:`flex w-full h-full ${n==="chatList"?"":"md:flex"}`,children:[e.jsx("div",{className:`${n==="chatList"?"flex":"hidden md:flex"} w-full md:w-[400px] flex-col h-full border-r border-white/5`,children:e.jsx(ai,{chats:N,currentUser:x,onlineUsers:Ye,onSelectChat:(z,A)=>{const se=N.find(le=>le.partnerId===z);se&&(ne(se),i("chatWindow"))},onNewChat:()=>i("newChat"),onCreateGroup:()=>i("createGroup"),onLogout:j,onSettings:()=>i("settings"),onAcceptRequest:ft,onRejectRequest:Te,pendingRequests:C,typingUsers:ge,onPinChat:M,statuses:P,onViewStatus:(z,A)=>G({items:z,index:A}),onAddStatus:()=>{var z;return(z=I.current)==null?void 0:z.click()},language:t,t:ce,onEnableNotifications:Nt,notificationsEnabled:h,isLoading:F})}),e.jsxs("div",{className:`${n!=="chatList"?"flex":"hidden md:flex"} flex-1 flex-col h-full bg-[#0b141a]`,children:[n==="chatList"&&e.jsx("div",{className:"hidden md:flex items-center justify-center h-full text-gray-500",children:e.jsx("p",{children:"Select a chat to start messaging"})}),n==="chatWindow"&&_&&e.jsx(yi,{currentUserId:x.id,partnerId:_.partnerId,partnerName:_.partnerName,partnerAvatar:_.partnerAvatar,messages:B,isPartnerOnline:Ye.has(_.partnerId),isPartnerTyping:ge[_.partnerId],onBack:$,onSendMessage:Y,onSendVoiceMessage:Fe,onDeleteMessage:ue,onTyping:_e,onRefresh:Ae,onReact:ut,onSendPoll:K,onVote:$e,onStartCall:pt,isGroup:_.isGroup,onShowProfile:z=>Ut("partnerProfile",z),onClearChat:Ge,language:t,t:ce}),n==="settings"&&e.jsx(Mi,{user:x,onBack:()=>i("chatList"),onGoToProfile:()=>i("profile"),onLogout:j,notificationsEnabled:h,onEnableNotifications:Nt,micEnabled:c,onEnableMic:Ct,soundEnabled:p,onToggleSound:u,currentSoundId:b,notificationSounds:Ve,onSelectSound:v,onTestSound:()=>{var z;return(z=f.current)==null?void 0:z.play()},language:t,onLanguageChange:a,t:ce}),n==="newChat"&&e.jsx(Ai,{onBack:()=>i("chatList"),currentUserId:x.id,language:t,t:ce}),n==="createGroup"&&e.jsx(Di,{onBack:()=>{w(x.id),i("chatList")},currentUserId:x.id,language:t,t:ce}),n==="profile"&&e.jsx(Gr,{user:x,onBack:()=>i("settings"),onUpdate:()=>{},language:t,t:ce}),n==="partnerProfile"&&e.jsx(Gr,{user:W,isPublicView:!0,onBack:()=>i("chatWindow"),onStartChat:()=>{i("chatWindow")},language:t,t:ce})]})]})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(kr,{position:"top-center",richColors:!0,theme:"dark"}),e.jsx(Xn,{onLoginSuccess:()=>{},language:t,t:ce})]})}console.log("ðŸš€ main.tsx execution started");"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/firebase-messaging-sw.js").then(t=>{console.log("âœ… ServiceWorker registration successful with scope: ",t.scope)},t=>{console.log("âŒ ServiceWorker registration failed: ",t)})});console.log("ðŸ—ï¸ Creating root and rendering App...");Ma.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(ii,{children:e.jsx(Li,{})})}));console.log("ðŸ main.tsx end of file reached");
